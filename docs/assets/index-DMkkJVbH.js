const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/browserAll-CpTfnsaS.js","assets/webworkerAll-CB3R_CgY.js","assets/colorToUniform-DmtBy-2V.js","assets/WebGPURenderer-uNAiHXuS.js","assets/SharedSystems--r6VEXoT.js","assets/WebGLRenderer-BPoQD2_1.js"])))=>i.map(i=>d[i]);
(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function e(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(n){if(n.ep)return;n.ep=!0;const r=e(n);fetch(n.href,r)}})();const fc="modulepreload",pc=function(s){return"/game.trail.prototype/"+s},Rr={},Ri=function(t,e,i){let n=Promise.resolve();if(e&&e.length>0){document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),a=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));n=Promise.allSettled(e.map(l=>{if(l=pc(l),l in Rr)return;Rr[l]=!0;const c=l.endsWith(".css"),h=c?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${h}`))return;const d=document.createElement("link");if(d.rel=c?"stylesheet":fc,c||(d.as="script"),d.crossOrigin="",d.href=l,a&&d.setAttribute("nonce",a),document.head.appendChild(d),c)return new Promise((u,f)=>{d.addEventListener("load",u),d.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${l}`)))})}))}function r(o){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=o,window.dispatchEvent(a),!a.defaultPrevented)throw o}return n.then(o=>{for(const a of o||[])a.status==="rejected"&&r(a.reason);return t().catch(r)})};var I=(s=>(s.Application="application",s.WebGLPipes="webgl-pipes",s.WebGLPipesAdaptor="webgl-pipes-adaptor",s.WebGLSystem="webgl-system",s.WebGPUPipes="webgpu-pipes",s.WebGPUPipesAdaptor="webgpu-pipes-adaptor",s.WebGPUSystem="webgpu-system",s.CanvasSystem="canvas-system",s.CanvasPipesAdaptor="canvas-pipes-adaptor",s.CanvasPipes="canvas-pipes",s.Asset="asset",s.LoadParser="load-parser",s.ResolveParser="resolve-parser",s.CacheParser="cache-parser",s.DetectionParser="detection-parser",s.MaskEffect="mask-effect",s.BlendMode="blend-mode",s.TextureSource="texture-source",s.Environment="environment",s.ShapeBuilder="shape-builder",s.Batcher="batcher",s))(I||{});const Bn=s=>{if(typeof s=="function"||typeof s=="object"&&s.extension){if(!s.extension)throw new Error("Extension class must have an extension object");s={...typeof s.extension!="object"?{type:s.extension}:s.extension,ref:s}}if(typeof s=="object")s={...s};else throw new Error("Invalid extension type");return typeof s.type=="string"&&(s.type=[s.type]),s},fi=(s,t)=>Bn(s).priority??t,dt={_addHandlers:{},_removeHandlers:{},_queue:{},remove(...s){return s.map(Bn).forEach(t=>{t.type.forEach(e=>{var i,n;return(n=(i=this._removeHandlers)[e])==null?void 0:n.call(i,t)})}),this},add(...s){return s.map(Bn).forEach(t=>{t.type.forEach(e=>{var r,o;const i=this._addHandlers,n=this._queue;i[e]?(o=i[e])==null||o.call(i,t):(n[e]=n[e]||[],(r=n[e])==null||r.push(t))})}),this},handle(s,t,e){var o;const i=this._addHandlers,n=this._removeHandlers;if(i[s]||n[s])throw new Error(`Extension type ${s} already has a handler`);i[s]=t,n[s]=e;const r=this._queue;return r[s]&&((o=r[s])==null||o.forEach(a=>t(a)),delete r[s]),this},handleByMap(s,t){return this.handle(s,e=>{e.name&&(t[e.name]=e.ref)},e=>{e.name&&delete t[e.name]})},handleByNamedList(s,t,e=-1){return this.handle(s,i=>{t.findIndex(r=>r.name===i.name)>=0||(t.push({name:i.name,value:i.ref}),t.sort((r,o)=>fi(o.value,e)-fi(r.value,e)))},i=>{const n=t.findIndex(r=>r.name===i.name);n!==-1&&t.splice(n,1)})},handleByList(s,t,e=-1){return this.handle(s,i=>{t.includes(i.ref)||(t.push(i.ref),t.sort((n,r)=>fi(r,e)-fi(n,e)))},i=>{const n=t.indexOf(i.ref);n!==-1&&t.splice(n,1)})},mixin(s,...t){for(const e of t)Object.defineProperties(s.prototype,Object.getOwnPropertyDescriptors(e))}},mc={extension:{type:I.Environment,name:"browser",priority:-1},test:()=>!0,load:async()=>{await Ri(()=>import("./browserAll-CpTfnsaS.js"),__vite__mapDeps([0,1,2]))}},gc={extension:{type:I.Environment,name:"webworker",priority:0},test:()=>typeof self<"u"&&self.WorkerGlobalScope!==void 0,load:async()=>{await Ri(()=>import("./webworkerAll-CB3R_CgY.js"),__vite__mapDeps([1,2]))}};class lt{constructor(t,e,i){this._x=e||0,this._y=i||0,this._observer=t}clone(t){return new lt(t??this._observer,this._x,this._y)}set(t=0,e=t){return(this._x!==t||this._y!==e)&&(this._x=t,this._y=e,this._observer._onUpdate(this)),this}copyFrom(t){return(this._x!==t.x||this._y!==t.y)&&(this._x=t.x,this._y=t.y,this._observer._onUpdate(this)),this}copyTo(t){return t.set(this._x,this._y),t}equals(t){return t.x===this._x&&t.y===this._y}toString(){return`[pixi.js/math:ObservablePoint x=${this._x} y=${this._y} scope=${this._observer}]`}get x(){return this._x}set x(t){this._x!==t&&(this._x=t,this._observer._onUpdate(this))}get y(){return this._y}set y(t){this._y!==t&&(this._y=t,this._observer._onUpdate(this))}}function ca(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var ha={exports:{}};(function(s){var t=Object.prototype.hasOwnProperty,e="~";function i(){}Object.create&&(i.prototype=Object.create(null),new i().__proto__||(e=!1));function n(l,c,h){this.fn=l,this.context=c,this.once=h||!1}function r(l,c,h,d,u){if(typeof h!="function")throw new TypeError("The listener must be a function");var f=new n(h,d||l,u),m=e?e+c:c;return l._events[m]?l._events[m].fn?l._events[m]=[l._events[m],f]:l._events[m].push(f):(l._events[m]=f,l._eventsCount++),l}function o(l,c){--l._eventsCount===0?l._events=new i:delete l._events[c]}function a(){this._events=new i,this._eventsCount=0}a.prototype.eventNames=function(){var c=[],h,d;if(this._eventsCount===0)return c;for(d in h=this._events)t.call(h,d)&&c.push(e?d.slice(1):d);return Object.getOwnPropertySymbols?c.concat(Object.getOwnPropertySymbols(h)):c},a.prototype.listeners=function(c){var h=e?e+c:c,d=this._events[h];if(!d)return[];if(d.fn)return[d.fn];for(var u=0,f=d.length,m=new Array(f);u<f;u++)m[u]=d[u].fn;return m},a.prototype.listenerCount=function(c){var h=e?e+c:c,d=this._events[h];return d?d.fn?1:d.length:0},a.prototype.emit=function(c,h,d,u,f,m){var x=e?e+c:c;if(!this._events[x])return!1;var p=this._events[x],g=arguments.length,y,b;if(p.fn){switch(p.once&&this.removeListener(c,p.fn,void 0,!0),g){case 1:return p.fn.call(p.context),!0;case 2:return p.fn.call(p.context,h),!0;case 3:return p.fn.call(p.context,h,d),!0;case 4:return p.fn.call(p.context,h,d,u),!0;case 5:return p.fn.call(p.context,h,d,u,f),!0;case 6:return p.fn.call(p.context,h,d,u,f,m),!0}for(b=1,y=new Array(g-1);b<g;b++)y[b-1]=arguments[b];p.fn.apply(p.context,y)}else{var _=p.length,S;for(b=0;b<_;b++)switch(p[b].once&&this.removeListener(c,p[b].fn,void 0,!0),g){case 1:p[b].fn.call(p[b].context);break;case 2:p[b].fn.call(p[b].context,h);break;case 3:p[b].fn.call(p[b].context,h,d);break;case 4:p[b].fn.call(p[b].context,h,d,u);break;default:if(!y)for(S=1,y=new Array(g-1);S<g;S++)y[S-1]=arguments[S];p[b].fn.apply(p[b].context,y)}}return!0},a.prototype.on=function(c,h,d){return r(this,c,h,d,!1)},a.prototype.once=function(c,h,d){return r(this,c,h,d,!0)},a.prototype.removeListener=function(c,h,d,u){var f=e?e+c:c;if(!this._events[f])return this;if(!h)return o(this,f),this;var m=this._events[f];if(m.fn)m.fn===h&&(!u||m.once)&&(!d||m.context===d)&&o(this,f);else{for(var x=0,p=[],g=m.length;x<g;x++)(m[x].fn!==h||u&&!m[x].once||d&&m[x].context!==d)&&p.push(m[x]);p.length?this._events[f]=p.length===1?p[0]:p:o(this,f)}return this},a.prototype.removeAllListeners=function(c){var h;return c?(h=e?e+c:c,this._events[h]&&o(this,h)):(this._events=new i,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=e,a.EventEmitter=a,s.exports=a})(ha);var yc=ha.exports;const Bt=ca(yc),xc=Math.PI*2,bc=180/Math.PI,_c=Math.PI/180;class ut{constructor(t=0,e=0){this.x=0,this.y=0,this.x=t,this.y=e}clone(){return new ut(this.x,this.y)}copyFrom(t){return this.set(t.x,t.y),this}copyTo(t){return t.set(this.x,this.y),t}equals(t){return t.x===this.x&&t.y===this.y}set(t=0,e=t){return this.x=t,this.y=e,this}toString(){return`[pixi.js/math:Point x=${this.x} y=${this.y}]`}static get shared(){return tn.x=0,tn.y=0,tn}}const tn=new ut;class G{constructor(t=1,e=0,i=0,n=1,r=0,o=0){this.array=null,this.a=t,this.b=e,this.c=i,this.d=n,this.tx=r,this.ty=o}fromArray(t){this.a=t[0],this.b=t[1],this.c=t[3],this.d=t[4],this.tx=t[2],this.ty=t[5]}set(t,e,i,n,r,o){return this.a=t,this.b=e,this.c=i,this.d=n,this.tx=r,this.ty=o,this}toArray(t,e){this.array||(this.array=new Float32Array(9));const i=e||this.array;return t?(i[0]=this.a,i[1]=this.b,i[2]=0,i[3]=this.c,i[4]=this.d,i[5]=0,i[6]=this.tx,i[7]=this.ty,i[8]=1):(i[0]=this.a,i[1]=this.c,i[2]=this.tx,i[3]=this.b,i[4]=this.d,i[5]=this.ty,i[6]=0,i[7]=0,i[8]=1),i}apply(t,e){e=e||new ut;const i=t.x,n=t.y;return e.x=this.a*i+this.c*n+this.tx,e.y=this.b*i+this.d*n+this.ty,e}applyInverse(t,e){e=e||new ut;const i=this.a,n=this.b,r=this.c,o=this.d,a=this.tx,l=this.ty,c=1/(i*o+r*-n),h=t.x,d=t.y;return e.x=o*c*h+-r*c*d+(l*r-a*o)*c,e.y=i*c*d+-n*c*h+(-l*i+a*n)*c,e}translate(t,e){return this.tx+=t,this.ty+=e,this}scale(t,e){return this.a*=t,this.d*=e,this.c*=t,this.b*=e,this.tx*=t,this.ty*=e,this}rotate(t){const e=Math.cos(t),i=Math.sin(t),n=this.a,r=this.c,o=this.tx;return this.a=n*e-this.b*i,this.b=n*i+this.b*e,this.c=r*e-this.d*i,this.d=r*i+this.d*e,this.tx=o*e-this.ty*i,this.ty=o*i+this.ty*e,this}append(t){const e=this.a,i=this.b,n=this.c,r=this.d;return this.a=t.a*e+t.b*n,this.b=t.a*i+t.b*r,this.c=t.c*e+t.d*n,this.d=t.c*i+t.d*r,this.tx=t.tx*e+t.ty*n+this.tx,this.ty=t.tx*i+t.ty*r+this.ty,this}appendFrom(t,e){const i=t.a,n=t.b,r=t.c,o=t.d,a=t.tx,l=t.ty,c=e.a,h=e.b,d=e.c,u=e.d;return this.a=i*c+n*d,this.b=i*h+n*u,this.c=r*c+o*d,this.d=r*h+o*u,this.tx=a*c+l*d+e.tx,this.ty=a*h+l*u+e.ty,this}setTransform(t,e,i,n,r,o,a,l,c){return this.a=Math.cos(a+c)*r,this.b=Math.sin(a+c)*r,this.c=-Math.sin(a-l)*o,this.d=Math.cos(a-l)*o,this.tx=t-(i*this.a+n*this.c),this.ty=e-(i*this.b+n*this.d),this}prepend(t){const e=this.tx;if(t.a!==1||t.b!==0||t.c!==0||t.d!==1){const i=this.a,n=this.c;this.a=i*t.a+this.b*t.c,this.b=i*t.b+this.b*t.d,this.c=n*t.a+this.d*t.c,this.d=n*t.b+this.d*t.d}return this.tx=e*t.a+this.ty*t.c+t.tx,this.ty=e*t.b+this.ty*t.d+t.ty,this}decompose(t){const e=this.a,i=this.b,n=this.c,r=this.d,o=t.pivot,a=-Math.atan2(-n,r),l=Math.atan2(i,e),c=Math.abs(a+l);return c<1e-5||Math.abs(xc-c)<1e-5?(t.rotation=l,t.skew.x=t.skew.y=0):(t.rotation=0,t.skew.x=a,t.skew.y=l),t.scale.x=Math.sqrt(e*e+i*i),t.scale.y=Math.sqrt(n*n+r*r),t.position.x=this.tx+(o.x*e+o.y*n),t.position.y=this.ty+(o.x*i+o.y*r),t}invert(){const t=this.a,e=this.b,i=this.c,n=this.d,r=this.tx,o=t*n-e*i;return this.a=n/o,this.b=-e/o,this.c=-i/o,this.d=t/o,this.tx=(i*this.ty-n*r)/o,this.ty=-(t*this.ty-e*r)/o,this}isIdentity(){return this.a===1&&this.b===0&&this.c===0&&this.d===1&&this.tx===0&&this.ty===0}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this}clone(){const t=new G;return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyTo(t){return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyFrom(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this}equals(t){return t.a===this.a&&t.b===this.b&&t.c===this.c&&t.d===this.d&&t.tx===this.tx&&t.ty===this.ty}toString(){return`[pixi.js:Matrix a=${this.a} b=${this.b} c=${this.c} d=${this.d} tx=${this.tx} ty=${this.ty}]`}static get IDENTITY(){return vc.identity()}static get shared(){return wc.identity()}}const wc=new G,vc=new G,Ce=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],Me=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],Te=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],Pe=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],Rn=[],da=[],pi=Math.sign;function Sc(){for(let s=0;s<16;s++){const t=[];Rn.push(t);for(let e=0;e<16;e++){const i=pi(Ce[s]*Ce[e]+Te[s]*Me[e]),n=pi(Me[s]*Ce[e]+Pe[s]*Me[e]),r=pi(Ce[s]*Te[e]+Te[s]*Pe[e]),o=pi(Me[s]*Te[e]+Pe[s]*Pe[e]);for(let a=0;a<16;a++)if(Ce[a]===i&&Me[a]===n&&Te[a]===r&&Pe[a]===o){t.push(a);break}}}for(let s=0;s<16;s++){const t=new G;t.set(Ce[s],Me[s],Te[s],Pe[s],0,0),da.push(t)}}Sc();const U={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:s=>Ce[s],uY:s=>Me[s],vX:s=>Te[s],vY:s=>Pe[s],inv:s=>s&8?s&15:-s&7,add:(s,t)=>Rn[s][t],sub:(s,t)=>Rn[s][U.inv(t)],rotate180:s=>s^4,isVertical:s=>(s&3)===2,byDirection:(s,t)=>Math.abs(s)*2<=Math.abs(t)?t>=0?U.S:U.N:Math.abs(t)*2<=Math.abs(s)?s>0?U.E:U.W:t>0?s>0?U.SE:U.SW:s>0?U.NE:U.NW,matrixAppendRotationInv:(s,t,e=0,i=0)=>{const n=da[U.inv(t)];n.tx=e,n.ty=i,s.append(n)},transformRectCoords:(s,t,e,i)=>{const{x:n,y:r,width:o,height:a}=s,{x:l,y:c,width:h,height:d}=t;return e===U.E?(i.set(n+l,r+c,o,a),i):e===U.S?i.set(h-r-a+l,n+c,a,o):e===U.W?i.set(h-n-o+l,d-r-a+c,o,a):e===U.N?i.set(r+l,d-n-o+c,a,o):i.set(n+l,r+c,o,a)}},mi=[new ut,new ut,new ut,new ut];class X{constructor(t=0,e=0,i=0,n=0){this.type="rectangle",this.x=Number(t),this.y=Number(e),this.width=Number(i),this.height=Number(n)}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}isEmpty(){return this.left===this.right||this.top===this.bottom}static get EMPTY(){return new X(0,0,0,0)}clone(){return new X(this.x,this.y,this.width,this.height)}copyFromBounds(t){return this.x=t.minX,this.y=t.minY,this.width=t.maxX-t.minX,this.height=t.maxY-t.minY,this}copyFrom(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this}copyTo(t){return t.copyFrom(this),t}contains(t,e){return this.width<=0||this.height<=0?!1:t>=this.x&&t<this.x+this.width&&e>=this.y&&e<this.y+this.height}strokeContains(t,e,i,n=.5){const{width:r,height:o}=this;if(r<=0||o<=0)return!1;const a=this.x,l=this.y,c=i*(1-n),h=i-c,d=a-c,u=a+r+c,f=l-c,m=l+o+c,x=a+h,p=a+r-h,g=l+h,y=l+o-h;return t>=d&&t<=u&&e>=f&&e<=m&&!(t>x&&t<p&&e>g&&e<y)}intersects(t,e){if(!e){const C=this.x<t.x?t.x:this.x;if((this.right>t.right?t.right:this.right)<=C)return!1;const A=this.y<t.y?t.y:this.y;return(this.bottom>t.bottom?t.bottom:this.bottom)>A}const i=this.left,n=this.right,r=this.top,o=this.bottom;if(n<=i||o<=r)return!1;const a=mi[0].set(t.left,t.top),l=mi[1].set(t.left,t.bottom),c=mi[2].set(t.right,t.top),h=mi[3].set(t.right,t.bottom);if(c.x<=a.x||l.y<=a.y)return!1;const d=Math.sign(e.a*e.d-e.b*e.c);if(d===0||(e.apply(a,a),e.apply(l,l),e.apply(c,c),e.apply(h,h),Math.max(a.x,l.x,c.x,h.x)<=i||Math.min(a.x,l.x,c.x,h.x)>=n||Math.max(a.y,l.y,c.y,h.y)<=r||Math.min(a.y,l.y,c.y,h.y)>=o))return!1;const u=d*(l.y-a.y),f=d*(a.x-l.x),m=u*i+f*r,x=u*n+f*r,p=u*i+f*o,g=u*n+f*o;if(Math.max(m,x,p,g)<=u*a.x+f*a.y||Math.min(m,x,p,g)>=u*h.x+f*h.y)return!1;const y=d*(a.y-c.y),b=d*(c.x-a.x),_=y*i+b*r,S=y*n+b*r,v=y*i+b*o,w=y*n+b*o;return!(Math.max(_,S,v,w)<=y*a.x+b*a.y||Math.min(_,S,v,w)>=y*h.x+b*h.y)}pad(t=0,e=t){return this.x-=t,this.y-=e,this.width+=t*2,this.height+=e*2,this}fit(t){const e=Math.max(this.x,t.x),i=Math.min(this.x+this.width,t.x+t.width),n=Math.max(this.y,t.y),r=Math.min(this.y+this.height,t.y+t.height);return this.x=e,this.width=Math.max(i-e,0),this.y=n,this.height=Math.max(r-n,0),this}ceil(t=1,e=.001){const i=Math.ceil((this.x+this.width-e)*t)/t,n=Math.ceil((this.y+this.height-e)*t)/t;return this.x=Math.floor((this.x+e)*t)/t,this.y=Math.floor((this.y+e)*t)/t,this.width=i-this.x,this.height=n-this.y,this}scale(t,e=t){return this.x*=t,this.y*=e,this.width*=t,this.height*=e,this}enlarge(t){const e=Math.min(this.x,t.x),i=Math.max(this.x+this.width,t.x+t.width),n=Math.min(this.y,t.y),r=Math.max(this.y+this.height,t.y+t.height);return this.x=e,this.width=i-e,this.y=n,this.height=r-n,this}getBounds(t){return t||(t=new X),t.copyFrom(this),t}containsRect(t){if(this.width<=0||this.height<=0)return!1;const e=t.x,i=t.y,n=t.x+t.width,r=t.y+t.height;return e>=this.x&&e<this.x+this.width&&i>=this.y&&i<this.y+this.height&&n>=this.x&&n<this.x+this.width&&r>=this.y&&r<this.y+this.height}set(t,e,i,n){return this.x=t,this.y=e,this.width=i,this.height=n,this}toString(){return`[pixi.js/math:Rectangle x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`}}const en={default:-1};function Q(s="default"){return en[s]===void 0&&(en[s]=-1),++en[s]}const Fr=new Set,N="8.0.0",kc="8.3.4",Ye={quiet:!1,noColor:!1},z=(s,t,e=3)=>{if(Ye.quiet||Fr.has(t))return;let i=new Error().stack;const n=`${t}
Deprecated since v${s}`,r=typeof console.groupCollapsed=="function"&&!Ye.noColor;typeof i>"u"?console.warn("PixiJS Deprecation Warning: ",n):(i=i.split(`
`).splice(e).join(`
`),r?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",n),console.warn(i),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",n),console.warn(i))),Fr.add(t)};Object.defineProperties(z,{quiet:{get:()=>Ye.quiet,set:s=>{Ye.quiet=s},enumerable:!0,configurable:!1},noColor:{get:()=>Ye.noColor,set:s=>{Ye.noColor=s},enumerable:!0,configurable:!1}});const ua=()=>{};function ss(s){return s+=s===0?1:0,--s,s|=s>>>1,s|=s>>>2,s|=s>>>4,s|=s>>>8,s|=s>>>16,s+1}function zr(s){return!(s&s-1)&&!!s}function fa(s){const t={};for(const e in s)s[e]!==void 0&&(t[e]=s[e]);return t}const Dr=Object.create(null);function Ac(s){const t=Dr[s];return t===void 0&&(Dr[s]=Q("resource")),t}const pa=class ma extends Bt{constructor(t={}){super(),this._resourceType="textureSampler",this._touched=0,this._maxAnisotropy=1,this.destroyed=!1,t={...ma.defaultOptions,...t},this.addressMode=t.addressMode,this.addressModeU=t.addressModeU??this.addressModeU,this.addressModeV=t.addressModeV??this.addressModeV,this.addressModeW=t.addressModeW??this.addressModeW,this.scaleMode=t.scaleMode,this.magFilter=t.magFilter??this.magFilter,this.minFilter=t.minFilter??this.minFilter,this.mipmapFilter=t.mipmapFilter??this.mipmapFilter,this.lodMinClamp=t.lodMinClamp,this.lodMaxClamp=t.lodMaxClamp,this.compare=t.compare,this.maxAnisotropy=t.maxAnisotropy??1}set addressMode(t){this.addressModeU=t,this.addressModeV=t,this.addressModeW=t}get addressMode(){return this.addressModeU}set wrapMode(t){z(N,"TextureStyle.wrapMode is now TextureStyle.addressMode"),this.addressMode=t}get wrapMode(){return this.addressMode}set scaleMode(t){this.magFilter=t,this.minFilter=t,this.mipmapFilter=t}get scaleMode(){return this.magFilter}set maxAnisotropy(t){this._maxAnisotropy=Math.min(t,16),this._maxAnisotropy>1&&(this.scaleMode="linear")}get maxAnisotropy(){return this._maxAnisotropy}get _resourceId(){return this._sharedResourceId||this._generateResourceId()}update(){this.emit("change",this),this._sharedResourceId=null}_generateResourceId(){const t=`${this.addressModeU}-${this.addressModeV}-${this.addressModeW}-${this.magFilter}-${this.minFilter}-${this.mipmapFilter}-${this.lodMinClamp}-${this.lodMaxClamp}-${this.compare}-${this._maxAnisotropy}`;return this._sharedResourceId=Ac(t),this._resourceId}destroy(){this.destroyed=!0,this.emit("destroy",this),this.emit("change",this),this.removeAllListeners()}};pa.defaultOptions={addressMode:"clamp-to-edge",scaleMode:"linear"};let is=pa;const ga=class ya extends Bt{constructor(t={}){super(),this.options=t,this.uid=Q("textureSource"),this._resourceType="textureSource",this._resourceId=Q("resource"),this.uploadMethodId="unknown",this._resolution=1,this.pixelWidth=1,this.pixelHeight=1,this.width=1,this.height=1,this.sampleCount=1,this.mipLevelCount=1,this.autoGenerateMipmaps=!1,this.format="rgba8unorm",this.dimension="2d",this.antialias=!1,this._touched=0,this._batchTick=-1,this._textureBindLocation=-1,t={...ya.defaultOptions,...t},this.label=t.label??"",this.resource=t.resource,this.autoGarbageCollect=t.autoGarbageCollect,this._resolution=t.resolution,t.width?this.pixelWidth=t.width*this._resolution:this.pixelWidth=this.resource?this.resourceWidth??1:1,t.height?this.pixelHeight=t.height*this._resolution:this.pixelHeight=this.resource?this.resourceHeight??1:1,this.width=this.pixelWidth/this._resolution,this.height=this.pixelHeight/this._resolution,this.format=t.format,this.dimension=t.dimensions,this.mipLevelCount=t.mipLevelCount,this.autoGenerateMipmaps=t.autoGenerateMipmaps,this.sampleCount=t.sampleCount,this.antialias=t.antialias,this.alphaMode=t.alphaMode,this.style=new is(fa(t)),this.destroyed=!1,this._refreshPOT()}get source(){return this}get style(){return this._style}set style(t){var e,i;this.style!==t&&((e=this._style)==null||e.off("change",this._onStyleChange,this),this._style=t,(i=this._style)==null||i.on("change",this._onStyleChange,this),this._onStyleChange())}set maxAnisotropy(t){this._style.maxAnisotropy=t}get maxAnisotropy(){return this._style.maxAnisotropy}get addressMode(){return this._style.addressMode}set addressMode(t){this._style.addressMode=t}get repeatMode(){return this._style.addressMode}set repeatMode(t){this._style.addressMode=t}get magFilter(){return this._style.magFilter}set magFilter(t){this._style.magFilter=t}get minFilter(){return this._style.minFilter}set minFilter(t){this._style.minFilter=t}get mipmapFilter(){return this._style.mipmapFilter}set mipmapFilter(t){this._style.mipmapFilter=t}get lodMinClamp(){return this._style.lodMinClamp}set lodMinClamp(t){this._style.lodMinClamp=t}get lodMaxClamp(){return this._style.lodMaxClamp}set lodMaxClamp(t){this._style.lodMaxClamp=t}_onStyleChange(){this.emit("styleChange",this)}update(){if(this.resource){const t=this._resolution;if(this.resize(this.resourceWidth/t,this.resourceHeight/t))return}this.emit("update",this)}destroy(){this.destroyed=!0,this.emit("destroy",this),this.emit("change",this),this._style&&(this._style.destroy(),this._style=null),this.uploadMethodId=null,this.resource=null,this.removeAllListeners()}unload(){this._resourceId=Q("resource"),this.emit("change",this),this.emit("unload",this)}get resourceWidth(){const{resource:t}=this;return t.naturalWidth||t.videoWidth||t.displayWidth||t.width}get resourceHeight(){const{resource:t}=this;return t.naturalHeight||t.videoHeight||t.displayHeight||t.height}get resolution(){return this._resolution}set resolution(t){this._resolution!==t&&(this._resolution=t,this.width=this.pixelWidth/t,this.height=this.pixelHeight/t)}resize(t,e,i){i||(i=this._resolution),t||(t=this.width),e||(e=this.height);const n=Math.round(t*i),r=Math.round(e*i);return this.width=n/i,this.height=r/i,this._resolution=i,this.pixelWidth===n&&this.pixelHeight===r?!1:(this._refreshPOT(),this.pixelWidth=n,this.pixelHeight=r,this.emit("resize",this),this._resourceId=Q("resource"),this.emit("change",this),!0)}updateMipmaps(){this.autoGenerateMipmaps&&this.mipLevelCount>1&&this.emit("updateMipmaps",this)}set wrapMode(t){this._style.wrapMode=t}get wrapMode(){return this._style.wrapMode}set scaleMode(t){this._style.scaleMode=t}get scaleMode(){return this._style.scaleMode}_refreshPOT(){this.isPowerOfTwo=zr(this.pixelWidth)&&zr(this.pixelHeight)}static test(t){throw new Error("Unimplemented")}};ga.defaultOptions={resolution:1,format:"bgra8unorm",alphaMode:"premultiply-alpha-on-upload",dimensions:"2d",mipLevelCount:1,autoGenerateMipmaps:!1,sampleCount:1,antialias:!1,autoGarbageCollect:!1};let Rt=ga;class sr extends Rt{constructor(t){const e=t.resource||new Float32Array(t.width*t.height*4);let i=t.format;i||(e instanceof Float32Array?i="rgba32float":e instanceof Int32Array||e instanceof Uint32Array?i="rgba32uint":e instanceof Int16Array||e instanceof Uint16Array?i="rgba16uint":(e instanceof Int8Array,i="bgra8unorm")),super({...t,resource:e,format:i}),this.uploadMethodId="buffer"}static test(t){return t instanceof Int8Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray||t instanceof Int16Array||t instanceof Uint16Array||t instanceof Int32Array||t instanceof Uint32Array||t instanceof Float32Array}}sr.extension=I.TextureSource;const Gr=new G;class Cc{constructor(t,e){this.mapCoord=new G,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,typeof e>"u"?this.clampMargin=t.width<10?0:.5:this.clampMargin=e,this.isSimple=!1,this.texture=t}get texture(){return this._texture}set texture(t){var e;this.texture!==t&&((e=this._texture)==null||e.removeListener("update",this.update,this),this._texture=t,this._texture.addListener("update",this.update,this),this.update())}multiplyUvs(t,e){e===void 0&&(e=t);const i=this.mapCoord;for(let n=0;n<t.length;n+=2){const r=t[n],o=t[n+1];e[n]=r*i.a+o*i.c+i.tx,e[n+1]=r*i.b+o*i.d+i.ty}return e}update(){const t=this._texture;this._updateID++;const e=t.uvs;this.mapCoord.set(e.x1-e.x0,e.y1-e.y0,e.x3-e.x0,e.y3-e.y0,e.x0,e.y0);const i=t.orig,n=t.trim;n&&(Gr.set(i.width/n.width,0,0,i.height/n.height,-n.x/n.width,-n.y/n.height),this.mapCoord.append(Gr));const r=t.source,o=this.uClampFrame,a=this.clampMargin/r._resolution,l=this.clampOffset/r._resolution;return o[0]=(t.frame.x+a+l)/r.width,o[1]=(t.frame.y+a+l)/r.height,o[2]=(t.frame.x+t.frame.width-a+l)/r.width,o[3]=(t.frame.y+t.frame.height-a+l)/r.height,this.uClampOffset[0]=this.clampOffset/r.pixelWidth,this.uClampOffset[1]=this.clampOffset/r.pixelHeight,this.isSimple=t.frame.width===r.width&&t.frame.height===r.height&&t.rotate===0,!0}}class O extends Bt{constructor({source:t,label:e,frame:i,orig:n,trim:r,defaultAnchor:o,defaultBorders:a,rotate:l,dynamic:c}={}){if(super(),this.uid=Q("texture"),this.uvs={x0:0,y0:0,x1:0,y1:0,x2:0,y2:0,x3:0,y3:0},this.frame=new X,this.noFrame=!1,this.dynamic=!1,this.isTexture=!0,this.label=e,this.source=(t==null?void 0:t.source)??new Rt,this.noFrame=!i,i)this.frame.copyFrom(i);else{const{width:h,height:d}=this._source;this.frame.width=h,this.frame.height=d}this.orig=n||this.frame,this.trim=r,this.rotate=l??0,this.defaultAnchor=o,this.defaultBorders=a,this.destroyed=!1,this.dynamic=c||!1,this.updateUvs()}set source(t){this._source&&this._source.off("resize",this.update,this),this._source=t,t.on("resize",this.update,this),this.emit("update",this)}get source(){return this._source}get textureMatrix(){return this._textureMatrix||(this._textureMatrix=new Cc(this)),this._textureMatrix}get width(){return this.orig.width}get height(){return this.orig.height}updateUvs(){const{uvs:t,frame:e}=this,{width:i,height:n}=this._source,r=e.x/i,o=e.y/n,a=e.width/i,l=e.height/n;let c=this.rotate;if(c){const h=a/2,d=l/2,u=r+h,f=o+d;c=U.add(c,U.NW),t.x0=u+h*U.uX(c),t.y0=f+d*U.uY(c),c=U.add(c,2),t.x1=u+h*U.uX(c),t.y1=f+d*U.uY(c),c=U.add(c,2),t.x2=u+h*U.uX(c),t.y2=f+d*U.uY(c),c=U.add(c,2),t.x3=u+h*U.uX(c),t.y3=f+d*U.uY(c)}else t.x0=r,t.y0=o,t.x1=r+a,t.y1=o,t.x2=r+a,t.y2=o+l,t.x3=r,t.y3=o+l}destroy(t=!1){this._source&&t&&(this._source.destroy(),this._source=null),this._textureMatrix=null,this.destroyed=!0,this.emit("destroy",this),this.removeAllListeners()}update(){this.noFrame&&(this.frame.width=this._source.width,this.frame.height=this._source.height),this.updateUvs(),this.emit("update",this)}get baseTexture(){return z(N,"Texture.baseTexture is now Texture.source"),this._source}}O.EMPTY=new O({label:"EMPTY",source:new Rt({label:"EMPTY"})});O.EMPTY.destroy=ua;O.WHITE=new O({source:new sr({resource:new Uint8Array([255,255,255,255]),width:1,height:1,alphaMode:"premultiply-alpha-on-upload",label:"WHITE"}),label:"WHITE"});O.WHITE.destroy=ua;function Mc(s,t,e){const{width:i,height:n}=e.orig,r=e.trim;if(r){const o=r.width,a=r.height;s.minX=r.x-t._x*i,s.maxX=s.minX+o,s.minY=r.y-t._y*n,s.maxY=s.minY+a}else s.minX=-t._x*i,s.maxX=s.minX+i,s.minY=-t._y*n,s.maxY=s.minY+n}const Or=new G;class It{constructor(t=1/0,e=1/0,i=-1/0,n=-1/0){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.matrix=Or,this.minX=t,this.minY=e,this.maxX=i,this.maxY=n}isEmpty(){return this.minX>this.maxX||this.minY>this.maxY}get rectangle(){this._rectangle||(this._rectangle=new X);const t=this._rectangle;return this.minX>this.maxX||this.minY>this.maxY?(t.x=0,t.y=0,t.width=0,t.height=0):t.copyFromBounds(this),t}clear(){return this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.matrix=Or,this}set(t,e,i,n){this.minX=t,this.minY=e,this.maxX=i,this.maxY=n}addFrame(t,e,i,n,r){r||(r=this.matrix);const o=r.a,a=r.b,l=r.c,c=r.d,h=r.tx,d=r.ty;let u=this.minX,f=this.minY,m=this.maxX,x=this.maxY,p=o*t+l*e+h,g=a*t+c*e+d;p<u&&(u=p),g<f&&(f=g),p>m&&(m=p),g>x&&(x=g),p=o*i+l*e+h,g=a*i+c*e+d,p<u&&(u=p),g<f&&(f=g),p>m&&(m=p),g>x&&(x=g),p=o*t+l*n+h,g=a*t+c*n+d,p<u&&(u=p),g<f&&(f=g),p>m&&(m=p),g>x&&(x=g),p=o*i+l*n+h,g=a*i+c*n+d,p<u&&(u=p),g<f&&(f=g),p>m&&(m=p),g>x&&(x=g),this.minX=u,this.minY=f,this.maxX=m,this.maxY=x}addRect(t,e){this.addFrame(t.x,t.y,t.x+t.width,t.y+t.height,e)}addBounds(t,e){this.addFrame(t.minX,t.minY,t.maxX,t.maxY,e)}addBoundsMask(t){this.minX=this.minX>t.minX?this.minX:t.minX,this.minY=this.minY>t.minY?this.minY:t.minY,this.maxX=this.maxX<t.maxX?this.maxX:t.maxX,this.maxY=this.maxY<t.maxY?this.maxY:t.maxY}applyMatrix(t){const e=this.minX,i=this.minY,n=this.maxX,r=this.maxY,{a:o,b:a,c:l,d:c,tx:h,ty:d}=t;let u=o*e+l*i+h,f=a*e+c*i+d;this.minX=u,this.minY=f,this.maxX=u,this.maxY=f,u=o*n+l*i+h,f=a*n+c*i+d,this.minX=u<this.minX?u:this.minX,this.minY=f<this.minY?f:this.minY,this.maxX=u>this.maxX?u:this.maxX,this.maxY=f>this.maxY?f:this.maxY,u=o*e+l*r+h,f=a*e+c*r+d,this.minX=u<this.minX?u:this.minX,this.minY=f<this.minY?f:this.minY,this.maxX=u>this.maxX?u:this.maxX,this.maxY=f>this.maxY?f:this.maxY,u=o*n+l*r+h,f=a*n+c*r+d,this.minX=u<this.minX?u:this.minX,this.minY=f<this.minY?f:this.minY,this.maxX=u>this.maxX?u:this.maxX,this.maxY=f>this.maxY?f:this.maxY}fit(t){return this.minX<t.left&&(this.minX=t.left),this.maxX>t.right&&(this.maxX=t.right),this.minY<t.top&&(this.minY=t.top),this.maxY>t.bottom&&(this.maxY=t.bottom),this}fitBounds(t,e,i,n){return this.minX<t&&(this.minX=t),this.maxX>e&&(this.maxX=e),this.minY<i&&(this.minY=i),this.maxY>n&&(this.maxY=n),this}pad(t,e=t){return this.minX-=t,this.maxX+=t,this.minY-=e,this.maxY+=e,this}ceil(){return this.minX=Math.floor(this.minX),this.minY=Math.floor(this.minY),this.maxX=Math.ceil(this.maxX),this.maxY=Math.ceil(this.maxY),this}clone(){return new It(this.minX,this.minY,this.maxX,this.maxY)}scale(t,e=t){return this.minX*=t,this.minY*=e,this.maxX*=t,this.maxY*=e,this}get x(){return this.minX}set x(t){const e=this.maxX-this.minX;this.minX=t,this.maxX=t+e}get y(){return this.minY}set y(t){const e=this.maxY-this.minY;this.minY=t,this.maxY=t+e}get width(){return this.maxX-this.minX}set width(t){this.maxX=this.minX+t}get height(){return this.maxY-this.minY}set height(t){this.maxY=this.minY+t}get left(){return this.minX}get right(){return this.maxX}get top(){return this.minY}get bottom(){return this.maxY}get isPositive(){return this.maxX-this.minX>0&&this.maxY-this.minY>0}get isValid(){return this.minX+this.minY!==1/0}addVertexData(t,e,i,n){let r=this.minX,o=this.minY,a=this.maxX,l=this.maxY;n||(n=this.matrix);const c=n.a,h=n.b,d=n.c,u=n.d,f=n.tx,m=n.ty;for(let x=e;x<i;x+=2){const p=t[x],g=t[x+1],y=c*p+d*g+f,b=h*p+u*g+m;r=y<r?y:r,o=b<o?b:o,a=y>a?y:a,l=b>l?b:l}this.minX=r,this.minY=o,this.maxX=a,this.maxY=l}containsPoint(t,e){return this.minX<=t&&this.minY<=e&&this.maxX>=t&&this.maxY>=e}toString(){return`[pixi.js:Bounds minX=${this.minX} minY=${this.minY} maxX=${this.maxX} maxY=${this.maxY} width=${this.width} height=${this.height}]`}copyFrom(t){return this.minX=t.minX,this.minY=t.minY,this.maxX=t.maxX,this.maxY=t.maxY,this}}var Tc={grad:.9,turn:360,rad:360/(2*Math.PI)},Vt=function(s){return typeof s=="string"?s.length>0:typeof s=="number"},nt=function(s,t,e){return t===void 0&&(t=0),e===void 0&&(e=Math.pow(10,t)),Math.round(e*s)/e+0},kt=function(s,t,e){return t===void 0&&(t=0),e===void 0&&(e=1),s>e?e:s>t?s:t},xa=function(s){return(s=isFinite(s)?s%360:0)>0?s:s+360},$r=function(s){return{r:kt(s.r,0,255),g:kt(s.g,0,255),b:kt(s.b,0,255),a:kt(s.a)}},sn=function(s){return{r:nt(s.r),g:nt(s.g),b:nt(s.b),a:nt(s.a,3)}},Pc=/^#([0-9a-f]{3,8})$/i,gi=function(s){var t=s.toString(16);return t.length<2?"0"+t:t},ba=function(s){var t=s.r,e=s.g,i=s.b,n=s.a,r=Math.max(t,e,i),o=r-Math.min(t,e,i),a=o?r===t?(e-i)/o:r===e?2+(i-t)/o:4+(t-e)/o:0;return{h:60*(a<0?a+6:a),s:r?o/r*100:0,v:r/255*100,a:n}},_a=function(s){var t=s.h,e=s.s,i=s.v,n=s.a;t=t/360*6,e/=100,i/=100;var r=Math.floor(t),o=i*(1-e),a=i*(1-(t-r)*e),l=i*(1-(1-t+r)*e),c=r%6;return{r:255*[i,a,o,o,l,i][c],g:255*[l,i,i,a,o,o][c],b:255*[o,o,l,i,i,a][c],a:n}},Wr=function(s){return{h:xa(s.h),s:kt(s.s,0,100),l:kt(s.l,0,100),a:kt(s.a)}},Nr=function(s){return{h:nt(s.h),s:nt(s.s),l:nt(s.l),a:nt(s.a,3)}},Ur=function(s){return _a((e=(t=s).s,{h:t.h,s:(e*=((i=t.l)<50?i:100-i)/100)>0?2*e/(i+e)*100:0,v:i+e,a:t.a}));var t,e,i},Os=function(s){return{h:(t=ba(s)).h,s:(n=(200-(e=t.s))*(i=t.v)/100)>0&&n<200?e*i/100/(n<=100?n:200-n)*100:0,l:n/2,a:t.a};var t,e,i,n},Ec=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Ic=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Lc=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Bc=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Fn={string:[[function(s){var t=Pc.exec(s);return t?(s=t[1]).length<=4?{r:parseInt(s[0]+s[0],16),g:parseInt(s[1]+s[1],16),b:parseInt(s[2]+s[2],16),a:s.length===4?nt(parseInt(s[3]+s[3],16)/255,2):1}:s.length===6||s.length===8?{r:parseInt(s.substr(0,2),16),g:parseInt(s.substr(2,2),16),b:parseInt(s.substr(4,2),16),a:s.length===8?nt(parseInt(s.substr(6,2),16)/255,2):1}:null:null},"hex"],[function(s){var t=Lc.exec(s)||Bc.exec(s);return t?t[2]!==t[4]||t[4]!==t[6]?null:$r({r:Number(t[1])/(t[2]?100/255:1),g:Number(t[3])/(t[4]?100/255:1),b:Number(t[5])/(t[6]?100/255:1),a:t[7]===void 0?1:Number(t[7])/(t[8]?100:1)}):null},"rgb"],[function(s){var t=Ec.exec(s)||Ic.exec(s);if(!t)return null;var e,i,n=Wr({h:(e=t[1],i=t[2],i===void 0&&(i="deg"),Number(e)*(Tc[i]||1)),s:Number(t[3]),l:Number(t[4]),a:t[5]===void 0?1:Number(t[5])/(t[6]?100:1)});return Ur(n)},"hsl"]],object:[[function(s){var t=s.r,e=s.g,i=s.b,n=s.a,r=n===void 0?1:n;return Vt(t)&&Vt(e)&&Vt(i)?$r({r:Number(t),g:Number(e),b:Number(i),a:Number(r)}):null},"rgb"],[function(s){var t=s.h,e=s.s,i=s.l,n=s.a,r=n===void 0?1:n;if(!Vt(t)||!Vt(e)||!Vt(i))return null;var o=Wr({h:Number(t),s:Number(e),l:Number(i),a:Number(r)});return Ur(o)},"hsl"],[function(s){var t=s.h,e=s.s,i=s.v,n=s.a,r=n===void 0?1:n;if(!Vt(t)||!Vt(e)||!Vt(i))return null;var o=function(a){return{h:xa(a.h),s:kt(a.s,0,100),v:kt(a.v,0,100),a:kt(a.a)}}({h:Number(t),s:Number(e),v:Number(i),a:Number(r)});return _a(o)},"hsv"]]},Hr=function(s,t){for(var e=0;e<t.length;e++){var i=t[e][0](s);if(i)return[i,t[e][1]]}return[null,void 0]},Rc=function(s){return typeof s=="string"?Hr(s.trim(),Fn.string):typeof s=="object"&&s!==null?Hr(s,Fn.object):[null,void 0]},nn=function(s,t){var e=Os(s);return{h:e.h,s:kt(e.s+100*t,0,100),l:e.l,a:e.a}},rn=function(s){return(299*s.r+587*s.g+114*s.b)/1e3/255},jr=function(s,t){var e=Os(s);return{h:e.h,s:e.s,l:kt(e.l+100*t,0,100),a:e.a}},zn=function(){function s(t){this.parsed=Rc(t)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return s.prototype.isValid=function(){return this.parsed!==null},s.prototype.brightness=function(){return nt(rn(this.rgba),2)},s.prototype.isDark=function(){return rn(this.rgba)<.5},s.prototype.isLight=function(){return rn(this.rgba)>=.5},s.prototype.toHex=function(){return t=sn(this.rgba),e=t.r,i=t.g,n=t.b,o=(r=t.a)<1?gi(nt(255*r)):"","#"+gi(e)+gi(i)+gi(n)+o;var t,e,i,n,r,o},s.prototype.toRgb=function(){return sn(this.rgba)},s.prototype.toRgbString=function(){return t=sn(this.rgba),e=t.r,i=t.g,n=t.b,(r=t.a)<1?"rgba("+e+", "+i+", "+n+", "+r+")":"rgb("+e+", "+i+", "+n+")";var t,e,i,n,r},s.prototype.toHsl=function(){return Nr(Os(this.rgba))},s.prototype.toHslString=function(){return t=Nr(Os(this.rgba)),e=t.h,i=t.s,n=t.l,(r=t.a)<1?"hsla("+e+", "+i+"%, "+n+"%, "+r+")":"hsl("+e+", "+i+"%, "+n+"%)";var t,e,i,n,r},s.prototype.toHsv=function(){return t=ba(this.rgba),{h:nt(t.h),s:nt(t.s),v:nt(t.v),a:nt(t.a,3)};var t},s.prototype.invert=function(){return Gt({r:255-(t=this.rgba).r,g:255-t.g,b:255-t.b,a:t.a});var t},s.prototype.saturate=function(t){return t===void 0&&(t=.1),Gt(nn(this.rgba,t))},s.prototype.desaturate=function(t){return t===void 0&&(t=.1),Gt(nn(this.rgba,-t))},s.prototype.grayscale=function(){return Gt(nn(this.rgba,-1))},s.prototype.lighten=function(t){return t===void 0&&(t=.1),Gt(jr(this.rgba,t))},s.prototype.darken=function(t){return t===void 0&&(t=.1),Gt(jr(this.rgba,-t))},s.prototype.rotate=function(t){return t===void 0&&(t=15),this.hue(this.hue()+t)},s.prototype.alpha=function(t){return typeof t=="number"?Gt({r:(e=this.rgba).r,g:e.g,b:e.b,a:t}):nt(this.rgba.a,3);var e},s.prototype.hue=function(t){var e=Os(this.rgba);return typeof t=="number"?Gt({h:t,s:e.s,l:e.l,a:e.a}):nt(e.h)},s.prototype.isEqual=function(t){return this.toHex()===Gt(t).toHex()},s}(),Gt=function(s){return s instanceof zn?s:new zn(s)},Yr=[],Fc=function(s){s.forEach(function(t){Yr.indexOf(t)<0&&(t(zn,Fn),Yr.push(t))})};function zc(s,t){var e={white:"#ffffff",bisque:"#ffe4c4",blue:"#0000ff",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",antiquewhite:"#faebd7",aqua:"#00ffff",azure:"#f0ffff",whitesmoke:"#f5f5f5",papayawhip:"#ffefd5",plum:"#dda0dd",blanchedalmond:"#ffebcd",black:"#000000",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",cornsilk:"#fff8dc",cornflowerblue:"#6495ed",burlywood:"#deb887",aquamarine:"#7fffd4",beige:"#f5f5dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkkhaki:"#bdb76b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",peachpuff:"#ffdab9",darkmagenta:"#8b008b",darkred:"#8b0000",darkorchid:"#9932cc",darkorange:"#ff8c00",darkslateblue:"#483d8b",gray:"#808080",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",deeppink:"#ff1493",deepskyblue:"#00bfff",wheat:"#f5deb3",firebrick:"#b22222",floralwhite:"#fffaf0",ghostwhite:"#f8f8ff",darkviolet:"#9400d3",magenta:"#ff00ff",green:"#008000",dodgerblue:"#1e90ff",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",blueviolet:"#8a2be2",forestgreen:"#228b22",lawngreen:"#7cfc00",indianred:"#cd5c5c",indigo:"#4b0082",fuchsia:"#ff00ff",brown:"#a52a2a",maroon:"#800000",mediumblue:"#0000cd",lightcoral:"#f08080",darkturquoise:"#00ced1",lightcyan:"#e0ffff",ivory:"#fffff0",lightyellow:"#ffffe0",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",linen:"#faf0e6",mediumaquamarine:"#66cdaa",lemonchiffon:"#fffacd",lime:"#00ff00",khaki:"#f0e68c",mediumseagreen:"#3cb371",limegreen:"#32cd32",mediumspringgreen:"#00fa9a",lightskyblue:"#87cefa",lightblue:"#add8e6",midnightblue:"#191970",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",mintcream:"#f5fffa",lightslategray:"#778899",lightslategrey:"#778899",navajowhite:"#ffdead",navy:"#000080",mediumvioletred:"#c71585",powderblue:"#b0e0e6",palegoldenrod:"#eee8aa",oldlace:"#fdf5e6",paleturquoise:"#afeeee",mediumturquoise:"#48d1cc",mediumorchid:"#ba55d3",rebeccapurple:"#663399",lightsteelblue:"#b0c4de",mediumslateblue:"#7b68ee",thistle:"#d8bfd8",tan:"#d2b48c",orchid:"#da70d6",mediumpurple:"#9370db",purple:"#800080",pink:"#ffc0cb",skyblue:"#87ceeb",springgreen:"#00ff7f",palegreen:"#98fb98",red:"#ff0000",yellow:"#ffff00",slateblue:"#6a5acd",lavenderblush:"#fff0f5",peru:"#cd853f",palevioletred:"#db7093",violet:"#ee82ee",teal:"#008080",slategray:"#708090",slategrey:"#708090",aliceblue:"#f0f8ff",darkseagreen:"#8fbc8f",darkolivegreen:"#556b2f",greenyellow:"#adff2f",seagreen:"#2e8b57",seashell:"#fff5ee",tomato:"#ff6347",silver:"#c0c0c0",sienna:"#a0522d",lavender:"#e6e6fa",lightgreen:"#90ee90",orange:"#ffa500",orangered:"#ff4500",steelblue:"#4682b4",royalblue:"#4169e1",turquoise:"#40e0d0",yellowgreen:"#9acd32",salmon:"#fa8072",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",darksalmon:"#e9967a",lightgoldenrodyellow:"#fafad2",snow:"#fffafa",lightgrey:"#d3d3d3",lightgray:"#d3d3d3",dimgray:"#696969",dimgrey:"#696969",olivedrab:"#6b8e23",olive:"#808000"},i={};for(var n in e)i[e[n]]=n;var r={};s.prototype.toName=function(o){if(!(this.rgba.a||this.rgba.r||this.rgba.g||this.rgba.b))return"transparent";var a,l,c=i[this.toHex()];if(c)return c;if(o!=null&&o.closest){var h=this.toRgb(),d=1/0,u="black";if(!r.length)for(var f in e)r[f]=new s(e[f]).toRgb();for(var m in e){var x=(a=h,l=r[m],Math.pow(a.r-l.r,2)+Math.pow(a.g-l.g,2)+Math.pow(a.b-l.b,2));x<d&&(d=x,u=m)}return u}},t.string.push([function(o){var a=o.toLowerCase(),l=a==="transparent"?"#0000":e[a];return l?new s(l).toRgb():null},"name"])}Fc([zc]);const ns=class Fs{constructor(t=16777215){this._value=null,this._components=new Float32Array(4),this._components.fill(1),this._int=16777215,this.value=t}get red(){return this._components[0]}get green(){return this._components[1]}get blue(){return this._components[2]}get alpha(){return this._components[3]}setValue(t){return this.value=t,this}set value(t){if(t instanceof Fs)this._value=this._cloneSource(t._value),this._int=t._int,this._components.set(t._components);else{if(t===null)throw new Error("Cannot set Color#value to null");(this._value===null||!this._isSourceEqual(this._value,t))&&(this._value=this._cloneSource(t),this._normalize(this._value))}}get value(){return this._value}_cloneSource(t){return typeof t=="string"||typeof t=="number"||t instanceof Number||t===null?t:Array.isArray(t)||ArrayBuffer.isView(t)?t.slice(0):typeof t=="object"&&t!==null?{...t}:t}_isSourceEqual(t,e){const i=typeof t;if(i!==typeof e)return!1;if(i==="number"||i==="string"||t instanceof Number)return t===e;if(Array.isArray(t)&&Array.isArray(e)||ArrayBuffer.isView(t)&&ArrayBuffer.isView(e))return t.length!==e.length?!1:t.every((r,o)=>r===e[o]);if(t!==null&&e!==null){const r=Object.keys(t),o=Object.keys(e);return r.length!==o.length?!1:r.every(a=>t[a]===e[a])}return t===e}toRgba(){const[t,e,i,n]=this._components;return{r:t,g:e,b:i,a:n}}toRgb(){const[t,e,i]=this._components;return{r:t,g:e,b:i}}toRgbaString(){const[t,e,i]=this.toUint8RgbArray();return`rgba(${t},${e},${i},${this.alpha})`}toUint8RgbArray(t){const[e,i,n]=this._components;return this._arrayRgb||(this._arrayRgb=[]),t||(t=this._arrayRgb),t[0]=Math.round(e*255),t[1]=Math.round(i*255),t[2]=Math.round(n*255),t}toArray(t){this._arrayRgba||(this._arrayRgba=[]),t||(t=this._arrayRgba);const[e,i,n,r]=this._components;return t[0]=e,t[1]=i,t[2]=n,t[3]=r,t}toRgbArray(t){this._arrayRgb||(this._arrayRgb=[]),t||(t=this._arrayRgb);const[e,i,n]=this._components;return t[0]=e,t[1]=i,t[2]=n,t}toNumber(){return this._int}toBgrNumber(){const[t,e,i]=this.toUint8RgbArray();return(i<<16)+(e<<8)+t}toLittleEndianNumber(){const t=this._int;return(t>>16)+(t&65280)+((t&255)<<16)}multiply(t){const[e,i,n,r]=Fs._temp.setValue(t)._components;return this._components[0]*=e,this._components[1]*=i,this._components[2]*=n,this._components[3]*=r,this._refreshInt(),this._value=null,this}premultiply(t,e=!0){return e&&(this._components[0]*=t,this._components[1]*=t,this._components[2]*=t),this._components[3]=t,this._refreshInt(),this._value=null,this}toPremultiplied(t,e=!0){if(t===1)return(255<<24)+this._int;if(t===0)return e?0:this._int;let i=this._int>>16&255,n=this._int>>8&255,r=this._int&255;return e&&(i=i*t+.5|0,n=n*t+.5|0,r=r*t+.5|0),(t*255<<24)+(i<<16)+(n<<8)+r}toHex(){const t=this._int.toString(16);return`#${"000000".substring(0,6-t.length)+t}`}toHexa(){const e=Math.round(this._components[3]*255).toString(16);return this.toHex()+"00".substring(0,2-e.length)+e}setAlpha(t){return this._components[3]=this._clamp(t),this}_normalize(t){let e,i,n,r;if((typeof t=="number"||t instanceof Number)&&t>=0&&t<=16777215){const o=t;e=(o>>16&255)/255,i=(o>>8&255)/255,n=(o&255)/255,r=1}else if((Array.isArray(t)||t instanceof Float32Array)&&t.length>=3&&t.length<=4)t=this._clamp(t),[e,i,n,r=1]=t;else if((t instanceof Uint8Array||t instanceof Uint8ClampedArray)&&t.length>=3&&t.length<=4)t=this._clamp(t,0,255),[e,i,n,r=255]=t,e/=255,i/=255,n/=255,r/=255;else if(typeof t=="string"||typeof t=="object"){if(typeof t=="string"){const a=Fs.HEX_PATTERN.exec(t);a&&(t=`#${a[2]}`)}const o=Gt(t);o.isValid()&&({r:e,g:i,b:n,a:r}=o.rgba,e/=255,i/=255,n/=255)}if(e!==void 0)this._components[0]=e,this._components[1]=i,this._components[2]=n,this._components[3]=r,this._refreshInt();else throw new Error(`Unable to convert color ${t}`)}_refreshInt(){this._clamp(this._components);const[t,e,i]=this._components;this._int=(t*255<<16)+(e*255<<8)+(i*255|0)}_clamp(t,e=0,i=1){return typeof t=="number"?Math.min(Math.max(t,e),i):(t.forEach((n,r)=>{t[r]=Math.min(Math.max(n,e),i)}),t)}static isColorLike(t){return typeof t=="number"||typeof t=="string"||t instanceof Number||t instanceof Fs||Array.isArray(t)||t instanceof Uint8Array||t instanceof Uint8ClampedArray||t instanceof Float32Array||t.r!==void 0&&t.g!==void 0&&t.b!==void 0||t.r!==void 0&&t.g!==void 0&&t.b!==void 0&&t.a!==void 0||t.h!==void 0&&t.s!==void 0&&t.l!==void 0||t.h!==void 0&&t.s!==void 0&&t.l!==void 0&&t.a!==void 0||t.h!==void 0&&t.s!==void 0&&t.v!==void 0||t.h!==void 0&&t.s!==void 0&&t.v!==void 0&&t.a!==void 0}};ns.shared=new ns;ns._temp=new ns;ns.HEX_PATTERN=/^(#|0x)?(([a-f0-9]{3}){1,2}([a-f0-9]{2})?)$/i;let st=ns;const Dc={cullArea:null,cullable:!1,cullableChildren:!0};let on=0;const Vr=500;function V(...s){on!==Vr&&(on++,on===Vr?console.warn("PixiJS Warning: too many warnings, no more warnings will be reported to the console by PixiJS."):console.warn("PixiJS Warning: ",...s))}const si={_registeredResources:new Set,register(s){this._registeredResources.add(s)},unregister(s){this._registeredResources.delete(s)},release(){this._registeredResources.forEach(s=>s.clear())},get registeredCount(){return this._registeredResources.size},isRegistered(s){return this._registeredResources.has(s)},reset(){this._registeredResources.clear()}};class Gc{constructor(t,e){this._pool=[],this._count=0,this._index=0,this._classType=t,e&&this.prepopulate(e)}prepopulate(t){for(let e=0;e<t;e++)this._pool[this._index++]=new this._classType;this._count+=t}get(t){var i;let e;return this._index>0?e=this._pool[--this._index]:e=new this._classType,(i=e.init)==null||i.call(e,t),e}return(t){var e;(e=t.reset)==null||e.call(t),this._pool[this._index++]=t}get totalSize(){return this._count}get totalFree(){return this._index}get totalUsed(){return this._count-this._index}clear(){if(this._pool.length>0&&this._pool[0].destroy)for(let t=0;t<this._index;t++)this._pool[t].destroy();this._pool.length=0,this._count=0,this._index=0}}class Oc{constructor(){this._poolsByClass=new Map}prepopulate(t,e){this.getPool(t).prepopulate(e)}get(t,e){return this.getPool(t).get(e)}return(t){this.getPool(t.constructor).return(t)}getPool(t){return this._poolsByClass.has(t)||this._poolsByClass.set(t,new Gc(t)),this._poolsByClass.get(t)}stats(){const t={};return this._poolsByClass.forEach(e=>{const i=t[e._classType.name]?e._classType.name+e._classType.ID:e._classType.name;t[i]={free:e.totalFree,used:e.totalUsed,size:e.totalSize}}),t}clear(){this._poolsByClass.forEach(t=>t.clear()),this._poolsByClass.clear()}}const At=new Oc;si.register(At);const $c={get isCachedAsTexture(){var s;return!!((s=this.renderGroup)!=null&&s.isCachedAsTexture)},cacheAsTexture(s){typeof s=="boolean"&&s===!1?this.disableRenderGroup():(this.enableRenderGroup(),this.renderGroup.enableCacheAsTexture(s===!0?{}:s))},updateCacheTexture(){var s;(s=this.renderGroup)==null||s.updateCacheTexture()},get cacheAsBitmap(){return this.isCachedAsTexture},set cacheAsBitmap(s){z("v8.6.0","cacheAsBitmap is deprecated, use cacheAsTexture instead."),this.cacheAsTexture(s)}};function Wc(s,t,e){const i=s.length;let n;if(t>=i||e===0)return;e=t+e>i?i-t:e;const r=i-e;for(n=t;n<r;++n)s[n]=s[n+e];s.length=r}const Nc={allowChildren:!0,removeChildren(s=0,t){var r;const e=t??this.children.length,i=e-s,n=[];if(i>0&&i<=e){for(let a=e-1;a>=s;a--){const l=this.children[a];l&&(n.push(l),l.parent=null)}Wc(this.children,s,e);const o=this.renderGroup||this.parentRenderGroup;o&&o.removeChildren(n);for(let a=0;a<n.length;++a){const l=n[a];(r=l.parentRenderLayer)==null||r.detach(l),this.emit("childRemoved",l,this,a),n[a].emit("removed",this)}return n.length>0&&this._didViewChangeTick++,n}else if(i===0&&this.children.length===0)return n;throw new RangeError("removeChildren: numeric values are outside the acceptable range.")},removeChildAt(s){const t=this.getChildAt(s);return this.removeChild(t)},getChildAt(s){if(s<0||s>=this.children.length)throw new Error(`getChildAt: Index (${s}) does not exist.`);return this.children[s]},setChildIndex(s,t){if(t<0||t>=this.children.length)throw new Error(`The index ${t} supplied is out of bounds ${this.children.length}`);this.getChildIndex(s),this.addChildAt(s,t)},getChildIndex(s){const t=this.children.indexOf(s);if(t===-1)throw new Error("The supplied Container must be a child of the caller");return t},addChildAt(s,t){this.allowChildren||z(N,"addChildAt: Only Containers will be allowed to add children in v8.0.0");const{children:e}=this;if(t<0||t>e.length)throw new Error(`${s}addChildAt: The index ${t} supplied is out of bounds ${e.length}`);if(s.parent){const n=s.parent.children.indexOf(s);if(s.parent===this&&n===t)return s;n!==-1&&s.parent.children.splice(n,1)}t===e.length?e.push(s):e.splice(t,0,s),s.parent=this,s.didChange=!0,s._updateFlags=15;const i=this.renderGroup||this.parentRenderGroup;return i&&i.addChild(s),this.sortableChildren&&(this.sortDirty=!0),this.emit("childAdded",s,this,t),s.emit("added",this),s},swapChildren(s,t){if(s===t)return;const e=this.getChildIndex(s),i=this.getChildIndex(t);this.children[e]=t,this.children[i]=s;const n=this.renderGroup||this.parentRenderGroup;n&&(n.structureDidChange=!0),this._didContainerChangeTick++},removeFromParent(){var s;(s=this.parent)==null||s.removeChild(this)},reparentChild(...s){return s.length===1?this.reparentChildAt(s[0],this.children.length):(s.forEach(t=>this.reparentChildAt(t,this.children.length)),s[0])},reparentChildAt(s,t){if(s.parent===this)return this.setChildIndex(s,t),s;const e=s.worldTransform.clone();s.removeFromParent(),this.addChildAt(s,t);const i=this.worldTransform.clone();return i.invert(),e.prepend(i),s.setFromMatrix(e),s},replaceChild(s,t){s.updateLocalTransform(),this.addChildAt(t,this.getChildIndex(s)),t.setFromMatrix(s.localTransform),t.updateLocalTransform(),this.removeChild(s)}},Uc={collectRenderables(s,t,e){this.parentRenderLayer&&this.parentRenderLayer!==e||this.globalDisplayStatus<7||!this.includeInBuild||(this.sortableChildren&&this.sortChildren(),this.isSimple?this.collectRenderablesSimple(s,t,e):this.renderGroup?t.renderPipes.renderGroup.addRenderGroup(this.renderGroup,s):this.collectRenderablesWithEffects(s,t,e))},collectRenderablesSimple(s,t,e){const i=this.children,n=i.length;for(let r=0;r<n;r++)i[r].collectRenderables(s,t,e)},collectRenderablesWithEffects(s,t,e){const{renderPipes:i}=t;for(let n=0;n<this.effects.length;n++){const r=this.effects[n];i[r.pipe].push(r,this,s)}this.collectRenderablesSimple(s,t,e);for(let n=this.effects.length-1;n>=0;n--){const r=this.effects[n];i[r.pipe].pop(r,this,s)}}};class qr{constructor(){this.pipe="filter",this.priority=1}destroy(){for(let t=0;t<this.filters.length;t++)this.filters[t].destroy();this.filters=null,this.filterArea=null}}class Hc{constructor(){this._effectClasses=[],this._tests=[],this._initialized=!1}init(){this._initialized||(this._initialized=!0,this._effectClasses.forEach(t=>{this.add({test:t.test,maskClass:t})}))}add(t){this._tests.push(t)}getMaskEffect(t){this._initialized||this.init();for(let e=0;e<this._tests.length;e++){const i=this._tests[e];if(i.test(t))return At.get(i.maskClass,t)}return t}returnMaskEffect(t){At.return(t)}}const Dn=new Hc;dt.handleByList(I.MaskEffect,Dn._effectClasses);const jc={_maskEffect:null,_maskOptions:{inverse:!1},_filterEffect:null,effects:[],_markStructureAsChanged(){const s=this.renderGroup||this.parentRenderGroup;s&&(s.structureDidChange=!0)},addEffect(s){this.effects.indexOf(s)===-1&&(this.effects.push(s),this.effects.sort((e,i)=>e.priority-i.priority),this._markStructureAsChanged(),this._updateIsSimple())},removeEffect(s){const t=this.effects.indexOf(s);t!==-1&&(this.effects.splice(t,1),this._markStructureAsChanged(),this._updateIsSimple())},set mask(s){const t=this._maskEffect;(t==null?void 0:t.mask)!==s&&(t&&(this.removeEffect(t),Dn.returnMaskEffect(t),this._maskEffect=null),s!=null&&(this._maskEffect=Dn.getMaskEffect(s),this.addEffect(this._maskEffect)))},get mask(){var s;return(s=this._maskEffect)==null?void 0:s.mask},setMask(s){this._maskOptions={...this._maskOptions,...s},s.mask&&(this.mask=s.mask),this._markStructureAsChanged()},set filters(s){var r;!Array.isArray(s)&&s&&(s=[s]);const t=this._filterEffect||(this._filterEffect=new qr);s=s;const e=(s==null?void 0:s.length)>0,i=((r=t.filters)==null?void 0:r.length)>0,n=e!==i;s=Array.isArray(s)?s.slice(0):s,t.filters=Object.freeze(s),n&&(e?this.addEffect(t):(this.removeEffect(t),t.filters=s??null))},get filters(){var s;return(s=this._filterEffect)==null?void 0:s.filters},set filterArea(s){this._filterEffect||(this._filterEffect=new qr),this._filterEffect.filterArea=s},get filterArea(){var s;return(s=this._filterEffect)==null?void 0:s.filterArea}},Yc={label:null,get name(){return z(N,"Container.name property has been removed, use Container.label instead"),this.label},set name(s){z(N,"Container.name property has been removed, use Container.label instead"),this.label=s},getChildByName(s,t=!1){return this.getChildByLabel(s,t)},getChildByLabel(s,t=!1){const e=this.children;for(let i=0;i<e.length;i++){const n=e[i];if(n.label===s||s instanceof RegExp&&s.test(n.label))return n}if(t)for(let i=0;i<e.length;i++){const r=e[i].getChildByLabel(s,!0);if(r)return r}return null},getChildrenByLabel(s,t=!1,e=[]){const i=this.children;for(let n=0;n<i.length;n++){const r=i[n];(r.label===s||s instanceof RegExp&&s.test(r.label))&&e.push(r)}if(t)for(let n=0;n<i.length;n++)i[n].getChildrenByLabel(s,!0,e);return e}},ft=At.getPool(G),Zt=At.getPool(It),Vc=new G,qc={getFastGlobalBounds(s,t){t||(t=new It),t.clear(),this._getGlobalBoundsRecursive(!!s,t,this.parentRenderLayer),t.isValid||t.set(0,0,0,0);const e=this.renderGroup||this.parentRenderGroup;return t.applyMatrix(e.worldTransform),t},_getGlobalBoundsRecursive(s,t,e){let i=t;if(s&&this.parentRenderLayer&&this.parentRenderLayer!==e||this.localDisplayStatus!==7||!this.measurable)return;const n=!!this.effects.length;if((this.renderGroup||n)&&(i=Zt.get().clear()),this.boundsArea)t.addRect(this.boundsArea,this.worldTransform);else{if(this.renderPipeId){const o=this.bounds;i.addFrame(o.minX,o.minY,o.maxX,o.maxY,this.groupTransform)}const r=this.children;for(let o=0;o<r.length;o++)r[o]._getGlobalBoundsRecursive(s,i,e)}if(n){let r=!1;const o=this.renderGroup||this.parentRenderGroup;for(let a=0;a<this.effects.length;a++)this.effects[a].addBounds&&(r||(r=!0,i.applyMatrix(o.worldTransform)),this.effects[a].addBounds(i,!0));r&&i.applyMatrix(o.worldTransform.copyTo(Vc).invert()),t.addBounds(i),Zt.return(i)}else this.renderGroup&&(t.addBounds(i,this.relativeGroupTransform),Zt.return(i))}};function wa(s,t,e){e.clear();let i,n;return s.parent?t?i=s.parent.worldTransform:(n=ft.get().identity(),i=ir(s,n)):i=G.IDENTITY,va(s,e,i,t),n&&ft.return(n),e.isValid||e.set(0,0,0,0),e}function va(s,t,e,i){var a,l;if(!s.visible||!s.measurable)return;let n;i?n=s.worldTransform:(s.updateLocalTransform(),n=ft.get(),n.appendFrom(s.localTransform,e));const r=t,o=!!s.effects.length;if(o&&(t=Zt.get().clear()),s.boundsArea)t.addRect(s.boundsArea,n);else{const c=s.bounds;c&&!c.isEmpty()&&(t.matrix=n,t.addBounds(c));for(let h=0;h<s.children.length;h++)va(s.children[h],t,n,i)}if(o){for(let c=0;c<s.effects.length;c++)(l=(a=s.effects[c]).addBounds)==null||l.call(a,t);r.addBounds(t,G.IDENTITY),Zt.return(t)}i||ft.return(n)}function ir(s,t){const e=s.parent;return e&&(ir(e,t),e.updateLocalTransform(),t.append(e.localTransform)),t}function Sa(s,t){if(s===16777215||!t)return t;if(t===16777215||!s)return s;const e=s>>16&255,i=s>>8&255,n=s&255,r=t>>16&255,o=t>>8&255,a=t&255,l=e*r/255|0,c=i*o/255|0,h=n*a/255|0;return(l<<16)+(c<<8)+h}const Xr=16777215;function Kr(s,t){return s===Xr?t:t===Xr?s:Sa(s,t)}function Ii(s){return((s&255)<<16)+(s&65280)+(s>>16&255)}const Xc={getGlobalAlpha(s){if(s)return this.renderGroup?this.renderGroup.worldAlpha:this.parentRenderGroup?this.parentRenderGroup.worldAlpha*this.alpha:this.alpha;let t=this.alpha,e=this.parent;for(;e;)t*=e.alpha,e=e.parent;return t},getGlobalTransform(s=new G,t){if(t)return s.copyFrom(this.worldTransform);this.updateLocalTransform();const e=ir(this,ft.get().identity());return s.appendFrom(this.localTransform,e),ft.return(e),s},getGlobalTint(s){if(s)return this.renderGroup?Ii(this.renderGroup.worldColor):this.parentRenderGroup?Ii(Kr(this.localColor,this.parentRenderGroup.worldColor)):this.tint;let t=this.localColor,e=this.parent;for(;e;)t=Kr(t,e.localColor),e=e.parent;return Ii(t)}};function ka(s,t,e){return t.clear(),e||(e=G.IDENTITY),Aa(s,t,e,s,!0),t.isValid||t.set(0,0,0,0),t}function Aa(s,t,e,i,n){var l,c;let r;if(n)r=ft.get(),r=e.copyTo(r);else{if(!s.visible||!s.measurable)return;s.updateLocalTransform();const h=s.localTransform;r=ft.get(),r.appendFrom(h,e)}const o=t,a=!!s.effects.length;if(a&&(t=Zt.get().clear()),s.boundsArea)t.addRect(s.boundsArea,r);else{s.renderPipeId&&(t.matrix=r,t.addBounds(s.bounds));const h=s.children;for(let d=0;d<h.length;d++)Aa(h[d],t,r,i,!1)}if(a){for(let h=0;h<s.effects.length;h++)(c=(l=s.effects[h]).addLocalBounds)==null||c.call(l,t,i);o.addBounds(t,G.IDENTITY),Zt.return(t)}ft.return(r)}function Ca(s,t){const e=s.children;for(let i=0;i<e.length;i++){const n=e[i],r=n.uid,o=(n._didViewChangeTick&65535)<<16|n._didContainerChangeTick&65535,a=t.index;(t.data[a]!==r||t.data[a+1]!==o)&&(t.data[t.index]=r,t.data[t.index+1]=o,t.didChange=!0),t.index=a+2,n.children.length&&Ca(n,t)}return t.didChange}const Kc=new G,Zc={_localBoundsCacheId:-1,_localBoundsCacheData:null,_setWidth(s,t){const e=Math.sign(this.scale.x)||1;t!==0?this.scale.x=s/t*e:this.scale.x=e},_setHeight(s,t){const e=Math.sign(this.scale.y)||1;t!==0?this.scale.y=s/t*e:this.scale.y=e},getLocalBounds(){this._localBoundsCacheData||(this._localBoundsCacheData={data:[],index:1,didChange:!1,localBounds:new It});const s=this._localBoundsCacheData;return s.index=1,s.didChange=!1,s.data[0]!==this._didViewChangeTick&&(s.didChange=!0,s.data[0]=this._didViewChangeTick),Ca(this,s),s.didChange&&ka(this,s.localBounds,Kc),s.localBounds},getBounds(s,t){return wa(this,s,t||new It)}},Jc={_onRender:null,set onRender(s){const t=this.renderGroup||this.parentRenderGroup;if(!s){this._onRender&&(t==null||t.removeOnRender(this)),this._onRender=null;return}this._onRender||t==null||t.addOnRender(this),this._onRender=s},get onRender(){return this._onRender}},Qc={_zIndex:0,sortDirty:!1,sortableChildren:!1,get zIndex(){return this._zIndex},set zIndex(s){this._zIndex!==s&&(this._zIndex=s,this.depthOfChildModified())},depthOfChildModified(){this.parent&&(this.parent.sortableChildren=!0,this.parent.sortDirty=!0),this.parentRenderGroup&&(this.parentRenderGroup.structureDidChange=!0)},sortChildren(){this.sortDirty&&(this.sortDirty=!1,this.children.sort(th))}};function th(s,t){return s._zIndex-t._zIndex}const eh={getGlobalPosition(s=new ut,t=!1){return this.parent?this.parent.toGlobal(this._position,s,t):(s.x=this._position.x,s.y=this._position.y),s},toGlobal(s,t,e=!1){const i=this.getGlobalTransform(ft.get(),e);return t=i.apply(s,t),ft.return(i),t},toLocal(s,t,e,i){t&&(s=t.toGlobal(s,e,i));const n=this.getGlobalTransform(ft.get(),i);return e=n.applyInverse(s,e),ft.return(n),e}};class Ma{constructor(){this.uid=Q("instructionSet"),this.instructions=[],this.instructionSize=0,this.renderables=[],this.gcTick=0}reset(){this.instructionSize=0}destroy(){this.instructions.length=0,this.renderables.length=0,this.renderPipes=null,this.gcTick=0}add(t){this.instructions[this.instructionSize++]=t}log(){this.instructions.length=this.instructionSize,console.table(this.instructions,["type","action"])}}let sh=0;class ih{constructor(t){this._poolKeyHash=Object.create(null),this._texturePool={},this.textureOptions=t||{},this.enableFullScreen=!1,this.textureStyle=new is(this.textureOptions)}createTexture(t,e,i){const n=new Rt({...this.textureOptions,width:t,height:e,resolution:1,antialias:i,autoGarbageCollect:!1});return new O({source:n,label:`texturePool_${sh++}`})}getOptimalTexture(t,e,i=1,n){let r=Math.ceil(t*i-1e-6),o=Math.ceil(e*i-1e-6);r=ss(r),o=ss(o);const a=(r<<17)+(o<<1)+(n?1:0);this._texturePool[a]||(this._texturePool[a]=[]);let l=this._texturePool[a].pop();return l||(l=this.createTexture(r,o,n)),l.source._resolution=i,l.source.width=r/i,l.source.height=o/i,l.source.pixelWidth=r,l.source.pixelHeight=o,l.frame.x=0,l.frame.y=0,l.frame.width=t,l.frame.height=e,l.updateUvs(),this._poolKeyHash[l.uid]=a,l}getSameSizeTexture(t,e=!1){const i=t.source;return this.getOptimalTexture(t.width,t.height,i._resolution,e)}returnTexture(t,e=!1){const i=this._poolKeyHash[t.uid];e&&(t.source.style=this.textureStyle),this._texturePool[i].push(t)}clear(t){if(t=t!==!1,t)for(const e in this._texturePool){const i=this._texturePool[e];if(i)for(let n=0;n<i.length;n++)i[n].destroy(!0)}this._texturePool={}}}const Ta=new ih;si.register(Ta);class nh{constructor(){this.renderPipeId="renderGroup",this.root=null,this.canBundle=!1,this.renderGroupParent=null,this.renderGroupChildren=[],this.worldTransform=new G,this.worldColorAlpha=4294967295,this.worldColor=16777215,this.worldAlpha=1,this.childrenToUpdate=Object.create(null),this.updateTick=0,this.gcTick=0,this.childrenRenderablesToUpdate={list:[],index:0},this.structureDidChange=!0,this.instructionSet=new Ma,this._onRenderContainers=[],this.textureNeedsUpdate=!0,this.isCachedAsTexture=!1,this._matrixDirty=7}init(t){this.root=t,t._onRender&&this.addOnRender(t),t.didChange=!0;const e=t.children;for(let i=0;i<e.length;i++){const n=e[i];n._updateFlags=15,this.addChild(n)}}enableCacheAsTexture(t={}){this.textureOptions=t,this.isCachedAsTexture=!0,this.textureNeedsUpdate=!0}disableCacheAsTexture(){this.isCachedAsTexture=!1,this.texture&&(Ta.returnTexture(this.texture,!0),this.texture=null)}updateCacheTexture(){this.textureNeedsUpdate=!0;const t=this._parentCacheAsTextureRenderGroup;t&&!t.textureNeedsUpdate&&t.updateCacheTexture()}reset(){this.renderGroupChildren.length=0;for(const t in this.childrenToUpdate){const e=this.childrenToUpdate[t];e.list.fill(null),e.index=0}this.childrenRenderablesToUpdate.index=0,this.childrenRenderablesToUpdate.list.fill(null),this.root=null,this.updateTick=0,this.structureDidChange=!0,this._onRenderContainers.length=0,this.renderGroupParent=null,this.disableCacheAsTexture()}get localTransform(){return this.root.localTransform}addRenderGroupChild(t){t.renderGroupParent&&t.renderGroupParent._removeRenderGroupChild(t),t.renderGroupParent=this,this.renderGroupChildren.push(t)}_removeRenderGroupChild(t){const e=this.renderGroupChildren.indexOf(t);e>-1&&this.renderGroupChildren.splice(e,1),t.renderGroupParent=null}addChild(t){if(this.structureDidChange=!0,t.parentRenderGroup=this,t.updateTick=-1,t.parent===this.root?t.relativeRenderGroupDepth=1:t.relativeRenderGroupDepth=t.parent.relativeRenderGroupDepth+1,t.didChange=!0,this.onChildUpdate(t),t.renderGroup){this.addRenderGroupChild(t.renderGroup);return}t._onRender&&this.addOnRender(t);const e=t.children;for(let i=0;i<e.length;i++)this.addChild(e[i])}removeChild(t){if(this.structureDidChange=!0,t._onRender&&(t.renderGroup||this.removeOnRender(t)),t.parentRenderGroup=null,t.renderGroup){this._removeRenderGroupChild(t.renderGroup);return}const e=t.children;for(let i=0;i<e.length;i++)this.removeChild(e[i])}removeChildren(t){for(let e=0;e<t.length;e++)this.removeChild(t[e])}onChildUpdate(t){let e=this.childrenToUpdate[t.relativeRenderGroupDepth];e||(e=this.childrenToUpdate[t.relativeRenderGroupDepth]={index:0,list:[]}),e.list[e.index++]=t}updateRenderable(t){t.globalDisplayStatus<7||(this.instructionSet.renderPipes[t.renderPipeId].updateRenderable(t),t.didViewUpdate=!1)}onChildViewUpdate(t){this.childrenRenderablesToUpdate.list[this.childrenRenderablesToUpdate.index++]=t}get isRenderable(){return this.root.localDisplayStatus===7&&this.worldAlpha>0}addOnRender(t){this._onRenderContainers.push(t)}removeOnRender(t){this._onRenderContainers.splice(this._onRenderContainers.indexOf(t),1)}runOnRender(t){for(let e=0;e<this._onRenderContainers.length;e++)this._onRenderContainers[e]._onRender(t)}destroy(){this.disableCacheAsTexture(),this.renderGroupParent=null,this.root=null,this.childrenRenderablesToUpdate=null,this.childrenToUpdate=null,this.renderGroupChildren=null,this._onRenderContainers=null,this.instructionSet=null}getChildren(t=[]){const e=this.root.children;for(let i=0;i<e.length;i++)this._getChildren(e[i],t);return t}_getChildren(t,e=[]){if(e.push(t),t.renderGroup)return e;const i=t.children;for(let n=0;n<i.length;n++)this._getChildren(i[n],e);return e}invalidateMatrices(){this._matrixDirty=7}get inverseWorldTransform(){return this._matrixDirty&1?(this._matrixDirty&=-2,this._inverseWorldTransform||(this._inverseWorldTransform=new G),this._inverseWorldTransform.copyFrom(this.worldTransform).invert()):this._inverseWorldTransform}get textureOffsetInverseTransform(){return this._matrixDirty&2?(this._matrixDirty&=-3,this._textureOffsetInverseTransform||(this._textureOffsetInverseTransform=new G),this._textureOffsetInverseTransform.copyFrom(this.inverseWorldTransform).translate(-this._textureBounds.x,-this._textureBounds.y)):this._textureOffsetInverseTransform}get inverseParentTextureTransform(){if(!(this._matrixDirty&4))return this._inverseParentTextureTransform;this._matrixDirty&=-5;const t=this._parentCacheAsTextureRenderGroup;return t?(this._inverseParentTextureTransform||(this._inverseParentTextureTransform=new G),this._inverseParentTextureTransform.copyFrom(this.worldTransform).prepend(t.inverseWorldTransform).translate(-t._textureBounds.x,-t._textureBounds.y)):this.worldTransform}get cacheToLocalTransform(){return this.isCachedAsTexture?this.textureOffsetInverseTransform:this._parentCacheAsTextureRenderGroup?this._parentCacheAsTextureRenderGroup.textureOffsetInverseTransform:null}}function rh(s,t,e={}){for(const i in t)!e[i]&&t[i]!==void 0&&(s[i]=t[i])}const an=new lt(null),yi=new lt(null),ln=new lt(null,1,1),xi=new lt(null),Zr=1,oh=2,cn=4;class it extends Bt{constructor(t={}){var e,i;super(),this.uid=Q("renderable"),this._updateFlags=15,this.renderGroup=null,this.parentRenderGroup=null,this.parentRenderGroupIndex=0,this.didChange=!1,this.didViewUpdate=!1,this.relativeRenderGroupDepth=0,this.children=[],this.parent=null,this.includeInBuild=!0,this.measurable=!0,this.isSimple=!0,this.updateTick=-1,this.localTransform=new G,this.relativeGroupTransform=new G,this.groupTransform=this.relativeGroupTransform,this.destroyed=!1,this._position=new lt(this,0,0),this._scale=ln,this._pivot=yi,this._origin=xi,this._skew=an,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._rotation=0,this.localColor=16777215,this.localAlpha=1,this.groupAlpha=1,this.groupColor=16777215,this.groupColorAlpha=4294967295,this.localBlendMode="inherit",this.groupBlendMode="normal",this.localDisplayStatus=7,this.globalDisplayStatus=7,this._didContainerChangeTick=0,this._didViewChangeTick=0,this._didLocalTransformChangeId=-1,this.effects=[],rh(this,t,{children:!0,parent:!0,effects:!0}),(e=t.children)==null||e.forEach(n=>this.addChild(n)),(i=t.parent)==null||i.addChild(this)}static mixin(t){z("8.8.0","Container.mixin is deprecated, please use extensions.mixin instead."),dt.mixin(it,t)}set _didChangeId(t){this._didViewChangeTick=t>>12&4095,this._didContainerChangeTick=t&4095}get _didChangeId(){return this._didContainerChangeTick&4095|(this._didViewChangeTick&4095)<<12}addChild(...t){if(this.allowChildren||z(N,"addChild: Only Containers will be allowed to add children in v8.0.0"),t.length>1){for(let n=0;n<t.length;n++)this.addChild(t[n]);return t[0]}const e=t[0],i=this.renderGroup||this.parentRenderGroup;return e.parent===this?(this.children.splice(this.children.indexOf(e),1),this.children.push(e),i&&(i.structureDidChange=!0),e):(e.parent&&e.parent.removeChild(e),this.children.push(e),this.sortableChildren&&(this.sortDirty=!0),e.parent=this,e.didChange=!0,e._updateFlags=15,i&&i.addChild(e),this.emit("childAdded",e,this,this.children.length-1),e.emit("added",this),this._didViewChangeTick++,e._zIndex!==0&&e.depthOfChildModified(),e)}removeChild(...t){if(t.length>1){for(let n=0;n<t.length;n++)this.removeChild(t[n]);return t[0]}const e=t[0],i=this.children.indexOf(e);return i>-1&&(this._didViewChangeTick++,this.children.splice(i,1),this.renderGroup?this.renderGroup.removeChild(e):this.parentRenderGroup&&this.parentRenderGroup.removeChild(e),e.parentRenderLayer&&e.parentRenderLayer.detach(e),e.parent=null,this.emit("childRemoved",e,this,i),e.emit("removed",this)),e}_onUpdate(t){t&&t===this._skew&&this._updateSkew(),this._didContainerChangeTick++,!this.didChange&&(this.didChange=!0,this.parentRenderGroup&&this.parentRenderGroup.onChildUpdate(this))}set isRenderGroup(t){!!this.renderGroup!==t&&(t?this.enableRenderGroup():this.disableRenderGroup())}get isRenderGroup(){return!!this.renderGroup}enableRenderGroup(){if(this.renderGroup)return;const t=this.parentRenderGroup;t==null||t.removeChild(this),this.renderGroup=At.get(nh,this),this.groupTransform=G.IDENTITY,t==null||t.addChild(this),this._updateIsSimple()}disableRenderGroup(){if(!this.renderGroup)return;const t=this.parentRenderGroup;t==null||t.removeChild(this),At.return(this.renderGroup),this.renderGroup=null,this.groupTransform=this.relativeGroupTransform,t==null||t.addChild(this),this._updateIsSimple()}_updateIsSimple(){this.isSimple=!this.renderGroup&&this.effects.length===0}get worldTransform(){return this._worldTransform||(this._worldTransform=new G),this.renderGroup?this._worldTransform.copyFrom(this.renderGroup.worldTransform):this.parentRenderGroup&&this._worldTransform.appendFrom(this.relativeGroupTransform,this.parentRenderGroup.worldTransform),this._worldTransform}get x(){return this._position.x}set x(t){this._position.x=t}get y(){return this._position.y}set y(t){this._position.y=t}get position(){return this._position}set position(t){this._position.copyFrom(t)}get rotation(){return this._rotation}set rotation(t){this._rotation!==t&&(this._rotation=t,this._onUpdate(this._skew))}get angle(){return this.rotation*bc}set angle(t){this.rotation=t*_c}get pivot(){return this._pivot===yi&&(this._pivot=new lt(this,0,0)),this._pivot}set pivot(t){this._pivot===yi&&(this._pivot=new lt(this,0,0),this._origin!==xi&&V("Setting both a pivot and origin on a Container is not recommended. This can lead to unexpected behavior if not handled carefully.")),typeof t=="number"?this._pivot.set(t):this._pivot.copyFrom(t)}get skew(){return this._skew===an&&(this._skew=new lt(this,0,0)),this._skew}set skew(t){this._skew===an&&(this._skew=new lt(this,0,0)),this._skew.copyFrom(t)}get scale(){return this._scale===ln&&(this._scale=new lt(this,1,1)),this._scale}set scale(t){this._scale===ln&&(this._scale=new lt(this,0,0)),typeof t=="string"&&(t=parseFloat(t)),typeof t=="number"?this._scale.set(t):this._scale.copyFrom(t)}get origin(){return this._origin===xi&&(this._origin=new lt(this,0,0)),this._origin}set origin(t){this._origin===xi&&(this._origin=new lt(this,0,0),this._pivot!==yi&&V("Setting both a pivot and origin on a Container is not recommended. This can lead to unexpected behavior if not handled carefully.")),typeof t=="number"?this._origin.set(t):this._origin.copyFrom(t)}get width(){return Math.abs(this.scale.x*this.getLocalBounds().width)}set width(t){const e=this.getLocalBounds().width;this._setWidth(t,e)}get height(){return Math.abs(this.scale.y*this.getLocalBounds().height)}set height(t){const e=this.getLocalBounds().height;this._setHeight(t,e)}getSize(t){t||(t={});const e=this.getLocalBounds();return t.width=Math.abs(this.scale.x*e.width),t.height=Math.abs(this.scale.y*e.height),t}setSize(t,e){const i=this.getLocalBounds();typeof t=="object"?(e=t.height??t.width,t=t.width):e??(e=t),t!==void 0&&this._setWidth(t,i.width),e!==void 0&&this._setHeight(e,i.height)}_updateSkew(){const t=this._rotation,e=this._skew;this._cx=Math.cos(t+e._y),this._sx=Math.sin(t+e._y),this._cy=-Math.sin(t-e._x),this._sy=Math.cos(t-e._x)}updateTransform(t){return this.position.set(typeof t.x=="number"?t.x:this.position.x,typeof t.y=="number"?t.y:this.position.y),this.scale.set(typeof t.scaleX=="number"?t.scaleX||1:this.scale.x,typeof t.scaleY=="number"?t.scaleY||1:this.scale.y),this.rotation=typeof t.rotation=="number"?t.rotation:this.rotation,this.skew.set(typeof t.skewX=="number"?t.skewX:this.skew.x,typeof t.skewY=="number"?t.skewY:this.skew.y),this.pivot.set(typeof t.pivotX=="number"?t.pivotX:this.pivot.x,typeof t.pivotY=="number"?t.pivotY:this.pivot.y),this.origin.set(typeof t.originX=="number"?t.originX:this.origin.x,typeof t.originY=="number"?t.originY:this.origin.y),this}setFromMatrix(t){t.decompose(this)}updateLocalTransform(){const t=this._didContainerChangeTick;if(this._didLocalTransformChangeId===t)return;this._didLocalTransformChangeId=t;const e=this.localTransform,i=this._scale,n=this._pivot,r=this._origin,o=this._position,a=i._x,l=i._y,c=n._x,h=n._y,d=-r._x,u=-r._y;e.a=this._cx*a,e.b=this._sx*a,e.c=this._cy*l,e.d=this._sy*l,e.tx=o._x-(c*e.a+h*e.c)+(d*e.a+u*e.c)-d,e.ty=o._y-(c*e.b+h*e.d)+(d*e.b+u*e.d)-u}set alpha(t){t!==this.localAlpha&&(this.localAlpha=t,this._updateFlags|=Zr,this._onUpdate())}get alpha(){return this.localAlpha}set tint(t){const i=st.shared.setValue(t??16777215).toBgrNumber();i!==this.localColor&&(this.localColor=i,this._updateFlags|=Zr,this._onUpdate())}get tint(){return Ii(this.localColor)}set blendMode(t){this.localBlendMode!==t&&(this.parentRenderGroup&&(this.parentRenderGroup.structureDidChange=!0),this._updateFlags|=oh,this.localBlendMode=t,this._onUpdate())}get blendMode(){return this.localBlendMode}get visible(){return!!(this.localDisplayStatus&2)}set visible(t){const e=t?2:0;(this.localDisplayStatus&2)!==e&&(this.parentRenderGroup&&(this.parentRenderGroup.structureDidChange=!0),this._updateFlags|=cn,this.localDisplayStatus^=2,this._onUpdate())}get culled(){return!(this.localDisplayStatus&4)}set culled(t){const e=t?0:4;(this.localDisplayStatus&4)!==e&&(this.parentRenderGroup&&(this.parentRenderGroup.structureDidChange=!0),this._updateFlags|=cn,this.localDisplayStatus^=4,this._onUpdate())}get renderable(){return!!(this.localDisplayStatus&1)}set renderable(t){const e=t?1:0;(this.localDisplayStatus&1)!==e&&(this._updateFlags|=cn,this.localDisplayStatus^=1,this.parentRenderGroup&&(this.parentRenderGroup.structureDidChange=!0),this._onUpdate())}get isRenderable(){return this.localDisplayStatus===7&&this.groupAlpha>0}destroy(t=!1){var n;if(this.destroyed)return;this.destroyed=!0;let e;if(this.children.length&&(e=this.removeChildren(0,this.children.length)),this.removeFromParent(),this.parent=null,this._maskEffect=null,this._filterEffect=null,this.effects=null,this._position=null,this._scale=null,this._pivot=null,this._origin=null,this._skew=null,this.emit("destroyed",this),this.removeAllListeners(),(typeof t=="boolean"?t:t==null?void 0:t.children)&&e)for(let r=0;r<e.length;++r)e[r].destroy(t);(n=this.renderGroup)==null||n.destroy(),this.renderGroup=null}}dt.mixin(it,Nc,qc,eh,Jc,Zc,jc,Yc,Qc,Dc,$c,Xc,Uc);class nr extends it{constructor(t){super(t),this.canBundle=!0,this.allowChildren=!1,this._roundPixels=0,this._lastUsed=-1,this._gpuData=Object.create(null),this._bounds=new It(0,1,0,0),this._boundsDirty=!0}get bounds(){return this._boundsDirty?(this.updateBounds(),this._boundsDirty=!1,this._bounds):this._bounds}get roundPixels(){return!!this._roundPixels}set roundPixels(t){this._roundPixels=t?1:0}containsPoint(t){const e=this.bounds,{x:i,y:n}=t;return i>=e.minX&&i<=e.maxX&&n>=e.minY&&n<=e.maxY}onViewUpdate(){if(this._didViewChangeTick++,this._boundsDirty=!0,this.didViewUpdate)return;this.didViewUpdate=!0;const t=this.renderGroup||this.parentRenderGroup;t&&t.onChildViewUpdate(this)}destroy(t){var e,i;super.destroy(t),this._bounds=null;for(const n in this._gpuData)(i=(e=this._gpuData[n]).destroy)==null||i.call(e);this._gpuData=null}collectRenderablesSimple(t,e,i){const{renderPipes:n}=e;n.blendMode.pushBlendMode(this,this.groupBlendMode,t),n[this.renderPipeId].addRenderable(this,t),this.didViewUpdate=!1;const o=this.children,a=o.length;for(let l=0;l<a;l++)o[l].collectRenderables(t,e,i);n.blendMode.popBlendMode(t)}}class rs extends nr{constructor(t=O.EMPTY){t instanceof O&&(t={texture:t});const{texture:e=O.EMPTY,anchor:i,roundPixels:n,width:r,height:o,...a}=t;super({label:"Sprite",...a}),this.renderPipeId="sprite",this.batched=!0,this._visualBounds={minX:0,maxX:1,minY:0,maxY:0},this._anchor=new lt({_onUpdate:()=>{this.onViewUpdate()}}),i?this.anchor=i:e.defaultAnchor&&(this.anchor=e.defaultAnchor),this.texture=e,this.allowChildren=!1,this.roundPixels=n??!1,r!==void 0&&(this.width=r),o!==void 0&&(this.height=o)}static from(t,e=!1){return t instanceof O?new rs(t):new rs(O.from(t,e))}set texture(t){t||(t=O.EMPTY);const e=this._texture;e!==t&&(e&&e.dynamic&&e.off("update",this.onViewUpdate,this),t.dynamic&&t.on("update",this.onViewUpdate,this),this._texture=t,this._width&&this._setWidth(this._width,this._texture.orig.width),this._height&&this._setHeight(this._height,this._texture.orig.height),this.onViewUpdate())}get texture(){return this._texture}get visualBounds(){return Mc(this._visualBounds,this._anchor,this._texture),this._visualBounds}get sourceBounds(){return z("8.6.1","Sprite.sourceBounds is deprecated, use visualBounds instead."),this.visualBounds}updateBounds(){const t=this._anchor,e=this._texture,i=this._bounds,{width:n,height:r}=e.orig;i.minX=-t._x*n,i.maxX=i.minX+n,i.minY=-t._y*r,i.maxY=i.minY+r}destroy(t=!1){if(super.destroy(t),typeof t=="boolean"?t:t==null?void 0:t.texture){const i=typeof t=="boolean"?t:t==null?void 0:t.textureSource;this._texture.destroy(i)}this._texture=null,this._visualBounds=null,this._bounds=null,this._anchor=null,this._gpuData=null}get anchor(){return this._anchor}set anchor(t){typeof t=="number"?this._anchor.set(t):this._anchor.copyFrom(t)}get width(){return Math.abs(this.scale.x)*this._texture.orig.width}set width(t){this._setWidth(t,this._texture.orig.width),this._width=t}get height(){return Math.abs(this.scale.y)*this._texture.orig.height}set height(t){this._setHeight(t,this._texture.orig.height),this._height=t}getSize(t){return t||(t={}),t.width=Math.abs(this.scale.x)*this._texture.orig.width,t.height=Math.abs(this.scale.y)*this._texture.orig.height,t}setSize(t,e){typeof t=="object"?(e=t.height??t.width,t=t.width):e??(e=t),t!==void 0&&this._setWidth(t,this._texture.orig.width),e!==void 0&&this._setHeight(e,this._texture.orig.height)}}const ah=new It;function Pa(s,t,e){const i=ah;s.measurable=!0,wa(s,e,i),t.addBoundsMask(i),s.measurable=!1}function Ea(s,t,e){const i=Zt.get();s.measurable=!0;const n=ft.get().identity(),r=Ia(s,e,n);ka(s,i,r),s.measurable=!1,t.addBoundsMask(i),ft.return(n),Zt.return(i)}function Ia(s,t,e){return s?(s!==t&&(Ia(s.parent,t,e),s.updateLocalTransform(),e.append(s.localTransform)),e):(V("Mask bounds, renderable is not inside the root container"),e)}class La{constructor(t){this.priority=0,this.inverse=!1,this.pipe="alphaMask",t!=null&&t.mask&&this.init(t.mask)}init(t){this.mask=t,this.renderMaskToTexture=!(t instanceof rs),this.mask.renderable=this.renderMaskToTexture,this.mask.includeInBuild=!this.renderMaskToTexture,this.mask.measurable=!1}reset(){this.mask.measurable=!0,this.mask=null}addBounds(t,e){this.inverse||Pa(this.mask,t,e)}addLocalBounds(t,e){Ea(this.mask,t,e)}containsPoint(t,e){const i=this.mask;return e(i,t)}destroy(){this.reset()}static test(t){return t instanceof rs}}La.extension=I.MaskEffect;class Ba{constructor(t){this.priority=0,this.pipe="colorMask",t!=null&&t.mask&&this.init(t.mask)}init(t){this.mask=t}destroy(){}static test(t){return typeof t=="number"}}Ba.extension=I.MaskEffect;class Ra{constructor(t){this.priority=0,this.pipe="stencilMask",t!=null&&t.mask&&this.init(t.mask)}init(t){this.mask=t,this.mask.includeInBuild=!1,this.mask.measurable=!1}reset(){this.mask.measurable=!0,this.mask.includeInBuild=!0,this.mask=null}addBounds(t,e){Pa(this.mask,t,e)}addLocalBounds(t,e){Ea(this.mask,t,e)}containsPoint(t,e){const i=this.mask;return e(i,t)}destroy(){this.reset()}static test(t){return t instanceof it}}Ra.extension=I.MaskEffect;const lh={createCanvas:(s,t)=>{const e=document.createElement("canvas");return e.width=s,e.height=t,e},createImage:()=>new Image,getCanvasRenderingContext2D:()=>CanvasRenderingContext2D,getWebGLRenderingContext:()=>WebGLRenderingContext,getNavigator:()=>navigator,getBaseUrl:()=>document.baseURI??window.location.href,getFontFaceSet:()=>document.fonts,fetch:(s,t)=>fetch(s,t),parseXML:s=>new DOMParser().parseFromString(s,"text/xml")};let Jr=lh;const j={get(){return Jr},set(s){Jr=s}};class Fa extends Rt{constructor(t){t.resource||(t.resource=j.get().createCanvas()),t.width||(t.width=t.resource.width,t.autoDensity||(t.width/=t.resolution)),t.height||(t.height=t.resource.height,t.autoDensity||(t.height/=t.resolution)),super(t),this.uploadMethodId="image",this.autoDensity=t.autoDensity,this.resizeCanvas(),this.transparent=!!t.transparent}resizeCanvas(){this.autoDensity&&"style"in this.resource&&(this.resource.style.width=`${this.width}px`,this.resource.style.height=`${this.height}px`),(this.resource.width!==this.pixelWidth||this.resource.height!==this.pixelHeight)&&(this.resource.width=this.pixelWidth,this.resource.height=this.pixelHeight)}resize(t=this.width,e=this.height,i=this._resolution){const n=super.resize(t,e,i);return n&&this.resizeCanvas(),n}static test(t){return globalThis.HTMLCanvasElement&&t instanceof HTMLCanvasElement||globalThis.OffscreenCanvas&&t instanceof OffscreenCanvas}get context2D(){return this._context2D||(this._context2D=this.resource.getContext("2d"))}}Fa.extension=I.TextureSource;class Le extends Rt{constructor(t){super(t),this.uploadMethodId="image",this.autoGarbageCollect=!0}static test(t){return globalThis.HTMLImageElement&&t instanceof HTMLImageElement||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||globalThis.VideoFrame&&t instanceof VideoFrame}}Le.extension=I.TextureSource;var Gn=(s=>(s[s.INTERACTION=50]="INTERACTION",s[s.HIGH=25]="HIGH",s[s.NORMAL=0]="NORMAL",s[s.LOW=-25]="LOW",s[s.UTILITY=-50]="UTILITY",s))(Gn||{});class hn{constructor(t,e=null,i=0,n=!1){this.next=null,this.previous=null,this._destroyed=!1,this._fn=t,this._context=e,this.priority=i,this._once=n}match(t,e=null){return this._fn===t&&this._context===e}emit(t){this._fn&&(this._context?this._fn.call(this._context,t):this._fn(t));const e=this.next;return this._once&&this.destroy(!0),this._destroyed&&(this.next=null),e}connect(t){this.previous=t,t.next&&(t.next.previous=this),this.next=t.next,t.next=this}destroy(t=!1){this._destroyed=!0,this._fn=null,this._context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);const e=this.next;return this.next=t?null:e,this.previous=null,e}}const za=class bt{constructor(){this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new hn(null,null,1/0),this.deltaMS=1/bt.targetFPMS,this.elapsedMS=1/bt.targetFPMS,this._tick=t=>{this._requestId=null,this.started&&(this.update(t),this.started&&this._requestId===null&&this._head.next&&(this._requestId=requestAnimationFrame(this._tick)))}}_requestIfNeeded(){this._requestId===null&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))}_cancelIfNeeded(){this._requestId!==null&&(cancelAnimationFrame(this._requestId),this._requestId=null)}_startIfPossible(){this.started?this._requestIfNeeded():this.autoStart&&this.start()}add(t,e,i=Gn.NORMAL){return this._addListener(new hn(t,e,i))}addOnce(t,e,i=Gn.NORMAL){return this._addListener(new hn(t,e,i,!0))}_addListener(t){let e=this._head.next,i=this._head;if(!e)t.connect(i);else{for(;e;){if(t.priority>e.priority){t.connect(i);break}i=e,e=e.next}t.previous||t.connect(i)}return this._startIfPossible(),this}remove(t,e){let i=this._head.next;for(;i;)i.match(t,e)?i=i.destroy():i=i.next;return this._head.next||this._cancelIfNeeded(),this}get count(){if(!this._head)return 0;let t=0,e=this._head;for(;e=e.next;)t++;return t}start(){this.started||(this.started=!0,this._requestIfNeeded())}stop(){this.started&&(this.started=!1,this._cancelIfNeeded())}destroy(){if(!this._protected){this.stop();let t=this._head.next;for(;t;)t=t.destroy(!0);this._head.destroy(),this._head=null}}update(t=performance.now()){let e;if(t>this.lastTime){if(e=this.elapsedMS=t-this.lastTime,e>this._maxElapsedMS&&(e=this._maxElapsedMS),e*=this.speed,this._minElapsedMS){const r=t-this._lastFrame|0;if(r<this._minElapsedMS)return;this._lastFrame=t-r%this._minElapsedMS}this.deltaMS=e,this.deltaTime=this.deltaMS*bt.targetFPMS;const i=this._head;let n=i.next;for(;n;)n=n.emit(this);i.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=t}get FPS(){return 1e3/this.elapsedMS}get minFPS(){return 1e3/this._maxElapsedMS}set minFPS(t){const e=Math.min(this.maxFPS,t),i=Math.min(Math.max(0,e)/1e3,bt.targetFPMS);this._maxElapsedMS=1/i}get maxFPS(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0}set maxFPS(t){if(t===0)this._minElapsedMS=0;else{const e=Math.max(this.minFPS,t);this._minElapsedMS=1/(e/1e3)}}static get shared(){if(!bt._shared){const t=bt._shared=new bt;t.autoStart=!0,t._protected=!0}return bt._shared}static get system(){if(!bt._system){const t=bt._system=new bt;t.autoStart=!0,t._protected=!0}return bt._system}};za.targetFPMS=.06;let bi=za,dn;async function Da(){return dn??(dn=(async()=>{var o;const t=j.get().createCanvas(1,1).getContext("webgl");if(!t)return"premultiply-alpha-on-upload";const e=await new Promise(a=>{const l=document.createElement("video");l.onloadeddata=()=>a(l),l.onerror=()=>a(null),l.autoplay=!1,l.crossOrigin="anonymous",l.preload="auto",l.src="data:video/webm;base64,GkXfo59ChoEBQveBAULygQRC84EIQoKEd2VibUKHgQJChYECGFOAZwEAAAAAAAHTEU2bdLpNu4tTq4QVSalmU6yBoU27i1OrhBZUrmtTrIHGTbuMU6uEElTDZ1OsggEXTbuMU6uEHFO7a1OsggG97AEAAAAAAABZAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVSalmoCrXsYMPQkBNgIRMYXZmV0GETGF2ZkSJiEBEAAAAAAAAFlSua8yuAQAAAAAAAEPXgQFzxYgAAAAAAAAAAZyBACK1nIN1bmSIgQCGhVZfVlA5g4EBI+ODhAJiWgDglLCBArqBApqBAlPAgQFVsIRVuYEBElTDZ9Vzc9JjwItjxYgAAAAAAAAAAWfInEWjh0VOQ09ERVJEh49MYXZjIGxpYnZweC12cDlnyKJFo4hEVVJBVElPTkSHlDAwOjAwOjAwLjA0MDAwMDAwMAAAH0O2dcfngQCgwqGggQAAAIJJg0IAABAAFgA4JBwYSgAAICAAEb///4r+AAB1oZ2mm+6BAaWWgkmDQgAAEAAWADgkHBhKAAAgIABIQBxTu2uRu4+zgQC3iveBAfGCAXHwgQM=",l.load()});if(!e)return"premultiply-alpha-on-upload";const i=t.createTexture();t.bindTexture(t.TEXTURE_2D,i);const n=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,n),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,i,0),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,t.NONE),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e);const r=new Uint8Array(4);return t.readPixels(0,0,1,1,t.RGBA,t.UNSIGNED_BYTE,r),t.deleteFramebuffer(n),t.deleteTexture(i),(o=t.getExtension("WEBGL_lose_context"))==null||o.loseContext(),r[0]<=r[3]?"premultiplied-alpha":"premultiply-alpha-on-upload"})()),dn}const Ni=class Ga extends Rt{constructor(t){super(t),this.isReady=!1,this.uploadMethodId="video",t={...Ga.defaultOptions,...t},this._autoUpdate=!0,this._isConnectedToTicker=!1,this._updateFPS=t.updateFPS||0,this._msToNextUpdate=0,this.autoPlay=t.autoPlay!==!1,this.alphaMode=t.alphaMode??"premultiply-alpha-on-upload",this._videoFrameRequestCallback=this._videoFrameRequestCallback.bind(this),this._videoFrameRequestCallbackHandle=null,this._load=null,this._resolve=null,this._reject=null,this._onCanPlay=this._onCanPlay.bind(this),this._onCanPlayThrough=this._onCanPlayThrough.bind(this),this._onError=this._onError.bind(this),this._onPlayStart=this._onPlayStart.bind(this),this._onPlayStop=this._onPlayStop.bind(this),this._onSeeked=this._onSeeked.bind(this),t.autoLoad!==!1&&this.load()}updateFrame(){if(!this.destroyed){if(this._updateFPS){const t=bi.shared.elapsedMS*this.resource.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-t)}(!this._updateFPS||this._msToNextUpdate<=0)&&(this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0),this.isValid&&this.update()}}_videoFrameRequestCallback(){this.updateFrame(),this.destroyed?this._videoFrameRequestCallbackHandle=null:this._videoFrameRequestCallbackHandle=this.resource.requestVideoFrameCallback(this._videoFrameRequestCallback)}get isValid(){return!!this.resource.videoWidth&&!!this.resource.videoHeight}async load(){if(this._load)return this._load;const t=this.resource,e=this.options;return(t.readyState===t.HAVE_ENOUGH_DATA||t.readyState===t.HAVE_FUTURE_DATA)&&t.width&&t.height&&(t.complete=!0),t.addEventListener("play",this._onPlayStart),t.addEventListener("pause",this._onPlayStop),t.addEventListener("seeked",this._onSeeked),this._isSourceReady()?this._mediaReady():(e.preload||t.addEventListener("canplay",this._onCanPlay),t.addEventListener("canplaythrough",this._onCanPlayThrough),t.addEventListener("error",this._onError,!0)),this.alphaMode=await Da(),this._load=new Promise((i,n)=>{this.isValid?i(this):(this._resolve=i,this._reject=n,e.preloadTimeoutMs!==void 0&&(this._preloadTimeout=setTimeout(()=>{this._onError(new ErrorEvent(`Preload exceeded timeout of ${e.preloadTimeoutMs}ms`))})),t.load())}),this._load}_onError(t){this.resource.removeEventListener("error",this._onError,!0),this.emit("error",t),this._reject&&(this._reject(t),this._reject=null,this._resolve=null)}_isSourcePlaying(){const t=this.resource;return!t.paused&&!t.ended}_isSourceReady(){return this.resource.readyState>2}_onPlayStart(){this.isValid||this._mediaReady(),this._configureAutoUpdate()}_onPlayStop(){this._configureAutoUpdate()}_onSeeked(){this._autoUpdate&&!this._isSourcePlaying()&&(this._msToNextUpdate=0,this.updateFrame(),this._msToNextUpdate=0)}_onCanPlay(){this.resource.removeEventListener("canplay",this._onCanPlay),this._mediaReady()}_onCanPlayThrough(){this.resource.removeEventListener("canplaythrough",this._onCanPlay),this._preloadTimeout&&(clearTimeout(this._preloadTimeout),this._preloadTimeout=void 0),this._mediaReady()}_mediaReady(){const t=this.resource;this.isValid&&(this.isReady=!0,this.resize(t.videoWidth,t.videoHeight)),this._msToNextUpdate=0,this.updateFrame(),this._msToNextUpdate=0,this._resolve&&(this._resolve(this),this._resolve=null,this._reject=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&this.resource.play()}destroy(){this._configureAutoUpdate();const t=this.resource;t&&(t.removeEventListener("play",this._onPlayStart),t.removeEventListener("pause",this._onPlayStop),t.removeEventListener("seeked",this._onSeeked),t.removeEventListener("canplay",this._onCanPlay),t.removeEventListener("canplaythrough",this._onCanPlayThrough),t.removeEventListener("error",this._onError,!0),t.pause(),t.src="",t.load()),super.destroy()}get autoUpdate(){return this._autoUpdate}set autoUpdate(t){t!==this._autoUpdate&&(this._autoUpdate=t,this._configureAutoUpdate())}get updateFPS(){return this._updateFPS}set updateFPS(t){t!==this._updateFPS&&(this._updateFPS=t,this._configureAutoUpdate())}_configureAutoUpdate(){this._autoUpdate&&this._isSourcePlaying()?!this._updateFPS&&this.resource.requestVideoFrameCallback?(this._isConnectedToTicker&&(bi.shared.remove(this.updateFrame,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0),this._videoFrameRequestCallbackHandle===null&&(this._videoFrameRequestCallbackHandle=this.resource.requestVideoFrameCallback(this._videoFrameRequestCallback))):(this._videoFrameRequestCallbackHandle!==null&&(this.resource.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker||(bi.shared.add(this.updateFrame,this),this._isConnectedToTicker=!0,this._msToNextUpdate=0)):(this._videoFrameRequestCallbackHandle!==null&&(this.resource.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker&&(bi.shared.remove(this.updateFrame,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0))}static test(t){return globalThis.HTMLVideoElement&&t instanceof HTMLVideoElement}};Ni.extension=I.TextureSource;Ni.defaultOptions={...Rt.defaultOptions,autoLoad:!0,autoPlay:!0,updateFPS:0,crossorigin:!0,loop:!1,muted:!0,playsinline:!0,preload:!1};Ni.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"};let $s=Ni;const Tt=(s,t,e=!1)=>(Array.isArray(s)||(s=[s]),t?s.map(i=>typeof i=="string"||e?t(i):i):s);class ch{constructor(){this._parsers=[],this._cache=new Map,this._cacheMap=new Map}reset(){this._cacheMap.clear(),this._cache.clear()}has(t){return this._cache.has(t)}get(t){const e=this._cache.get(t);return e||V(`[Assets] Asset id ${t} was not found in the Cache`),e}set(t,e){const i=Tt(t);let n;for(let l=0;l<this.parsers.length;l++){const c=this.parsers[l];if(c.test(e)){n=c.getCacheableAssets(i,e);break}}const r=new Map(Object.entries(n||{}));n||i.forEach(l=>{r.set(l,e)});const o=[...r.keys()],a={cacheKeys:o,keys:i};i.forEach(l=>{this._cacheMap.set(l,a)}),o.forEach(l=>{const c=n?n[l]:e;this._cache.has(l)&&this._cache.get(l)!==c&&V("[Cache] already has key:",l),this._cache.set(l,r.get(l))})}remove(t){if(!this._cacheMap.has(t)){V(`[Assets] Asset id ${t} was not found in the Cache`);return}const e=this._cacheMap.get(t);e.cacheKeys.forEach(n=>{this._cache.delete(n)}),e.keys.forEach(n=>{this._cacheMap.delete(n)})}get parsers(){return this._parsers}}const Y=new ch,On=[];dt.handleByList(I.TextureSource,On);function Oa(s={}){const t=s&&s.resource,e=t?s.resource:s,i=t?s:{resource:s};for(let n=0;n<On.length;n++){const r=On[n];if(r.test(e))return new r(i)}throw new Error(`Could not find a source type for resource: ${i.resource}`)}function hh(s={},t=!1){const e=s&&s.resource,i=e?s.resource:s,n=e?s:{resource:s};if(!t&&Y.has(i))return Y.get(i);const r=new O({source:Oa(n)});return r.on("destroy",()=>{Y.has(i)&&Y.remove(i)}),t||Y.set(i,r),r}function dh(s,t=!1){return typeof s=="string"?Y.get(s):s instanceof Rt?new O({source:s}):hh(s,t)}O.from=dh;Rt.from=Oa;dt.add(La,Ba,Ra,$s,Le,Fa,sr);var xe=(s=>(s[s.Low=0]="Low",s[s.Normal=1]="Normal",s[s.High=2]="High",s))(xe||{});function Mt(s){if(typeof s!="string")throw new TypeError(`Path must be a string. Received ${JSON.stringify(s)}`)}function Ps(s){return s.split("?")[0].split("#")[0]}function uh(s){return s.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function fh(s,t,e){return s.replace(new RegExp(uh(t),"g"),e)}function ph(s,t){let e="",i=0,n=-1,r=0,o=-1;for(let a=0;a<=s.length;++a){if(a<s.length)o=s.charCodeAt(a);else{if(o===47)break;o=47}if(o===47){if(!(n===a-1||r===1))if(n!==a-1&&r===2){if(e.length<2||i!==2||e.charCodeAt(e.length-1)!==46||e.charCodeAt(e.length-2)!==46){if(e.length>2){const l=e.lastIndexOf("/");if(l!==e.length-1){l===-1?(e="",i=0):(e=e.slice(0,l),i=e.length-1-e.lastIndexOf("/")),n=a,r=0;continue}}else if(e.length===2||e.length===1){e="",i=0,n=a,r=0;continue}}}else e.length>0?e+=`/${s.slice(n+1,a)}`:e=s.slice(n+1,a),i=a-n-1;n=a,r=0}else o===46&&r!==-1?++r:r=-1}return e}const _t={toPosix(s){return fh(s,"\\","/")},isUrl(s){return/^https?:/.test(this.toPosix(s))},isDataUrl(s){return/^data:([a-z]+\/[a-z0-9-+.]+(;[a-z0-9-.!#$%*+.{}|~`]+=[a-z0-9-.!#$%*+.{}()_|~`]+)*)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s<>]*?)$/i.test(s)},isBlobUrl(s){return s.startsWith("blob:")},hasProtocol(s){return/^[^/:]+:/.test(this.toPosix(s))},getProtocol(s){Mt(s),s=this.toPosix(s);const t=/^file:\/\/\//.exec(s);if(t)return t[0];const e=/^[^/:]+:\/{0,2}/.exec(s);return e?e[0]:""},toAbsolute(s,t,e){if(Mt(s),this.isDataUrl(s)||this.isBlobUrl(s))return s;const i=Ps(this.toPosix(t??j.get().getBaseUrl())),n=Ps(this.toPosix(e??this.rootname(i)));return s=this.toPosix(s),s.startsWith("/")?_t.join(n,s.slice(1)):this.isAbsolute(s)?s:this.join(i,s)},normalize(s){if(Mt(s),s.length===0)return".";if(this.isDataUrl(s)||this.isBlobUrl(s))return s;s=this.toPosix(s);let t="";const e=s.startsWith("/");this.hasProtocol(s)&&(t=this.rootname(s),s=s.slice(t.length));const i=s.endsWith("/");return s=ph(s),s.length>0&&i&&(s+="/"),e?`/${s}`:t+s},isAbsolute(s){return Mt(s),s=this.toPosix(s),this.hasProtocol(s)?!0:s.startsWith("/")},join(...s){if(s.length===0)return".";let t;for(let e=0;e<s.length;++e){const i=s[e];if(Mt(i),i.length>0)if(t===void 0)t=i;else{const n=s[e-1]??"";this.joinExtensions.includes(this.extname(n).toLowerCase())?t+=`/../${i}`:t+=`/${i}`}}return t===void 0?".":this.normalize(t)},dirname(s){if(Mt(s),s.length===0)return".";s=this.toPosix(s);let t=s.charCodeAt(0);const e=t===47;let i=-1,n=!0;const r=this.getProtocol(s),o=s;s=s.slice(r.length);for(let a=s.length-1;a>=1;--a)if(t=s.charCodeAt(a),t===47){if(!n){i=a;break}}else n=!1;return i===-1?e?"/":this.isUrl(o)?r+s:r:e&&i===1?"//":r+s.slice(0,i)},rootname(s){Mt(s),s=this.toPosix(s);let t="";if(s.startsWith("/")?t="/":t=this.getProtocol(s),this.isUrl(s)){const e=s.indexOf("/",t.length);e!==-1?t=s.slice(0,e):t=s,t.endsWith("/")||(t+="/")}return t},basename(s,t){Mt(s),t&&Mt(t),s=Ps(this.toPosix(s));let e=0,i=-1,n=!0,r;if(t!==void 0&&t.length>0&&t.length<=s.length){if(t.length===s.length&&t===s)return"";let o=t.length-1,a=-1;for(r=s.length-1;r>=0;--r){const l=s.charCodeAt(r);if(l===47){if(!n){e=r+1;break}}else a===-1&&(n=!1,a=r+1),o>=0&&(l===t.charCodeAt(o)?--o===-1&&(i=r):(o=-1,i=a))}return e===i?i=a:i===-1&&(i=s.length),s.slice(e,i)}for(r=s.length-1;r>=0;--r)if(s.charCodeAt(r)===47){if(!n){e=r+1;break}}else i===-1&&(n=!1,i=r+1);return i===-1?"":s.slice(e,i)},extname(s){Mt(s),s=Ps(this.toPosix(s));let t=-1,e=0,i=-1,n=!0,r=0;for(let o=s.length-1;o>=0;--o){const a=s.charCodeAt(o);if(a===47){if(!n){e=o+1;break}continue}i===-1&&(n=!1,i=o+1),a===46?t===-1?t=o:r!==1&&(r=1):t!==-1&&(r=-1)}return t===-1||i===-1||r===0||r===1&&t===i-1&&t===e+1?"":s.slice(t,i)},parse(s){Mt(s);const t={root:"",dir:"",base:"",ext:"",name:""};if(s.length===0)return t;s=Ps(this.toPosix(s));let e=s.charCodeAt(0);const i=this.isAbsolute(s);let n;t.root=this.rootname(s),i||this.hasProtocol(s)?n=1:n=0;let r=-1,o=0,a=-1,l=!0,c=s.length-1,h=0;for(;c>=n;--c){if(e=s.charCodeAt(c),e===47){if(!l){o=c+1;break}continue}a===-1&&(l=!1,a=c+1),e===46?r===-1?r=c:h!==1&&(h=1):r!==-1&&(h=-1)}return r===-1||a===-1||h===0||h===1&&r===a-1&&r===o+1?a!==-1&&(o===0&&i?t.base=t.name=s.slice(1,a):t.base=t.name=s.slice(o,a)):(o===0&&i?(t.name=s.slice(1,r),t.base=s.slice(1,a)):(t.name=s.slice(o,r),t.base=s.slice(o,a)),t.ext=s.slice(r,a)),t.dir=this.dirname(s),t},sep:"/",delimiter:":",joinExtensions:[".html"]};function $a(s,t,e,i,n){const r=t[e];for(let o=0;o<r.length;o++){const a=r[o];e<t.length-1?$a(s.replace(i[e],a),t,e+1,i,n):n.push(s.replace(i[e],a))}}function mh(s){const t=/\{(.*?)\}/g,e=s.match(t),i=[];if(e){const n=[];e.forEach(r=>{const o=r.substring(1,r.length-1).split(",");n.push(o)}),$a(s,n,0,e,i)}else i.push(s);return i}const Fi=s=>!Array.isArray(s);class ps{constructor(){this._defaultBundleIdentifierOptions={connector:"-",createBundleAssetId:(t,e)=>`${t}${this._bundleIdConnector}${e}`,extractAssetIdFromBundle:(t,e)=>e.replace(`${t}${this._bundleIdConnector}`,"")},this._bundleIdConnector=this._defaultBundleIdentifierOptions.connector,this._createBundleAssetId=this._defaultBundleIdentifierOptions.createBundleAssetId,this._extractAssetIdFromBundle=this._defaultBundleIdentifierOptions.extractAssetIdFromBundle,this._assetMap={},this._preferredOrder=[],this._parsers=[],this._resolverHash={},this._bundles={}}setBundleIdentifier(t){if(this._bundleIdConnector=t.connector??this._bundleIdConnector,this._createBundleAssetId=t.createBundleAssetId??this._createBundleAssetId,this._extractAssetIdFromBundle=t.extractAssetIdFromBundle??this._extractAssetIdFromBundle,this._extractAssetIdFromBundle("foo",this._createBundleAssetId("foo","bar"))!=="bar")throw new Error("[Resolver] GenerateBundleAssetId are not working correctly")}prefer(...t){t.forEach(e=>{this._preferredOrder.push(e),e.priority||(e.priority=Object.keys(e.params))}),this._resolverHash={}}set basePath(t){this._basePath=t}get basePath(){return this._basePath}set rootPath(t){this._rootPath=t}get rootPath(){return this._rootPath}get parsers(){return this._parsers}reset(){this.setBundleIdentifier(this._defaultBundleIdentifierOptions),this._assetMap={},this._preferredOrder=[],this._resolverHash={},this._rootPath=null,this._basePath=null,this._manifest=null,this._bundles={},this._defaultSearchParams=null}setDefaultSearchParams(t){if(typeof t=="string")this._defaultSearchParams=t;else{const e=t;this._defaultSearchParams=Object.keys(e).map(i=>`${encodeURIComponent(i)}=${encodeURIComponent(e[i])}`).join("&")}}getAlias(t){const{alias:e,src:i}=t;return Tt(e||i,r=>typeof r=="string"?r:Array.isArray(r)?r.map(o=>(o==null?void 0:o.src)??o):r!=null&&r.src?r.src:r,!0)}addManifest(t){this._manifest&&V("[Resolver] Manifest already exists, this will be overwritten"),this._manifest=t,t.bundles.forEach(e=>{this.addBundle(e.name,e.assets)})}addBundle(t,e){const i=[];let n=e;Array.isArray(e)||(n=Object.entries(e).map(([r,o])=>typeof o=="string"||Array.isArray(o)?{alias:r,src:o}:{alias:r,...o})),n.forEach(r=>{const o=r.src,a=r.alias;let l;if(typeof a=="string"){const c=this._createBundleAssetId(t,a);i.push(c),l=[a,c]}else{const c=a.map(h=>this._createBundleAssetId(t,h));i.push(...c),l=[...a,...c]}this.add({...r,alias:l,src:o})}),this._bundles[t]=i}add(t){const e=[];Array.isArray(t)?e.push(...t):e.push(t);let i;i=r=>{this.hasKey(r)&&V(`[Resolver] already has key: ${r} overwriting`)},Tt(e).forEach(r=>{const{src:o}=r;let{data:a,format:l,loadParser:c,parser:h}=r;const d=Tt(o).map(m=>typeof m=="string"?mh(m):Array.isArray(m)?m:[m]),u=this.getAlias(r);Array.isArray(u)?u.forEach(i):i(u);const f=[];d.forEach(m=>{m.forEach(x=>{let p={};if(typeof x!="object"){p.src=x;for(let g=0;g<this._parsers.length;g++){const y=this._parsers[g];if(y.test(x)){p=y.parse(x);break}}}else a=x.data??a,l=x.format??l,(x.loadParser||x.parser)&&(c=x.loadParser??c,h=x.parser??h),p={...p,...x};if(!u)throw new Error(`[Resolver] alias is undefined for this asset: ${p.src}`);p=this._buildResolvedAsset(p,{aliases:u,data:a,format:l,loadParser:c,parser:h}),f.push(p)})}),u.forEach(m=>{this._assetMap[m]=f})})}resolveBundle(t){const e=Fi(t);t=Tt(t);const i={};return t.forEach(n=>{const r=this._bundles[n];if(r){const o=this.resolve(r),a={};for(const l in o){const c=o[l];a[this._extractAssetIdFromBundle(n,l)]=c}i[n]=a}}),e?i[t[0]]:i}resolveUrl(t){const e=this.resolve(t);if(typeof t!="string"){const i={};for(const n in e)i[n]=e[n].src;return i}return e.src}resolve(t){const e=Fi(t);t=Tt(t);const i={};return t.forEach(n=>{if(!this._resolverHash[n])if(this._assetMap[n]){let r=this._assetMap[n];const o=this._getPreferredOrder(r);o==null||o.priority.forEach(a=>{o.params[a].forEach(l=>{const c=r.filter(h=>h[a]?h[a]===l:!1);c.length&&(r=c)})}),this._resolverHash[n]=r[0]}else this._resolverHash[n]=this._buildResolvedAsset({alias:[n],src:n},{});i[n]=this._resolverHash[n]}),e?i[t[0]]:i}hasKey(t){return!!this._assetMap[t]}hasBundle(t){return!!this._bundles[t]}_getPreferredOrder(t){for(let e=0;e<t.length;e++){const i=t[e],n=this._preferredOrder.find(r=>r.params.format.includes(i.format));if(n)return n}return this._preferredOrder[0]}_appendDefaultSearchParams(t){if(!this._defaultSearchParams)return t;const e=/\?/.test(t)?"&":"?";return`${t}${e}${this._defaultSearchParams}`}_buildResolvedAsset(t,e){const{aliases:i,data:n,loadParser:r,parser:o,format:a}=e;return(this._basePath||this._rootPath)&&(t.src=_t.toAbsolute(t.src,this._basePath,this._rootPath)),t.alias=i??t.alias??[t.src],t.src=this._appendDefaultSearchParams(t.src),t.data={...n||{},...t.data},t.loadParser=r??t.loadParser,t.parser=o??t.parser,t.format=a??t.format??gh(t.src),t}}ps.RETINA_PREFIX=/@([0-9\.]+)x/;function gh(s){return s.split(".").pop().split("?").shift().split("#").shift()}const $n=(s,t)=>{const e=t.split("?")[1];return e&&(s+=`?${e}`),s},Wa=class zs{constructor(t,e){this.linkedSheets=[];let i=t;(t==null?void 0:t.source)instanceof Rt&&(i={texture:t,data:e});const{texture:n,data:r,cachePrefix:o=""}=i;this.cachePrefix=o,this._texture=n instanceof O?n:null,this.textureSource=n.source,this.textures={},this.animations={},this.data=r;const a=parseFloat(r.meta.scale);a?(this.resolution=a,n.source.resolution=this.resolution):this.resolution=n.source._resolution,this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}parse(){return new Promise(t=>{this._callback=t,this._batchIndex=0,this._frameKeys.length<=zs.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()})}_processFrames(t){let e=t;const i=zs.BATCH_SIZE;for(;e-t<i&&e<this._frameKeys.length;){const n=this._frameKeys[e],r=this._frames[n],o=r.frame;if(o){let a=null,l=null;const c=r.trimmed!==!1&&r.sourceSize?r.sourceSize:r.frame,h=new X(0,0,Math.floor(c.w)/this.resolution,Math.floor(c.h)/this.resolution);r.rotated?a=new X(Math.floor(o.x)/this.resolution,Math.floor(o.y)/this.resolution,Math.floor(o.h)/this.resolution,Math.floor(o.w)/this.resolution):a=new X(Math.floor(o.x)/this.resolution,Math.floor(o.y)/this.resolution,Math.floor(o.w)/this.resolution,Math.floor(o.h)/this.resolution),r.trimmed!==!1&&r.spriteSourceSize&&(l=new X(Math.floor(r.spriteSourceSize.x)/this.resolution,Math.floor(r.spriteSourceSize.y)/this.resolution,Math.floor(o.w)/this.resolution,Math.floor(o.h)/this.resolution)),this.textures[n]=new O({source:this.textureSource,frame:a,orig:h,trim:l,rotate:r.rotated?2:0,defaultAnchor:r.anchor,defaultBorders:r.borders,label:n.toString()})}e++}}_processAnimations(){const t=this.data.animations||{};for(const e in t){this.animations[e]=[];for(let i=0;i<t[e].length;i++){const n=t[e][i];this.animations[e].push(this.textures[n])}}}_parseComplete(){const t=this._callback;this._callback=null,this._batchIndex=0,t.call(this,this.textures)}_nextBatch(){this._processFrames(this._batchIndex*zs.BATCH_SIZE),this._batchIndex++,setTimeout(()=>{this._batchIndex*zs.BATCH_SIZE<this._frameKeys.length?this._nextBatch():(this._processAnimations(),this._parseComplete())},0)}destroy(t=!1){var e;for(const i in this.textures)this.textures[i].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,t&&((e=this._texture)==null||e.destroy(),this.textureSource.destroy()),this._texture=null,this.textureSource=null,this.linkedSheets=[]}};Wa.BATCH_SIZE=1e3;let Qr=Wa;const yh=["jpg","png","jpeg","avif","webp","basis","etc2","bc7","bc6h","bc5","bc4","bc3","bc2","bc1","eac","astc"];function Na(s,t,e){const i={};if(s.forEach(n=>{i[n]=t}),Object.keys(t.textures).forEach(n=>{i[`${t.cachePrefix}${n}`]=t.textures[n]}),!e){const n=_t.dirname(s[0]);t.linkedSheets.forEach((r,o)=>{const a=Na([`${n}/${t.data.meta.related_multi_packs[o]}`],r,!0);Object.assign(i,a)})}return i}const xh={extension:I.Asset,cache:{test:s=>s instanceof Qr,getCacheableAssets:(s,t)=>Na(s,t,!1)},resolver:{extension:{type:I.ResolveParser,name:"resolveSpritesheet"},test:s=>{const e=s.split("?")[0].split("."),i=e.pop(),n=e.pop();return i==="json"&&yh.includes(n)},parse:s=>{var e;const t=s.split(".");return{resolution:parseFloat(((e=ps.RETINA_PREFIX.exec(s))==null?void 0:e[1])??"1"),format:t[t.length-2],src:s}}},loader:{name:"spritesheetLoader",id:"spritesheet",extension:{type:I.LoadParser,priority:xe.Normal,name:"spritesheetLoader"},async testParse(s,t){return _t.extname(t.src).toLowerCase()===".json"&&!!s.frames},async parse(s,t,e){var d,u;const{texture:i,imageFilename:n,textureOptions:r,cachePrefix:o}=(t==null?void 0:t.data)??{};let a=_t.dirname(t.src);a&&a.lastIndexOf("/")!==a.length-1&&(a+="/");let l;if(i instanceof O)l=i;else{const f=$n(a+(n??s.meta.image),t.src);l=(await e.load([{src:f,data:r}]))[f]}const c=new Qr({texture:l.source,data:s,cachePrefix:o});await c.parse();const h=(d=s==null?void 0:s.meta)==null?void 0:d.related_multi_packs;if(Array.isArray(h)){const f=[];for(const x of h){if(typeof x!="string")continue;let p=a+x;(u=t.data)!=null&&u.ignoreMultiPack||(p=$n(p,t.src),f.push(e.load({src:p,data:{textureOptions:r,ignoreMultiPack:!0}})))}const m=await Promise.all(f);c.linkedSheets=m,m.forEach(x=>{x.linkedSheets=[c].concat(c.linkedSheets.filter(p=>p!==x))})}return c},async unload(s,t,e){await e.unload(s.textureSource._sourceOrigin),s.destroy(!1)}}};dt.add(xh);const un=Object.create(null),to=Object.create(null);function rr(s,t){let e=to[s];return e===void 0&&(un[t]===void 0&&(un[t]=1),to[s]=e=un[t]++),e}let We;function Ua(){return(!We||We!=null&&We.isContextLost())&&(We=j.get().createCanvas().getContext("webgl",{})),We}let _i;function bh(){if(!_i){_i="mediump";const s=Ua();s&&s.getShaderPrecisionFormat&&(_i=s.getShaderPrecisionFormat(s.FRAGMENT_SHADER,s.HIGH_FLOAT).precision?"highp":"mediump")}return _i}function _h(s,t,e){return t?s:e?(s=s.replace("out vec4 finalColor;",""),`

        #ifdef GL_ES // This checks if it is WebGL1
        #define in varying
        #define finalColor gl_FragColor
        #define texture texture2D
        #endif
        ${s}
        `):`

        #ifdef GL_ES // This checks if it is WebGL1
        #define in attribute
        #define out varying
        #endif
        ${s}
        `}function wh(s,t,e){const i=e?t.maxSupportedFragmentPrecision:t.maxSupportedVertexPrecision;if(s.substring(0,9)!=="precision"){let n=e?t.requestedFragmentPrecision:t.requestedVertexPrecision;return n==="highp"&&i!=="highp"&&(n="mediump"),`precision ${n} float;
${s}`}else if(i!=="highp"&&s.substring(0,15)==="precision highp")return s.replace("precision highp","precision mediump");return s}function vh(s,t){return t?`#version 300 es
${s}`:s}const Sh={},kh={};function Ah(s,{name:t="pixi-program"},e=!0){t=t.replace(/\s+/g,"-"),t+=e?"-fragment":"-vertex";const i=e?Sh:kh;return i[t]?(i[t]++,t+=`-${i[t]}`):i[t]=1,s.indexOf("#define SHADER_NAME")!==-1?s:`${`#define SHADER_NAME ${t}`}
${s}`}function Ch(s,t){return t?s.replace("#version 300 es",""):s}const fn={stripVersion:Ch,ensurePrecision:wh,addProgramDefines:_h,setProgramName:Ah,insertVersion:vh},Es=Object.create(null),Ha=class Wn{constructor(t){t={...Wn.defaultOptions,...t};const e=t.fragment.indexOf("#version 300 es")!==-1,i={stripVersion:e,ensurePrecision:{requestedFragmentPrecision:t.preferredFragmentPrecision,requestedVertexPrecision:t.preferredVertexPrecision,maxSupportedVertexPrecision:"highp",maxSupportedFragmentPrecision:bh()},setProgramName:{name:t.name},addProgramDefines:e,insertVersion:e};let n=t.fragment,r=t.vertex;Object.keys(fn).forEach(o=>{const a=i[o];n=fn[o](n,a,!0),r=fn[o](r,a,!1)}),this.fragment=n,this.vertex=r,this.transformFeedbackVaryings=t.transformFeedbackVaryings,this._key=rr(`${this.vertex}:${this.fragment}`,"gl-program")}destroy(){this.fragment=null,this.vertex=null,this._attributeData=null,this._uniformData=null,this._uniformBlockData=null,this.transformFeedbackVaryings=null,Es[this._cacheKey]=null}static from(t){const e=`${t.vertex}:${t.fragment}`;return Es[e]||(Es[e]=new Wn(t),Es[e]._cacheKey=e),Es[e]}};Ha.defaultOptions={preferredVertexPrecision:"highp",preferredFragmentPrecision:"mediump"};let ja=Ha;const eo={uint8x2:{size:2,stride:2,normalised:!1},uint8x4:{size:4,stride:4,normalised:!1},sint8x2:{size:2,stride:2,normalised:!1},sint8x4:{size:4,stride:4,normalised:!1},unorm8x2:{size:2,stride:2,normalised:!0},unorm8x4:{size:4,stride:4,normalised:!0},snorm8x2:{size:2,stride:2,normalised:!0},snorm8x4:{size:4,stride:4,normalised:!0},uint16x2:{size:2,stride:4,normalised:!1},uint16x4:{size:4,stride:8,normalised:!1},sint16x2:{size:2,stride:4,normalised:!1},sint16x4:{size:4,stride:8,normalised:!1},unorm16x2:{size:2,stride:4,normalised:!0},unorm16x4:{size:4,stride:8,normalised:!0},snorm16x2:{size:2,stride:4,normalised:!0},snorm16x4:{size:4,stride:8,normalised:!0},float16x2:{size:2,stride:4,normalised:!1},float16x4:{size:4,stride:8,normalised:!1},float32:{size:1,stride:4,normalised:!1},float32x2:{size:2,stride:8,normalised:!1},float32x3:{size:3,stride:12,normalised:!1},float32x4:{size:4,stride:16,normalised:!1},uint32:{size:1,stride:4,normalised:!1},uint32x2:{size:2,stride:8,normalised:!1},uint32x3:{size:3,stride:12,normalised:!1},uint32x4:{size:4,stride:16,normalised:!1},sint32:{size:1,stride:4,normalised:!1},sint32x2:{size:2,stride:8,normalised:!1},sint32x3:{size:3,stride:12,normalised:!1},sint32x4:{size:4,stride:16,normalised:!1}};function Mh(s){return eo[s]??eo.float32}const Th={f32:"float32","vec2<f32>":"float32x2","vec3<f32>":"float32x3","vec4<f32>":"float32x4",vec2f:"float32x2",vec3f:"float32x3",vec4f:"float32x4",i32:"sint32","vec2<i32>":"sint32x2","vec3<i32>":"sint32x3","vec4<i32>":"sint32x4",u32:"uint32","vec2<u32>":"uint32x2","vec3<u32>":"uint32x3","vec4<u32>":"uint32x4",bool:"uint32","vec2<bool>":"uint32x2","vec3<bool>":"uint32x3","vec4<bool>":"uint32x4"};function Ph({source:s,entryPoint:t}){const e={},i=s.indexOf(`fn ${t}`);if(i!==-1){const n=s.indexOf("->",i);if(n!==-1){const r=s.substring(i,n),o=/@location\((\d+)\)\s+([a-zA-Z0-9_]+)\s*:\s*([a-zA-Z0-9_<>]+)(?:,|\s|$)/g;let a;for(;(a=o.exec(r))!==null;){const l=Th[a[3]]??"float32";e[a[2]]={location:parseInt(a[1],10),format:l,stride:Mh(l).stride,offset:0,instance:!1,start:0}}}}return e}function pn(s){var d,u;const t=/(^|[^/])@(group|binding)\(\d+\)[^;]+;/g,e=/@group\((\d+)\)/,i=/@binding\((\d+)\)/,n=/var(<[^>]+>)? (\w+)/,r=/:\s*(\w+)/,o=/struct\s+(\w+)\s*{([^}]+)}/g,a=/(\w+)\s*:\s*([\w\<\>]+)/g,l=/struct\s+(\w+)/,c=(d=s.match(t))==null?void 0:d.map(f=>({group:parseInt(f.match(e)[1],10),binding:parseInt(f.match(i)[1],10),name:f.match(n)[2],isUniform:f.match(n)[1]==="<uniform>",type:f.match(r)[1]}));if(!c)return{groups:[],structs:[]};const h=((u=s.match(o))==null?void 0:u.map(f=>{const m=f.match(l)[1],x=f.match(a).reduce((p,g)=>{const[y,b]=g.split(":");return p[y.trim()]=b.trim(),p},{});return x?{name:m,members:x}:null}).filter(({name:f})=>c.some(m=>m.type===f)))??[];return{groups:c,structs:h}}var Ds=(s=>(s[s.VERTEX=1]="VERTEX",s[s.FRAGMENT=2]="FRAGMENT",s[s.COMPUTE=4]="COMPUTE",s))(Ds||{});function Eh({groups:s}){const t=[];for(let e=0;e<s.length;e++){const i=s[e];t[i.group]||(t[i.group]=[]),i.isUniform?t[i.group].push({binding:i.binding,visibility:Ds.VERTEX|Ds.FRAGMENT,buffer:{type:"uniform"}}):i.type==="sampler"?t[i.group].push({binding:i.binding,visibility:Ds.FRAGMENT,sampler:{type:"filtering"}}):i.type==="texture_2d"&&t[i.group].push({binding:i.binding,visibility:Ds.FRAGMENT,texture:{sampleType:"float",viewDimension:"2d",multisampled:!1}})}return t}function Ih({groups:s}){const t=[];for(let e=0;e<s.length;e++){const i=s[e];t[i.group]||(t[i.group]={}),t[i.group][i.name]=i.binding}return t}function Lh(s,t){const e=new Set,i=new Set,n=[...s.structs,...t.structs].filter(o=>e.has(o.name)?!1:(e.add(o.name),!0)),r=[...s.groups,...t.groups].filter(o=>{const a=`${o.name}-${o.binding}`;return i.has(a)?!1:(i.add(a),!0)});return{structs:n,groups:r}}const Is=Object.create(null);class Ui{constructor(t){var a,l;this._layoutKey=0,this._attributeLocationsKey=0;const{fragment:e,vertex:i,layout:n,gpuLayout:r,name:o}=t;if(this.name=o,this.fragment=e,this.vertex=i,e.source===i.source){const c=pn(e.source);this.structsAndGroups=c}else{const c=pn(i.source),h=pn(e.source);this.structsAndGroups=Lh(c,h)}this.layout=n??Ih(this.structsAndGroups),this.gpuLayout=r??Eh(this.structsAndGroups),this.autoAssignGlobalUniforms=((a=this.layout[0])==null?void 0:a.globalUniforms)!==void 0,this.autoAssignLocalUniforms=((l=this.layout[1])==null?void 0:l.localUniforms)!==void 0,this._generateProgramKey()}_generateProgramKey(){const{vertex:t,fragment:e}=this,i=t.source+e.source+t.entryPoint+e.entryPoint;this._layoutKey=rr(i,"program")}get attributeData(){return this._attributeData??(this._attributeData=Ph(this.vertex)),this._attributeData}destroy(){this.gpuLayout=null,this.layout=null,this.structsAndGroups=null,this.fragment=null,this.vertex=null,Is[this._cacheKey]=null}static from(t){const e=`${t.vertex.source}:${t.fragment.source}:${t.fragment.entryPoint}:${t.vertex.entryPoint}`;return Is[e]||(Is[e]=new Ui(t),Is[e]._cacheKey=e),Is[e]}}const Ya=["f32","i32","vec2<f32>","vec3<f32>","vec4<f32>","mat2x2<f32>","mat3x3<f32>","mat4x4<f32>","mat3x2<f32>","mat4x2<f32>","mat2x3<f32>","mat4x3<f32>","mat2x4<f32>","mat3x4<f32>","vec2<i32>","vec3<i32>","vec4<i32>"],Bh=Ya.reduce((s,t)=>(s[t]=!0,s),{});function Rh(s,t){switch(s){case"f32":return 0;case"vec2<f32>":return new Float32Array(2*t);case"vec3<f32>":return new Float32Array(3*t);case"vec4<f32>":return new Float32Array(4*t);case"mat2x2<f32>":return new Float32Array([1,0,0,1]);case"mat3x3<f32>":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4x4<f32>":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}const Va=class qa{constructor(t,e){this._touched=0,this.uid=Q("uniform"),this._resourceType="uniformGroup",this._resourceId=Q("resource"),this.isUniformGroup=!0,this._dirtyId=0,this.destroyed=!1,e={...qa.defaultOptions,...e},this.uniformStructures=t;const i={};for(const n in t){const r=t[n];if(r.name=n,r.size=r.size??1,!Bh[r.type]){const o=r.type.match(/^array<(\w+(?:<\w+>)?),\s*(\d+)>$/);if(o){const[,a,l]=o;throw new Error(`Uniform type ${r.type} is not supported. Use type: '${a}', size: ${l} instead.`)}throw new Error(`Uniform type ${r.type} is not supported. Supported uniform types are: ${Ya.join(", ")}`)}r.value??(r.value=Rh(r.type,r.size)),i[n]=r.value}this.uniforms=i,this._dirtyId=1,this.ubo=e.ubo,this.isStatic=e.isStatic,this._signature=rr(Object.keys(i).map(n=>`${n}-${t[n].type}`).join("-"),"uniform-group")}update(){this._dirtyId++}};Va.defaultOptions={ubo:!1,isStatic:!1};let Xa=Va;class Li{constructor(t){this.resources=Object.create(null),this._dirty=!0;let e=0;for(const i in t){const n=t[i];this.setResource(n,e++)}this._updateKey()}_updateKey(){if(!this._dirty)return;this._dirty=!1;const t=[];let e=0;for(const i in this.resources)t[e++]=this.resources[i]._resourceId;this._key=t.join("|")}setResource(t,e){var n,r;const i=this.resources[e];t!==i&&(i&&((n=t.off)==null||n.call(t,"change",this.onResourceChange,this)),(r=t.on)==null||r.call(t,"change",this.onResourceChange,this),this.resources[e]=t,this._dirty=!0)}getResource(t){return this.resources[t]}_touch(t){const e=this.resources;for(const i in e)e[i]._touched=t}destroy(){var e;const t=this.resources;for(const i in t){const n=t[i];(e=n==null?void 0:n.off)==null||e.call(n,"change",this.onResourceChange,this)}this.resources=null}onResourceChange(t){if(this._dirty=!0,t.destroyed){const e=this.resources;for(const i in e)e[i]===t&&(e[i]=null)}else this._updateKey()}}var Nn=(s=>(s[s.WEBGL=1]="WEBGL",s[s.WEBGPU=2]="WEBGPU",s[s.BOTH=3]="BOTH",s))(Nn||{});class or extends Bt{constructor(t){super(),this.uid=Q("shader"),this._uniformBindMap=Object.create(null),this._ownedBindGroups=[];let{gpuProgram:e,glProgram:i,groups:n,resources:r,compatibleRenderers:o,groupMap:a}=t;this.gpuProgram=e,this.glProgram=i,o===void 0&&(o=0,e&&(o|=Nn.WEBGPU),i&&(o|=Nn.WEBGL)),this.compatibleRenderers=o;const l={};if(!r&&!n&&(r={}),r&&n)throw new Error("[Shader] Cannot have both resources and groups");if(!e&&n&&!a)throw new Error("[Shader] No group map or WebGPU shader provided - consider using resources instead.");if(!e&&n&&a)for(const c in a)for(const h in a[c]){const d=a[c][h];l[d]={group:c,binding:h,name:d}}else if(e&&n&&!a){const c=e.structsAndGroups.groups;a={},c.forEach(h=>{a[h.group]=a[h.group]||{},a[h.group][h.binding]=h.name,l[h.name]=h})}else if(r){n={},a={},e&&e.structsAndGroups.groups.forEach(d=>{a[d.group]=a[d.group]||{},a[d.group][d.binding]=d.name,l[d.name]=d});let c=0;for(const h in r)l[h]||(n[99]||(n[99]=new Li,this._ownedBindGroups.push(n[99])),l[h]={group:99,binding:c,name:h},a[99]=a[99]||{},a[99][c]=h,c++);for(const h in r){const d=h;let u=r[h];!u.source&&!u._resourceType&&(u=new Xa(u));const f=l[d];f&&(n[f.group]||(n[f.group]=new Li,this._ownedBindGroups.push(n[f.group])),n[f.group].setResource(u,f.binding))}}this.groups=n,this._uniformBindMap=a,this.resources=this._buildResourceAccessor(n,l)}addResource(t,e,i){var n,r;(n=this._uniformBindMap)[e]||(n[e]={}),(r=this._uniformBindMap[e])[i]||(r[i]=t),this.groups[e]||(this.groups[e]=new Li,this._ownedBindGroups.push(this.groups[e]))}_buildResourceAccessor(t,e){const i={};for(const n in e){const r=e[n];Object.defineProperty(i,r.name,{get(){return t[r.group].getResource(r.binding)},set(o){t[r.group].setResource(o,r.binding)}})}return i}destroy(t=!1){var e,i;this.emit("destroy",this),t&&((e=this.gpuProgram)==null||e.destroy(),(i=this.glProgram)==null||i.destroy()),this.gpuProgram=null,this.glProgram=null,this.removeAllListeners(),this._uniformBindMap=null,this._ownedBindGroups.forEach(n=>{n.destroy()}),this._ownedBindGroups=null,this.resources=null,this.groups=null}static from(t){const{gpu:e,gl:i,...n}=t;let r,o;return e&&(r=Ui.from(e)),i&&(o=ja.from(i)),new or({gpuProgram:r,glProgram:o,...n})}}const Un=[];dt.handleByNamedList(I.Environment,Un);async function Fh(s){if(!s)for(let t=0;t<Un.length;t++){const e=Un[t];if(e.value.test()){await e.value.load();return}}}let Ls;function zh(){if(typeof Ls=="boolean")return Ls;try{Ls=new Function("param1","param2","param3","return param1[param2] === param3;")({a:"b"},"a","b")===!0}catch{Ls=!1}return Ls}function so(s,t,e=2){const i=t&&t.length,n=i?t[0]*e:s.length;let r=Ka(s,0,n,e,!0);const o=[];if(!r||r.next===r.prev)return o;let a,l,c;if(i&&(r=Wh(s,t,r,e)),s.length>80*e){a=s[0],l=s[1];let h=a,d=l;for(let u=e;u<n;u+=e){const f=s[u],m=s[u+1];f<a&&(a=f),m<l&&(l=m),f>h&&(h=f),m>d&&(d=m)}c=Math.max(h-a,d-l),c=c!==0?32767/c:0}return qs(r,o,e,a,l,c,0),o}function Ka(s,t,e,i,n){let r;if(n===Jh(s,t,e,i)>0)for(let o=t;o<e;o+=i)r=io(o/i|0,s[o],s[o+1],r);else for(let o=e-i;o>=t;o-=i)r=io(o/i|0,s[o],s[o+1],r);return r&&os(r,r.next)&&(Ks(r),r=r.next),r}function Be(s,t){if(!s)return s;t||(t=s);let e=s,i;do if(i=!1,!e.steiner&&(os(e,e.next)||K(e.prev,e,e.next)===0)){if(Ks(e),e=t=e.prev,e===e.next)break;i=!0}else e=e.next;while(i||e!==t);return t}function qs(s,t,e,i,n,r,o){if(!s)return;!o&&r&&Yh(s,i,n,r);let a=s;for(;s.prev!==s.next;){const l=s.prev,c=s.next;if(r?Gh(s,i,n,r):Dh(s)){t.push(l.i,s.i,c.i),Ks(s),s=c.next,a=c.next;continue}if(s=c,s===a){o?o===1?(s=Oh(Be(s),t),qs(s,t,e,i,n,r,2)):o===2&&$h(s,t,e,i,n,r):qs(Be(s),t,e,i,n,r,1);break}}}function Dh(s){const t=s.prev,e=s,i=s.next;if(K(t,e,i)>=0)return!1;const n=t.x,r=e.x,o=i.x,a=t.y,l=e.y,c=i.y,h=Math.min(n,r,o),d=Math.min(a,l,c),u=Math.max(n,r,o),f=Math.max(a,l,c);let m=i.next;for(;m!==t;){if(m.x>=h&&m.x<=u&&m.y>=d&&m.y<=f&&Gs(n,a,r,l,o,c,m.x,m.y)&&K(m.prev,m,m.next)>=0)return!1;m=m.next}return!0}function Gh(s,t,e,i){const n=s.prev,r=s,o=s.next;if(K(n,r,o)>=0)return!1;const a=n.x,l=r.x,c=o.x,h=n.y,d=r.y,u=o.y,f=Math.min(a,l,c),m=Math.min(h,d,u),x=Math.max(a,l,c),p=Math.max(h,d,u),g=Hn(f,m,t,e,i),y=Hn(x,p,t,e,i);let b=s.prevZ,_=s.nextZ;for(;b&&b.z>=g&&_&&_.z<=y;){if(b.x>=f&&b.x<=x&&b.y>=m&&b.y<=p&&b!==n&&b!==o&&Gs(a,h,l,d,c,u,b.x,b.y)&&K(b.prev,b,b.next)>=0||(b=b.prevZ,_.x>=f&&_.x<=x&&_.y>=m&&_.y<=p&&_!==n&&_!==o&&Gs(a,h,l,d,c,u,_.x,_.y)&&K(_.prev,_,_.next)>=0))return!1;_=_.nextZ}for(;b&&b.z>=g;){if(b.x>=f&&b.x<=x&&b.y>=m&&b.y<=p&&b!==n&&b!==o&&Gs(a,h,l,d,c,u,b.x,b.y)&&K(b.prev,b,b.next)>=0)return!1;b=b.prevZ}for(;_&&_.z<=y;){if(_.x>=f&&_.x<=x&&_.y>=m&&_.y<=p&&_!==n&&_!==o&&Gs(a,h,l,d,c,u,_.x,_.y)&&K(_.prev,_,_.next)>=0)return!1;_=_.nextZ}return!0}function Oh(s,t){let e=s;do{const i=e.prev,n=e.next.next;!os(i,n)&&Ja(i,e,e.next,n)&&Xs(i,n)&&Xs(n,i)&&(t.push(i.i,e.i,n.i),Ks(e),Ks(e.next),e=s=n),e=e.next}while(e!==s);return Be(e)}function $h(s,t,e,i,n,r){let o=s;do{let a=o.next.next;for(;a!==o.prev;){if(o.i!==a.i&&Xh(o,a)){let l=Qa(o,a);o=Be(o,o.next),l=Be(l,l.next),qs(o,t,e,i,n,r,0),qs(l,t,e,i,n,r,0);return}a=a.next}o=o.next}while(o!==s)}function Wh(s,t,e,i){const n=[];for(let r=0,o=t.length;r<o;r++){const a=t[r]*i,l=r<o-1?t[r+1]*i:s.length,c=Ka(s,a,l,i,!1);c===c.next&&(c.steiner=!0),n.push(qh(c))}n.sort(Nh);for(let r=0;r<n.length;r++)e=Uh(n[r],e);return e}function Nh(s,t){let e=s.x-t.x;if(e===0&&(e=s.y-t.y,e===0)){const i=(s.next.y-s.y)/(s.next.x-s.x),n=(t.next.y-t.y)/(t.next.x-t.x);e=i-n}return e}function Uh(s,t){const e=Hh(s,t);if(!e)return t;const i=Qa(e,s);return Be(i,i.next),Be(e,e.next)}function Hh(s,t){let e=t;const i=s.x,n=s.y;let r=-1/0,o;if(os(s,e))return e;do{if(os(s,e.next))return e.next;if(n<=e.y&&n>=e.next.y&&e.next.y!==e.y){const d=e.x+(n-e.y)*(e.next.x-e.x)/(e.next.y-e.y);if(d<=i&&d>r&&(r=d,o=e.x<e.next.x?e:e.next,d===i))return o}e=e.next}while(e!==t);if(!o)return null;const a=o,l=o.x,c=o.y;let h=1/0;e=o;do{if(i>=e.x&&e.x>=l&&i!==e.x&&Za(n<c?i:r,n,l,c,n<c?r:i,n,e.x,e.y)){const d=Math.abs(n-e.y)/(i-e.x);Xs(e,s)&&(d<h||d===h&&(e.x>o.x||e.x===o.x&&jh(o,e)))&&(o=e,h=d)}e=e.next}while(e!==a);return o}function jh(s,t){return K(s.prev,s,t.prev)<0&&K(t.next,s,s.next)<0}function Yh(s,t,e,i){let n=s;do n.z===0&&(n.z=Hn(n.x,n.y,t,e,i)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next;while(n!==s);n.prevZ.nextZ=null,n.prevZ=null,Vh(n)}function Vh(s){let t,e=1;do{let i=s,n;s=null;let r=null;for(t=0;i;){t++;let o=i,a=0;for(let c=0;c<e&&(a++,o=o.nextZ,!!o);c++);let l=e;for(;a>0||l>0&&o;)a!==0&&(l===0||!o||i.z<=o.z)?(n=i,i=i.nextZ,a--):(n=o,o=o.nextZ,l--),r?r.nextZ=n:s=n,n.prevZ=r,r=n;i=o}r.nextZ=null,e*=2}while(t>1);return s}function Hn(s,t,e,i,n){return s=(s-e)*n|0,t=(t-i)*n|0,s=(s|s<<8)&16711935,s=(s|s<<4)&252645135,s=(s|s<<2)&858993459,s=(s|s<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,s|t<<1}function qh(s){let t=s,e=s;do(t.x<e.x||t.x===e.x&&t.y<e.y)&&(e=t),t=t.next;while(t!==s);return e}function Za(s,t,e,i,n,r,o,a){return(n-o)*(t-a)>=(s-o)*(r-a)&&(s-o)*(i-a)>=(e-o)*(t-a)&&(e-o)*(r-a)>=(n-o)*(i-a)}function Gs(s,t,e,i,n,r,o,a){return!(s===o&&t===a)&&Za(s,t,e,i,n,r,o,a)}function Xh(s,t){return s.next.i!==t.i&&s.prev.i!==t.i&&!Kh(s,t)&&(Xs(s,t)&&Xs(t,s)&&Zh(s,t)&&(K(s.prev,s,t.prev)||K(s,t.prev,t))||os(s,t)&&K(s.prev,s,s.next)>0&&K(t.prev,t,t.next)>0)}function K(s,t,e){return(t.y-s.y)*(e.x-t.x)-(t.x-s.x)*(e.y-t.y)}function os(s,t){return s.x===t.x&&s.y===t.y}function Ja(s,t,e,i){const n=vi(K(s,t,e)),r=vi(K(s,t,i)),o=vi(K(e,i,s)),a=vi(K(e,i,t));return!!(n!==r&&o!==a||n===0&&wi(s,e,t)||r===0&&wi(s,i,t)||o===0&&wi(e,s,i)||a===0&&wi(e,t,i))}function wi(s,t,e){return t.x<=Math.max(s.x,e.x)&&t.x>=Math.min(s.x,e.x)&&t.y<=Math.max(s.y,e.y)&&t.y>=Math.min(s.y,e.y)}function vi(s){return s>0?1:s<0?-1:0}function Kh(s,t){let e=s;do{if(e.i!==s.i&&e.next.i!==s.i&&e.i!==t.i&&e.next.i!==t.i&&Ja(e,e.next,s,t))return!0;e=e.next}while(e!==s);return!1}function Xs(s,t){return K(s.prev,s,s.next)<0?K(s,t,s.next)>=0&&K(s,s.prev,t)>=0:K(s,t,s.prev)<0||K(s,s.next,t)<0}function Zh(s,t){let e=s,i=!1;const n=(s.x+t.x)/2,r=(s.y+t.y)/2;do e.y>r!=e.next.y>r&&e.next.y!==e.y&&n<(e.next.x-e.x)*(r-e.y)/(e.next.y-e.y)+e.x&&(i=!i),e=e.next;while(e!==s);return i}function Qa(s,t){const e=jn(s.i,s.x,s.y),i=jn(t.i,t.x,t.y),n=s.next,r=t.prev;return s.next=t,t.prev=s,e.next=n,n.prev=e,i.next=e,e.prev=i,r.next=i,i.prev=r,i}function io(s,t,e,i){const n=jn(s,t,e);return i?(n.next=i.next,n.prev=i,i.next.prev=n,i.next=n):(n.prev=n,n.next=n),n}function Ks(s){s.next.prev=s.prev,s.prev.next=s.next,s.prevZ&&(s.prevZ.nextZ=s.nextZ),s.nextZ&&(s.nextZ.prevZ=s.prevZ)}function jn(s,t,e){return{i:s,x:t,y:e,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Jh(s,t,e,i){let n=0;for(let r=t,o=e-i;r<e;r+=i)n+=(s[o]-s[r])*(s[r+1]+s[o+1]),o=r;return n}const Qh=so.default||so;var tl=(s=>(s[s.NONE=0]="NONE",s[s.COLOR=16384]="COLOR",s[s.STENCIL=1024]="STENCIL",s[s.DEPTH=256]="DEPTH",s[s.COLOR_DEPTH=16640]="COLOR_DEPTH",s[s.COLOR_STENCIL=17408]="COLOR_STENCIL",s[s.DEPTH_STENCIL=1280]="DEPTH_STENCIL",s[s.ALL=17664]="ALL",s))(tl||{});class td{constructor(t){this.items=[],this._name=t}emit(t,e,i,n,r,o,a,l){const{name:c,items:h}=this;for(let d=0,u=h.length;d<u;d++)h[d][c](t,e,i,n,r,o,a,l);return this}add(t){return t[this._name]&&(this.remove(t),this.items.push(t)),this}remove(t){const e=this.items.indexOf(t);return e!==-1&&this.items.splice(e,1),this}contains(t){return this.items.indexOf(t)!==-1}removeAll(){return this.items.length=0,this}destroy(){this.removeAll(),this.items=null,this._name=null}get empty(){return this.items.length===0}get name(){return this._name}}const ed=["init","destroy","contextChange","resolutionChange","resetState","renderEnd","renderStart","render","update","postrender","prerender"],el=class sl extends Bt{constructor(t){super(),this.uid=Q("renderer"),this.runners=Object.create(null),this.renderPipes=Object.create(null),this._initOptions={},this._systemsHash=Object.create(null),this.type=t.type,this.name=t.name,this.config=t;const e=[...ed,...this.config.runners??[]];this._addRunners(...e),this._unsafeEvalCheck()}async init(t={}){const e=t.skipExtensionImports===!0?!0:t.manageImports===!1;await Fh(e),this._addSystems(this.config.systems),this._addPipes(this.config.renderPipes,this.config.renderPipeAdaptors);for(const i in this._systemsHash)t={...this._systemsHash[i].constructor.defaultOptions,...t};t={...sl.defaultOptions,...t},this._roundPixels=t.roundPixels?1:0;for(let i=0;i<this.runners.init.items.length;i++)await this.runners.init.items[i].init(t);this._initOptions=t}render(t,e){let i=t;if(i instanceof it&&(i={container:i},e&&(z(N,"passing a second argument is deprecated, please use render options instead"),i.target=e.renderTexture)),i.target||(i.target=this.view.renderTarget),i.target===this.view.renderTarget&&(this._lastObjectRendered=i.container,i.clearColor??(i.clearColor=this.background.colorRgba),i.clear??(i.clear=this.background.clearBeforeRender)),i.clearColor){const n=Array.isArray(i.clearColor)&&i.clearColor.length===4;i.clearColor=n?i.clearColor:st.shared.setValue(i.clearColor).toArray()}i.transform||(i.container.updateLocalTransform(),i.transform=i.container.localTransform),i.container.visible&&(i.container.enableRenderGroup(),this.runners.prerender.emit(i),this.runners.renderStart.emit(i),this.runners.render.emit(i),this.runners.renderEnd.emit(i),this.runners.postrender.emit(i))}resize(t,e,i){const n=this.view.resolution;this.view.resize(t,e,i),this.emit("resize",this.view.screen.width,this.view.screen.height,this.view.resolution),i!==void 0&&i!==n&&this.runners.resolutionChange.emit(i)}clear(t={}){const e=this;t.target||(t.target=e.renderTarget.renderTarget),t.clearColor||(t.clearColor=this.background.colorRgba),t.clear??(t.clear=tl.ALL);const{clear:i,clearColor:n,target:r}=t;st.shared.setValue(n??this.background.colorRgba),e.renderTarget.clear(r,i,st.shared.toArray())}get resolution(){return this.view.resolution}set resolution(t){this.view.resolution=t,this.runners.resolutionChange.emit(t)}get width(){return this.view.texture.frame.width}get height(){return this.view.texture.frame.height}get canvas(){return this.view.canvas}get lastObjectRendered(){return this._lastObjectRendered}get renderingToScreen(){return this.renderTarget.renderingToScreen}get screen(){return this.view.screen}_addRunners(...t){t.forEach(e=>{this.runners[e]=new td(e)})}_addSystems(t){let e;for(e in t){const i=t[e];this._addSystem(i.value,i.name)}}_addSystem(t,e){const i=new t(this);if(this[e])throw new Error(`Whoops! The name "${e}" is already in use`);this[e]=i,this._systemsHash[e]=i;for(const n in this.runners)this.runners[n].add(i);return this}_addPipes(t,e){const i=e.reduce((n,r)=>(n[r.name]=r.value,n),{});t.forEach(n=>{const r=n.value,o=n.name,a=i[o];this.renderPipes[o]=new r(this,a?new a:null),this.runners.destroy.add(this.renderPipes[o])})}destroy(t=!1){this.runners.destroy.items.reverse(),this.runners.destroy.emit(t),Object.values(this.runners).forEach(e=>{e.destroy()}),(t===!0||typeof t=="object"&&t.releaseGlobalResources)&&si.release(),this._systemsHash=null,this.renderPipes=null}generateTexture(t){return this.textureGenerator.generateTexture(t)}get roundPixels(){return!!this._roundPixels}_unsafeEvalCheck(){if(!zh())throw new Error("Current environment does not allow unsafe-eval, please use pixi.js/unsafe-eval module to enable support.")}resetState(){this.runners.resetState.emit()}};el.defaultOptions={resolution:1,failIfMajorPerformanceCaveat:!1,roundPixels:!1};let il=el,Si;function sd(s){return Si!==void 0||(Si=(()=>{var e;const t={stencil:!0,failIfMajorPerformanceCaveat:s??il.defaultOptions.failIfMajorPerformanceCaveat};try{if(!j.get().getWebGLRenderingContext())return!1;let n=j.get().createCanvas().getContext("webgl",t);const r=!!((e=n==null?void 0:n.getContextAttributes())!=null&&e.stencil);if(n){const o=n.getExtension("WEBGL_lose_context");o&&o.loseContext()}return n=null,r}catch{return!1}})()),Si}let ki;async function id(s={}){return ki!==void 0||(ki=await(async()=>{const t=j.get().getNavigator().gpu;if(!t)return!1;try{return await(await t.requestAdapter(s)).requestDevice(),!0}catch{return!1}})()),ki}const no=["webgl","webgpu","canvas"];async function nd(s){let t=[];s.preference?(t.push(s.preference),no.forEach(r=>{r!==s.preference&&t.push(r)})):t=no.slice();let e,i={};for(let r=0;r<t.length;r++){const o=t[r];if(o==="webgpu"&&await id()){const{WebGPURenderer:a}=await Ri(async()=>{const{WebGPURenderer:l}=await import("./WebGPURenderer-uNAiHXuS.js");return{WebGPURenderer:l}},__vite__mapDeps([3,2,4]));e=a,i={...s,...s.webgpu};break}else if(o==="webgl"&&sd(s.failIfMajorPerformanceCaveat??il.defaultOptions.failIfMajorPerformanceCaveat)){const{WebGLRenderer:a}=await Ri(async()=>{const{WebGLRenderer:l}=await import("./WebGLRenderer-BPoQD2_1.js");return{WebGLRenderer:l}},__vite__mapDeps([5,2,4]));e=a,i={...s,...s.webgl};break}else if(o==="canvas")throw i={...s},new Error("CanvasRenderer is not yet implemented")}if(delete i.webgpu,delete i.webgl,!e)throw new Error("No available renderer for the current environment");const n=new e;return await n.init(i),n}const nl="8.13.2";class rl{static init(){var t;(t=globalThis.__PIXI_APP_INIT__)==null||t.call(globalThis,this,nl)}static destroy(){}}rl.extension=I.Application;class rd{constructor(t){this._renderer=t}init(){var t;(t=globalThis.__PIXI_RENDERER_INIT__)==null||t.call(globalThis,this._renderer,nl)}destroy(){this._renderer=null}}rd.extension={type:[I.WebGLSystem,I.WebGPUSystem],name:"initHook",priority:-10};const ol=class Yn{constructor(...t){this.stage=new it,t[0]!==void 0&&z(N,"Application constructor options are deprecated, please use Application.init() instead.")}async init(t){t={...t},this.renderer=await nd(t),Yn._plugins.forEach(e=>{e.init.call(this,t)})}render(){this.renderer.render({container:this.stage})}get canvas(){return this.renderer.canvas}get view(){return z(N,"Application.view is deprecated, please use Application.canvas instead."),this.renderer.canvas}get screen(){return this.renderer.screen}destroy(t=!1,e=!1){const i=Yn._plugins.slice(0);i.reverse(),i.forEach(n=>{n.destroy.call(this)}),this.stage.destroy(e),this.stage=null,this.renderer.destroy(t),this.renderer=null}};ol._plugins=[];let al=ol;dt.handleByList(I.Application,al._plugins);dt.add(rl);class ll extends Bt{constructor(){super(...arguments),this.chars=Object.create(null),this.lineHeight=0,this.fontFamily="",this.fontMetrics={fontSize:0,ascent:0,descent:0},this.baseLineOffset=0,this.distanceField={type:"none",range:0},this.pages=[],this.applyFillAsTint=!0,this.baseMeasurementFontSize=100,this.baseRenderedFontSize=100}get font(){return z(N,"BitmapFont.font is deprecated, please use BitmapFont.fontFamily instead."),this.fontFamily}get pageTextures(){return z(N,"BitmapFont.pageTextures is deprecated, please use BitmapFont.pages instead."),this.pages}get size(){return z(N,"BitmapFont.size is deprecated, please use BitmapFont.fontMetrics.fontSize instead."),this.fontMetrics.fontSize}get distanceFieldRange(){return z(N,"BitmapFont.distanceFieldRange is deprecated, please use BitmapFont.distanceField.range instead."),this.distanceField.range}get distanceFieldType(){return z(N,"BitmapFont.distanceFieldType is deprecated, please use BitmapFont.distanceField.type instead."),this.distanceField.type}destroy(t=!1){var e;this.emit("destroy",this),this.removeAllListeners();for(const i in this.chars)(e=this.chars[i].texture)==null||e.destroy();this.chars=null,t&&(this.pages.forEach(i=>i.texture.destroy(!0)),this.pages=null)}}/**
 * tiny-lru
 *
 * @copyright 2025 Jason Mulligan <jason.mulligan@avoidwork.com>
 * @license BSD-3-Clause
 * @version 11.4.5
 */class od{constructor(t=0,e=0,i=!1){this.first=null,this.items=Object.create(null),this.last=null,this.max=t,this.resetTtl=i,this.size=0,this.ttl=e}clear(){return this.first=null,this.items=Object.create(null),this.last=null,this.size=0,this}delete(t){if(this.has(t)){const e=this.items[t];delete this.items[t],this.size--,e.prev!==null&&(e.prev.next=e.next),e.next!==null&&(e.next.prev=e.prev),this.first===e&&(this.first=e.next),this.last===e&&(this.last=e.prev)}return this}entries(t=this.keys()){return t.map(e=>[e,this.get(e)])}evict(t=!1){if(t||this.size>0){const e=this.first;delete this.items[e.key],--this.size===0?(this.first=null,this.last=null):(this.first=e.next,this.first.prev=null)}return this}expiresAt(t){let e;return this.has(t)&&(e=this.items[t].expiry),e}get(t){const e=this.items[t];if(e!==void 0){if(this.ttl>0&&e.expiry<=Date.now()){this.delete(t);return}return this.moveToEnd(e),e.value}}has(t){return t in this.items}moveToEnd(t){this.last!==t&&(t.prev!==null&&(t.prev.next=t.next),t.next!==null&&(t.next.prev=t.prev),this.first===t&&(this.first=t.next),t.prev=this.last,t.next=null,this.last!==null&&(this.last.next=t),this.last=t,this.first===null&&(this.first=t))}keys(){const t=[];let e=this.first;for(;e!==null;)t.push(e.key),e=e.next;return t}setWithEvicted(t,e,i=this.resetTtl){let n=null;if(this.has(t))this.set(t,e,!0,i);else{this.max>0&&this.size===this.max&&(n={...this.first},this.evict(!0));let r=this.items[t]={expiry:this.ttl>0?Date.now()+this.ttl:this.ttl,key:t,prev:this.last,next:null,value:e};++this.size===1?this.first=r:this.last.next=r,this.last=r}return n}set(t,e,i=!1,n=this.resetTtl){let r=this.items[t];return i||r!==void 0?(r.value=e,i===!1&&n&&(r.expiry=this.ttl>0?Date.now()+this.ttl:this.ttl),this.moveToEnd(r)):(this.max>0&&this.size===this.max&&this.evict(!0),r=this.items[t]={expiry:this.ttl>0?Date.now()+this.ttl:this.ttl,key:t,prev:this.last,next:null,value:e},++this.size===1?this.first=r:this.last.next=r,this.last=r),this}values(t=this.keys()){return t.map(e=>this.get(e))}}function cl(s=1e3,t=0,e=!1){if(isNaN(s)||s<0)throw new TypeError("Invalid max value");if(isNaN(t)||t<0)throw new TypeError("Invalid ttl value");if(typeof e!="boolean")throw new TypeError("Invalid resetTtl value");return new od(s,t,e)}const ad=["serif","sans-serif","monospace","cursive","fantasy","system-ui"];function zi(s){const t=typeof s.fontSize=="number"?`${s.fontSize}px`:s.fontSize;let e=s.fontFamily;Array.isArray(s.fontFamily)||(e=s.fontFamily.split(","));for(let i=e.length-1;i>=0;i--){let n=e[i].trim();!/([\"\'])[^\'\"]+\1/.test(n)&&!ad.includes(n)&&(n=`"${n}"`),e[i]=n}return`${s.fontStyle} ${s.fontVariant} ${s.fontWeight} ${t} ${e.join(",")}`}const mn={willReadFrequently:!0},Ft=class E{static get experimentalLetterSpacingSupported(){let t=E._experimentalLetterSpacingSupported;if(t===void 0){const e=j.get().getCanvasRenderingContext2D().prototype;t=E._experimentalLetterSpacingSupported="letterSpacing"in e||"textLetterSpacing"in e}return t}constructor(t,e,i,n,r,o,a,l,c){this.text=t,this.style=e,this.width=i,this.height=n,this.lines=r,this.lineWidths=o,this.lineHeight=a,this.maxLineWidth=l,this.fontProperties=c}static measureText(t=" ",e,i=E._canvas,n=e.wordWrap){var y;const r=`${t}-${e.styleKey}-wordWrap-${n}`;if(E._measurementCache.has(r))return E._measurementCache.get(r);const o=zi(e),a=E.measureFont(o);a.fontSize===0&&(a.fontSize=e.fontSize,a.ascent=e.fontSize);const l=E.__context;l.font=o;const h=(n?E._wordWrap(t,e,i):t).split(/(?:\r\n|\r|\n)/),d=new Array(h.length);let u=0;for(let b=0;b<h.length;b++){const _=E._measureText(h[b],e.letterSpacing,l);d[b]=_,u=Math.max(u,_)}const f=((y=e._stroke)==null?void 0:y.width)||0;let m=u+f;e.dropShadow&&(m+=e.dropShadow.distance);const x=e.lineHeight||a.fontSize;let p=Math.max(x,a.fontSize+f)+(h.length-1)*(x+e.leading);e.dropShadow&&(p+=e.dropShadow.distance);const g=new E(t,e,m,p,h,d,x+e.leading,u,a);return E._measurementCache.set(r,g),g}static _measureText(t,e,i){let n=!1;E.experimentalLetterSpacingSupported&&(E.experimentalLetterSpacing?(i.letterSpacing=`${e}px`,i.textLetterSpacing=`${e}px`,n=!0):(i.letterSpacing="0px",i.textLetterSpacing="0px"));const r=i.measureText(t);let o=r.width;const a=-r.actualBoundingBoxLeft;let c=r.actualBoundingBoxRight-a;if(o>0)if(n)o-=e,c-=e;else{const h=(E.graphemeSegmenter(t).length-1)*e;o+=h,c+=h}return Math.max(o,c)}static _wordWrap(t,e,i=E._canvas){const n=i.getContext("2d",mn);let r=0,o="",a="";const l=Object.create(null),{letterSpacing:c,whiteSpace:h}=e,d=E._collapseSpaces(h),u=E._collapseNewlines(h);let f=!d;const m=e.wordWrapWidth+c,x=E._tokenize(t);for(let p=0;p<x.length;p++){let g=x[p];if(E._isNewline(g)){if(!u){a+=E._addLine(o),f=!d,o="",r=0;continue}g=" "}if(d){const b=E.isBreakingSpace(g),_=E.isBreakingSpace(o[o.length-1]);if(b&&_)continue}const y=E._getFromCache(g,c,l,n);if(y>m)if(o!==""&&(a+=E._addLine(o),o="",r=0),E.canBreakWords(g,e.breakWords)){const b=E.wordWrapSplit(g);for(let _=0;_<b.length;_++){let S=b[_],v=S,w=1;for(;b[_+w];){const T=b[_+w];if(!E.canBreakChars(v,T,g,_,e.breakWords))S+=T;else break;v=T,w++}_+=w-1;const C=E._getFromCache(S,c,l,n);C+r>m&&(a+=E._addLine(o),f=!1,o="",r=0),o+=S,r+=C}}else{o.length>0&&(a+=E._addLine(o),o="",r=0);const b=p===x.length-1;a+=E._addLine(g,!b),f=!1,o="",r=0}else y+r>m&&(f=!1,a+=E._addLine(o),o="",r=0),(o.length>0||!E.isBreakingSpace(g)||f)&&(o+=g,r+=y)}return a+=E._addLine(o,!1),a}static _addLine(t,e=!0){return t=E._trimRight(t),t=e?`${t}
`:t,t}static _getFromCache(t,e,i,n){let r=i[t];return typeof r!="number"&&(r=E._measureText(t,e,n)+e,i[t]=r),r}static _collapseSpaces(t){return t==="normal"||t==="pre-line"}static _collapseNewlines(t){return t==="normal"}static _trimRight(t){if(typeof t!="string")return"";for(let e=t.length-1;e>=0;e--){const i=t[e];if(!E.isBreakingSpace(i))break;t=t.slice(0,-1)}return t}static _isNewline(t){return typeof t!="string"?!1:E._newlines.includes(t.charCodeAt(0))}static isBreakingSpace(t,e){return typeof t!="string"?!1:E._breakingSpaces.includes(t.charCodeAt(0))}static _tokenize(t){const e=[];let i="";if(typeof t!="string")return e;for(let n=0;n<t.length;n++){const r=t[n],o=t[n+1];if(E.isBreakingSpace(r,o)||E._isNewline(r)){i!==""&&(e.push(i),i=""),r==="\r"&&o===`
`?(e.push(`\r
`),n++):e.push(r);continue}i+=r}return i!==""&&e.push(i),e}static canBreakWords(t,e){return e}static canBreakChars(t,e,i,n,r){return!0}static wordWrapSplit(t){return E.graphemeSegmenter(t)}static measureFont(t){if(E._fonts[t])return E._fonts[t];const e=E._context;e.font=t;const i=e.measureText(E.METRICS_STRING+E.BASELINE_SYMBOL),n={ascent:i.actualBoundingBoxAscent,descent:i.actualBoundingBoxDescent,fontSize:i.actualBoundingBoxAscent+i.actualBoundingBoxDescent};return E._fonts[t]=n,n}static clearMetrics(t=""){t?delete E._fonts[t]:E._fonts={}}static get _canvas(){if(!E.__canvas){let t;try{const e=new OffscreenCanvas(0,0),i=e.getContext("2d",mn);if(i!=null&&i.measureText)return E.__canvas=e,e;t=j.get().createCanvas()}catch{t=j.get().createCanvas()}t.width=t.height=10,E.__canvas=t}return E.__canvas}static get _context(){return E.__context||(E.__context=E._canvas.getContext("2d",mn)),E.__context}};Ft.METRICS_STRING="|ÉqÅ";Ft.BASELINE_SYMBOL="M";Ft.BASELINE_MULTIPLIER=1.4;Ft.HEIGHT_MULTIPLIER=2;Ft.graphemeSegmenter=(()=>{if(typeof(Intl==null?void 0:Intl.Segmenter)=="function"){const s=new Intl.Segmenter;return t=>{const e=s.segment(t),i=[];let n=0;for(const r of e)i[n++]=r.segment;return i}}return s=>[...s]})();Ft.experimentalLetterSpacing=!1;Ft._fonts={};Ft._newlines=[10,13];Ft._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];Ft._measurementCache=cl(1e3);let Wt=Ft;const ro=[{offset:0,color:"white"},{offset:1,color:"black"}],ar=class Vn{constructor(...t){this.uid=Q("fillGradient"),this._tick=0,this.type="linear",this.colorStops=[];let e=ld(t);e={...e.type==="radial"?Vn.defaultRadialOptions:Vn.defaultLinearOptions,...fa(e)},this._textureSize=e.textureSize,this._wrapMode=e.wrapMode,e.type==="radial"?(this.center=e.center,this.outerCenter=e.outerCenter??this.center,this.innerRadius=e.innerRadius,this.outerRadius=e.outerRadius,this.scale=e.scale,this.rotation=e.rotation):(this.start=e.start,this.end=e.end),this.textureSpace=e.textureSpace,this.type=e.type,e.colorStops.forEach(n=>{this.addColorStop(n.offset,n.color)})}addColorStop(t,e){return this.colorStops.push({offset:t,color:st.shared.setValue(e).toHexa()}),this}buildLinearGradient(){if(this.texture)return;let{x:t,y:e}=this.start,{x:i,y:n}=this.end,r=i-t,o=n-e;const a=r<0||o<0;if(this._wrapMode==="clamp-to-edge"){if(r<0){const p=t;t=i,i=p,r*=-1}if(o<0){const p=e;e=n,n=p,o*=-1}}const l=this.colorStops.length?this.colorStops:ro,c=this._textureSize,{canvas:h,context:d}=ao(c,1),u=a?d.createLinearGradient(this._textureSize,0,0,0):d.createLinearGradient(0,0,this._textureSize,0);oo(u,l),d.fillStyle=u,d.fillRect(0,0,c,1),this.texture=new O({source:new Le({resource:h,addressMode:this._wrapMode})});const f=Math.sqrt(r*r+o*o),m=Math.atan2(o,r),x=new G;x.scale(f/c,1),x.rotate(m),x.translate(t,e),this.textureSpace==="local"&&x.scale(c,c),this.transform=x}buildGradient(){this.texture||this._tick++,this.type==="linear"?this.buildLinearGradient():this.buildRadialGradient()}buildRadialGradient(){if(this.texture)return;const t=this.colorStops.length?this.colorStops:ro,e=this._textureSize,{canvas:i,context:n}=ao(e,e),{x:r,y:o}=this.center,{x:a,y:l}=this.outerCenter,c=this.innerRadius,h=this.outerRadius,d=a-h,u=l-h,f=e/(h*2),m=(r-d)*f,x=(o-u)*f,p=n.createRadialGradient(m,x,c*f,(a-d)*f,(l-u)*f,h*f);oo(p,t),n.fillStyle=t[t.length-1].color,n.fillRect(0,0,e,e),n.fillStyle=p,n.translate(m,x),n.rotate(this.rotation),n.scale(1,this.scale),n.translate(-m,-x),n.fillRect(0,0,e,e),this.texture=new O({source:new Le({resource:i,addressMode:this._wrapMode})});const g=new G;g.scale(1/f,1/f),g.translate(d,u),this.textureSpace==="local"&&g.scale(e,e),this.transform=g}destroy(){var t;(t=this.texture)==null||t.destroy(!0),this.texture=null,this.transform=null,this.colorStops=[],this.start=null,this.end=null,this.center=null,this.outerCenter=null}get styleKey(){return`fill-gradient-${this.uid}-${this._tick}`}};ar.defaultLinearOptions={start:{x:0,y:0},end:{x:0,y:1},colorStops:[],textureSpace:"local",type:"linear",textureSize:256,wrapMode:"clamp-to-edge"};ar.defaultRadialOptions={center:{x:.5,y:.5},innerRadius:0,outerRadius:.5,colorStops:[],scale:1,textureSpace:"local",type:"radial",textureSize:256,wrapMode:"clamp-to-edge"};let Qt=ar;function oo(s,t){for(let e=0;e<t.length;e++){const i=t[e];s.addColorStop(i.offset,i.color)}}function ao(s,t){const e=j.get().createCanvas(s,t),i=e.getContext("2d");return{canvas:e,context:i}}function ld(s){let t=s[0]??{};return(typeof t=="number"||s[1])&&(z("8.5.2","use options object instead"),t={type:"linear",start:{x:s[0],y:s[1]},end:{x:s[2],y:s[3]},textureSpace:s[4],textureSize:s[5]??Qt.defaultLinearOptions.textureSize}),t}const lo={repeat:{addressModeU:"repeat",addressModeV:"repeat"},"repeat-x":{addressModeU:"repeat",addressModeV:"clamp-to-edge"},"repeat-y":{addressModeU:"clamp-to-edge",addressModeV:"repeat"},"no-repeat":{addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}};class Hi{constructor(t,e){this.uid=Q("fillPattern"),this._tick=0,this.transform=new G,this.texture=t,this.transform.scale(1/t.frame.width,1/t.frame.height),e&&(t.source.style.addressModeU=lo[e].addressModeU,t.source.style.addressModeV=lo[e].addressModeV)}setTransform(t){const e=this.texture;this.transform.copyFrom(t),this.transform.invert(),this.transform.scale(1/e.frame.width,1/e.frame.height),this._tick++}get texture(){return this._texture}set texture(t){this._texture!==t&&(this._texture=t,this._tick++)}get styleKey(){return`fill-pattern-${this.uid}-${this._tick}`}destroy(){this.texture.destroy(!0),this.texture=null}}var cd=dd,gn={a:7,c:6,h:1,l:2,m:2,q:4,s:4,t:2,v:1,z:0},hd=/([astvzqmhlc])([^astvzqmhlc]*)/ig;function dd(s){var t=[];return s.replace(hd,function(e,i,n){var r=i.toLowerCase();for(n=fd(n),r=="m"&&n.length>2&&(t.push([i].concat(n.splice(0,2))),r="l",i=i=="m"?"l":"L");;){if(n.length==gn[r])return n.unshift(i),t.push(n);if(n.length<gn[r])throw new Error("malformed path data");t.push([i].concat(n.splice(0,gn[r])))}}),t}var ud=/-?[0-9]*\.?[0-9]+(?:e[-+]?\d+)?/ig;function fd(s){var t=s.match(ud);return t?t.map(Number):[]}const pd=ca(cd);function md(s,t){const e=pd(s),i=[];let n=null,r=0,o=0;for(let a=0;a<e.length;a++){const l=e[a],c=l[0],h=l;switch(c){case"M":r=h[1],o=h[2],t.moveTo(r,o);break;case"m":r+=h[1],o+=h[2],t.moveTo(r,o);break;case"H":r=h[1],t.lineTo(r,o);break;case"h":r+=h[1],t.lineTo(r,o);break;case"V":o=h[1],t.lineTo(r,o);break;case"v":o+=h[1],t.lineTo(r,o);break;case"L":r=h[1],o=h[2],t.lineTo(r,o);break;case"l":r+=h[1],o+=h[2],t.lineTo(r,o);break;case"C":r=h[5],o=h[6],t.bezierCurveTo(h[1],h[2],h[3],h[4],r,o);break;case"c":t.bezierCurveTo(r+h[1],o+h[2],r+h[3],o+h[4],r+h[5],o+h[6]),r+=h[5],o+=h[6];break;case"S":r=h[3],o=h[4],t.bezierCurveToShort(h[1],h[2],r,o);break;case"s":t.bezierCurveToShort(r+h[1],o+h[2],r+h[3],o+h[4]),r+=h[3],o+=h[4];break;case"Q":r=h[3],o=h[4],t.quadraticCurveTo(h[1],h[2],r,o);break;case"q":t.quadraticCurveTo(r+h[1],o+h[2],r+h[3],o+h[4]),r+=h[3],o+=h[4];break;case"T":r=h[1],o=h[2],t.quadraticCurveToShort(r,o);break;case"t":r+=h[1],o+=h[2],t.quadraticCurveToShort(r,o);break;case"A":r=h[6],o=h[7],t.arcToSvg(h[1],h[2],h[3],h[4],h[5],r,o);break;case"a":r+=h[6],o+=h[7],t.arcToSvg(h[1],h[2],h[3],h[4],h[5],r,o);break;case"Z":case"z":t.closePath(),i.length>0&&(n=i.pop(),n?(r=n.startX,o=n.startY):(r=0,o=0)),n=null;break;default:V(`Unknown SVG path command: ${c}`)}c!=="Z"&&c!=="z"&&n===null&&(n={startX:r,startY:o},i.push(n))}return t}class ji{constructor(t=0,e=0,i=0){this.type="circle",this.x=t,this.y=e,this.radius=i}clone(){return new ji(this.x,this.y,this.radius)}contains(t,e){if(this.radius<=0)return!1;const i=this.radius*this.radius;let n=this.x-t,r=this.y-e;return n*=n,r*=r,n+r<=i}strokeContains(t,e,i,n=.5){if(this.radius===0)return!1;const r=this.x-t,o=this.y-e,a=this.radius,l=(1-n)*i,c=Math.sqrt(r*r+o*o);return c<=a+l&&c>a-(i-l)}getBounds(t){return t||(t=new X),t.x=this.x-this.radius,t.y=this.y-this.radius,t.width=this.radius*2,t.height=this.radius*2,t}copyFrom(t){return this.x=t.x,this.y=t.y,this.radius=t.radius,this}copyTo(t){return t.copyFrom(this),t}toString(){return`[pixi.js/math:Circle x=${this.x} y=${this.y} radius=${this.radius}]`}}class lr{constructor(t=0,e=0,i=0,n=0){this.type="ellipse",this.x=t,this.y=e,this.halfWidth=i,this.halfHeight=n}clone(){return new lr(this.x,this.y,this.halfWidth,this.halfHeight)}contains(t,e){if(this.halfWidth<=0||this.halfHeight<=0)return!1;let i=(t-this.x)/this.halfWidth,n=(e-this.y)/this.halfHeight;return i*=i,n*=n,i+n<=1}strokeContains(t,e,i,n=.5){const{halfWidth:r,halfHeight:o}=this;if(r<=0||o<=0)return!1;const a=i*(1-n),l=i-a,c=r-l,h=o-l,d=r+a,u=o+a,f=t-this.x,m=e-this.y,x=f*f/(c*c)+m*m/(h*h),p=f*f/(d*d)+m*m/(u*u);return x>1&&p<=1}getBounds(t){return t||(t=new X),t.x=this.x-this.halfWidth,t.y=this.y-this.halfHeight,t.width=this.halfWidth*2,t.height=this.halfHeight*2,t}copyFrom(t){return this.x=t.x,this.y=t.y,this.halfWidth=t.halfWidth,this.halfHeight=t.halfHeight,this}copyTo(t){return t.copyFrom(this),t}toString(){return`[pixi.js/math:Ellipse x=${this.x} y=${this.y} halfWidth=${this.halfWidth} halfHeight=${this.halfHeight}]`}}function gd(s,t,e,i,n,r){const o=s-e,a=t-i,l=n-e,c=r-i,h=o*l+a*c,d=l*l+c*c;let u=-1;d!==0&&(u=h/d);let f,m;u<0?(f=e,m=i):u>1?(f=n,m=r):(f=e+u*l,m=i+u*c);const x=s-f,p=t-m;return x*x+p*p}let yd,xd;class Ws{constructor(...t){this.type="polygon";let e=Array.isArray(t[0])?t[0]:t;if(typeof e[0]!="number"){const i=[];for(let n=0,r=e.length;n<r;n++)i.push(e[n].x,e[n].y);e=i}this.points=e,this.closePath=!0}isClockwise(){let t=0;const e=this.points,i=e.length;for(let n=0;n<i;n+=2){const r=e[n],o=e[n+1],a=e[(n+2)%i],l=e[(n+3)%i];t+=(a-r)*(l+o)}return t<0}containsPolygon(t){const e=this.getBounds(yd),i=t.getBounds(xd);if(!e.containsRect(i))return!1;const n=t.points;for(let r=0;r<n.length;r+=2){const o=n[r],a=n[r+1];if(!this.contains(o,a))return!1}return!0}clone(){const t=this.points.slice(),e=new Ws(t);return e.closePath=this.closePath,e}contains(t,e){let i=!1;const n=this.points.length/2;for(let r=0,o=n-1;r<n;o=r++){const a=this.points[r*2],l=this.points[r*2+1],c=this.points[o*2],h=this.points[o*2+1];l>e!=h>e&&t<(c-a)*((e-l)/(h-l))+a&&(i=!i)}return i}strokeContains(t,e,i,n=.5){const r=i*i,o=r*(1-n),a=r-o,{points:l}=this,c=l.length-(this.closePath?0:2);for(let h=0;h<c;h+=2){const d=l[h],u=l[h+1],f=l[(h+2)%l.length],m=l[(h+3)%l.length],x=gd(t,e,d,u,f,m),p=Math.sign((f-d)*(e-u)-(m-u)*(t-d));if(x<=(p<0?a:o))return!0}return!1}getBounds(t){t||(t=new X);const e=this.points;let i=1/0,n=-1/0,r=1/0,o=-1/0;for(let a=0,l=e.length;a<l;a+=2){const c=e[a],h=e[a+1];i=c<i?c:i,n=c>n?c:n,r=h<r?h:r,o=h>o?h:o}return t.x=i,t.width=n-i,t.y=r,t.height=o-r,t}copyFrom(t){return this.points=t.points.slice(),this.closePath=t.closePath,this}copyTo(t){return t.copyFrom(this),t}toString(){return`[pixi.js/math:PolygoncloseStroke=${this.closePath}points=${this.points.reduce((t,e)=>`${t}, ${e}`,"")}]`}get lastX(){return this.points[this.points.length-2]}get lastY(){return this.points[this.points.length-1]}get x(){return z("8.11.0","Polygon.lastX is deprecated, please use Polygon.lastX instead."),this.points[this.points.length-2]}get y(){return z("8.11.0","Polygon.y is deprecated, please use Polygon.lastY instead."),this.points[this.points.length-1]}get startX(){return this.points[0]}get startY(){return this.points[1]}}const Ai=(s,t,e,i,n,r,o)=>{const a=s-e,l=t-i,c=Math.sqrt(a*a+l*l);return c>=n-r&&c<=n+o};class cr{constructor(t=0,e=0,i=0,n=0,r=20){this.type="roundedRectangle",this.x=t,this.y=e,this.width=i,this.height=n,this.radius=r}getBounds(t){return t||(t=new X),t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t}clone(){return new cr(this.x,this.y,this.width,this.height,this.radius)}copyFrom(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this}copyTo(t){return t.copyFrom(this),t}contains(t,e){if(this.width<=0||this.height<=0)return!1;if(t>=this.x&&t<=this.x+this.width&&e>=this.y&&e<=this.y+this.height){const i=Math.max(0,Math.min(this.radius,Math.min(this.width,this.height)/2));if(e>=this.y+i&&e<=this.y+this.height-i||t>=this.x+i&&t<=this.x+this.width-i)return!0;let n=t-(this.x+i),r=e-(this.y+i);const o=i*i;if(n*n+r*r<=o||(n=t-(this.x+this.width-i),n*n+r*r<=o)||(r=e-(this.y+this.height-i),n*n+r*r<=o)||(n=t-(this.x+i),n*n+r*r<=o))return!0}return!1}strokeContains(t,e,i,n=.5){const{x:r,y:o,width:a,height:l,radius:c}=this,h=i*(1-n),d=i-h,u=r+c,f=o+c,m=a-c*2,x=l-c*2,p=r+a,g=o+l;return(t>=r-h&&t<=r+d||t>=p-d&&t<=p+h)&&e>=f&&e<=f+x||(e>=o-h&&e<=o+d||e>=g-d&&e<=g+h)&&t>=u&&t<=u+m?!0:t<u&&e<f&&Ai(t,e,u,f,c,d,h)||t>p-c&&e<f&&Ai(t,e,p-c,f,c,d,h)||t>p-c&&e>g-c&&Ai(t,e,p-c,g-c,c,d,h)||t<u&&e>g-c&&Ai(t,e,u,g-c,c,d,h)}toString(){return`[pixi.js/math:RoundedRectangle x=${this.x} y=${this.y}width=${this.width} height=${this.height} radius=${this.radius}]`}}const hl={};function bd(s,t,e){let i=2166136261;for(let n=0;n<t;n++)i^=s[n].uid,i=Math.imul(i,16777619),i>>>=0;return hl[i]||_d(s,t,i,e)}function _d(s,t,e,i){const n={};let r=0;for(let a=0;a<i;a++){const l=a<t?s[a]:O.EMPTY.source;n[r++]=l.source,n[r++]=l.style}const o=new Li(n);return hl[e]=o,o}class co{constructor(t){typeof t=="number"?this.rawBinaryData=new ArrayBuffer(t):t instanceof Uint8Array?this.rawBinaryData=t.buffer:this.rawBinaryData=t,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData),this.size=this.rawBinaryData.byteLength}get int8View(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View}get uint8View(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View}get int16View(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View}get int32View(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View}get float64View(){return this._float64Array||(this._float64Array=new Float64Array(this.rawBinaryData)),this._float64Array}get bigUint64View(){return this._bigUint64Array||(this._bigUint64Array=new BigUint64Array(this.rawBinaryData)),this._bigUint64Array}view(t){return this[`${t}View`]}destroy(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this.uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null}static sizeOf(t){switch(t){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(`${t} isn't a valid view type`)}}}function ho(s,t){const e=s.byteLength/8|0,i=new Float64Array(s,0,e);new Float64Array(t,0,e).set(i);const r=s.byteLength-e*8;if(r>0){const o=new Uint8Array(s,e*8,r);new Uint8Array(t,e*8,r).set(o)}}const wd={normal:"normal-npm",add:"add-npm",screen:"screen-npm"};var vd=(s=>(s[s.DISABLED=0]="DISABLED",s[s.RENDERING_MASK_ADD=1]="RENDERING_MASK_ADD",s[s.MASK_ACTIVE=2]="MASK_ACTIVE",s[s.INVERSE_MASK_ACTIVE=3]="INVERSE_MASK_ACTIVE",s[s.RENDERING_MASK_REMOVE=4]="RENDERING_MASK_REMOVE",s[s.NONE=5]="NONE",s))(vd||{});function uo(s,t){return t.alphaMode==="no-premultiply-alpha"&&wd[s]||s}const Sd=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join(`
`);function kd(s){let t="";for(let e=0;e<s;++e)e>0&&(t+=`
else `),e<s-1&&(t+=`if(test == ${e}.0){}`);return t}function Ad(s,t){if(s===0)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");const e=t.createShader(t.FRAGMENT_SHADER);try{for(;;){const i=Sd.replace(/%forloop%/gi,kd(s));if(t.shaderSource(e,i),t.compileShader(e),!t.getShaderParameter(e,t.COMPILE_STATUS))s=s/2|0;else break}}finally{t.deleteShader(e)}return s}let Ne=null;function Cd(){var t;if(Ne)return Ne;const s=Ua();return Ne=s.getParameter(s.MAX_TEXTURE_IMAGE_UNITS),Ne=Ad(Ne,s),(t=s.getExtension("WEBGL_lose_context"))==null||t.loseContext(),Ne}class Md{constructor(){this.ids=Object.create(null),this.textures=[],this.count=0}clear(){for(let t=0;t<this.count;t++){const e=this.textures[t];this.textures[t]=null,this.ids[e.uid]=null}this.count=0}}class Td{constructor(){this.renderPipeId="batch",this.action="startBatch",this.start=0,this.size=0,this.textures=new Md,this.blendMode="normal",this.topology="triangle-strip",this.canBundle=!0}destroy(){this.textures=null,this.gpuBindGroup=null,this.bindGroup=null,this.batcher=null}}const Ns=[];let Di=0;si.register({clear:()=>{if(Ns.length>0)for(const s of Ns)s&&s.destroy();Ns.length=0,Di=0}});function fo(){return Di>0?Ns[--Di]:new Td}function po(s){Ns[Di++]=s}let Bs=0;const dl=class ul{constructor(t){this.uid=Q("batcher"),this.dirty=!0,this.batchIndex=0,this.batches=[],this._elements=[],t={...ul.defaultOptions,...t},t.maxTextures||(z("v8.8.0","maxTextures is a required option for Batcher now, please pass it in the options"),t.maxTextures=Cd());const{maxTextures:e,attributesInitialSize:i,indicesInitialSize:n}=t;this.attributeBuffer=new co(i*4),this.indexBuffer=new Uint16Array(n),this.maxTextures=e}begin(){this.elementSize=0,this.elementStart=0,this.indexSize=0,this.attributeSize=0;for(let t=0;t<this.batchIndex;t++)po(this.batches[t]);this.batchIndex=0,this._batchIndexStart=0,this._batchIndexSize=0,this.dirty=!0}add(t){this._elements[this.elementSize++]=t,t._indexStart=this.indexSize,t._attributeStart=this.attributeSize,t._batcher=this,this.indexSize+=t.indexSize,this.attributeSize+=t.attributeSize*this.vertexSize}checkAndUpdateTexture(t,e){const i=t._batch.textures.ids[e._source.uid];return!i&&i!==0?!1:(t._textureId=i,t.texture=e,!0)}updateElement(t){this.dirty=!0;const e=this.attributeBuffer;t.packAsQuad?this.packQuadAttributes(t,e.float32View,e.uint32View,t._attributeStart,t._textureId):this.packAttributes(t,e.float32View,e.uint32View,t._attributeStart,t._textureId)}break(t){const e=this._elements;if(!e[this.elementStart])return;let i=fo(),n=i.textures;n.clear();const r=e[this.elementStart];let o=uo(r.blendMode,r.texture._source),a=r.topology;this.attributeSize*4>this.attributeBuffer.size&&this._resizeAttributeBuffer(this.attributeSize*4),this.indexSize>this.indexBuffer.length&&this._resizeIndexBuffer(this.indexSize);const l=this.attributeBuffer.float32View,c=this.attributeBuffer.uint32View,h=this.indexBuffer;let d=this._batchIndexSize,u=this._batchIndexStart,f="startBatch";const m=this.maxTextures;for(let x=this.elementStart;x<this.elementSize;++x){const p=e[x];e[x]=null;const y=p.texture._source,b=uo(p.blendMode,y),_=o!==b||a!==p.topology;if(y._batchTick===Bs&&!_){p._textureId=y._textureBindLocation,d+=p.indexSize,p.packAsQuad?(this.packQuadAttributes(p,l,c,p._attributeStart,p._textureId),this.packQuadIndex(h,p._indexStart,p._attributeStart/this.vertexSize)):(this.packAttributes(p,l,c,p._attributeStart,p._textureId),this.packIndex(p,h,p._indexStart,p._attributeStart/this.vertexSize)),p._batch=i;continue}y._batchTick=Bs,(n.count>=m||_)&&(this._finishBatch(i,u,d-u,n,o,a,t,f),f="renderBatch",u=d,o=b,a=p.topology,i=fo(),n=i.textures,n.clear(),++Bs),p._textureId=y._textureBindLocation=n.count,n.ids[y.uid]=n.count,n.textures[n.count++]=y,p._batch=i,d+=p.indexSize,p.packAsQuad?(this.packQuadAttributes(p,l,c,p._attributeStart,p._textureId),this.packQuadIndex(h,p._indexStart,p._attributeStart/this.vertexSize)):(this.packAttributes(p,l,c,p._attributeStart,p._textureId),this.packIndex(p,h,p._indexStart,p._attributeStart/this.vertexSize))}n.count>0&&(this._finishBatch(i,u,d-u,n,o,a,t,f),u=d,++Bs),this.elementStart=this.elementSize,this._batchIndexStart=u,this._batchIndexSize=d}_finishBatch(t,e,i,n,r,o,a,l){t.gpuBindGroup=null,t.bindGroup=null,t.action=l,t.batcher=this,t.textures=n,t.blendMode=r,t.topology=o,t.start=e,t.size=i,++Bs,this.batches[this.batchIndex++]=t,a.add(t)}finish(t){this.break(t)}ensureAttributeBuffer(t){t*4<=this.attributeBuffer.size||this._resizeAttributeBuffer(t*4)}ensureIndexBuffer(t){t<=this.indexBuffer.length||this._resizeIndexBuffer(t)}_resizeAttributeBuffer(t){const e=Math.max(t,this.attributeBuffer.size*2),i=new co(e);ho(this.attributeBuffer.rawBinaryData,i.rawBinaryData),this.attributeBuffer=i}_resizeIndexBuffer(t){const e=this.indexBuffer;let i=Math.max(t,e.length*1.5);i+=i%2;const n=i>65535?new Uint32Array(i):new Uint16Array(i);if(n.BYTES_PER_ELEMENT!==e.BYTES_PER_ELEMENT)for(let r=0;r<e.length;r++)n[r]=e[r];else ho(e.buffer,n.buffer);this.indexBuffer=n}packQuadIndex(t,e,i){t[e]=i+0,t[e+1]=i+1,t[e+2]=i+2,t[e+3]=i+0,t[e+4]=i+2,t[e+5]=i+3}packIndex(t,e,i,n){const r=t.indices,o=t.indexSize,a=t.indexOffset,l=t.attributeOffset;for(let c=0;c<o;c++)e[i++]=n+r[c+a]-l}destroy(){if(this.batches!==null){for(let t=0;t<this.batches.length;t++)po(this.batches[t]);this.batches=null;for(let t=0;t<this._elements.length;t++)this._elements[t]&&(this._elements[t]._batch=null);this._elements=null,this.indexBuffer=null,this.attributeBuffer.destroy(),this.attributeBuffer=null}}};dl.defaultOptions={maxTextures:null,attributesInitialSize:4,indicesInitialSize:6};let Pd=dl;var gt=(s=>(s[s.MAP_READ=1]="MAP_READ",s[s.MAP_WRITE=2]="MAP_WRITE",s[s.COPY_SRC=4]="COPY_SRC",s[s.COPY_DST=8]="COPY_DST",s[s.INDEX=16]="INDEX",s[s.VERTEX=32]="VERTEX",s[s.UNIFORM=64]="UNIFORM",s[s.STORAGE=128]="STORAGE",s[s.INDIRECT=256]="INDIRECT",s[s.QUERY_RESOLVE=512]="QUERY_RESOLVE",s[s.STATIC=1024]="STATIC",s))(gt||{});class Zs extends Bt{constructor(t){let{data:e,size:i}=t;const{usage:n,label:r,shrinkToFit:o}=t;super(),this.uid=Q("buffer"),this._resourceType="buffer",this._resourceId=Q("resource"),this._touched=0,this._updateID=1,this._dataInt32=null,this.shrinkToFit=!0,this.destroyed=!1,e instanceof Array&&(e=new Float32Array(e)),this._data=e,i??(i=e==null?void 0:e.byteLength);const a=!!e;this.descriptor={size:i,usage:n,mappedAtCreation:a,label:r},this.shrinkToFit=o??!0}get data(){return this._data}set data(t){this.setDataWithSize(t,t.length,!0)}get dataInt32(){return this._dataInt32||(this._dataInt32=new Int32Array(this.data.buffer)),this._dataInt32}get static(){return!!(this.descriptor.usage&gt.STATIC)}set static(t){t?this.descriptor.usage|=gt.STATIC:this.descriptor.usage&=~gt.STATIC}setDataWithSize(t,e,i){if(this._updateID++,this._updateSize=e*t.BYTES_PER_ELEMENT,this._data===t){i&&this.emit("update",this);return}const n=this._data;if(this._data=t,this._dataInt32=null,!n||n.length!==t.length){!this.shrinkToFit&&n&&t.byteLength<n.byteLength?i&&this.emit("update",this):(this.descriptor.size=t.byteLength,this._resourceId=Q("resource"),this.emit("change",this));return}i&&this.emit("update",this)}update(t){this._updateSize=t??this._updateSize,this._updateID++,this.emit("update",this)}destroy(){this.destroyed=!0,this.emit("destroy",this),this.emit("change",this),this._data=null,this.descriptor=null,this.removeAllListeners()}}function fl(s,t){if(!(s instanceof Zs)){let e=t?gt.INDEX:gt.VERTEX;s instanceof Array&&(t?(s=new Uint32Array(s),e=gt.INDEX|gt.COPY_DST):(s=new Float32Array(s),e=gt.VERTEX|gt.COPY_DST)),s=new Zs({data:s,label:t?"index-mesh-buffer":"vertex-mesh-buffer",usage:e})}return s}function Ed(s,t,e){const i=s.getAttribute(t);if(!i)return e.minX=0,e.minY=0,e.maxX=0,e.maxY=0,e;const n=i.buffer.data;let r=1/0,o=1/0,a=-1/0,l=-1/0;const c=n.BYTES_PER_ELEMENT,h=(i.offset||0)/c,d=(i.stride||2*4)/c;for(let u=h;u<n.length;u+=d){const f=n[u],m=n[u+1];f>a&&(a=f),m>l&&(l=m),f<r&&(r=f),m<o&&(o=m)}return e.minX=r,e.minY=o,e.maxX=a,e.maxY=l,e}function Id(s){return(s instanceof Zs||Array.isArray(s)||s.BYTES_PER_ELEMENT)&&(s={buffer:s}),s.buffer=fl(s.buffer,!1),s}class Ld extends Bt{constructor(t={}){super(),this.uid=Q("geometry"),this._layoutKey=0,this.instanceCount=1,this._bounds=new It,this._boundsDirty=!0;const{attributes:e,indexBuffer:i,topology:n}=t;if(this.buffers=[],this.attributes={},e)for(const r in e)this.addAttribute(r,e[r]);this.instanceCount=t.instanceCount??1,i&&this.addIndex(i),this.topology=n||"triangle-list"}onBufferUpdate(){this._boundsDirty=!0,this.emit("update",this)}getAttribute(t){return this.attributes[t]}getIndex(){return this.indexBuffer}getBuffer(t){return this.getAttribute(t).buffer}getSize(){for(const t in this.attributes){const e=this.attributes[t];return e.buffer.data.length/(e.stride/4||e.size)}return 0}addAttribute(t,e){const i=Id(e);this.buffers.indexOf(i.buffer)===-1&&(this.buffers.push(i.buffer),i.buffer.on("update",this.onBufferUpdate,this),i.buffer.on("change",this.onBufferUpdate,this)),this.attributes[t]=i}addIndex(t){this.indexBuffer=fl(t,!0),this.buffers.push(this.indexBuffer)}get bounds(){return this._boundsDirty?(this._boundsDirty=!1,Ed(this,"aPosition",this._bounds)):this._bounds}destroy(t=!1){this.emit("destroy",this),this.removeAllListeners(),t&&this.buffers.forEach(e=>e.destroy()),this.attributes=null,this.buffers=null,this.indexBuffer=null,this._bounds=null}}const Bd=new Float32Array(1),Rd=new Uint32Array(1);class Fd extends Ld{constructor(){const e=new Zs({data:Bd,label:"attribute-batch-buffer",usage:gt.VERTEX|gt.COPY_DST,shrinkToFit:!1}),i=new Zs({data:Rd,label:"index-batch-buffer",usage:gt.INDEX|gt.COPY_DST,shrinkToFit:!1}),n=6*4;super({attributes:{aPosition:{buffer:e,format:"float32x2",stride:n,offset:0},aUV:{buffer:e,format:"float32x2",stride:n,offset:2*4},aColor:{buffer:e,format:"unorm8x4",stride:n,offset:4*4},aTextureIdAndRound:{buffer:e,format:"uint16x2",stride:n,offset:5*4}},indexBuffer:i})}}function mo(s,t,e){if(s)for(const i in s){const n=i.toLocaleLowerCase(),r=t[n];if(r){let o=s[i];i==="header"&&(o=o.replace(/@in\s+[^;]+;\s*/g,"").replace(/@out\s+[^;]+;\s*/g,"")),e&&r.push(`//----${e}----//`),r.push(o)}else V(`${i} placement hook does not exist in shader`)}}const zd=/\{\{(.*?)\}\}/g;function go(s){var i;const t={};return(((i=s.match(zd))==null?void 0:i.map(n=>n.replace(/[{()}]/g,"")))??[]).forEach(n=>{t[n]=[]}),t}function yo(s,t){let e;const i=/@in\s+([^;]+);/g;for(;(e=i.exec(s))!==null;)t.push(e[1])}function xo(s,t,e=!1){const i=[];yo(t,i),s.forEach(a=>{a.header&&yo(a.header,i)});const n=i;e&&n.sort();const r=n.map((a,l)=>`       @location(${l}) ${a},`).join(`
`);let o=t.replace(/@in\s+[^;]+;\s*/g,"");return o=o.replace("{{in}}",`
${r}
`),o}function bo(s,t){let e;const i=/@out\s+([^;]+);/g;for(;(e=i.exec(s))!==null;)t.push(e[1])}function Dd(s){const e=/\b(\w+)\s*:/g.exec(s);return e?e[1]:""}function Gd(s){const t=/@.*?\s+/g;return s.replace(t,"")}function Od(s,t){const e=[];bo(t,e),s.forEach(l=>{l.header&&bo(l.header,e)});let i=0;const n=e.sort().map(l=>l.indexOf("builtin")>-1?l:`@location(${i++}) ${l}`).join(`,
`),r=e.sort().map(l=>`       var ${Gd(l)};`).join(`
`),o=`return VSOutput(
            ${e.sort().map(l=>` ${Dd(l)}`).join(`,
`)});`;let a=t.replace(/@out\s+[^;]+;\s*/g,"");return a=a.replace("{{struct}}",`
${n}
`),a=a.replace("{{start}}",`
${r}
`),a=a.replace("{{return}}",`
${o}
`),a}function _o(s,t){let e=s;for(const i in t){const n=t[i];n.join(`
`).length?e=e.replace(`{{${i}}}`,`//-----${i} START-----//
${n.join(`
`)}
//----${i} FINISH----//`):e=e.replace(`{{${i}}}`,"")}return e}const ce=Object.create(null),yn=new Map;let $d=0;function Wd({template:s,bits:t}){const e=pl(s,t);if(ce[e])return ce[e];const{vertex:i,fragment:n}=Ud(s,t);return ce[e]=ml(i,n,t),ce[e]}function Nd({template:s,bits:t}){const e=pl(s,t);return ce[e]||(ce[e]=ml(s.vertex,s.fragment,t)),ce[e]}function Ud(s,t){const e=t.map(o=>o.vertex).filter(o=>!!o),i=t.map(o=>o.fragment).filter(o=>!!o);let n=xo(e,s.vertex,!0);n=Od(e,n);const r=xo(i,s.fragment,!0);return{vertex:n,fragment:r}}function pl(s,t){return t.map(e=>(yn.has(e)||yn.set(e,$d++),yn.get(e))).sort((e,i)=>e-i).join("-")+s.vertex+s.fragment}function ml(s,t,e){const i=go(s),n=go(t);return e.forEach(r=>{mo(r.vertex,i,r.name),mo(r.fragment,n,r.name)}),{vertex:_o(s,i),fragment:_o(t,n)}}const Hd=`
    @in aPosition: vec2<f32>;
    @in aUV: vec2<f32>;

    @out @builtin(position) vPosition: vec4<f32>;
    @out vUV : vec2<f32>;
    @out vColor : vec4<f32>;

    {{header}}

    struct VSOutput {
        {{struct}}
    };

    @vertex
    fn main( {{in}} ) -> VSOutput {

        var worldTransformMatrix = globalUniforms.uWorldTransformMatrix;
        var modelMatrix = mat3x3<f32>(
            1.0, 0.0, 0.0,
            0.0, 1.0, 0.0,
            0.0, 0.0, 1.0
          );
        var position = aPosition;
        var uv = aUV;

        {{start}}

        vColor = vec4<f32>(1., 1., 1., 1.);

        {{main}}

        vUV = uv;

        var modelViewProjectionMatrix = globalUniforms.uProjectionMatrix * worldTransformMatrix * modelMatrix;

        vPosition =  vec4<f32>((modelViewProjectionMatrix *  vec3<f32>(position, 1.0)).xy, 0.0, 1.0);

        vColor *= globalUniforms.uWorldColorAlpha;

        {{end}}

        {{return}}
    };
`,jd=`
    @in vUV : vec2<f32>;
    @in vColor : vec4<f32>;

    {{header}}

    @fragment
    fn main(
        {{in}}
      ) -> @location(0) vec4<f32> {

        {{start}}

        var outColor:vec4<f32>;

        {{main}}

        var finalColor:vec4<f32> = outColor * vColor;

        {{end}}

        return finalColor;
      };
`,Yd=`
    in vec2 aPosition;
    in vec2 aUV;

    out vec4 vColor;
    out vec2 vUV;

    {{header}}

    void main(void){

        mat3 worldTransformMatrix = uWorldTransformMatrix;
        mat3 modelMatrix = mat3(
            1.0, 0.0, 0.0,
            0.0, 1.0, 0.0,
            0.0, 0.0, 1.0
          );
        vec2 position = aPosition;
        vec2 uv = aUV;

        {{start}}

        vColor = vec4(1.);

        {{main}}

        vUV = uv;

        mat3 modelViewProjectionMatrix = uProjectionMatrix * worldTransformMatrix * modelMatrix;

        gl_Position = vec4((modelViewProjectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);

        vColor *= uWorldColorAlpha;

        {{end}}
    }
`,Vd=`

    in vec4 vColor;
    in vec2 vUV;

    out vec4 finalColor;

    {{header}}

    void main(void) {

        {{start}}

        vec4 outColor;

        {{main}}

        finalColor = outColor * vColor;

        {{end}}
    }
`,qd={name:"global-uniforms-bit",vertex:{header:`
        struct GlobalUniforms {
            uProjectionMatrix:mat3x3<f32>,
            uWorldTransformMatrix:mat3x3<f32>,
            uWorldColorAlpha: vec4<f32>,
            uResolution: vec2<f32>,
        }

        @group(0) @binding(0) var<uniform> globalUniforms : GlobalUniforms;
        `}},Xd={name:"global-uniforms-bit",vertex:{header:`
          uniform mat3 uProjectionMatrix;
          uniform mat3 uWorldTransformMatrix;
          uniform vec4 uWorldColorAlpha;
          uniform vec2 uResolution;
        `}};function Kd({bits:s,name:t}){const e=Wd({template:{fragment:jd,vertex:Hd},bits:[qd,...s]});return Ui.from({name:t,vertex:{source:e.vertex,entryPoint:"main"},fragment:{source:e.fragment,entryPoint:"main"}})}function Zd({bits:s,name:t}){return new ja({name:t,...Nd({template:{vertex:Yd,fragment:Vd},bits:[Xd,...s]})})}const Jd={name:"color-bit",vertex:{header:`
            @in aColor: vec4<f32>;
        `,main:`
            vColor *= vec4<f32>(aColor.rgb * aColor.a, aColor.a);
        `}},Qd={name:"color-bit",vertex:{header:`
            in vec4 aColor;
        `,main:`
            vColor *= vec4(aColor.rgb * aColor.a, aColor.a);
        `}},xn={};function tu(s){const t=[];if(s===1)t.push("@group(1) @binding(0) var textureSource1: texture_2d<f32>;"),t.push("@group(1) @binding(1) var textureSampler1: sampler;");else{let e=0;for(let i=0;i<s;i++)t.push(`@group(1) @binding(${e++}) var textureSource${i+1}: texture_2d<f32>;`),t.push(`@group(1) @binding(${e++}) var textureSampler${i+1}: sampler;`)}return t.join(`
`)}function eu(s){const t=[];if(s===1)t.push("outColor = textureSampleGrad(textureSource1, textureSampler1, vUV, uvDx, uvDy);");else{t.push("switch vTextureId {");for(let e=0;e<s;e++)e===s-1?t.push("  default:{"):t.push(`  case ${e}:{`),t.push(`      outColor = textureSampleGrad(textureSource${e+1}, textureSampler${e+1}, vUV, uvDx, uvDy);`),t.push("      break;}");t.push("}")}return t.join(`
`)}function su(s){return xn[s]||(xn[s]={name:"texture-batch-bit",vertex:{header:`
                @in aTextureIdAndRound: vec2<u32>;
                @out @interpolate(flat) vTextureId : u32;
            `,main:`
                vTextureId = aTextureIdAndRound.y;
            `,end:`
                if(aTextureIdAndRound.x == 1)
                {
                    vPosition = vec4<f32>(roundPixels(vPosition.xy, globalUniforms.uResolution), vPosition.zw);
                }
            `},fragment:{header:`
                @in @interpolate(flat) vTextureId: u32;

                ${tu(s)}
            `,main:`
                var uvDx = dpdx(vUV);
                var uvDy = dpdy(vUV);

                ${eu(s)}
            `}}),xn[s]}const bn={};function iu(s){const t=[];for(let e=0;e<s;e++)e>0&&t.push("else"),e<s-1&&t.push(`if(vTextureId < ${e}.5)`),t.push("{"),t.push(`	outColor = texture(uTextures[${e}], vUV);`),t.push("}");return t.join(`
`)}function nu(s){return bn[s]||(bn[s]={name:"texture-batch-bit",vertex:{header:`
                in vec2 aTextureIdAndRound;
                out float vTextureId;

            `,main:`
                vTextureId = aTextureIdAndRound.y;
            `,end:`
                if(aTextureIdAndRound.x == 1.)
                {
                    gl_Position.xy = roundPixels(gl_Position.xy, uResolution);
                }
            `},fragment:{header:`
                in float vTextureId;

                uniform sampler2D uTextures[${s}];

            `,main:`

                ${iu(s)}
            `}}),bn[s]}const ru={name:"round-pixels-bit",vertex:{header:`
            fn roundPixels(position: vec2<f32>, targetSize: vec2<f32>) -> vec2<f32>
            {
                return (floor(((position * 0.5 + 0.5) * targetSize) + 0.5) / targetSize) * 2.0 - 1.0;
            }
        `}},ou={name:"round-pixels-bit",vertex:{header:`
            vec2 roundPixels(vec2 position, vec2 targetSize)
            {
                return (floor(((position * 0.5 + 0.5) * targetSize) + 0.5) / targetSize) * 2.0 - 1.0;
            }
        `}},wo={};function au(s){let t=wo[s];if(t)return t;const e=new Int32Array(s);for(let i=0;i<s;i++)e[i]=i;return t=wo[s]=new Xa({uTextures:{value:e,type:"i32",size:s}},{isStatic:!0}),t}class lu extends or{constructor(t){const e=Zd({name:"batch",bits:[Qd,nu(t),ou]}),i=Kd({name:"batch",bits:[Jd,su(t),ru]});super({glProgram:e,gpuProgram:i,resources:{batchSamplers:au(t)}})}}let _n=null;const gl=class yl extends Pd{constructor(t){super(t),this.geometry=new Fd,this.name=yl.extension.name,this.vertexSize=6,_n??(_n=new lu(t.maxTextures)),this.shader=_n}packAttributes(t,e,i,n,r){const o=r<<16|t.roundPixels&65535,a=t.transform,l=a.a,c=a.b,h=a.c,d=a.d,u=a.tx,f=a.ty,{positions:m,uvs:x}=t,p=t.color,g=t.attributeOffset,y=g+t.attributeSize;for(let b=g;b<y;b++){const _=b*2,S=m[_],v=m[_+1];e[n++]=l*S+h*v+u,e[n++]=d*v+c*S+f,e[n++]=x[_],e[n++]=x[_+1],i[n++]=p,i[n++]=o}}packQuadAttributes(t,e,i,n,r){const o=t.texture,a=t.transform,l=a.a,c=a.b,h=a.c,d=a.d,u=a.tx,f=a.ty,m=t.bounds,x=m.maxX,p=m.minX,g=m.maxY,y=m.minY,b=o.uvs,_=t.color,S=r<<16|t.roundPixels&65535;e[n+0]=l*p+h*y+u,e[n+1]=d*y+c*p+f,e[n+2]=b.x0,e[n+3]=b.y0,i[n+4]=_,i[n+5]=S,e[n+6]=l*x+h*y+u,e[n+7]=d*y+c*x+f,e[n+8]=b.x1,e[n+9]=b.y1,i[n+10]=_,i[n+11]=S,e[n+12]=l*x+h*g+u,e[n+13]=d*g+c*x+f,e[n+14]=b.x2,e[n+15]=b.y2,i[n+16]=_,i[n+17]=S,e[n+18]=l*p+h*g+u,e[n+19]=d*g+c*p+f,e[n+20]=b.x3,e[n+21]=b.y3,i[n+22]=_,i[n+23]=S}};gl.extension={type:[I.Batcher],name:"default"};let cu=gl;function hu(s,t,e,i,n,r,o,a=null){let l=0;e*=t,n*=r;const c=a.a,h=a.b,d=a.c,u=a.d,f=a.tx,m=a.ty;for(;l<o;){const x=s[e],p=s[e+1];i[n]=c*x+d*p+f,i[n+1]=h*x+u*p+m,n+=r,e+=t,l++}}function du(s,t,e,i){let n=0;for(t*=e;n<i;)s[t]=0,s[t+1]=0,t+=e,n++}function xl(s,t,e,i,n){const r=t.a,o=t.b,a=t.c,l=t.d,c=t.tx,h=t.ty;e||(e=0),i||(i=2),n||(n=s.length/i-e);let d=e*i;for(let u=0;u<n;u++){const f=s[d],m=s[d+1];s[d]=r*f+a*m+c,s[d+1]=o*f+l*m+h,d+=i}}const uu=new G;class bl{constructor(){this.packAsQuad=!1,this.batcherName="default",this.topology="triangle-list",this.applyTransform=!0,this.roundPixels=0,this._batcher=null,this._batch=null}get uvs(){return this.geometryData.uvs}get positions(){return this.geometryData.vertices}get indices(){return this.geometryData.indices}get blendMode(){return this.renderable&&this.applyTransform?this.renderable.groupBlendMode:"normal"}get color(){const t=this.baseColor,e=t>>16|t&65280|(t&255)<<16,i=this.renderable;return i?Sa(e,i.groupColor)+(this.alpha*i.groupAlpha*255<<24):e+(this.alpha*255<<24)}get transform(){var t;return((t=this.renderable)==null?void 0:t.groupTransform)||uu}copyTo(t){t.indexOffset=this.indexOffset,t.indexSize=this.indexSize,t.attributeOffset=this.attributeOffset,t.attributeSize=this.attributeSize,t.baseColor=this.baseColor,t.alpha=this.alpha,t.texture=this.texture,t.geometryData=this.geometryData,t.topology=this.topology}reset(){this.applyTransform=!0,this.renderable=null,this.topology="triangle-list"}destroy(){this.renderable=null,this.texture=null,this.geometryData=null,this._batcher=null,this._batch=null}}const Js={extension:{type:I.ShapeBuilder,name:"circle"},build(s,t){let e,i,n,r,o,a;if(s.type==="circle"){const _=s;if(o=a=_.radius,o<=0)return!1;e=_.x,i=_.y,n=r=0}else if(s.type==="ellipse"){const _=s;if(o=_.halfWidth,a=_.halfHeight,o<=0||a<=0)return!1;e=_.x,i=_.y,n=r=0}else{const _=s,S=_.width/2,v=_.height/2;e=_.x+S,i=_.y+v,o=a=Math.max(0,Math.min(_.radius,Math.min(S,v))),n=S-o,r=v-a}if(n<0||r<0)return!1;const l=Math.ceil(2.3*Math.sqrt(o+a)),c=l*8+(n?4:0)+(r?4:0);if(c===0)return!1;if(l===0)return t[0]=t[6]=e+n,t[1]=t[3]=i+r,t[2]=t[4]=e-n,t[5]=t[7]=i-r,!0;let h=0,d=l*4+(n?2:0)+2,u=d,f=c,m=n+o,x=r,p=e+m,g=e-m,y=i+x;if(t[h++]=p,t[h++]=y,t[--d]=y,t[--d]=g,r){const _=i-x;t[u++]=g,t[u++]=_,t[--f]=_,t[--f]=p}for(let _=1;_<l;_++){const S=Math.PI/2*(_/l),v=n+Math.cos(S)*o,w=r+Math.sin(S)*a,C=e+v,T=e-v,A=i+w,k=i-w;t[h++]=C,t[h++]=A,t[--d]=A,t[--d]=T,t[u++]=T,t[u++]=k,t[--f]=k,t[--f]=C}m=n,x=r+a,p=e+m,g=e-m,y=i+x;const b=i-x;return t[h++]=p,t[h++]=y,t[--f]=b,t[--f]=p,n&&(t[h++]=g,t[h++]=y,t[--f]=b,t[--f]=g),!0},triangulate(s,t,e,i,n,r){if(s.length===0)return;let o=0,a=0;for(let h=0;h<s.length;h+=2)o+=s[h],a+=s[h+1];o/=s.length/2,a/=s.length/2;let l=i;t[l*e]=o,t[l*e+1]=a;const c=l++;for(let h=0;h<s.length;h+=2)t[l*e]=s[h],t[l*e+1]=s[h+1],h>0&&(n[r++]=l,n[r++]=c,n[r++]=l-1),l++;n[r++]=c+1,n[r++]=c,n[r++]=l-1}},fu={...Js,extension:{...Js.extension,name:"ellipse"}},pu={...Js,extension:{...Js.extension,name:"roundedRectangle"}},_l=1e-4,vo=1e-4;function mu(s){const t=s.length;if(t<6)return 1;let e=0;for(let i=0,n=s[t-2],r=s[t-1];i<t;i+=2){const o=s[i],a=s[i+1];e+=(o-n)*(a+r),n=o,r=a}return e<0?-1:1}function So(s,t,e,i,n,r,o,a){const l=s-e*n,c=t-i*n,h=s+e*r,d=t+i*r;let u,f;o?(u=i,f=-e):(u=-i,f=e);const m=l+u,x=c+f,p=h+u,g=d+f;return a.push(m,x),a.push(p,g),2}function ke(s,t,e,i,n,r,o,a){const l=e-s,c=i-t;let h=Math.atan2(l,c),d=Math.atan2(n-s,r-t);a&&h<d?h+=Math.PI*2:!a&&h>d&&(d+=Math.PI*2);let u=h;const f=d-h,m=Math.abs(f),x=Math.sqrt(l*l+c*c),p=(15*m*Math.sqrt(x)/Math.PI>>0)+1,g=f/p;if(u+=g,a){o.push(s,t),o.push(e,i);for(let y=1,b=u;y<p;y++,b+=g)o.push(s,t),o.push(s+Math.sin(b)*x,t+Math.cos(b)*x);o.push(s,t),o.push(n,r)}else{o.push(e,i),o.push(s,t);for(let y=1,b=u;y<p;y++,b+=g)o.push(s+Math.sin(b)*x,t+Math.cos(b)*x),o.push(s,t);o.push(n,r),o.push(s,t)}return p*2}function gu(s,t,e,i,n,r){const o=_l;if(s.length===0)return;const a=t;let l=a.alignment;if(t.alignment!==.5){let W=mu(s);l=(l-.5)*W+.5}const c=new ut(s[0],s[1]),h=new ut(s[s.length-2],s[s.length-1]),d=i,u=Math.abs(c.x-h.x)<o&&Math.abs(c.y-h.y)<o;if(d){s=s.slice(),u&&(s.pop(),s.pop(),h.set(s[s.length-2],s[s.length-1]));const W=(c.x+h.x)*.5,ae=(h.y+c.y)*.5;s.unshift(W,ae),s.push(W,ae)}const f=n,m=s.length/2;let x=s.length;const p=f.length/2,g=a.width/2,y=g*g,b=a.miterLimit*a.miterLimit;let _=s[0],S=s[1],v=s[2],w=s[3],C=0,T=0,A=-(S-w),k=_-v,F=0,L=0,$=Math.sqrt(A*A+k*k);A/=$,k/=$,A*=g,k*=g;const Dt=l,M=(1-Dt)*2,B=Dt*2;d||(a.cap==="round"?x+=ke(_-A*(M-B)*.5,S-k*(M-B)*.5,_-A*M,S-k*M,_+A*B,S+k*B,f,!0)+2:a.cap==="square"&&(x+=So(_,S,A,k,M,B,!0,f))),f.push(_-A*M,S-k*M),f.push(_+A*B,S+k*B);for(let W=1;W<m-1;++W){_=s[(W-1)*2],S=s[(W-1)*2+1],v=s[W*2],w=s[W*2+1],C=s[(W+1)*2],T=s[(W+1)*2+1],A=-(S-w),k=_-v,$=Math.sqrt(A*A+k*k),A/=$,k/=$,A*=g,k*=g,F=-(w-T),L=v-C,$=Math.sqrt(F*F+L*L),F/=$,L/=$,F*=g,L*=g;const ae=v-_,As=S-w,Cs=v-C,Ms=T-w,Er=ae*Cs+As*Ms,hi=As*Cs-Ms*ae,Ts=hi<0;if(Math.abs(hi)<.001*Math.abs(Er)){f.push(v-A*M,w-k*M),f.push(v+A*B,w+k*B),Er>=0&&(a.join==="round"?x+=ke(v,w,v-A*M,w-k*M,v-F*M,w-L*M,f,!1)+4:x+=2,f.push(v-F*B,w-L*B),f.push(v+F*M,w+L*M));continue}const Ir=(-A+_)*(-k+w)-(-A+v)*(-k+S),Lr=(-F+C)*(-L+w)-(-F+v)*(-L+T),di=(ae*Lr-Cs*Ir)/hi,ui=(Ms*Ir-As*Lr)/hi,Qi=(di-v)*(di-v)+(ui-w)*(ui-w),_e=v+(di-v)*M,we=w+(ui-w)*M,ve=v-(di-v)*B,Se=w-(ui-w)*B,dc=Math.min(ae*ae+As*As,Cs*Cs+Ms*Ms),Br=Ts?M:B,uc=dc+Br*Br*y;Qi<=uc?a.join==="bevel"||Qi/y>b?(Ts?(f.push(_e,we),f.push(v+A*B,w+k*B),f.push(_e,we),f.push(v+F*B,w+L*B)):(f.push(v-A*M,w-k*M),f.push(ve,Se),f.push(v-F*M,w-L*M),f.push(ve,Se)),x+=2):a.join==="round"?Ts?(f.push(_e,we),f.push(v+A*B,w+k*B),x+=ke(v,w,v+A*B,w+k*B,v+F*B,w+L*B,f,!0)+4,f.push(_e,we),f.push(v+F*B,w+L*B)):(f.push(v-A*M,w-k*M),f.push(ve,Se),x+=ke(v,w,v-A*M,w-k*M,v-F*M,w-L*M,f,!1)+4,f.push(v-F*M,w-L*M),f.push(ve,Se)):(f.push(_e,we),f.push(ve,Se)):(f.push(v-A*M,w-k*M),f.push(v+A*B,w+k*B),a.join==="round"?Ts?x+=ke(v,w,v+A*B,w+k*B,v+F*B,w+L*B,f,!0)+2:x+=ke(v,w,v-A*M,w-k*M,v-F*M,w-L*M,f,!1)+2:a.join==="miter"&&Qi/y<=b&&(Ts?(f.push(ve,Se),f.push(ve,Se)):(f.push(_e,we),f.push(_e,we)),x+=2),f.push(v-F*M,w-L*M),f.push(v+F*B,w+L*B),x+=2)}_=s[(m-2)*2],S=s[(m-2)*2+1],v=s[(m-1)*2],w=s[(m-1)*2+1],A=-(S-w),k=_-v,$=Math.sqrt(A*A+k*k),A/=$,k/=$,A*=g,k*=g,f.push(v-A*M,w-k*M),f.push(v+A*B,w+k*B),d||(a.cap==="round"?x+=ke(v-A*(M-B)*.5,w-k*(M-B)*.5,v-A*M,w-k*M,v+A*B,w+k*B,f,!1)+2:a.cap==="square"&&(x+=So(v,w,A,k,M,B,!1,f)));const oe=vo*vo;for(let W=p;W<x+p-2;++W)_=f[W*2],S=f[W*2+1],v=f[(W+1)*2],w=f[(W+1)*2+1],C=f[(W+2)*2],T=f[(W+2)*2+1],!(Math.abs(_*(w-T)+v*(T-S)+C*(S-w))<oe)&&r.push(W,W+1,W+2)}function yu(s,t,e,i){const n=_l;if(s.length===0)return;const r=s[0],o=s[1],a=s[s.length-2],l=s[s.length-1],c=t||Math.abs(r-a)<n&&Math.abs(o-l)<n,h=e,d=s.length/2,u=h.length/2;for(let f=0;f<d;f++)h.push(s[f*2]),h.push(s[f*2+1]);for(let f=0;f<d-1;f++)i.push(u+f,u+f+1);c&&i.push(u+d-1,u)}function wl(s,t,e,i,n,r,o){const a=Qh(s,t,2);if(!a)return;for(let c=0;c<a.length;c+=3)r[o++]=a[c]+n,r[o++]=a[c+1]+n,r[o++]=a[c+2]+n;let l=n*i;for(let c=0;c<s.length;c+=2)e[l]=s[c],e[l+1]=s[c+1],l+=i}const xu=[],bu={extension:{type:I.ShapeBuilder,name:"polygon"},build(s,t){for(let e=0;e<s.points.length;e++)t[e]=s.points[e];return!0},triangulate(s,t,e,i,n,r){wl(s,xu,t,e,i,n,r)}},_u={extension:{type:I.ShapeBuilder,name:"rectangle"},build(s,t){const e=s,i=e.x,n=e.y,r=e.width,o=e.height;return r>0&&o>0?(t[0]=i,t[1]=n,t[2]=i+r,t[3]=n,t[4]=i+r,t[5]=n+o,t[6]=i,t[7]=n+o,!0):!1},triangulate(s,t,e,i,n,r){let o=0;i*=e,t[i+o]=s[0],t[i+o+1]=s[1],o+=e,t[i+o]=s[2],t[i+o+1]=s[3],o+=e,t[i+o]=s[6],t[i+o+1]=s[7],o+=e,t[i+o]=s[4],t[i+o+1]=s[5],o+=e;const a=i/e;n[r++]=a,n[r++]=a+1,n[r++]=a+2,n[r++]=a+1,n[r++]=a+3,n[r++]=a+2}},wu={extension:{type:I.ShapeBuilder,name:"triangle"},build(s,t){return t[0]=s.x,t[1]=s.y,t[2]=s.x2,t[3]=s.y2,t[4]=s.x3,t[5]=s.y3,!0},triangulate(s,t,e,i,n,r){let o=0;i*=e,t[i+o]=s[0],t[i+o+1]=s[1],o+=e,t[i+o]=s[2],t[i+o+1]=s[3],o+=e,t[i+o]=s[4],t[i+o+1]=s[5];const a=i/e;n[r++]=a,n[r++]=a+1,n[r++]=a+2}},vu=new G,Su=new X;function ku(s,t,e,i){const n=t.matrix?s.copyFrom(t.matrix).invert():s.identity();if(t.textureSpace==="local"){const o=e.getBounds(Su);t.width&&o.pad(t.width);const{x:a,y:l}=o,c=1/o.width,h=1/o.height,d=-a*c,u=-l*h,f=n.a,m=n.b,x=n.c,p=n.d;n.a*=c,n.b*=c,n.c*=h,n.d*=h,n.tx=d*f+u*x+n.tx,n.ty=d*m+u*p+n.ty}else n.translate(t.texture.frame.x,t.texture.frame.y),n.scale(1/t.texture.source.width,1/t.texture.source.height);const r=t.texture.source.style;return!(t.fill instanceof Qt)&&r.addressMode==="clamp-to-edge"&&(r.addressMode="repeat",r.update()),i&&n.append(vu.copyFrom(i).invert()),n}const Yi={};dt.handleByMap(I.ShapeBuilder,Yi);dt.add(_u,bu,wu,Js,fu,pu);const Au=new X,Cu=new G;function Mu(s,t){const{geometryData:e,batches:i}=t;i.length=0,e.indices.length=0,e.vertices.length=0,e.uvs.length=0;for(let n=0;n<s.instructions.length;n++){const r=s.instructions[n];if(r.action==="texture")Tu(r.data,i,e);else if(r.action==="fill"||r.action==="stroke"){const o=r.action==="stroke",a=r.data.path.shapePath,l=r.data.style,c=r.data.hole;o&&c&&ko(c.shapePath,l,!0,i,e),c&&(a.shapePrimitives[a.shapePrimitives.length-1].holes=c.shapePath.shapePrimitives),ko(a,l,o,i,e)}}}function Tu(s,t,e){const i=[],n=Yi.rectangle,r=Au;r.x=s.dx,r.y=s.dy,r.width=s.dw,r.height=s.dh;const o=s.transform;if(!n.build(r,i))return;const{vertices:a,uvs:l,indices:c}=e,h=c.length,d=a.length/2;o&&xl(i,o),n.triangulate(i,a,2,d,c,h);const u=s.image,f=u.uvs;l.push(f.x0,f.y0,f.x1,f.y1,f.x3,f.y3,f.x2,f.y2);const m=At.get(bl);m.indexOffset=h,m.indexSize=c.length-h,m.attributeOffset=d,m.attributeSize=a.length/2-d,m.baseColor=s.style,m.alpha=s.alpha,m.texture=u,m.geometryData=e,t.push(m)}function ko(s,t,e,i,n){const{vertices:r,uvs:o,indices:a}=n;s.shapePrimitives.forEach(({shape:l,transform:c,holes:h})=>{const d=[],u=Yi[l.type];if(!u.build(l,d))return;const f=a.length,m=r.length/2;let x="triangle-list";if(c&&xl(d,c),e){const b=l.closePath??!0,_=t;_.pixelLine?(yu(d,b,r,a),x="line-list"):gu(d,_,!1,b,r,a)}else if(h){const b=[],_=d.slice();Pu(h).forEach(v=>{b.push(_.length/2),_.push(...v)}),wl(_,b,r,2,m,a,f)}else u.triangulate(d,r,2,m,a,f);const p=o.length/2,g=t.texture;if(g!==O.WHITE){const b=ku(Cu,t,l,c);hu(r,2,m,o,p,2,r.length/2-m,b)}else du(o,p,2,r.length/2-m);const y=At.get(bl);y.indexOffset=f,y.indexSize=a.length-f,y.attributeOffset=m,y.attributeSize=r.length/2-m,y.baseColor=t.color,y.alpha=t.alpha,y.texture=g,y.geometryData=n,y.topology=x,i.push(y)})}function Pu(s){const t=[];for(let e=0;e<s.length;e++){const i=s[e].shape,n=[];Yi[i.type].build(i,n)&&t.push(n)}return t}class Eu{constructor(){this.batches=[],this.geometryData={vertices:[],uvs:[],indices:[]}}}class Iu{constructor(){this.instructions=new Ma}init(t){this.batcher=new cu({maxTextures:t}),this.instructions.reset()}get geometry(){return z(kc,"GraphicsContextRenderData#geometry is deprecated, please use batcher.geometry instead."),this.batcher.geometry}destroy(){this.batcher.destroy(),this.instructions.destroy(),this.batcher=null,this.instructions=null}}const hr=class qn{constructor(t){this._gpuContextHash={},this._graphicsDataContextHash=Object.create(null),this._renderer=t,t.renderableGC.addManagedHash(this,"_gpuContextHash"),t.renderableGC.addManagedHash(this,"_graphicsDataContextHash")}init(t){qn.defaultOptions.bezierSmoothness=(t==null?void 0:t.bezierSmoothness)??qn.defaultOptions.bezierSmoothness}getContextRenderData(t){return this._graphicsDataContextHash[t.uid]||this._initContextRenderData(t)}updateGpuContext(t){let e=this._gpuContextHash[t.uid]||this._initContext(t);if(t.dirty){e?this._cleanGraphicsContextData(t):e=this._initContext(t),Mu(t,e);const i=t.batchMode;t.customShader||i==="no-batch"?e.isBatchable=!1:i==="auto"?e.isBatchable=e.geometryData.vertices.length<400:e.isBatchable=!0,t.dirty=!1}return e}getGpuContext(t){return this._gpuContextHash[t.uid]||this._initContext(t)}_initContextRenderData(t){const e=At.get(Iu,{maxTextures:this._renderer.limits.maxBatchableTextures}),{batches:i,geometryData:n}=this._gpuContextHash[t.uid],r=n.vertices.length,o=n.indices.length;for(let h=0;h<i.length;h++)i[h].applyTransform=!1;const a=e.batcher;a.ensureAttributeBuffer(r),a.ensureIndexBuffer(o),a.begin();for(let h=0;h<i.length;h++){const d=i[h];a.add(d)}a.finish(e.instructions);const l=a.geometry;l.indexBuffer.setDataWithSize(a.indexBuffer,a.indexSize,!0),l.buffers[0].setDataWithSize(a.attributeBuffer.float32View,a.attributeSize,!0);const c=a.batches;for(let h=0;h<c.length;h++){const d=c[h];d.bindGroup=bd(d.textures.textures,d.textures.count,this._renderer.limits.maxBatchableTextures)}return this._graphicsDataContextHash[t.uid]=e,e}_initContext(t){const e=new Eu;return e.context=t,this._gpuContextHash[t.uid]=e,t.on("destroy",this.onGraphicsContextDestroy,this),this._gpuContextHash[t.uid]}onGraphicsContextDestroy(t){this._cleanGraphicsContextData(t),t.off("destroy",this.onGraphicsContextDestroy,this),this._gpuContextHash[t.uid]=null}_cleanGraphicsContextData(t){const e=this._gpuContextHash[t.uid];e.isBatchable||this._graphicsDataContextHash[t.uid]&&(At.return(this.getContextRenderData(t)),this._graphicsDataContextHash[t.uid]=null),e.batches&&e.batches.forEach(i=>{At.return(i)})}destroy(){for(const t in this._gpuContextHash)this._gpuContextHash[t]&&this.onGraphicsContextDestroy(this._gpuContextHash[t].context)}};hr.extension={type:[I.WebGLSystem,I.WebGPUSystem,I.CanvasSystem],name:"graphicsContext"};hr.defaultOptions={bezierSmoothness:.5};let vl=hr;const Lu=8,Ci=11920929e-14,Bu=1;function Sl(s,t,e,i,n,r,o,a,l,c){const d=Math.min(.99,Math.max(0,c??vl.defaultOptions.bezierSmoothness));let u=(Bu-d)/1;return u*=u,Ru(t,e,i,n,r,o,a,l,s,u),s}function Ru(s,t,e,i,n,r,o,a,l,c){Xn(s,t,e,i,n,r,o,a,l,c,0),l.push(o,a)}function Xn(s,t,e,i,n,r,o,a,l,c,h){if(h>Lu)return;const d=(s+e)/2,u=(t+i)/2,f=(e+n)/2,m=(i+r)/2,x=(n+o)/2,p=(r+a)/2,g=(d+f)/2,y=(u+m)/2,b=(f+x)/2,_=(m+p)/2,S=(g+b)/2,v=(y+_)/2;if(h>0){let w=o-s,C=a-t;const T=Math.abs((e-o)*C-(i-a)*w),A=Math.abs((n-o)*C-(r-a)*w);if(T>Ci&&A>Ci){if((T+A)*(T+A)<=c*(w*w+C*C)){l.push(S,v);return}}else if(T>Ci){if(T*T<=c*(w*w+C*C)){l.push(S,v);return}}else if(A>Ci){if(A*A<=c*(w*w+C*C)){l.push(S,v);return}}else if(w=S-(s+o)/2,C=v-(t+a)/2,w*w+C*C<=c){l.push(S,v);return}}Xn(s,t,d,u,g,y,S,v,l,c,h+1),Xn(S,v,b,_,x,p,o,a,l,c,h+1)}const Fu=8,zu=11920929e-14,Du=1;function Gu(s,t,e,i,n,r,o,a){const c=Math.min(.99,Math.max(0,a??vl.defaultOptions.bezierSmoothness));let h=(Du-c)/1;return h*=h,Ou(t,e,i,n,r,o,s,h),s}function Ou(s,t,e,i,n,r,o,a){Kn(o,s,t,e,i,n,r,a,0),o.push(n,r)}function Kn(s,t,e,i,n,r,o,a,l){if(l>Fu)return;const c=(t+i)/2,h=(e+n)/2,d=(i+r)/2,u=(n+o)/2,f=(c+d)/2,m=(h+u)/2;let x=r-t,p=o-e;const g=Math.abs((i-r)*p-(n-o)*x);if(g>zu){if(g*g<=a*(x*x+p*p)){s.push(f,m);return}}else if(x=f-(t+r)/2,p=m-(e+o)/2,x*x+p*p<=a){s.push(f,m);return}Kn(s,t,e,c,h,f,m,a,l+1),Kn(s,f,m,d,u,r,o,a,l+1)}function kl(s,t,e,i,n,r,o,a){let l=Math.abs(n-r);(!o&&n>r||o&&r>n)&&(l=2*Math.PI-l),a||(a=Math.max(6,Math.floor(6*Math.pow(i,1/3)*(l/Math.PI)))),a=Math.max(a,3);let c=l/a,h=n;c*=o?-1:1;for(let d=0;d<a+1;d++){const u=Math.cos(h),f=Math.sin(h),m=t+u*i,x=e+f*i;s.push(m,x),h+=c}}function $u(s,t,e,i,n,r){const o=s[s.length-2],l=s[s.length-1]-e,c=o-t,h=n-e,d=i-t,u=Math.abs(l*d-c*h);if(u<1e-8||r===0){(s[s.length-2]!==t||s[s.length-1]!==e)&&s.push(t,e);return}const f=l*l+c*c,m=h*h+d*d,x=l*h+c*d,p=r*Math.sqrt(f)/u,g=r*Math.sqrt(m)/u,y=p*x/f,b=g*x/m,_=p*d+g*c,S=p*h+g*l,v=c*(g+y),w=l*(g+y),C=d*(p+b),T=h*(p+b),A=Math.atan2(w-S,v-_),k=Math.atan2(T-S,C-_);kl(s,_+t,S+e,r,A,k,c*h>d*l)}const Us=Math.PI*2,wn={centerX:0,centerY:0,ang1:0,ang2:0},vn=({x:s,y:t},e,i,n,r,o,a,l)=>{s*=e,t*=i;const c=n*s-r*t,h=r*s+n*t;return l.x=c+o,l.y=h+a,l};function Wu(s,t){const e=t===-1.5707963267948966?-.551915024494:1.3333333333333333*Math.tan(t/4),i=t===1.5707963267948966?.551915024494:e,n=Math.cos(s),r=Math.sin(s),o=Math.cos(s+t),a=Math.sin(s+t);return[{x:n-r*i,y:r+n*i},{x:o+a*i,y:a-o*i},{x:o,y:a}]}const Ao=(s,t,e,i)=>{const n=s*i-t*e<0?-1:1;let r=s*e+t*i;return r>1&&(r=1),r<-1&&(r=-1),n*Math.acos(r)},Nu=(s,t,e,i,n,r,o,a,l,c,h,d,u)=>{const f=Math.pow(n,2),m=Math.pow(r,2),x=Math.pow(h,2),p=Math.pow(d,2);let g=f*m-f*p-m*x;g<0&&(g=0),g/=f*p+m*x,g=Math.sqrt(g)*(o===a?-1:1);const y=g*n/r*d,b=g*-r/n*h,_=c*y-l*b+(s+e)/2,S=l*y+c*b+(t+i)/2,v=(h-y)/n,w=(d-b)/r,C=(-h-y)/n,T=(-d-b)/r,A=Ao(1,0,v,w);let k=Ao(v,w,C,T);a===0&&k>0&&(k-=Us),a===1&&k<0&&(k+=Us),u.centerX=_,u.centerY=S,u.ang1=A,u.ang2=k};function Uu(s,t,e,i,n,r,o,a=0,l=0,c=0){if(r===0||o===0)return;const h=Math.sin(a*Us/360),d=Math.cos(a*Us/360),u=d*(t-i)/2+h*(e-n)/2,f=-h*(t-i)/2+d*(e-n)/2;if(u===0&&f===0)return;r=Math.abs(r),o=Math.abs(o);const m=Math.pow(u,2)/Math.pow(r,2)+Math.pow(f,2)/Math.pow(o,2);m>1&&(r*=Math.sqrt(m),o*=Math.sqrt(m)),Nu(t,e,i,n,r,o,l,c,h,d,u,f,wn);let{ang1:x,ang2:p}=wn;const{centerX:g,centerY:y}=wn;let b=Math.abs(p)/(Us/4);Math.abs(1-b)<1e-7&&(b=1);const _=Math.max(Math.ceil(b),1);p/=_;let S=s[s.length-2],v=s[s.length-1];const w={x:0,y:0};for(let C=0;C<_;C++){const T=Wu(x,p),{x:A,y:k}=vn(T[0],r,o,d,h,g,y,w),{x:F,y:L}=vn(T[1],r,o,d,h,g,y,w),{x:$,y:Dt}=vn(T[2],r,o,d,h,g,y,w);Sl(s,S,v,A,k,F,L,$,Dt),S=$,v=Dt,x+=p}}function Hu(s,t,e){const i=(o,a)=>{const l=a.x-o.x,c=a.y-o.y,h=Math.sqrt(l*l+c*c),d=l/h,u=c/h;return{len:h,nx:d,ny:u}},n=(o,a)=>{o===0?s.moveTo(a.x,a.y):s.lineTo(a.x,a.y)};let r=t[t.length-1];for(let o=0;o<t.length;o++){const a=t[o%t.length],l=a.radius??e;if(l<=0){n(o,a),r=a;continue}const c=t[(o+1)%t.length],h=i(a,r),d=i(a,c);if(h.len<1e-4||d.len<1e-4){n(o,a),r=a;continue}let u=Math.asin(h.nx*d.ny-h.ny*d.nx),f=1,m=!1;h.nx*d.nx-h.ny*-d.ny<0?u<0?u=Math.PI+u:(u=Math.PI-u,f=-1,m=!0):u>0&&(f=-1,m=!0);const x=u/2;let p,g=Math.abs(Math.cos(x)*l/Math.sin(x));g>Math.min(h.len/2,d.len/2)?(g=Math.min(h.len/2,d.len/2),p=Math.abs(g*Math.sin(x)/Math.cos(x))):p=l;const y=a.x+d.nx*g+-d.ny*p*f,b=a.y+d.ny*g+d.nx*p*f,_=Math.atan2(h.ny,h.nx)+Math.PI/2*f,S=Math.atan2(d.ny,d.nx)-Math.PI/2*f;o===0&&s.moveTo(y+Math.cos(_)*p,b+Math.sin(_)*p),s.arc(y,b,p,_,S,m),r=a}}function ju(s,t,e,i){const n=(a,l)=>Math.sqrt((a.x-l.x)**2+(a.y-l.y)**2),r=(a,l,c)=>({x:a.x+(l.x-a.x)*c,y:a.y+(l.y-a.y)*c}),o=t.length;for(let a=0;a<o;a++){const l=t[(a+1)%o],c=l.radius??e;if(c<=0){a===0?s.moveTo(l.x,l.y):s.lineTo(l.x,l.y);continue}const h=t[a],d=t[(a+2)%o],u=n(h,l);let f;if(u<1e-4)f=l;else{const p=Math.min(u/2,c);f=r(l,h,p/u)}const m=n(d,l);let x;if(m<1e-4)x=l;else{const p=Math.min(m/2,c);x=r(l,d,p/m)}a===0?s.moveTo(f.x,f.y):s.lineTo(f.x,f.y),s.quadraticCurveTo(l.x,l.y,x.x,x.y,i)}}const Yu=new X;class Vu{constructor(t){this.shapePrimitives=[],this._currentPoly=null,this._bounds=new It,this._graphicsPath2D=t,this.signed=t.checkForHoles}moveTo(t,e){return this.startPoly(t,e),this}lineTo(t,e){this._ensurePoly();const i=this._currentPoly.points,n=i[i.length-2],r=i[i.length-1];return(n!==t||r!==e)&&i.push(t,e),this}arc(t,e,i,n,r,o){this._ensurePoly(!1);const a=this._currentPoly.points;return kl(a,t,e,i,n,r,o),this}arcTo(t,e,i,n,r){this._ensurePoly();const o=this._currentPoly.points;return $u(o,t,e,i,n,r),this}arcToSvg(t,e,i,n,r,o,a){const l=this._currentPoly.points;return Uu(l,this._currentPoly.lastX,this._currentPoly.lastY,o,a,t,e,i,n,r),this}bezierCurveTo(t,e,i,n,r,o,a){this._ensurePoly();const l=this._currentPoly;return Sl(this._currentPoly.points,l.lastX,l.lastY,t,e,i,n,r,o,a),this}quadraticCurveTo(t,e,i,n,r){this._ensurePoly();const o=this._currentPoly;return Gu(this._currentPoly.points,o.lastX,o.lastY,t,e,i,n,r),this}closePath(){return this.endPoly(!0),this}addPath(t,e){this.endPoly(),e&&!e.isIdentity()&&(t=t.clone(!0),t.transform(e));const i=this.shapePrimitives,n=i.length;for(let r=0;r<t.instructions.length;r++){const o=t.instructions[r];this[o.action](...o.data)}if(t.checkForHoles&&i.length-n>1){let r=null;for(let o=n;o<i.length;o++){const a=i[o];if(a.shape.type==="polygon"){const l=a.shape,c=r==null?void 0:r.shape;c&&c.containsPolygon(l)?(r.holes||(r.holes=[]),r.holes.push(a),i.copyWithin(o,o+1),i.length--,o--):r=a}}}return this}finish(t=!1){this.endPoly(t)}rect(t,e,i,n,r){return this.drawShape(new X(t,e,i,n),r),this}circle(t,e,i,n){return this.drawShape(new ji(t,e,i),n),this}poly(t,e,i){const n=new Ws(t);return n.closePath=e,this.drawShape(n,i),this}regularPoly(t,e,i,n,r=0,o){n=Math.max(n|0,3);const a=-1*Math.PI/2+r,l=Math.PI*2/n,c=[];for(let h=0;h<n;h++){const d=a-h*l;c.push(t+i*Math.cos(d),e+i*Math.sin(d))}return this.poly(c,!0,o),this}roundPoly(t,e,i,n,r,o=0,a){if(n=Math.max(n|0,3),r<=0)return this.regularPoly(t,e,i,n,o);const l=i*Math.sin(Math.PI/n)-.001;r=Math.min(r,l);const c=-1*Math.PI/2+o,h=Math.PI*2/n,d=(n-2)*Math.PI/n/2;for(let u=0;u<n;u++){const f=u*h+c,m=t+i*Math.cos(f),x=e+i*Math.sin(f),p=f+Math.PI+d,g=f-Math.PI-d,y=m+r*Math.cos(p),b=x+r*Math.sin(p),_=m+r*Math.cos(g),S=x+r*Math.sin(g);u===0?this.moveTo(y,b):this.lineTo(y,b),this.quadraticCurveTo(m,x,_,S,a)}return this.closePath()}roundShape(t,e,i=!1,n){return t.length<3?this:(i?ju(this,t,e,n):Hu(this,t,e),this.closePath())}filletRect(t,e,i,n,r){if(r===0)return this.rect(t,e,i,n);const o=Math.min(i,n)/2,a=Math.min(o,Math.max(-o,r)),l=t+i,c=e+n,h=a<0?-a:0,d=Math.abs(a);return this.moveTo(t,e+d).arcTo(t+h,e+h,t+d,e,d).lineTo(l-d,e).arcTo(l-h,e+h,l,e+d,d).lineTo(l,c-d).arcTo(l-h,c-h,t+i-d,c,d).lineTo(t+d,c).arcTo(t+h,c-h,t,c-d,d).closePath()}chamferRect(t,e,i,n,r,o){if(r<=0)return this.rect(t,e,i,n);const a=Math.min(r,Math.min(i,n)/2),l=t+i,c=e+n,h=[t+a,e,l-a,e,l,e+a,l,c-a,l-a,c,t+a,c,t,c-a,t,e+a];for(let d=h.length-1;d>=2;d-=2)h[d]===h[d-2]&&h[d-1]===h[d-3]&&h.splice(d-1,2);return this.poly(h,!0,o)}ellipse(t,e,i,n,r){return this.drawShape(new lr(t,e,i,n),r),this}roundRect(t,e,i,n,r,o){return this.drawShape(new cr(t,e,i,n,r),o),this}drawShape(t,e){return this.endPoly(),this.shapePrimitives.push({shape:t,transform:e}),this}startPoly(t,e){let i=this._currentPoly;return i&&this.endPoly(),i=new Ws,i.points.push(t,e),this._currentPoly=i,this}endPoly(t=!1){const e=this._currentPoly;return e&&e.points.length>2&&(e.closePath=t,this.shapePrimitives.push({shape:e})),this._currentPoly=null,this}_ensurePoly(t=!0){if(!this._currentPoly&&(this._currentPoly=new Ws,t)){const e=this.shapePrimitives[this.shapePrimitives.length-1];if(e){let i=e.shape.x,n=e.shape.y;if(e.transform&&!e.transform.isIdentity()){const r=e.transform,o=i;i=r.a*i+r.c*n+r.tx,n=r.b*o+r.d*n+r.ty}this._currentPoly.points.push(i,n)}else this._currentPoly.points.push(0,0)}}buildPath(){const t=this._graphicsPath2D;this.shapePrimitives.length=0,this._currentPoly=null;for(let e=0;e<t.instructions.length;e++){const i=t.instructions[e];this[i.action](...i.data)}this.finish()}get bounds(){const t=this._bounds;t.clear();const e=this.shapePrimitives;for(let i=0;i<e.length;i++){const n=e[i],r=n.shape.getBounds(Yu);n.transform?t.addRect(r,n.transform):t.addRect(r)}return t}}class Jt{constructor(t,e=!1){this.instructions=[],this.uid=Q("graphicsPath"),this._dirty=!0,this.checkForHoles=e,typeof t=="string"?md(t,this):this.instructions=(t==null?void 0:t.slice())??[]}get shapePath(){return this._shapePath||(this._shapePath=new Vu(this)),this._dirty&&(this._dirty=!1,this._shapePath.buildPath()),this._shapePath}addPath(t,e){return t=t.clone(),this.instructions.push({action:"addPath",data:[t,e]}),this._dirty=!0,this}arc(...t){return this.instructions.push({action:"arc",data:t}),this._dirty=!0,this}arcTo(...t){return this.instructions.push({action:"arcTo",data:t}),this._dirty=!0,this}arcToSvg(...t){return this.instructions.push({action:"arcToSvg",data:t}),this._dirty=!0,this}bezierCurveTo(...t){return this.instructions.push({action:"bezierCurveTo",data:t}),this._dirty=!0,this}bezierCurveToShort(t,e,i,n,r){const o=this.instructions[this.instructions.length-1],a=this.getLastPoint(ut.shared);let l=0,c=0;if(!o||o.action!=="bezierCurveTo")l=a.x,c=a.y;else{l=o.data[2],c=o.data[3];const h=a.x,d=a.y;l=h+(h-l),c=d+(d-c)}return this.instructions.push({action:"bezierCurveTo",data:[l,c,t,e,i,n,r]}),this._dirty=!0,this}closePath(){return this.instructions.push({action:"closePath",data:[]}),this._dirty=!0,this}ellipse(...t){return this.instructions.push({action:"ellipse",data:t}),this._dirty=!0,this}lineTo(...t){return this.instructions.push({action:"lineTo",data:t}),this._dirty=!0,this}moveTo(...t){return this.instructions.push({action:"moveTo",data:t}),this}quadraticCurveTo(...t){return this.instructions.push({action:"quadraticCurveTo",data:t}),this._dirty=!0,this}quadraticCurveToShort(t,e,i){const n=this.instructions[this.instructions.length-1],r=this.getLastPoint(ut.shared);let o=0,a=0;if(!n||n.action!=="quadraticCurveTo")o=r.x,a=r.y;else{o=n.data[0],a=n.data[1];const l=r.x,c=r.y;o=l+(l-o),a=c+(c-a)}return this.instructions.push({action:"quadraticCurveTo",data:[o,a,t,e,i]}),this._dirty=!0,this}rect(t,e,i,n,r){return this.instructions.push({action:"rect",data:[t,e,i,n,r]}),this._dirty=!0,this}circle(t,e,i,n){return this.instructions.push({action:"circle",data:[t,e,i,n]}),this._dirty=!0,this}roundRect(...t){return this.instructions.push({action:"roundRect",data:t}),this._dirty=!0,this}poly(...t){return this.instructions.push({action:"poly",data:t}),this._dirty=!0,this}regularPoly(...t){return this.instructions.push({action:"regularPoly",data:t}),this._dirty=!0,this}roundPoly(...t){return this.instructions.push({action:"roundPoly",data:t}),this._dirty=!0,this}roundShape(...t){return this.instructions.push({action:"roundShape",data:t}),this._dirty=!0,this}filletRect(...t){return this.instructions.push({action:"filletRect",data:t}),this._dirty=!0,this}chamferRect(...t){return this.instructions.push({action:"chamferRect",data:t}),this._dirty=!0,this}star(t,e,i,n,r,o,a){r||(r=n/2);const l=-1*Math.PI/2+o,c=i*2,h=Math.PI*2/c,d=[];for(let u=0;u<c;u++){const f=u%2?r:n,m=u*h+l;d.push(t+f*Math.cos(m),e+f*Math.sin(m))}return this.poly(d,!0,a),this}clone(t=!1){const e=new Jt;if(e.checkForHoles=this.checkForHoles,!t)e.instructions=this.instructions.slice();else for(let i=0;i<this.instructions.length;i++){const n=this.instructions[i];e.instructions.push({action:n.action,data:n.data.slice()})}return e}clear(){return this.instructions.length=0,this._dirty=!0,this}transform(t){if(t.isIdentity())return this;const e=t.a,i=t.b,n=t.c,r=t.d,o=t.tx,a=t.ty;let l=0,c=0,h=0,d=0,u=0,f=0,m=0,x=0;for(let p=0;p<this.instructions.length;p++){const g=this.instructions[p],y=g.data;switch(g.action){case"moveTo":case"lineTo":l=y[0],c=y[1],y[0]=e*l+n*c+o,y[1]=i*l+r*c+a;break;case"bezierCurveTo":h=y[0],d=y[1],u=y[2],f=y[3],l=y[4],c=y[5],y[0]=e*h+n*d+o,y[1]=i*h+r*d+a,y[2]=e*u+n*f+o,y[3]=i*u+r*f+a,y[4]=e*l+n*c+o,y[5]=i*l+r*c+a;break;case"quadraticCurveTo":h=y[0],d=y[1],l=y[2],c=y[3],y[0]=e*h+n*d+o,y[1]=i*h+r*d+a,y[2]=e*l+n*c+o,y[3]=i*l+r*c+a;break;case"arcToSvg":l=y[5],c=y[6],m=y[0],x=y[1],y[0]=e*m+n*x,y[1]=i*m+r*x,y[5]=e*l+n*c+o,y[6]=i*l+r*c+a;break;case"circle":y[4]=Rs(y[3],t);break;case"rect":y[4]=Rs(y[4],t);break;case"ellipse":y[8]=Rs(y[8],t);break;case"roundRect":y[5]=Rs(y[5],t);break;case"addPath":y[0].transform(t);break;case"poly":y[2]=Rs(y[2],t);break;default:V("unknown transform action",g.action);break}}return this._dirty=!0,this}get bounds(){return this.shapePath.bounds}getLastPoint(t){let e=this.instructions.length-1,i=this.instructions[e];if(!i)return t.x=0,t.y=0,t;for(;i.action==="closePath";){if(e--,e<0)return t.x=0,t.y=0,t;i=this.instructions[e]}switch(i.action){case"moveTo":case"lineTo":t.x=i.data[0],t.y=i.data[1];break;case"quadraticCurveTo":t.x=i.data[2],t.y=i.data[3];break;case"bezierCurveTo":t.x=i.data[4],t.y=i.data[5];break;case"arc":case"arcToSvg":t.x=i.data[5],t.y=i.data[6];break;case"addPath":i.data[0].getLastPoint(t);break}return t}}function Rs(s,t){return s?s.prepend(t):t.clone()}function J(s,t,e){const i=s.getAttribute(t);return i?Number(i):e}function qu(s,t){const e=s.querySelectorAll("defs");for(let i=0;i<e.length;i++){const n=e[i];for(let r=0;r<n.children.length;r++){const o=n.children[r];switch(o.nodeName.toLowerCase()){case"lineargradient":t.defs[o.id]=Xu(o);break;case"radialgradient":t.defs[o.id]=Ku();break}}}}function Xu(s){const t=J(s,"x1",0),e=J(s,"y1",0),i=J(s,"x2",1),n=J(s,"y2",0),r=s.getAttribute("gradientUnits")||"objectBoundingBox",o=new Qt(t,e,i,n,r==="objectBoundingBox"?"local":"global");for(let a=0;a<s.children.length;a++){const l=s.children[a],c=J(l,"offset",0),h=st.shared.setValue(l.getAttribute("stop-color")).toNumber();o.addColorStop(c,h)}return o}function Ku(s){return V("[SVG Parser] Radial gradients are not yet supported"),new Qt(0,0,1,0)}function Co(s){const t=s.match(/url\s*\(\s*['"]?\s*#([^'"\s)]+)\s*['"]?\s*\)/i);return t?t[1]:""}const Mo={fill:{type:"paint",default:0},"fill-opacity":{type:"number",default:1},stroke:{type:"paint",default:0},"stroke-width":{type:"number",default:1},"stroke-opacity":{type:"number",default:1},"stroke-linecap":{type:"string",default:"butt"},"stroke-linejoin":{type:"string",default:"miter"},"stroke-miterlimit":{type:"number",default:10},"stroke-dasharray":{type:"string",default:"none"},"stroke-dashoffset":{type:"number",default:0},opacity:{type:"number",default:1}};function Al(s,t){const e=s.getAttribute("style"),i={},n={},r={strokeStyle:i,fillStyle:n,useFill:!1,useStroke:!1};for(const o in Mo){const a=s.getAttribute(o);a&&To(t,r,o,a.trim())}if(e){const o=e.split(";");for(let a=0;a<o.length;a++){const l=o[a].trim(),[c,h]=l.split(":");Mo[c]&&To(t,r,c,h.trim())}}return{strokeStyle:r.useStroke?i:null,fillStyle:r.useFill?n:null,useFill:r.useFill,useStroke:r.useStroke}}function To(s,t,e,i){switch(e){case"stroke":if(i!=="none"){if(i.startsWith("url(")){const n=Co(i);t.strokeStyle.fill=s.defs[n]}else t.strokeStyle.color=st.shared.setValue(i).toNumber();t.useStroke=!0}break;case"stroke-width":t.strokeStyle.width=Number(i);break;case"fill":if(i!=="none"){if(i.startsWith("url(")){const n=Co(i);t.fillStyle.fill=s.defs[n]}else t.fillStyle.color=st.shared.setValue(i).toNumber();t.useFill=!0}break;case"fill-opacity":t.fillStyle.alpha=Number(i);break;case"stroke-opacity":t.strokeStyle.alpha=Number(i);break;case"opacity":t.fillStyle.alpha=Number(i),t.strokeStyle.alpha=Number(i);break}}function Zu(s){if(s.length<=2)return!0;const t=s.map(a=>a.area).sort((a,l)=>l-a),[e,i]=t,n=t[t.length-1],r=e/i,o=i/n;return!(r>3&&o<2)}function Ju(s){return s.split(/(?=[Mm])/).filter(i=>i.trim().length>0)}function Qu(s){const t=s.match(/[-+]?[0-9]*\.?[0-9]+/g);if(!t||t.length<4)return 0;const e=t.map(Number),i=[],n=[];for(let h=0;h<e.length;h+=2)h+1<e.length&&(i.push(e[h]),n.push(e[h+1]));if(i.length===0||n.length===0)return 0;const r=Math.min(...i),o=Math.max(...i),a=Math.min(...n),l=Math.max(...n);return(o-r)*(l-a)}function Po(s,t){const e=new Jt(s,!1);for(const i of e.instructions)t.instructions.push(i)}function tf(s,t){if(typeof s=="string"){const o=document.createElement("div");o.innerHTML=s.trim(),s=o.querySelector("svg")}const e={context:t,defs:{},path:new Jt};qu(s,e);const i=s.children,{fillStyle:n,strokeStyle:r}=Al(s,e);for(let o=0;o<i.length;o++){const a=i[o];a.nodeName.toLowerCase()!=="defs"&&Cl(a,e,n,r)}return t}function Cl(s,t,e,i){const n=s.children,{fillStyle:r,strokeStyle:o}=Al(s,t);r&&e?e={...e,...r}:r&&(e=r),o&&i?i={...i,...o}:o&&(i=o);const a=!e&&!i;a&&(e={color:0});let l,c,h,d,u,f,m,x,p,g,y,b,_,S,v,w,C;switch(s.nodeName.toLowerCase()){case"path":{S=s.getAttribute("d");const T=s.getAttribute("fill-rule"),A=Ju(S),k=T==="evenodd",F=A.length>1;if(k&&F){const $=A.map(M=>({path:M,area:Qu(M)}));if($.sort((M,B)=>B.area-M.area),A.length>3||!Zu($))for(let M=0;M<$.length;M++){const B=$[M],oe=M===0;t.context.beginPath();const W=new Jt(void 0,!0);Po(B.path,W),t.context.path(W),oe?(e&&t.context.fill(e),i&&t.context.stroke(i)):t.context.cut()}else for(let M=0;M<$.length;M++){const B=$[M],oe=M%2===1;t.context.beginPath();const W=new Jt(void 0,!0);Po(B.path,W),t.context.path(W),oe?t.context.cut():(e&&t.context.fill(e),i&&t.context.stroke(i))}}else{const $=T?T==="evenodd":!0;v=new Jt(S,$),t.context.path(v),e&&t.context.fill(e),i&&t.context.stroke(i)}break}case"circle":m=J(s,"cx",0),x=J(s,"cy",0),p=J(s,"r",0),t.context.ellipse(m,x,p,p),e&&t.context.fill(e),i&&t.context.stroke(i);break;case"rect":l=J(s,"x",0),c=J(s,"y",0),w=J(s,"width",0),C=J(s,"height",0),g=J(s,"rx",0),y=J(s,"ry",0),g||y?t.context.roundRect(l,c,w,C,g||y):t.context.rect(l,c,w,C),e&&t.context.fill(e),i&&t.context.stroke(i);break;case"ellipse":m=J(s,"cx",0),x=J(s,"cy",0),g=J(s,"rx",0),y=J(s,"ry",0),t.context.beginPath(),t.context.ellipse(m,x,g,y),e&&t.context.fill(e),i&&t.context.stroke(i);break;case"line":h=J(s,"x1",0),d=J(s,"y1",0),u=J(s,"x2",0),f=J(s,"y2",0),t.context.beginPath(),t.context.moveTo(h,d),t.context.lineTo(u,f),i&&t.context.stroke(i);break;case"polygon":_=s.getAttribute("points"),b=_.match(/\d+/g).map(T=>parseInt(T,10)),t.context.poly(b,!0),e&&t.context.fill(e),i&&t.context.stroke(i);break;case"polyline":_=s.getAttribute("points"),b=_.match(/\d+/g).map(T=>parseInt(T,10)),t.context.poly(b,!1),i&&t.context.stroke(i);break;case"g":case"svg":break;default:{V(`[SVG parser] <${s.nodeName}> elements unsupported`);break}}a&&(e=null);for(let T=0;T<n.length;T++)Cl(n[T],t,e,i)}function ef(s){return st.isColorLike(s)}function Eo(s){return s instanceof Hi}function Io(s){return s instanceof Qt}function sf(s){return s instanceof O}function nf(s,t,e){const i=st.shared.setValue(t??0);return s.color=i.toNumber(),s.alpha=i.alpha===1?e.alpha:i.alpha,s.texture=O.WHITE,{...e,...s}}function rf(s,t,e){return s.texture=t,{...e,...s}}function Lo(s,t,e){return s.fill=t,s.color=16777215,s.texture=t.texture,s.matrix=t.transform,{...e,...s}}function Bo(s,t,e){return t.buildGradient(),s.fill=t,s.color=16777215,s.texture=t.texture,s.matrix=t.transform,s.textureSpace=t.textureSpace,{...e,...s}}function of(s,t){const e={...t,...s},i=st.shared.setValue(e.color);return e.alpha*=i.alpha,e.color=i.toNumber(),e}function Ee(s,t){if(s==null)return null;const e={},i=s;return ef(s)?nf(e,s,t):sf(s)?rf(e,s,t):Eo(s)?Lo(e,s,t):Io(s)?Bo(e,s,t):i.fill&&Eo(i.fill)?Lo(i,i.fill,t):i.fill&&Io(i.fill)?Bo(i,i.fill,t):of(i,t)}function Gi(s,t){const{width:e,alignment:i,miterLimit:n,cap:r,join:o,pixelLine:a,...l}=t,c=Ee(s,l);return c?{width:e,alignment:i,miterLimit:n,cap:r,join:o,pixelLine:a,...c}:null}const af=new ut,Ro=new G,dr=class Ot extends Bt{constructor(){super(...arguments),this.uid=Q("graphicsContext"),this.dirty=!0,this.batchMode="auto",this.instructions=[],this._activePath=new Jt,this._transform=new G,this._fillStyle={...Ot.defaultFillStyle},this._strokeStyle={...Ot.defaultStrokeStyle},this._stateStack=[],this._tick=0,this._bounds=new It,this._boundsDirty=!0}clone(){const t=new Ot;return t.batchMode=this.batchMode,t.instructions=this.instructions.slice(),t._activePath=this._activePath.clone(),t._transform=this._transform.clone(),t._fillStyle={...this._fillStyle},t._strokeStyle={...this._strokeStyle},t._stateStack=this._stateStack.slice(),t._bounds=this._bounds.clone(),t._boundsDirty=!0,t}get fillStyle(){return this._fillStyle}set fillStyle(t){this._fillStyle=Ee(t,Ot.defaultFillStyle)}get strokeStyle(){return this._strokeStyle}set strokeStyle(t){this._strokeStyle=Gi(t,Ot.defaultStrokeStyle)}setFillStyle(t){return this._fillStyle=Ee(t,Ot.defaultFillStyle),this}setStrokeStyle(t){return this._strokeStyle=Ee(t,Ot.defaultStrokeStyle),this}texture(t,e,i,n,r,o){return this.instructions.push({action:"texture",data:{image:t,dx:i||0,dy:n||0,dw:r||t.frame.width,dh:o||t.frame.height,transform:this._transform.clone(),alpha:this._fillStyle.alpha,style:e?st.shared.setValue(e).toNumber():16777215}}),this.onUpdate(),this}beginPath(){return this._activePath=new Jt,this}fill(t,e){let i;const n=this.instructions[this.instructions.length-1];return this._tick===0&&n&&n.action==="stroke"?i=n.data.path:i=this._activePath.clone(),i?(t!=null&&(e!==void 0&&typeof t=="number"&&(z(N,"GraphicsContext.fill(color, alpha) is deprecated, use GraphicsContext.fill({ color, alpha }) instead"),t={color:t,alpha:e}),this._fillStyle=Ee(t,Ot.defaultFillStyle)),this.instructions.push({action:"fill",data:{style:this.fillStyle,path:i}}),this.onUpdate(),this._initNextPathLocation(),this._tick=0,this):this}_initNextPathLocation(){const{x:t,y:e}=this._activePath.getLastPoint(ut.shared);this._activePath.clear(),this._activePath.moveTo(t,e)}stroke(t){let e;const i=this.instructions[this.instructions.length-1];return this._tick===0&&i&&i.action==="fill"?e=i.data.path:e=this._activePath.clone(),e?(t!=null&&(this._strokeStyle=Gi(t,Ot.defaultStrokeStyle)),this.instructions.push({action:"stroke",data:{style:this.strokeStyle,path:e}}),this.onUpdate(),this._initNextPathLocation(),this._tick=0,this):this}cut(){for(let t=0;t<2;t++){const e=this.instructions[this.instructions.length-1-t],i=this._activePath.clone();if(e&&(e.action==="stroke"||e.action==="fill"))if(e.data.hole)e.data.hole.addPath(i);else{e.data.hole=i;break}}return this._initNextPathLocation(),this}arc(t,e,i,n,r,o){this._tick++;const a=this._transform;return this._activePath.arc(a.a*t+a.c*e+a.tx,a.b*t+a.d*e+a.ty,i,n,r,o),this}arcTo(t,e,i,n,r){this._tick++;const o=this._transform;return this._activePath.arcTo(o.a*t+o.c*e+o.tx,o.b*t+o.d*e+o.ty,o.a*i+o.c*n+o.tx,o.b*i+o.d*n+o.ty,r),this}arcToSvg(t,e,i,n,r,o,a){this._tick++;const l=this._transform;return this._activePath.arcToSvg(t,e,i,n,r,l.a*o+l.c*a+l.tx,l.b*o+l.d*a+l.ty),this}bezierCurveTo(t,e,i,n,r,o,a){this._tick++;const l=this._transform;return this._activePath.bezierCurveTo(l.a*t+l.c*e+l.tx,l.b*t+l.d*e+l.ty,l.a*i+l.c*n+l.tx,l.b*i+l.d*n+l.ty,l.a*r+l.c*o+l.tx,l.b*r+l.d*o+l.ty,a),this}closePath(){var t;return this._tick++,(t=this._activePath)==null||t.closePath(),this}ellipse(t,e,i,n){return this._tick++,this._activePath.ellipse(t,e,i,n,this._transform.clone()),this}circle(t,e,i){return this._tick++,this._activePath.circle(t,e,i,this._transform.clone()),this}path(t){return this._tick++,this._activePath.addPath(t,this._transform.clone()),this}lineTo(t,e){this._tick++;const i=this._transform;return this._activePath.lineTo(i.a*t+i.c*e+i.tx,i.b*t+i.d*e+i.ty),this}moveTo(t,e){this._tick++;const i=this._transform,n=this._activePath.instructions,r=i.a*t+i.c*e+i.tx,o=i.b*t+i.d*e+i.ty;return n.length===1&&n[0].action==="moveTo"?(n[0].data[0]=r,n[0].data[1]=o,this):(this._activePath.moveTo(r,o),this)}quadraticCurveTo(t,e,i,n,r){this._tick++;const o=this._transform;return this._activePath.quadraticCurveTo(o.a*t+o.c*e+o.tx,o.b*t+o.d*e+o.ty,o.a*i+o.c*n+o.tx,o.b*i+o.d*n+o.ty,r),this}rect(t,e,i,n){return this._tick++,this._activePath.rect(t,e,i,n,this._transform.clone()),this}roundRect(t,e,i,n,r){return this._tick++,this._activePath.roundRect(t,e,i,n,r,this._transform.clone()),this}poly(t,e){return this._tick++,this._activePath.poly(t,e,this._transform.clone()),this}regularPoly(t,e,i,n,r=0,o){return this._tick++,this._activePath.regularPoly(t,e,i,n,r,o),this}roundPoly(t,e,i,n,r,o){return this._tick++,this._activePath.roundPoly(t,e,i,n,r,o),this}roundShape(t,e,i,n){return this._tick++,this._activePath.roundShape(t,e,i,n),this}filletRect(t,e,i,n,r){return this._tick++,this._activePath.filletRect(t,e,i,n,r),this}chamferRect(t,e,i,n,r,o){return this._tick++,this._activePath.chamferRect(t,e,i,n,r,o),this}star(t,e,i,n,r=0,o=0){return this._tick++,this._activePath.star(t,e,i,n,r,o,this._transform.clone()),this}svg(t){return this._tick++,tf(t,this),this}restore(){const t=this._stateStack.pop();return t&&(this._transform=t.transform,this._fillStyle=t.fillStyle,this._strokeStyle=t.strokeStyle),this}save(){return this._stateStack.push({transform:this._transform.clone(),fillStyle:{...this._fillStyle},strokeStyle:{...this._strokeStyle}}),this}getTransform(){return this._transform}resetTransform(){return this._transform.identity(),this}rotate(t){return this._transform.rotate(t),this}scale(t,e=t){return this._transform.scale(t,e),this}setTransform(t,e,i,n,r,o){return t instanceof G?(this._transform.set(t.a,t.b,t.c,t.d,t.tx,t.ty),this):(this._transform.set(t,e,i,n,r,o),this)}transform(t,e,i,n,r,o){return t instanceof G?(this._transform.append(t),this):(Ro.set(t,e,i,n,r,o),this._transform.append(Ro),this)}translate(t,e=t){return this._transform.translate(t,e),this}clear(){return this._activePath.clear(),this.instructions.length=0,this.resetTransform(),this.onUpdate(),this}onUpdate(){this._boundsDirty=!0,!this.dirty&&(this.emit("update",this,16),this.dirty=!0)}get bounds(){if(!this._boundsDirty)return this._bounds;this._boundsDirty=!1;const t=this._bounds;t.clear();for(let e=0;e<this.instructions.length;e++){const i=this.instructions[e],n=i.action;if(n==="fill"){const r=i.data;t.addBounds(r.path.bounds)}else if(n==="texture"){const r=i.data;t.addFrame(r.dx,r.dy,r.dx+r.dw,r.dy+r.dh,r.transform)}if(n==="stroke"){const r=i.data,o=r.style.alignment,a=r.style.width*(1-o),l=r.path.bounds;t.addFrame(l.minX-a,l.minY-a,l.maxX+a,l.maxY+a)}}return t}containsPoint(t){var n;if(!this.bounds.containsPoint(t.x,t.y))return!1;const e=this.instructions;let i=!1;for(let r=0;r<e.length;r++){const o=e[r],a=o.data,l=a.path;if(!o.action||!l)continue;const c=a.style,h=l.shapePath.shapePrimitives;for(let d=0;d<h.length;d++){const u=h[d].shape;if(!c||!u)continue;const f=h[d].transform,m=f?f.applyInverse(t,af):t;if(o.action==="fill")i=u.contains(m.x,m.y);else{const p=c;i=u.strokeContains(m.x,m.y,p.width,p.alignment)}const x=a.hole;if(x){const p=(n=x.shapePath)==null?void 0:n.shapePrimitives;if(p)for(let g=0;g<p.length;g++)p[g].shape.contains(m.x,m.y)&&(i=!1)}if(i)return!0}}return i}destroy(t=!1){if(this._stateStack.length=0,this._transform=null,this.emit("destroy",this),this.removeAllListeners(),typeof t=="boolean"?t:t==null?void 0:t.texture){const i=typeof t=="boolean"?t:t==null?void 0:t.textureSource;this._fillStyle.texture&&(this._fillStyle.fill&&"uid"in this._fillStyle.fill?this._fillStyle.fill.destroy():this._fillStyle.texture.destroy(i)),this._strokeStyle.texture&&(this._strokeStyle.fill&&"uid"in this._strokeStyle.fill?this._strokeStyle.fill.destroy():this._strokeStyle.texture.destroy(i))}this._fillStyle=null,this._strokeStyle=null,this.instructions=null,this._activePath=null,this._bounds=null,this._stateStack=null,this.customShader=null,this._transform=null}};dr.defaultFillStyle={color:16777215,alpha:1,texture:O.WHITE,matrix:null,fill:null,textureSpace:"local"};dr.defaultStrokeStyle={width:1,color:16777215,alpha:1,alignment:.5,miterLimit:10,cap:"butt",join:"miter",texture:O.WHITE,matrix:null,fill:null,textureSpace:"local",pixelLine:!1};let vt=dr;const ur=class He extends Bt{constructor(t={}){super(),this.uid=Q("textStyle"),this._tick=0,lf(t);const e={...He.defaultTextStyle,...t};for(const i in e){const n=i;this[n]=e[i]}this.update(),this._tick=0}get align(){return this._align}set align(t){this._align=t,this.update()}get breakWords(){return this._breakWords}set breakWords(t){this._breakWords=t,this.update()}get dropShadow(){return this._dropShadow}set dropShadow(t){t!==null&&typeof t=="object"?this._dropShadow=this._createProxy({...He.defaultDropShadow,...t}):this._dropShadow=t?this._createProxy({...He.defaultDropShadow}):null,this.update()}get fontFamily(){return this._fontFamily}set fontFamily(t){this._fontFamily=t,this.update()}get fontSize(){return this._fontSize}set fontSize(t){typeof t=="string"?this._fontSize=parseInt(t,10):this._fontSize=t,this.update()}get fontStyle(){return this._fontStyle}set fontStyle(t){this._fontStyle=t.toLowerCase(),this.update()}get fontVariant(){return this._fontVariant}set fontVariant(t){this._fontVariant=t,this.update()}get fontWeight(){return this._fontWeight}set fontWeight(t){this._fontWeight=t,this.update()}get leading(){return this._leading}set leading(t){this._leading=t,this.update()}get letterSpacing(){return this._letterSpacing}set letterSpacing(t){this._letterSpacing=t,this.update()}get lineHeight(){return this._lineHeight}set lineHeight(t){this._lineHeight=t,this.update()}get padding(){return this._padding}set padding(t){this._padding=t,this.update()}get filters(){return this._filters}set filters(t){this._filters=Object.freeze(t),this.update()}get trim(){return this._trim}set trim(t){this._trim=t,this.update()}get textBaseline(){return this._textBaseline}set textBaseline(t){this._textBaseline=t,this.update()}get whiteSpace(){return this._whiteSpace}set whiteSpace(t){this._whiteSpace=t,this.update()}get wordWrap(){return this._wordWrap}set wordWrap(t){this._wordWrap=t,this.update()}get wordWrapWidth(){return this._wordWrapWidth}set wordWrapWidth(t){this._wordWrapWidth=t,this.update()}get fill(){return this._originalFill}set fill(t){t!==this._originalFill&&(this._originalFill=t,this._isFillStyle(t)&&(this._originalFill=this._createProxy({...vt.defaultFillStyle,...t},()=>{this._fill=Ee({...this._originalFill},vt.defaultFillStyle)})),this._fill=Ee(t===0?"black":t,vt.defaultFillStyle),this.update())}get stroke(){return this._originalStroke}set stroke(t){t!==this._originalStroke&&(this._originalStroke=t,this._isFillStyle(t)&&(this._originalStroke=this._createProxy({...vt.defaultStrokeStyle,...t},()=>{this._stroke=Gi({...this._originalStroke},vt.defaultStrokeStyle)})),this._stroke=Gi(t,vt.defaultStrokeStyle),this.update())}update(){this._tick++,this.emit("update",this)}reset(){const t=He.defaultTextStyle;for(const e in t)this[e]=t[e]}get styleKey(){return`${this.uid}-${this._tick}`}clone(){return new He({align:this.align,breakWords:this.breakWords,dropShadow:this._dropShadow?{...this._dropShadow}:null,fill:this._fill,fontFamily:this.fontFamily,fontSize:this.fontSize,fontStyle:this.fontStyle,fontVariant:this.fontVariant,fontWeight:this.fontWeight,leading:this.leading,letterSpacing:this.letterSpacing,lineHeight:this.lineHeight,padding:this.padding,stroke:this._stroke,textBaseline:this.textBaseline,whiteSpace:this.whiteSpace,wordWrap:this.wordWrap,wordWrapWidth:this.wordWrapWidth,filters:this._filters?[...this._filters]:void 0})}_getFinalPadding(){let t=0;if(this._filters)for(let e=0;e<this._filters.length;e++)t+=this._filters[e].padding;return Math.max(this._padding,t)}destroy(t=!1){var i,n,r,o;if(this.removeAllListeners(),typeof t=="boolean"?t:t==null?void 0:t.texture){const a=typeof t=="boolean"?t:t==null?void 0:t.textureSource;(i=this._fill)!=null&&i.texture&&this._fill.texture.destroy(a),(n=this._originalFill)!=null&&n.texture&&this._originalFill.texture.destroy(a),(r=this._stroke)!=null&&r.texture&&this._stroke.texture.destroy(a),(o=this._originalStroke)!=null&&o.texture&&this._originalStroke.texture.destroy(a)}this._fill=null,this._stroke=null,this.dropShadow=null,this._originalStroke=null,this._originalFill=null}_createProxy(t,e){return new Proxy(t,{set:(i,n,r)=>(i[n]=r,e==null||e(n,r),this.update(),!0)})}_isFillStyle(t){return(t??null)!==null&&!(st.isColorLike(t)||t instanceof Qt||t instanceof Hi)}};ur.defaultDropShadow={alpha:1,angle:Math.PI/6,blur:0,color:"black",distance:5};ur.defaultTextStyle={align:"left",breakWords:!1,dropShadow:null,fill:"black",fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",leading:0,letterSpacing:0,lineHeight:0,padding:0,stroke:null,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100};let Re=ur;function lf(s){const t=s;if(typeof t.dropShadow=="boolean"&&t.dropShadow){const e=Re.defaultDropShadow;s.dropShadow={alpha:t.dropShadowAlpha??e.alpha,angle:t.dropShadowAngle??e.angle,blur:t.dropShadowBlur??e.blur,color:t.dropShadowColor??e.color,distance:t.dropShadowDistance??e.distance}}if(t.strokeThickness!==void 0){z(N,"strokeThickness is now a part of stroke");const e=t.stroke;let i={};if(st.isColorLike(e))i.color=e;else if(e instanceof Qt||e instanceof Hi)i.fill=e;else if(Object.hasOwnProperty.call(e,"color")||Object.hasOwnProperty.call(e,"fill"))i=e;else throw new Error("Invalid stroke value.");s.stroke={...i,width:t.strokeThickness}}if(Array.isArray(t.fillGradientStops)){if(z(N,"gradient fill is now a fill pattern: `new FillGradient(...)`"),!Array.isArray(t.fill)||t.fill.length===0)throw new Error("Invalid fill value. Expected an array of colors for gradient fill.");t.fill.length!==t.fillGradientStops.length&&V("The number of fill colors must match the number of fill gradient stops.");const e=new Qt({start:{x:0,y:0},end:{x:0,y:1},textureSpace:"local"}),i=t.fillGradientStops.slice(),n=t.fill.map(r=>st.shared.setValue(r).toNumber());i.forEach((r,o)=>{e.addColorStop(r,n[o])}),s.fill={fill:e}}}class cf{constructor(t){this._canvasPool=Object.create(null),this.canvasOptions=t||{},this.enableFullScreen=!1}_createCanvasAndContext(t,e){const i=j.get().createCanvas();i.width=t,i.height=e;const n=i.getContext("2d");return{canvas:i,context:n}}getOptimalCanvasAndContext(t,e,i=1){t=Math.ceil(t*i-1e-6),e=Math.ceil(e*i-1e-6),t=ss(t),e=ss(e);const n=(t<<17)+(e<<1);this._canvasPool[n]||(this._canvasPool[n]=[]);let r=this._canvasPool[n].pop();return r||(r=this._createCanvasAndContext(t,e)),r}returnCanvasAndContext(t){const e=t.canvas,{width:i,height:n}=e,r=(i<<17)+(n<<1);t.context.resetTransform(),t.context.clearRect(0,0,i,n),this._canvasPool[r].push(t)}clear(){this._canvasPool={}}}const Qs=new cf;si.register(Qs);const Fo=1e5;function Oi(s,t,e,i=0){if(s.texture===O.WHITE&&!s.fill)return st.shared.setValue(s.color).setAlpha(s.alpha??1).toHexa();if(s.fill){if(s.fill instanceof Hi){const n=s.fill,r=t.createPattern(n.texture.source.resource,"repeat"),o=n.transform.copyTo(G.shared);return o.scale(n.texture.frame.width,n.texture.frame.height),r.setTransform(o),r}else if(s.fill instanceof Qt){const n=s.fill,r=n.type==="linear",o=n.textureSpace==="local";let a=1,l=1;o&&e&&(a=e.width+i,l=e.height+i);let c,h=!1;if(r){const{start:d,end:u}=n;c=t.createLinearGradient(d.x*a,d.y*l,u.x*a,u.y*l),h=Math.abs(u.x-d.x)<Math.abs((u.y-d.y)*.1)}else{const{center:d,innerRadius:u,outerCenter:f,outerRadius:m}=n;c=t.createRadialGradient(d.x*a,d.y*l,u*a,f.x*a,f.y*l,m*a)}if(h&&o&&e){const d=e.lineHeight/l;for(let u=0;u<e.lines.length;u++){const f=(u*e.lineHeight+i/2)/l;n.colorStops.forEach(m=>{const x=f+m.offset*d;c.addColorStop(Math.floor(x*Fo)/Fo,st.shared.setValue(m.color).toHex())})}}else n.colorStops.forEach(d=>{c.addColorStop(d.offset,st.shared.setValue(d.color).toHex())});return c}}else{const n=t.createPattern(s.texture.source.resource,"repeat"),r=s.matrix.copyTo(G.shared);return r.scale(s.texture.frame.width,s.texture.frame.height),n.setTransform(r),n}return V("FillStyle not recognised",s),"red"}const Ml=class Tl extends ll{constructor(t){super(),this.resolution=1,this.pages=[],this._padding=0,this._measureCache=Object.create(null),this._currentChars=[],this._currentX=0,this._currentY=0,this._currentMaxCharHeight=0,this._currentPageIndex=-1,this._skipKerning=!1;const e={...Tl.defaultOptions,...t};this._textureSize=e.textureSize,this._mipmap=e.mipmap;const i=e.style.clone();e.overrideFill&&(i._fill.color=16777215,i._fill.alpha=1,i._fill.texture=O.WHITE,i._fill.fill=null),this.applyFillAsTint=e.overrideFill;const n=i.fontSize;i.fontSize=this.baseMeasurementFontSize;const r=zi(i);e.overrideSize?i._stroke&&(i._stroke.width*=this.baseRenderedFontSize/n):i.fontSize=this.baseRenderedFontSize=n,this._style=i,this._skipKerning=e.skipKerning??!1,this.resolution=e.resolution??1,this._padding=e.padding??4,e.textureStyle&&(this._textureStyle=e.textureStyle instanceof is?e.textureStyle:new is(e.textureStyle)),this.fontMetrics=Wt.measureFont(r),this.lineHeight=i.lineHeight||this.fontMetrics.fontSize||i.fontSize}ensureCharacters(t){var p,g;const e=Wt.graphemeSegmenter(t).filter(y=>!this._currentChars.includes(y)).filter((y,b,_)=>_.indexOf(y)===b);if(!e.length)return;this._currentChars=[...this._currentChars,...e];let i;this._currentPageIndex===-1?i=this._nextPage():i=this.pages[this._currentPageIndex];let{canvas:n,context:r}=i.canvasAndContext,o=i.texture.source;const a=this._style;let l=this._currentX,c=this._currentY,h=this._currentMaxCharHeight;const d=this.baseRenderedFontSize/this.baseMeasurementFontSize,u=this._padding*d;let f=!1;const m=n.width/this.resolution,x=n.height/this.resolution;for(let y=0;y<e.length;y++){const b=e[y],_=Wt.measureText(b,a,n,!1);_.lineHeight=_.height;const S=_.width*d,v=Math.ceil((a.fontStyle==="italic"?2:1)*S),w=_.height*d,C=v+u*2,T=w+u*2;if(f=!1,b!==`
`&&b!=="\r"&&b!=="	"&&b!==" "&&(f=!0,h=Math.ceil(Math.max(T,h))),l+C>m&&(c+=h,h=T,l=0,c+h>x)){o.update();const k=this._nextPage();n=k.canvasAndContext.canvas,r=k.canvasAndContext.context,o=k.texture.source,l=0,c=0,h=0}const A=S/d-(((p=a.dropShadow)==null?void 0:p.distance)??0)-(((g=a._stroke)==null?void 0:g.width)??0);if(this.chars[b]={id:b.codePointAt(0),xOffset:-this._padding,yOffset:-this._padding,xAdvance:A,kerning:{}},f){this._drawGlyph(r,_,l+u,c+u,d,a);const k=o.width*d,F=o.height*d,L=new X(l/k*o.width,c/F*o.height,C/k*o.width,T/F*o.height);this.chars[b].texture=new O({source:o,frame:L}),l+=Math.ceil(C)}}o.update(),this._currentX=l,this._currentY=c,this._currentMaxCharHeight=h,this._skipKerning&&this._applyKerning(e,r)}get pageTextures(){return z(N,"BitmapFont.pageTextures is deprecated, please use BitmapFont.pages instead."),this.pages}_applyKerning(t,e){const i=this._measureCache;for(let n=0;n<t.length;n++){const r=t[n];for(let o=0;o<this._currentChars.length;o++){const a=this._currentChars[o];let l=i[r];l||(l=i[r]=e.measureText(r).width);let c=i[a];c||(c=i[a]=e.measureText(a).width);let h=e.measureText(r+a).width,d=h-(l+c);d&&(this.chars[r].kerning[a]=d),h=e.measureText(r+a).width,d=h-(l+c),d&&(this.chars[a].kerning[r]=d)}}}_nextPage(){this._currentPageIndex++;const t=this.resolution,e=Qs.getOptimalCanvasAndContext(this._textureSize,this._textureSize,t);this._setupContext(e.context,this._style,t);const i=t*(this.baseRenderedFontSize/this.baseMeasurementFontSize),n=new O({source:new Le({resource:e.canvas,resolution:i,alphaMode:"premultiply-alpha-on-upload",autoGenerateMipmaps:this._mipmap})});this._textureStyle&&(n.source.style=this._textureStyle);const r={canvasAndContext:e,texture:n};return this.pages[this._currentPageIndex]=r,r}_setupContext(t,e,i){e.fontSize=this.baseRenderedFontSize,t.scale(i,i),t.font=zi(e),e.fontSize=this.baseMeasurementFontSize,t.textBaseline=e.textBaseline;const n=e._stroke,r=(n==null?void 0:n.width)??0;if(n&&(t.lineWidth=r,t.lineJoin=n.join,t.miterLimit=n.miterLimit,t.strokeStyle=Oi(n,t)),e._fill&&(t.fillStyle=Oi(e._fill,t)),e.dropShadow){const o=e.dropShadow,a=st.shared.setValue(o.color).toArray(),l=o.blur*i,c=o.distance*i;t.shadowColor=`rgba(${a[0]*255},${a[1]*255},${a[2]*255},${o.alpha})`,t.shadowBlur=l,t.shadowOffsetX=Math.cos(o.angle)*c,t.shadowOffsetY=Math.sin(o.angle)*c}else t.shadowColor="black",t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0}_drawGlyph(t,e,i,n,r,o){const a=e.text,l=e.fontProperties,c=o._stroke,h=((c==null?void 0:c.width)??0)*r,d=i+h/2,u=n-h/2,f=l.descent*r,m=e.lineHeight*r;let x=!1;o.stroke&&h&&(x=!0,t.strokeText(a,d,u+m-f));const{shadowBlur:p,shadowOffsetX:g,shadowOffsetY:y}=t;o._fill&&(x&&(t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0),t.fillText(a,d,u+m-f)),x&&(t.shadowBlur=p,t.shadowOffsetX=g,t.shadowOffsetY=y)}destroy(){super.destroy();for(let t=0;t<this.pages.length;t++){const{canvasAndContext:e,texture:i}=this.pages[t];Qs.returnCanvasAndContext(e),i.destroy(!0)}this.pages=null}};Ml.defaultOptions={textureSize:512,style:new Re,mipmap:!0};let zo=Ml;function hf(s,t,e,i){const n={width:0,height:0,offsetY:0,scale:t.fontSize/e.baseMeasurementFontSize,lines:[{width:0,charPositions:[],spaceWidth:0,spacesIndex:[],chars:[]}]};n.offsetY=e.baseLineOffset;let r=n.lines[0],o=null,a=!0;const l={width:0,start:0,index:0,positions:[],chars:[]},c=e.baseMeasurementFontSize/t.fontSize,h=t.letterSpacing*c,d=t.wordWrapWidth*c,u=t.lineHeight?t.lineHeight*c:e.lineHeight,f=t.wordWrap&&t.breakWords,m=g=>{const y=r.width;for(let b=0;b<l.index;b++){const _=g.positions[b];r.chars.push(g.chars[b]),r.charPositions.push(_+y)}r.width+=g.width,a=!1,l.width=0,l.index=0,l.chars.length=0},x=()=>{let g=r.chars.length-1;if(i){let y=r.chars[g];for(;y===" ";)r.width-=e.chars[y].xAdvance,y=r.chars[--g]}n.width=Math.max(n.width,r.width),r={width:0,charPositions:[],chars:[],spaceWidth:0,spacesIndex:[]},a=!0,n.lines.push(r),n.height+=u},p=g=>g-h>d;for(let g=0;g<s.length+1;g++){let y;const b=g===s.length;b||(y=s[g]);const _=e.chars[y]||e.chars[" "];if(/(?:\s)/.test(y)||y==="\r"||y===`
`||b){if(!a&&t.wordWrap&&p(r.width+l.width)?(x(),m(l),b||r.charPositions.push(0)):(l.start=r.width,m(l),b||r.charPositions.push(0)),y==="\r"||y===`
`)x();else if(!b){const C=_.xAdvance+(_.kerning[o]||0)+h;r.width+=C,r.spaceWidth=C,r.spacesIndex.push(r.charPositions.length),r.chars.push(y)}}else{const w=_.kerning[o]||0,C=_.xAdvance+w+h;f&&p(r.width+l.width+C)&&(m(l),x()),l.positions[l.index++]=l.width+w,l.chars.push(y),l.width+=C}o=y}return x(),t.align==="center"?df(n):t.align==="right"?uf(n):t.align==="justify"&&ff(n),n}function df(s){for(let t=0;t<s.lines.length;t++){const e=s.lines[t],i=s.width/2-e.width/2;for(let n=0;n<e.charPositions.length;n++)e.charPositions[n]+=i}}function uf(s){for(let t=0;t<s.lines.length;t++){const e=s.lines[t],i=s.width-e.width;for(let n=0;n<e.charPositions.length;n++)e.charPositions[n]+=i}}function ff(s){const t=s.width;for(let e=0;e<s.lines.length;e++){const i=s.lines[e];let n=0,r=i.spacesIndex[n++],o=0;const a=i.spacesIndex.length,c=(t-i.width)/a;for(let h=0;h<i.charPositions.length;h++)h===r&&(r=i.spacesIndex[n++],o+=c),i.charPositions[h]+=o}}function pf(s){if(s==="")return[];typeof s=="string"&&(s=[s]);const t=[];for(let e=0,i=s.length;e<i;e++){const n=s[e];if(Array.isArray(n)){if(n.length!==2)throw new Error(`[BitmapFont]: Invalid character range length, expecting 2 got ${n.length}.`);if(n[0].length===0||n[1].length===0)throw new Error("[BitmapFont]: Invalid character delimiter.");const r=n[0].charCodeAt(0),o=n[1].charCodeAt(0);if(o<r)throw new Error("[BitmapFont]: Invalid character range.");for(let a=r,l=o;a<=l;a++)t.push(String.fromCharCode(a))}else t.push(...Array.from(n))}if(t.length===0)throw new Error("[BitmapFont]: Empty set when resolving characters.");return t}let Mi=0;class mf{constructor(){this.ALPHA=[["a","z"],["A","Z"]," "],this.NUMERIC=[["0","9"]],this.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "],this.ASCII=[[" ","~"]],this.defaultOptions={chars:this.ALPHANUMERIC,resolution:1,padding:4,skipKerning:!1,textureStyle:null},this.measureCache=cl(1e3)}getFont(t,e){var o;let i=`${e.fontFamily}-bitmap`,n=!0;if(e._fill.fill&&!e._stroke?(i+=e._fill.fill.styleKey,n=!1):(e._stroke||e.dropShadow)&&(i=`${e.styleKey}-bitmap`,n=!1),!Y.has(i)){const a=Object.create(e);a.lineHeight=0;const l=new zo({style:a,overrideFill:n,overrideSize:!0,...this.defaultOptions});Mi++,Mi>50&&V("BitmapText",`You have dynamically created ${Mi} bitmap fonts, this can be inefficient. Try pre installing your font styles using \`BitmapFont.install({name:"style1", style})\``),l.once("destroy",()=>{Mi--,Y.remove(i)}),Y.set(i,l)}const r=Y.get(i);return(o=r.ensureCharacters)==null||o.call(r,t),r}getLayout(t,e,i=!0){const n=this.getFont(t,e),r=`${t}-${e.styleKey}-${i}`;if(this.measureCache.has(r))return this.measureCache.get(r);const o=Wt.graphemeSegmenter(t),a=hf(o,e,n,i);return this.measureCache.set(r,a),a}measureText(t,e,i=!0){return this.getLayout(t,e,i)}install(...t){var c,h,d,u;let e=t[0];typeof e=="string"&&(e={name:e,style:t[1],chars:(c=t[2])==null?void 0:c.chars,resolution:(h=t[2])==null?void 0:h.resolution,padding:(d=t[2])==null?void 0:d.padding,skipKerning:(u=t[2])==null?void 0:u.skipKerning},z(N,"BitmapFontManager.install(name, style, options) is deprecated, use BitmapFontManager.install({name, style, ...options})"));const i=e==null?void 0:e.name;if(!i)throw new Error("[BitmapFontManager] Property `name` is required.");e={...this.defaultOptions,...e};const n=e.style,r=n instanceof Re?n:new Re(n),o=e.dynamicFill??this._canUseTintForStyle(r),a=new zo({style:r,overrideFill:o,skipKerning:e.skipKerning,padding:e.padding,resolution:e.resolution,overrideSize:!1,textureStyle:e.textureStyle}),l=pf(e.chars);return a.ensureCharacters(l.join("")),Y.set(`${i}-bitmap`,a),a.once("destroy",()=>Y.remove(`${i}-bitmap`)),a}uninstall(t){const e=`${t}-bitmap`,i=Y.get(e);i&&i.destroy()}_canUseTintForStyle(t){return!t._stroke&&(!t.dropShadow||t.dropShadow.color===0)&&!t._fill.fill&&t._fill.color===16777215}}const Do=new mf;class Pl extends ll{constructor(t,e){super();const{textures:i,data:n}=t;Object.keys(n.pages).forEach(r=>{const o=n.pages[parseInt(r,10)],a=i[o.id];this.pages.push({texture:a})}),Object.keys(n.chars).forEach(r=>{const o=n.chars[r],{frame:a,source:l,rotate:c}=i[o.page],h=U.transformRectCoords(o,a,c,new X),d=new O({frame:h,orig:new X(0,0,o.width,o.height),source:l,rotate:c});this.chars[r]={id:r.codePointAt(0),xOffset:o.xOffset,yOffset:o.yOffset,xAdvance:o.xAdvance,kerning:o.kerning??{},texture:d}}),this.baseRenderedFontSize=n.fontSize,this.baseMeasurementFontSize=n.fontSize,this.fontMetrics={ascent:0,descent:0,fontSize:n.fontSize},this.baseLineOffset=n.baseLineOffset,this.lineHeight=n.lineHeight,this.fontFamily=n.fontFamily,this.distanceField=n.distanceField??{type:"none",range:0},this.url=e}destroy(){super.destroy();for(let t=0;t<this.pages.length;t++){const{texture:e}=this.pages[t];e.destroy(!0)}this.pages=null}static install(t){Do.install(t)}static uninstall(t){Do.uninstall(t)}}const Sn={test(s){return typeof s=="string"&&s.startsWith("info face=")},parse(s){const t=s.match(/^[a-z]+\s+.+$/gm),e={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[],distanceField:[]};for(const d in t){const u=t[d].match(/^[a-z]+/gm)[0],f=t[d].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),m={};for(const x in f){const p=f[x].split("="),g=p[0],y=p[1].replace(/"/gm,""),b=parseFloat(y),_=isNaN(b)?y:b;m[g]=_}e[u].push(m)}const i={chars:{},pages:[],lineHeight:0,fontSize:0,fontFamily:"",distanceField:null,baseLineOffset:0},[n]=e.info,[r]=e.common,[o]=e.distanceField??[];o&&(i.distanceField={range:parseInt(o.distanceRange,10),type:o.fieldType}),i.fontSize=parseInt(n.size,10),i.fontFamily=n.face,i.lineHeight=parseInt(r.lineHeight,10);const a=e.page;for(let d=0;d<a.length;d++)i.pages.push({id:parseInt(a[d].id,10)||0,file:a[d].file});const l={};i.baseLineOffset=i.lineHeight-parseInt(r.base,10);const c=e.char;for(let d=0;d<c.length;d++){const u=c[d],f=parseInt(u.id,10);let m=u.letter??u.char??String.fromCharCode(f);m==="space"&&(m=" "),l[f]=m,i.chars[m]={id:f,page:parseInt(u.page,10)||0,x:parseInt(u.x,10),y:parseInt(u.y,10),width:parseInt(u.width,10),height:parseInt(u.height,10),xOffset:parseInt(u.xoffset,10),yOffset:parseInt(u.yoffset,10),xAdvance:parseInt(u.xadvance,10),kerning:{}}}const h=e.kerning||[];for(let d=0;d<h.length;d++){const u=parseInt(h[d].first,10),f=parseInt(h[d].second,10),m=parseInt(h[d].amount,10);i.chars[l[f]].kerning[l[u]]=m}return i}},Go={test(s){const t=s;return typeof t!="string"&&"getElementsByTagName"in t&&t.getElementsByTagName("page").length&&t.getElementsByTagName("info")[0].getAttribute("face")!==null},parse(s){const t={chars:{},pages:[],lineHeight:0,fontSize:0,fontFamily:"",distanceField:null,baseLineOffset:0},e=s.getElementsByTagName("info")[0],i=s.getElementsByTagName("common")[0],n=s.getElementsByTagName("distanceField")[0];n&&(t.distanceField={type:n.getAttribute("fieldType"),range:parseInt(n.getAttribute("distanceRange"),10)});const r=s.getElementsByTagName("page"),o=s.getElementsByTagName("char"),a=s.getElementsByTagName("kerning");t.fontSize=parseInt(e.getAttribute("size"),10),t.fontFamily=e.getAttribute("face"),t.lineHeight=parseInt(i.getAttribute("lineHeight"),10);for(let c=0;c<r.length;c++)t.pages.push({id:parseInt(r[c].getAttribute("id"),10)||0,file:r[c].getAttribute("file")});const l={};t.baseLineOffset=t.lineHeight-parseInt(i.getAttribute("base"),10);for(let c=0;c<o.length;c++){const h=o[c],d=parseInt(h.getAttribute("id"),10);let u=h.getAttribute("letter")??h.getAttribute("char")??String.fromCharCode(d);u==="space"&&(u=" "),l[d]=u,t.chars[u]={id:d,page:parseInt(h.getAttribute("page"),10)||0,x:parseInt(h.getAttribute("x"),10),y:parseInt(h.getAttribute("y"),10),width:parseInt(h.getAttribute("width"),10),height:parseInt(h.getAttribute("height"),10),xOffset:parseInt(h.getAttribute("xoffset"),10),yOffset:parseInt(h.getAttribute("yoffset"),10),xAdvance:parseInt(h.getAttribute("xadvance"),10),kerning:{}}}for(let c=0;c<a.length;c++){const h=parseInt(a[c].getAttribute("first"),10),d=parseInt(a[c].getAttribute("second"),10),u=parseInt(a[c].getAttribute("amount"),10);t.chars[l[d]].kerning[l[h]]=u}return t}},Oo={test(s){return typeof s=="string"&&s.includes("<font>")?Go.test(j.get().parseXML(s)):!1},parse(s){return Go.parse(j.get().parseXML(s))}},gf=[".xml",".fnt"],yf={extension:{type:I.CacheParser,name:"cacheBitmapFont"},test:s=>s instanceof Pl,getCacheableAssets(s,t){const e={};return s.forEach(i=>{e[i]=t,e[`${i}-bitmap`]=t}),e[`${t.fontFamily}-bitmap`]=t,e}},xf={extension:{type:I.LoadParser,priority:xe.Normal},name:"loadBitmapFont",id:"bitmap-font",test(s){return gf.includes(_t.extname(s).toLowerCase())},async testParse(s){return Sn.test(s)||Oo.test(s)},async parse(s,t,e){const i=Sn.test(s)?Sn.parse(s):Oo.parse(s),{src:n}=t,{pages:r}=i,o=[],a=i.distanceField?{scaleMode:"linear",alphaMode:"premultiply-alpha-on-upload",autoGenerateMipmaps:!1,resolution:1}:{};for(let d=0;d<r.length;++d){const u=r[d].file;let f=_t.join(_t.dirname(n),u);f=$n(f,n),o.push({src:f,data:a})}const l=await e.load(o),c=o.map(d=>l[d.src]);return new Pl({data:i,textures:c},n)},async load(s,t){return await(await j.get().fetch(s)).text()},async unload(s,t,e){await Promise.all(s.pages.map(i=>e.unload(i.texture.source._sourceOrigin))),s.destroy()}};class bf{constructor(t,e=!1){this._loader=t,this._assetList=[],this._isLoading=!1,this._maxConcurrent=1,this.verbose=e}add(t){t.forEach(e=>{this._assetList.push(e)}),this.verbose&&console.log("[BackgroundLoader] assets: ",this._assetList),this._isActive&&!this._isLoading&&this._next()}async _next(){if(this._assetList.length&&this._isActive){this._isLoading=!0;const t=[],e=Math.min(this._assetList.length,this._maxConcurrent);for(let i=0;i<e;i++)t.push(this._assetList.pop());await this._loader.load(t),this._isLoading=!1,this._next()}}get active(){return this._isActive}set active(t){this._isActive!==t&&(this._isActive=t,t&&!this._isLoading&&this._next())}}const _f={extension:{type:I.CacheParser,name:"cacheTextureArray"},test:s=>Array.isArray(s)&&s.every(t=>t instanceof O),getCacheableAssets:(s,t)=>{const e={};return s.forEach(i=>{t.forEach((n,r)=>{e[i+(r===0?"":r+1)]=n})}),e}};async function El(s){if("Image"in globalThis)return new Promise(t=>{const e=new Image;e.onload=()=>{t(!0)},e.onerror=()=>{t(!1)},e.src=s});if("createImageBitmap"in globalThis&&"fetch"in globalThis){try{const t=await(await fetch(s)).blob();await createImageBitmap(t)}catch{return!1}return!0}return!1}const wf={extension:{type:I.DetectionParser,priority:1},test:async()=>El("data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A="),add:async s=>[...s,"avif"],remove:async s=>s.filter(t=>t!=="avif")},$o=["png","jpg","jpeg"],vf={extension:{type:I.DetectionParser,priority:-1},test:()=>Promise.resolve(!0),add:async s=>[...s,...$o],remove:async s=>s.filter(t=>!$o.includes(t))},Sf="WorkerGlobalScope"in globalThis&&globalThis instanceof globalThis.WorkerGlobalScope;function Vi(s){return Sf?!1:document.createElement("video").canPlayType(s)!==""}const kf={extension:{type:I.DetectionParser,priority:0},test:async()=>Vi("video/mp4"),add:async s=>[...s,"mp4","m4v"],remove:async s=>s.filter(t=>t!=="mp4"&&t!=="m4v")},Af={extension:{type:I.DetectionParser,priority:0},test:async()=>Vi("video/ogg"),add:async s=>[...s,"ogv"],remove:async s=>s.filter(t=>t!=="ogv")},Cf={extension:{type:I.DetectionParser,priority:0},test:async()=>Vi("video/webm"),add:async s=>[...s,"webm"],remove:async s=>s.filter(t=>t!=="webm")},Mf={extension:{type:I.DetectionParser,priority:0},test:async()=>El("data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA="),add:async s=>[...s,"webp"],remove:async s=>s.filter(t=>t!=="webp")};class Tf{constructor(){this._parsers=[],this._parsersValidated=!1,this.parsers=new Proxy(this._parsers,{set:(t,e,i)=>(this._parsersValidated=!1,t[e]=i,!0)}),this.promiseCache={}}reset(){this._parsersValidated=!1,this.promiseCache={}}_getLoadPromiseAndParser(t,e){const i={promise:null,parser:null};return i.promise=(async()=>{var o,a;let n=null,r=null;if((e.parser||e.loadParser)&&(r=this._parserHash[e.parser||e.loadParser],e.loadParser&&V(`[Assets] "loadParser" is deprecated, use "parser" instead for ${t}`),r||V(`[Assets] specified load parser "${e.parser||e.loadParser}" not found while loading ${t}`)),!r){for(let l=0;l<this.parsers.length;l++){const c=this.parsers[l];if(c.load&&((o=c.test)!=null&&o.call(c,t,e,this))){r=c;break}}if(!r)return V(`[Assets] ${t} could not be loaded as we don't know how to parse it, ensure the correct parser has been added`),null}n=await r.load(t,e,this),i.parser=r;for(let l=0;l<this.parsers.length;l++){const c=this.parsers[l];c.parse&&c.parse&&await((a=c.testParse)==null?void 0:a.call(c,n,e,this))&&(n=await c.parse(n,e,this)||n,i.parser=c)}return n})(),i}async load(t,e){this._parsersValidated||this._validateParsers();let i=0;const n={},r=Fi(t),o=Tt(t,c=>({alias:[c],src:c,data:{}})),a=o.length,l=o.map(async c=>{const h=_t.toAbsolute(c.src);if(!n[c.src])try{this.promiseCache[h]||(this.promiseCache[h]=this._getLoadPromiseAndParser(h,c)),n[c.src]=await this.promiseCache[h].promise,e&&e(++i/a)}catch(d){throw delete this.promiseCache[h],delete n[c.src],new Error(`[Loader.load] Failed to load ${h}.
${d}`)}});return await Promise.all(l),r?n[o[0].src]:n}async unload(t){const i=Tt(t,n=>({alias:[n],src:n})).map(async n=>{var a,l;const r=_t.toAbsolute(n.src),o=this.promiseCache[r];if(o){const c=await o.promise;delete this.promiseCache[r],await((l=(a=o.parser)==null?void 0:a.unload)==null?void 0:l.call(a,c,n,this))}});await Promise.all(i)}_validateParsers(){this._parsersValidated=!0,this._parserHash=this._parsers.filter(t=>t.name||t.id).reduce((t,e)=>(!e.name&&!e.id?V("[Assets] parser should have an id"):(t[e.name]||t[e.id])&&V(`[Assets] parser id conflict "${e.id}"`),t[e.name]=e,e.id&&(t[e.id]=e),t),{})}}function ms(s,t){if(Array.isArray(t)){for(const e of t)if(s.startsWith(`data:${e}`))return!0;return!1}return s.startsWith(`data:${t}`)}function gs(s,t){const e=s.split("?")[0],i=_t.extname(e).toLowerCase();return Array.isArray(t)?t.includes(i):i===t}const Pf=".json",Ef="application/json",If={extension:{type:I.LoadParser,priority:xe.Low},name:"loadJson",id:"json",test(s){return ms(s,Ef)||gs(s,Pf)},async load(s){return await(await j.get().fetch(s)).json()}},Lf=".txt",Bf="text/plain",Rf={name:"loadTxt",id:"text",extension:{type:I.LoadParser,priority:xe.Low,name:"loadTxt"},test(s){return ms(s,Bf)||gs(s,Lf)},async load(s){return await(await j.get().fetch(s)).text()}},Ff=["normal","bold","100","200","300","400","500","600","700","800","900"],zf=[".ttf",".otf",".woff",".woff2"],Df=["font/ttf","font/otf","font/woff","font/woff2"],Gf=/^(--|-?[A-Z_])[0-9A-Z_-]*$/i;function Of(s){const t=_t.extname(s),n=_t.basename(s,t).replace(/(-|_)/g," ").toLowerCase().split(" ").map(a=>a.charAt(0).toUpperCase()+a.slice(1));let r=n.length>0;for(const a of n)if(!a.match(Gf)){r=!1;break}let o=n.join(" ");return r||(o=`"${o.replace(/[\\"]/g,"\\$&")}"`),o}const $f=/^[0-9A-Za-z%:/?#\[\]@!\$&'()\*\+,;=\-._~]*$/;function Wf(s){return $f.test(s)?s:encodeURI(s)}const Nf={extension:{type:I.LoadParser,priority:xe.Low},name:"loadWebFont",id:"web-font",test(s){return ms(s,Df)||gs(s,zf)},async load(s,t){var i,n,r;const e=j.get().getFontFaceSet();if(e){const o=[],a=((i=t.data)==null?void 0:i.family)??Of(s),l=((r=(n=t.data)==null?void 0:n.weights)==null?void 0:r.filter(h=>Ff.includes(h)))??["normal"],c=t.data??{};for(let h=0;h<l.length;h++){const d=l[h],u=new FontFace(a,`url(${Wf(s)})`,{...c,weight:d});await u.load(),e.add(u),o.push(u)}return Y.has(`${a}-and-url`)?Y.get(`${a}-and-url`).entries.push({url:s,faces:o}):Y.set(`${a}-and-url`,{entries:[{url:s,faces:o}]}),o.length===1?o[0]:o}return V("[loadWebFont] FontFace API is not supported. Skipping loading font"),null},unload(s){const t=Array.isArray(s)?s:[s],e=t[0].family,i=Y.get(`${e}-and-url`),n=i.entries.find(r=>r.faces.some(o=>t.indexOf(o)!==-1));n.faces=n.faces.filter(r=>t.indexOf(r)===-1),n.faces.length===0&&(i.entries=i.entries.filter(r=>r!==n)),t.forEach(r=>{j.get().getFontFaceSet().delete(r)}),i.entries.length===0&&Y.remove(`${e}-and-url`)}};function fr(s,t=1){var i;const e=(i=ps.RETINA_PREFIX)==null?void 0:i.exec(s);return e?parseFloat(e[1]):t}function pr(s,t,e){s.label=e,s._sourceOrigin=e;const i=new O({source:s,label:e}),n=()=>{delete t.promiseCache[e],Y.has(e)&&Y.remove(e)};return i.source.once("destroy",()=>{t.promiseCache[e]&&(V("[Assets] A TextureSource managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the TextureSource."),n())}),i.once("destroy",()=>{s.destroyed||(V("[Assets] A Texture managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the Texture."),n())}),i}const Uf=".svg",Hf="image/svg+xml",jf={extension:{type:I.LoadParser,priority:xe.Low,name:"loadSVG"},name:"loadSVG",id:"svg",config:{crossOrigin:"anonymous",parseAsGraphicsContext:!1},test(s){return ms(s,Hf)||gs(s,Uf)},async load(s,t,e){var i;return((i=t.data)==null?void 0:i.parseAsGraphicsContext)??this.config.parseAsGraphicsContext?Vf(s):Yf(s,t,e,this.config.crossOrigin)},unload(s){s.destroy(!0)}};async function Yf(s,t,e,i){var p,g,y;const n=await j.get().fetch(s),r=j.get().createImage();r.src=`data:image/svg+xml;charset=utf-8,${encodeURIComponent(await n.text())}`,r.crossOrigin=i,await r.decode();const o=((p=t.data)==null?void 0:p.width)??r.width,a=((g=t.data)==null?void 0:g.height)??r.height,l=((y=t.data)==null?void 0:y.resolution)||fr(s),c=Math.ceil(o*l),h=Math.ceil(a*l),d=j.get().createCanvas(c,h),u=d.getContext("2d");u.imageSmoothingEnabled=!0,u.imageSmoothingQuality="high",u.drawImage(r,0,0,o*l,a*l);const{parseAsGraphicsContext:f,...m}=t.data??{},x=new Le({resource:d,alphaMode:"premultiply-alpha-on-upload",resolution:l,...m});return pr(x,e,s)}async function Vf(s){const e=await(await j.get().fetch(s)).text(),i=new vt;return i.svg(e),i}const qf=`(function () {
    'use strict';

    const WHITE_PNG = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII=";
    async function checkImageBitmap() {
      try {
        if (typeof createImageBitmap !== "function")
          return false;
        const response = await fetch(WHITE_PNG);
        const imageBlob = await response.blob();
        const imageBitmap = await createImageBitmap(imageBlob);
        return imageBitmap.width === 1 && imageBitmap.height === 1;
      } catch (_e) {
        return false;
      }
    }
    void checkImageBitmap().then((result) => {
      self.postMessage(result);
    });

})();
`;let Ve=null,Zn=class{constructor(){Ve||(Ve=URL.createObjectURL(new Blob([qf],{type:"application/javascript"}))),this.worker=new Worker(Ve)}};Zn.revokeObjectURL=function(){Ve&&(URL.revokeObjectURL(Ve),Ve=null)};const Xf=`(function () {
    'use strict';

    async function loadImageBitmap(url, alphaMode) {
      const response = await fetch(url);
      if (!response.ok) {
        throw new Error(\`[WorkerManager.loadImageBitmap] Failed to fetch \${url}: \${response.status} \${response.statusText}\`);
      }
      const imageBlob = await response.blob();
      return alphaMode === "premultiplied-alpha" ? createImageBitmap(imageBlob, { premultiplyAlpha: "none" }) : createImageBitmap(imageBlob);
    }
    self.onmessage = async (event) => {
      try {
        const imageBitmap = await loadImageBitmap(event.data.data[0], event.data.data[1]);
        self.postMessage({
          data: imageBitmap,
          uuid: event.data.uuid,
          id: event.data.id
        }, [imageBitmap]);
      } catch (e) {
        self.postMessage({
          error: e,
          uuid: event.data.uuid,
          id: event.data.id
        });
      }
    };

})();
`;let qe=null;class Il{constructor(){qe||(qe=URL.createObjectURL(new Blob([Xf],{type:"application/javascript"}))),this.worker=new Worker(qe)}}Il.revokeObjectURL=function(){qe&&(URL.revokeObjectURL(qe),qe=null)};let Wo=0,kn;class Kf{constructor(){this._initialized=!1,this._createdWorkers=0,this._workerPool=[],this._queue=[],this._resolveHash={}}isImageBitmapSupported(){return this._isImageBitmapSupported!==void 0?this._isImageBitmapSupported:(this._isImageBitmapSupported=new Promise(t=>{const{worker:e}=new Zn;e.addEventListener("message",i=>{e.terminate(),Zn.revokeObjectURL(),t(i.data)})}),this._isImageBitmapSupported)}loadImageBitmap(t,e){var i;return this._run("loadImageBitmap",[t,(i=e==null?void 0:e.data)==null?void 0:i.alphaMode])}async _initWorkers(){this._initialized||(this._initialized=!0)}_getWorker(){kn===void 0&&(kn=navigator.hardwareConcurrency||4);let t=this._workerPool.pop();return!t&&this._createdWorkers<kn&&(this._createdWorkers++,t=new Il().worker,t.addEventListener("message",e=>{this._complete(e.data),this._returnWorker(e.target),this._next()})),t}_returnWorker(t){this._workerPool.push(t)}_complete(t){t.error!==void 0?this._resolveHash[t.uuid].reject(t.error):this._resolveHash[t.uuid].resolve(t.data),this._resolveHash[t.uuid]=null}async _run(t,e){await this._initWorkers();const i=new Promise((n,r)=>{this._queue.push({id:t,arguments:e,resolve:n,reject:r})});return this._next(),i}_next(){if(!this._queue.length)return;const t=this._getWorker();if(!t)return;const e=this._queue.pop(),i=e.id;this._resolveHash[Wo]={resolve:e.resolve,reject:e.reject},t.postMessage({data:e.arguments,uuid:Wo++,id:i})}reset(){this._workerPool.forEach(t=>t.terminate()),this._workerPool.length=0,Object.values(this._resolveHash).forEach(({reject:t})=>{t==null||t(new Error("WorkerManager destroyed"))}),this._resolveHash={},this._queue.length=0,this._initialized=!1,this._createdWorkers=0}}const No=new Kf,Zf=[".jpeg",".jpg",".png",".webp",".avif"],Jf=["image/jpeg","image/png","image/webp","image/avif"];async function Qf(s,t){var n;const e=await j.get().fetch(s);if(!e.ok)throw new Error(`[loadImageBitmap] Failed to fetch ${s}: ${e.status} ${e.statusText}`);const i=await e.blob();return((n=t==null?void 0:t.data)==null?void 0:n.alphaMode)==="premultiplied-alpha"?createImageBitmap(i,{premultiplyAlpha:"none"}):createImageBitmap(i)}const Ll={name:"loadTextures",id:"texture",extension:{type:I.LoadParser,priority:xe.High,name:"loadTextures"},config:{preferWorkers:!0,preferCreateImageBitmap:!0,crossOrigin:"anonymous"},test(s){return ms(s,Jf)||gs(s,Zf)},async load(s,t,e){var r;let i=null;globalThis.createImageBitmap&&this.config.preferCreateImageBitmap?this.config.preferWorkers&&await No.isImageBitmapSupported()?i=await No.loadImageBitmap(s,t):i=await Qf(s,t):i=await new Promise((o,a)=>{i=j.get().createImage(),i.crossOrigin=this.config.crossOrigin,i.src=s,i.complete?o(i):(i.onload=()=>{o(i)},i.onerror=a)});const n=new Le({resource:i,alphaMode:"premultiply-alpha-on-upload",resolution:((r=t.data)==null?void 0:r.resolution)||fr(s),...t.data});return pr(n,e,s)},unload(s){s.destroy(!0)}},tp=[".mp4",".m4v",".webm",".ogg",".ogv",".h264",".avi",".mov"];let An,Cn;function ep(s,t,e){e===void 0&&!t.startsWith("data:")?s.crossOrigin=ip(t):e!==!1&&(s.crossOrigin=typeof e=="string"?e:"anonymous")}function sp(s){return new Promise((t,e)=>{s.addEventListener("canplaythrough",i),s.addEventListener("error",n),s.load();function i(){r(),t()}function n(o){r(),e(o)}function r(){s.removeEventListener("canplaythrough",i),s.removeEventListener("error",n)}})}function ip(s,t=globalThis.location){if(s.startsWith("data:"))return"";t||(t=globalThis.location);const e=new URL(s,document.baseURI);return e.hostname!==t.hostname||e.port!==t.port||e.protocol!==t.protocol?"anonymous":""}function np(){const s=[],t=[];for(const e of tp){const i=$s.MIME_TYPES[e.substring(1)]||`video/${e.substring(1)}`;Vi(i)&&(s.push(e),t.includes(i)||t.push(i))}return{validVideoExtensions:s,validVideoMime:t}}const rp={name:"loadVideo",id:"video",extension:{type:I.LoadParser,name:"loadVideo"},test(s){if(!An||!Cn){const{validVideoExtensions:i,validVideoMime:n}=np();An=i,Cn=n}const t=ms(s,Cn),e=gs(s,An);return t||e},async load(s,t,e){var l,c;const i={...$s.defaultOptions,resolution:((l=t.data)==null?void 0:l.resolution)||fr(s),alphaMode:((c=t.data)==null?void 0:c.alphaMode)||await Da(),...t.data},n=document.createElement("video"),r={preload:i.autoLoad!==!1?"auto":void 0,"webkit-playsinline":i.playsinline!==!1?"":void 0,playsinline:i.playsinline!==!1?"":void 0,muted:i.muted===!0?"":void 0,loop:i.loop===!0?"":void 0,autoplay:i.autoPlay!==!1?"":void 0};Object.keys(r).forEach(h=>{const d=r[h];d!==void 0&&n.setAttribute(h,d)}),i.muted===!0&&(n.muted=!0),ep(n,s,i.crossorigin);const o=document.createElement("source");let a;if(i.mime)a=i.mime;else if(s.startsWith("data:"))a=s.slice(5,s.indexOf(";"));else if(!s.startsWith("blob:")){const h=s.split("?")[0].slice(s.lastIndexOf(".")+1).toLowerCase();a=$s.MIME_TYPES[h]||`video/${h}`}return o.src=s,a&&(o.type=a),new Promise(h=>{const d=async()=>{const u=new $s({...i,resource:n});n.removeEventListener("canplay",d),t.data.preload&&await sp(n),h(pr(u,e,s))};i.preload&&!i.autoPlay&&n.load(),n.addEventListener("canplay",d),n.appendChild(o)})},unload(s){s.destroy(!0)}},Bl={extension:{type:I.ResolveParser,name:"resolveTexture"},test:Ll.test,parse:s=>{var t;return{resolution:parseFloat(((t=ps.RETINA_PREFIX.exec(s))==null?void 0:t[1])??"1"),format:s.split(".").pop(),src:s}}},op={extension:{type:I.ResolveParser,priority:-2,name:"resolveJson"},test:s=>ps.RETINA_PREFIX.test(s)&&s.endsWith(".json"),parse:Bl.parse};class ap{constructor(){this._detections=[],this._initialized=!1,this.resolver=new ps,this.loader=new Tf,this.cache=Y,this._backgroundLoader=new bf(this.loader),this._backgroundLoader.active=!0,this.reset()}async init(t={}){var r,o;if(this._initialized){V("[Assets]AssetManager already initialized, did you load before calling this Assets.init()?");return}if(this._initialized=!0,t.defaultSearchParams&&this.resolver.setDefaultSearchParams(t.defaultSearchParams),t.basePath&&(this.resolver.basePath=t.basePath),t.bundleIdentifier&&this.resolver.setBundleIdentifier(t.bundleIdentifier),t.manifest){let a=t.manifest;typeof a=="string"&&(a=await this.load(a)),this.resolver.addManifest(a)}const e=((r=t.texturePreference)==null?void 0:r.resolution)??1,i=typeof e=="number"?[e]:e,n=await this._detectFormats({preferredFormats:(o=t.texturePreference)==null?void 0:o.format,skipDetections:t.skipDetections,detections:this._detections});this.resolver.prefer({params:{format:n,resolution:i}}),t.preferences&&this.setPreferences(t.preferences)}add(t){this.resolver.add(t)}async load(t,e){this._initialized||await this.init();const i=Fi(t),n=Tt(t).map(a=>{if(typeof a!="string"){const l=this.resolver.getAlias(a);return l.some(c=>!this.resolver.hasKey(c))&&this.add(a),Array.isArray(l)?l[0]:l}return this.resolver.hasKey(a)||this.add({alias:a,src:a}),a}),r=this.resolver.resolve(n),o=await this._mapLoadToResolve(r,e);return i?o[n[0]]:o}addBundle(t,e){this.resolver.addBundle(t,e)}async loadBundle(t,e){this._initialized||await this.init();let i=!1;typeof t=="string"&&(i=!0,t=[t]);const n=this.resolver.resolveBundle(t),r={},o=Object.keys(n);let a=0,l=0;const c=()=>{e==null||e(++a/l)},h=o.map(d=>{const u=n[d],f=Object.values(u),m=[...new Set(f.flat())];return l+=m.length,this._mapLoadToResolve(u,c).then(x=>{r[d]=x})});return await Promise.all(h),i?r[t[0]]:r}async backgroundLoad(t){this._initialized||await this.init(),typeof t=="string"&&(t=[t]);const e=this.resolver.resolve(t);this._backgroundLoader.add(Object.values(e))}async backgroundLoadBundle(t){this._initialized||await this.init(),typeof t=="string"&&(t=[t]);const e=this.resolver.resolveBundle(t);Object.values(e).forEach(i=>{this._backgroundLoader.add(Object.values(i))})}reset(){this.resolver.reset(),this.loader.reset(),this.cache.reset(),this._initialized=!1}get(t){if(typeof t=="string")return Y.get(t);const e={};for(let i=0;i<t.length;i++)e[i]=Y.get(t[i]);return e}async _mapLoadToResolve(t,e){const i=[...new Set(Object.values(t))];this._backgroundLoader.active=!1;const n=await this.loader.load(i,e);this._backgroundLoader.active=!0;const r={};return i.forEach(o=>{const a=n[o.src],l=[o.src];o.alias&&l.push(...o.alias),l.forEach(c=>{r[c]=a}),Y.set(l,a)}),r}async unload(t){this._initialized||await this.init();const e=Tt(t).map(n=>typeof n!="string"?n.src:n),i=this.resolver.resolve(e);await this._unloadFromResolved(i)}async unloadBundle(t){this._initialized||await this.init(),t=Tt(t);const e=this.resolver.resolveBundle(t),i=Object.keys(e).map(n=>this._unloadFromResolved(e[n]));await Promise.all(i)}async _unloadFromResolved(t){const e=Object.values(t);e.forEach(i=>{Y.remove(i.src)}),await this.loader.unload(e)}async _detectFormats(t){let e=[];t.preferredFormats&&(e=Array.isArray(t.preferredFormats)?t.preferredFormats:[t.preferredFormats]);for(const i of t.detections)t.skipDetections||await i.test()?e=await i.add(e):t.skipDetections||(e=await i.remove(e));return e=e.filter((i,n)=>e.indexOf(i)===n),e}get detections(){return this._detections}setPreferences(t){this.loader.parsers.forEach(e=>{e.config&&Object.keys(e.config).filter(i=>i in t).forEach(i=>{e.config[i]=t[i]})})}}const Xt=new ap;dt.handleByList(I.LoadParser,Xt.loader.parsers).handleByList(I.ResolveParser,Xt.resolver.parsers).handleByList(I.CacheParser,Xt.cache.parsers).handleByList(I.DetectionParser,Xt.detections);dt.add(_f,vf,wf,Mf,kf,Af,Cf,If,Rf,Nf,jf,Ll,rp,xf,yf,Bl,op);const Uo={loader:I.LoadParser,resolver:I.ResolveParser,cache:I.CacheParser,detection:I.DetectionParser};dt.handle(I.Asset,s=>{const t=s.ref;Object.entries(Uo).filter(([e])=>!!t[e]).forEach(([e,i])=>dt.add(Object.assign(t[e],{extension:t[e].extension??i})))},s=>{const t=s.ref;Object.keys(Uo).filter(e=>!!t[e]).forEach(e=>dt.remove(t[e]))});class Fe extends nr{constructor(t){t instanceof vt&&(t={context:t});const{context:e,roundPixels:i,...n}=t||{};super({label:"Graphics",...n}),this.renderPipeId="graphics",e?this._context=e:this._context=this._ownedContext=new vt,this._context.on("update",this.onViewUpdate,this),this.didViewUpdate=!0,this.allowChildren=!1,this.roundPixels=i??!1}set context(t){t!==this._context&&(this._context.off("update",this.onViewUpdate,this),this._context=t,this._context.on("update",this.onViewUpdate,this),this.onViewUpdate())}get context(){return this._context}get bounds(){return this._context.bounds}updateBounds(){}containsPoint(t){return this._context.containsPoint(t)}destroy(t){this._ownedContext&&!t?this._ownedContext.destroy(t):(t===!0||(t==null?void 0:t.context)===!0)&&this._context.destroy(t),this._ownedContext=null,this._context=null,super.destroy(t)}_callContextMethod(t,e){return this.context[t](...e),this}setFillStyle(...t){return this._callContextMethod("setFillStyle",t)}setStrokeStyle(...t){return this._callContextMethod("setStrokeStyle",t)}fill(...t){return this._callContextMethod("fill",t)}stroke(...t){return this._callContextMethod("stroke",t)}texture(...t){return this._callContextMethod("texture",t)}beginPath(){return this._callContextMethod("beginPath",[])}cut(){return this._callContextMethod("cut",[])}arc(...t){return this._callContextMethod("arc",t)}arcTo(...t){return this._callContextMethod("arcTo",t)}arcToSvg(...t){return this._callContextMethod("arcToSvg",t)}bezierCurveTo(...t){return this._callContextMethod("bezierCurveTo",t)}closePath(){return this._callContextMethod("closePath",[])}ellipse(...t){return this._callContextMethod("ellipse",t)}circle(...t){return this._callContextMethod("circle",t)}path(...t){return this._callContextMethod("path",t)}lineTo(...t){return this._callContextMethod("lineTo",t)}moveTo(...t){return this._callContextMethod("moveTo",t)}quadraticCurveTo(...t){return this._callContextMethod("quadraticCurveTo",t)}rect(...t){return this._callContextMethod("rect",t)}roundRect(...t){return this._callContextMethod("roundRect",t)}poly(...t){return this._callContextMethod("poly",t)}regularPoly(...t){return this._callContextMethod("regularPoly",t)}roundPoly(...t){return this._callContextMethod("roundPoly",t)}roundShape(...t){return this._callContextMethod("roundShape",t)}filletRect(...t){return this._callContextMethod("filletRect",t)}chamferRect(...t){return this._callContextMethod("chamferRect",t)}star(...t){return this._callContextMethod("star",t)}svg(...t){return this._callContextMethod("svg",t)}restore(...t){return this._callContextMethod("restore",t)}save(){return this._callContextMethod("save",[])}getTransform(){return this.context.getTransform()}resetTransform(){return this._callContextMethod("resetTransform",[])}rotateTransform(...t){return this._callContextMethod("rotate",t)}scaleTransform(...t){return this._callContextMethod("scale",t)}setTransform(...t){return this._callContextMethod("setTransform",t)}transform(...t){return this._callContextMethod("transform",t)}translateTransform(...t){return this._callContextMethod("translate",t)}clear(){return this._callContextMethod("clear",[])}get fillStyle(){return this._context.fillStyle}set fillStyle(t){this._context.fillStyle=t}get strokeStyle(){return this._context.strokeStyle}set strokeStyle(t){this._context.strokeStyle=t}clone(t=!1){return t?new Fe(this._context.clone()):(this._ownedContext=null,new Fe(this._context))}lineStyle(t,e,i){z(N,"Graphics#lineStyle is no longer needed. Use Graphics#setStrokeStyle to set the stroke style.");const n={};return t&&(n.width=t),e&&(n.color=e),i&&(n.alpha=i),this.context.strokeStyle=n,this}beginFill(t,e){z(N,"Graphics#beginFill is no longer needed. Use Graphics#fill to fill the shape with the desired style.");const i={};return t!==void 0&&(i.color=t),e!==void 0&&(i.alpha=e),this.context.fillStyle=i,this}endFill(){z(N,"Graphics#endFill is no longer needed. Use Graphics#fill to fill the shape with the desired style."),this.context.fill();const t=this.context.strokeStyle;return(t.width!==vt.defaultStrokeStyle.width||t.color!==vt.defaultStrokeStyle.color||t.alpha!==vt.defaultStrokeStyle.alpha)&&this.context.stroke(),this}drawCircle(...t){return z(N,"Graphics#drawCircle has been renamed to Graphics#circle"),this._callContextMethod("circle",t)}drawEllipse(...t){return z(N,"Graphics#drawEllipse has been renamed to Graphics#ellipse"),this._callContextMethod("ellipse",t)}drawPolygon(...t){return z(N,"Graphics#drawPolygon has been renamed to Graphics#poly"),this._callContextMethod("poly",t)}drawRect(...t){return z(N,"Graphics#drawRect has been renamed to Graphics#rect"),this._callContextMethod("rect",t)}drawRoundedRect(...t){return z(N,"Graphics#drawRoundedRect has been renamed to Graphics#roundRect"),this._callContextMethod("roundRect",t)}drawStar(...t){return z(N,"Graphics#drawStar has been renamed to Graphics#star"),this._callContextMethod("star",t)}}class lp extends nr{constructor(t,e){const{text:i,resolution:n,style:r,anchor:o,width:a,height:l,roundPixels:c,...h}=t;super({...h}),this.batched=!0,this._resolution=null,this._autoResolution=!0,this._didTextUpdate=!0,this._styleClass=e,this.text=i??"",this.style=r,this.resolution=n??null,this.allowChildren=!1,this._anchor=new lt({_onUpdate:()=>{this.onViewUpdate()}}),o&&(this.anchor=o),this.roundPixels=c??!1,a!==void 0&&(this.width=a),l!==void 0&&(this.height=l)}get anchor(){return this._anchor}set anchor(t){typeof t=="number"?this._anchor.set(t):this._anchor.copyFrom(t)}set text(t){t=t.toString(),this._text!==t&&(this._text=t,this.onViewUpdate())}get text(){return this._text}set resolution(t){this._autoResolution=t===null,this._resolution=t,this.onViewUpdate()}get resolution(){return this._resolution}get style(){return this._style}set style(t){var e;t||(t={}),(e=this._style)==null||e.off("update",this.onViewUpdate,this),t instanceof this._styleClass?this._style=t:this._style=new this._styleClass(t),this._style.on("update",this.onViewUpdate,this),this.onViewUpdate()}get width(){return Math.abs(this.scale.x)*this.bounds.width}set width(t){this._setWidth(t,this.bounds.width)}get height(){return Math.abs(this.scale.y)*this.bounds.height}set height(t){this._setHeight(t,this.bounds.height)}getSize(t){return t||(t={}),t.width=Math.abs(this.scale.x)*this.bounds.width,t.height=Math.abs(this.scale.y)*this.bounds.height,t}setSize(t,e){typeof t=="object"?(e=t.height??t.width,t=t.width):e??(e=t),t!==void 0&&this._setWidth(t,this.bounds.width),e!==void 0&&this._setHeight(e,this.bounds.height)}containsPoint(t){const e=this.bounds.width,i=this.bounds.height,n=-e*this.anchor.x;let r=0;return t.x>=n&&t.x<=n+e&&(r=-i*this.anchor.y,t.y>=r&&t.y<=r+i)}onViewUpdate(){this.didViewUpdate||(this._didTextUpdate=!0),super.onViewUpdate()}destroy(t=!1){super.destroy(t),this.owner=null,this._bounds=null,this._anchor=null,(typeof t=="boolean"?t:t!=null&&t.style)&&this._style.destroy(t),this._style=null,this._text=null}get styleKey(){return`${this._text}:${this._style.styleKey}:${this._resolution}`}}function cp(s,t){let e=s[0]??{};return(typeof e=="string"||s[1])&&(z(N,`use new ${t}({ text: "hi!", style }) instead`),e={text:e,style:s[1]}),e}let Ae=null,qt=null;function hp(s,t){Ae||(Ae=j.get().createCanvas(256,128),qt=Ae.getContext("2d",{willReadFrequently:!0}),qt.globalCompositeOperation="copy",qt.globalAlpha=1),(Ae.width<s||Ae.height<t)&&(Ae.width=ss(s),Ae.height=ss(t))}function Ho(s,t,e){for(let i=0,n=4*e*t;i<t;++i,n+=4)if(s[n+3]!==0)return!1;return!0}function jo(s,t,e,i,n){const r=4*t;for(let o=i,a=i*r+4*e;o<=n;++o,a+=r)if(s[a+3]!==0)return!1;return!0}function dp(...s){let t=s[0];t.canvas||(t={canvas:s[0],resolution:s[1]});const{canvas:e}=t,i=Math.min(t.resolution??1,1),n=t.width??e.width,r=t.height??e.height;let o=t.output;if(hp(n,r),!qt)throw new TypeError("Failed to get canvas 2D context");qt.drawImage(e,0,0,n,r,0,0,n*i,r*i);const l=qt.getImageData(0,0,n,r).data;let c=0,h=0,d=n-1,u=r-1;for(;h<r&&Ho(l,n,h);)++h;if(h===r)return X.EMPTY;for(;Ho(l,n,u);)--u;for(;jo(l,n,c,h,u);)++c;for(;jo(l,n,d,h,u);)--d;return++d,++u,qt.globalCompositeOperation="source-over",qt.strokeRect(c,h,d-c,u-h),qt.globalCompositeOperation="copy",o??(o=new X),o.set(c/i,h/i,(d-c)/i,(u-h)/i),o}const Yo=new X;class up{getCanvasAndContext(t){const{text:e,style:i,resolution:n=1}=t,r=i._getFinalPadding(),o=Wt.measureText(e||" ",i),a=Math.ceil(Math.ceil(Math.max(1,o.width)+r*2)*n),l=Math.ceil(Math.ceil(Math.max(1,o.height)+r*2)*n),c=Qs.getOptimalCanvasAndContext(a,l);this._renderTextToCanvas(e,i,r,n,c);const h=i.trim?dp({canvas:c.canvas,width:a,height:l,resolution:1,output:Yo}):Yo.set(0,0,a,l);return{canvasAndContext:c,frame:h}}returnCanvasAndContext(t){Qs.returnCanvasAndContext(t)}_renderTextToCanvas(t,e,i,n,r){var b,_,S,v;const{canvas:o,context:a}=r,l=zi(e),c=Wt.measureText(t||" ",e),h=c.lines,d=c.lineHeight,u=c.lineWidths,f=c.maxLineWidth,m=c.fontProperties,x=o.height;if(a.resetTransform(),a.scale(n,n),a.textBaseline=e.textBaseline,(b=e._stroke)!=null&&b.width){const w=e._stroke;a.lineWidth=w.width,a.miterLimit=w.miterLimit,a.lineJoin=w.join,a.lineCap=w.cap}a.font=l;let p,g;const y=e.dropShadow?2:1;for(let w=0;w<y;++w){const C=e.dropShadow&&w===0,T=C?Math.ceil(Math.max(1,x)+i*2):0,A=T*n;if(C){a.fillStyle="black",a.strokeStyle="black";const L=e.dropShadow,$=L.color,Dt=L.alpha;a.shadowColor=st.shared.setValue($).setAlpha(Dt).toRgbaString();const M=L.blur*n,B=L.distance*n;a.shadowBlur=M,a.shadowOffsetX=Math.cos(L.angle)*B,a.shadowOffsetY=Math.sin(L.angle)*B+A}else{if(a.fillStyle=e._fill?Oi(e._fill,a,c,i*2):null,(_=e._stroke)!=null&&_.width){const L=e._stroke.width*.5+i*2;a.strokeStyle=Oi(e._stroke,a,c,L)}a.shadowColor="black"}let k=(d-m.fontSize)/2;d-m.fontSize<0&&(k=0);const F=((S=e._stroke)==null?void 0:S.width)??0;for(let L=0;L<h.length;L++)p=F/2,g=F/2+L*d+m.ascent+k,e.align==="right"?p+=f-u[L]:e.align==="center"&&(p+=(f-u[L])/2),(v=e._stroke)!=null&&v.width&&this._drawLetterSpacing(h[L],e,r,p+i,g+i-T,!0),e._fill!==void 0&&this._drawLetterSpacing(h[L],e,r,p+i,g+i-T)}}_drawLetterSpacing(t,e,i,n,r,o=!1){const{context:a}=i,l=e.letterSpacing;let c=!1;if(Wt.experimentalLetterSpacingSupported&&(Wt.experimentalLetterSpacing?(a.letterSpacing=`${l}px`,a.textLetterSpacing=`${l}px`,c=!0):(a.letterSpacing="0px",a.textLetterSpacing="0px")),l===0||c){o?a.strokeText(t,n,r):a.fillText(t,n,r);return}let h=n;const d=Wt.graphemeSegmenter(t);let u=a.measureText(t).width,f=0;for(let m=0;m<d.length;++m){const x=d[m];o?a.strokeText(x,h,r):a.fillText(x,h,r);let p="";for(let g=m+1;g<d.length;++g)p+=d[g];f=a.measureText(p).width,h+=u-f+l,u=f}}}const Vo=new up;class Rl extends lp{constructor(...t){const e=cp(t,"Text");super(e,Re),this.renderPipeId="text",e.textureStyle&&(this.textureStyle=e.textureStyle instanceof is?e.textureStyle:new is(e.textureStyle))}updateBounds(){const t=this._bounds,e=this._anchor;let i=0,n=0;if(this._style.trim){const{frame:r,canvasAndContext:o}=Vo.getCanvasAndContext({text:this.text,style:this._style,resolution:1});Vo.returnCanvasAndContext(o),i=r.width,n=r.height}else{const r=Wt.measureText(this._text,this._style);i=r.width,n=r.height}t.minX=-e._x*i,t.maxX=t.minX+i,t.minY=-e._y*n,t.maxY=t.minY+n}}dt.add(mc,gc);const fp=[{day:1,forcedDice:4,targetLevel:5,reward:{kind:"minigame",minigame:"lootbox",forceLootboxAmount:50,forceLootboxKind:"bonus",notes:"Fixed starter 50p bonus to demonstrate bonus currency."},forceLandingCategory:"minigame",autoTriggerCategory:!0,overrideZone:"carnival",designerNotes:"Introduce movement + UI.",popups:{start_day:["<p>Welcome to tombola trails! I’m Tom, your guide to this world!</p>","<p>Before I forget, here is your daily dice, you can roll this every day to move through the world and earn rewards, why not give it a try?</p>"],post_move:["<p>You moved onto your first tile!</p>","<p>Looks like you collected some tokens, every step you take will give you a token, once you get X, you can play a bonus game!</p>","<p>You’ve landed on a minigame, lets see what it is!</p>"],pre_minigame:["<p>Ah, a mystery box, why not tap and see whats inside?</p>"],post_minigame:["<p>That’s a cool prize. It looks like you also found a key! You can collect keys every consecutive day you play and when you have 30 you can open the treasure vault. I’ve heard there are some great riches to be had. Be warned however, that skipping a day will cause all keys to be destroyed!</p>","<p>You also found a prize star! You can collect a single prize star each day, and when you have 5 you will win a prize. Don’t worry about losing these, they won’t reset even if you miss a day!</p>","<p>That’s everything for today. But before you go, if you want a sneak peek of what’s coming up you can look further ahead by scrolling.</p>"]}},{day:2,forcedDice:6,targetLevel:11,reward:{kind:"freePlays",amount:2,notes:"Two Free Plays to showcase multi-award."},forceLandingCategory:"instant_prize",overrideZone:"carnival",designerNotes:"Highlight progress & level nodes.",popups:{start_day:"<p>Welcome back {PLAYER_NAME} it’s great to see you! Ready to see what prizes await today?</p>",post_move:"<p>Looks like you’ve landed on an instant win space, let’s see what your prize is shall we?</p>",post_instantwin:["<p>Way to go! Another prize and another star, it won’t be long until you have 5! Remember that 5 stars grants a prize!</p>","<p>Since you’re down by the water, why not try one of our water themed games? Oh, and don’t forget to continue the adventure tomorrow!</p>"]}},{day:3,forcedDice:3,targetLevel:14,reward:{kind:"bonus",notes:"Introduce choice game (Mega Box) using existing overlay."},overrideZone:"carnival",forceLandingCategory:"bonus_round",autoTriggerCategory:!0,designerNotes:"Introduce concept of prizes via Mega Box (existing 12-box game).",popups:{start_day:"<p>Hey again partner! See that special prize game up ahead? Let’s land on it!</p>",post_move:"<p>You did it! Time to play the Mega Box game!</p>",pre_minigame:["<p>Pick a box to keep, eliminate the rest, then decide if you want to switch at the end.</p>"],post_minigame:["<p>Exciting! That tension really builds. You also collected your key and prize star.</p>","<p>Come back tomorrow for more!</p>"]}},{day:4,forcedDice:1,targetLevel:15,reward:{kind:"minigame",minigame:"slot",forceSlotSymbol:"⭐",notes:"Force open slot after landing (tutorial explanation). Guaranteed win via forced symbols."},overrideZone:"carnival",forceLandingCategory:"mystery",designerNotes:"Teach minigame basics.",popups:{start_day:["<p>Welcome back, let’s get to rolling shall we?</p>","<p>Is that, a mystery space ahead?</p>"],post_move:"<p>This is a mystery square, you won’t know what it is until you land on it! Let’s hope we get lucky! We'll see you tomorrow no matter the reward I hope!</p>"}},{day:5,forcedDice:4,targetLevel:19,reward:{kind:"tokens",amount:15,notes:"Bump token amount; show resource utility soon."},overrideZone:"carnival",designerNotes:"Escalating token reward.",popups:{start_day:"<p>It’s your 5th day, you know what that means? Collecting a prize star today will give you a reward!</p>",post_instantwin:["<p>It’s your 5th prize star!</p>","<p>Wow, way to go! Remember, you receive prize star prizes every 5th day, so why not start collecting stars again tomorrow?</p>"]}},{day:6,forcedDice:3,targetLevel:22,reward:{kind:"minigame",minigame:"spin_wheel",notes:"Demonstrate spin wheel fairness/visuals."},overrideZone:"carnival",designerNotes:"Spin Wheel intro.",popups:{start_day:"<p>Hey! Hope you're ready to win some prizes!</p>",post_roll:"<p>You’ve landed on a movement space! Looks like the journey doesn’t stop here!</p>",post_move:"<p>Looks like a mini game!</p>",post_minigame:"<p>Thats a lot of tokens today, just a few more and you will be able to redeem them for a bonus game!</p>"}},{day:7,forcedDice:5,targetLevel:27,reward:{kind:"tokens",amount:20,notes:"Escalation before finale; sets up for loot box preview."},overrideZone:"carnival",designerNotes:"Pre-finale build-up.",popups:{start_day:"<p>Hi again! We’re still so close to having enough tokens for a bonus game!</p>",post_move:"<p>Let’s hope we get a good token prize! Only X to go!</p>",post_minigame:"<p>You’ve done it! Looks like it’s time for a bonus game!</p>"}},{day:8,forcedDice:3,targetLevel:30,reward:{kind:"minigame",minigame:"lootbox",forceLootboxKind:"cash",forceLootboxAmount:100,notes:"Showcase guaranteed cash reel outcome before transition."},overrideZone:"carnival",transitionAfter:!0,designerNotes:"Finale + transition.",popups:{start_day:"<p>Welcome back! Yesterday was exciting and I have a feeling today will be too!</p>",post_minigame:"<p>You’ve reached the end of the zone! Looks like a new adventure awaits</p>"}}];function et(s){return s>=1&&s<=8}function mt(s){return fp.find(t=>t.day===s)}const zt="/game.trail.prototype/",pp=`${zt}jungle/jungle_background.png`,mp=`${zt}carnival/carnival_background.png`,gp=`${zt}general/token.svg`,mr=`${zt}carnival/carnival_character.png`,yp=`${zt}general/BM.png`,xp=`${zt}general/FP.png`,qo=`${zt}general/key.png`,Xo=`${zt}general/star.png`,bp=`${zt}pirates/pirate_background.png`,_p=`${zt}dark_universe/horror_background.png`,wp=`${zt}tomorrowland/scifi_background.png`;let ot=30;const Fl="trailProgressV2",zl="tokensV1",vp=8;let as=140,ze=260,jt=38,je="Jungle";const Et=["slot","spin_wheel","lootbox"],Sp="minigameAssignmentsV1",Dl="currenciesV1",Gl="categoryAssignmentsV1",Ol="dayStateV1",$l="levelStateV1",Wl="dualChoiceMilestoneConsumedV1",Nl="prizeStarMilestoneCycleV1",Ul="engagementStateV1";let H={consecutiveDays:0,cumulativeDays:0,milestoneCycles:0,milestoneProgress:0};function kp(){try{const s=localStorage.getItem(Ul);if(!s)return;const t=JSON.parse(s);typeof t.consecutiveDays=="number"&&(H.consecutiveDays=Math.max(0,Math.min(7,Math.floor(t.consecutiveDays)))),typeof t.cumulativeDays=="number"&&(H.cumulativeDays=Math.max(0,Math.floor(t.cumulativeDays))),typeof t.milestoneCycles=="number"&&(H.milestoneCycles=Math.max(0,Math.floor(t.milestoneCycles))),typeof t.milestoneProgress=="number"&&(H.milestoneProgress=Math.max(0,Math.min(29,Math.floor(t.milestoneProgress))))}catch{}}function Oe(){localStorage.setItem(Ul,JSON.stringify(H))}function ls(s){let t=document.getElementById("toast-host");t||(t=document.createElement("div"),t.id="toast-host",Object.assign(t.style,{position:"fixed",bottom:"16px",left:"50%",transform:"translateX(-50%)",zIndex:"4000",display:"flex",flexDirection:"column",gap:"8px",pointerEvents:"none"}),document.body.appendChild(t));const e=document.createElement("div");e.textContent=s,Object.assign(e.style,{background:"#111c",color:"#fff",padding:"8px 12px",borderRadius:"8px",fontSize:"12px",letterSpacing:".5px",boxShadow:"0 4px 10px rgba(0,0,0,0.5)",backdropFilter:"blur(6px)"}),t.appendChild(e),setTimeout(()=>{e.style.transition="opacity 500ms",e.style.opacity="0",setTimeout(()=>e.remove(),540)},2200)}function Jn(){te!==H.milestoneProgress&&(te=H.milestoneProgress),Ct(),rt()}function Ap(){if(ls("7-Day Streak Complete!"),H.consecutiveDays=0,Oe(),!Lt)if(la()||fs.size>0)Vs=!0,setTimeout(()=>{if(Vs&&!la()&&(Vs=!1,!Lt))try{Wi()}catch{}},1200);else try{Wi()}catch{}}function Cp(){ls("30-Day Milestone: Safe Game!"),H.milestoneCycles+=1,H.milestoneProgress=0,te=0,Oe(),Ct(),rt();try{Ep()}catch{}}let le=null;function Mp(){const s=["1","2","3","4","5","6","7","8","9"];for(let t=s.length-1;t>0;t--){const e=Math.floor(Math.random()*(t+1));[s[t],s[e]]=[s[e],s[t]]}return s.slice(0,3).join("")}function Tp(){le={code:Mp(),attempts:[],solved:!1}}function Pp(){const s=ct.filter(e=>e.kind!=="nothing"&&e.kind!=="prizeStars"&&e.kind!=="streakKeys");let t=s[Math.floor(Math.random()*s.length)]||{kind:"tokens",amount:200,label:"200 Tokens"};if(t.amount&&typeof t.amount=="number"){const e=t.amount*3;t={...t,amount:e,label:t.kind==="tokens"?`${e} Tokens`:t.kind==="cash"?pe(e):t.kind==="freePlays"?`${e} Free Plays`:t.kind==="bonus"?`${pe(e)} Bonus`:t.label+" x3"}}else t={...t,label:t.label+" x3"};return be(t),ls("Safe Cracked! Reward: "+t.label),t}function Ep(){D(),Tp();const{attempts:s}=le,t=document.createElement("div");t.className="modal-backdrop safe-game-backdrop";const e=document.createElement("div");e.className="modal safe-game-modal",e.setAttribute("role","dialog"),e.style.maxWidth="520px",e.style.width="100%",e.style.boxSizing="border-box",e.style.margin="0 auto",e.innerHTML=`
    <h2 style='margin-top:0;text-align:center;'>Safe Crack (Code Wordle)</h2>
    <p style='text-align:center;margin:0 0 14px;font-size:14px;'>Guess the 3 unique digits (1-9). Infinite attempts. Safe reward pays <strong>3×</strong> normal!</p>
    <form class='safe-wordle-form' style='display:flex;justify-content:center;gap:10px;margin-bottom:14px;'>
      <input type='text' inputmode='numeric' maxlength='1' class='safe-cell-input' data-idx='0' style='width:64px;height:64px;text-align:center;font-size:30px;font-weight:700;border:2px solid #555;border-radius:12px;background:#222;color:#fff;' />
      <input type='text' inputmode='numeric' maxlength='1' class='safe-cell-input' data-idx='1' style='width:64px;height:64px;text-align:center;font-size:30px;font-weight:700;border:2px solid #555;border-radius:12px;background:#222;color:#fff;' />
      <input type='text' inputmode='numeric' maxlength='1' class='safe-cell-input' data-idx='2' style='width:64px;height:64px;text-align:center;font-size:30px;font-weight:700;border:2px solid #555;border-radius:12px;background:#222;color:#fff;' />
      <button type='submit' class='primary' style='height:64px;padding:0 22px;font-size:16px;border-radius:14px;'>Enter</button>
    </form>
    <div class='attempts-grid' style='display:flex;flex-direction:column;gap:6px;max-height:260px;overflow:auto;padding-right:4px;'></div>
    <div class='safe-footer' style='display:flex;justify-content:center;margin-top:18px;'>
      <button type='button' class='close-safe tertiary' style='padding:8px 18px;'>Close</button>
    </div>`;const i=e.querySelector(".safe-wordle-form"),n=Array.from(i.querySelectorAll(".safe-cell-input")),r=e.querySelector(".attempts-grid");function o(h){const d=n[h+1];d&&d.focus()}n.forEach(h=>{h.addEventListener("input",()=>{h.value=h.value.replace(/[^1-9]/g,""),h.value.length===1&&o(parseInt(h.dataset.idx))}),h.addEventListener("keydown",d=>{if(d.key==="Backspace"&&!h.value){const u=n[parseInt(h.dataset.idx)-1];u==null||u.focus()}})});function a(){r.innerHTML=s.map(h=>l(h)).join("")}function l(h){const d=le.code;let u="";for(let f=0;f<3;f++){const m=h[f];let x="neutral";d[f]===m?x="exact":d.includes(m)&&(x="partial"),u+=`<div class='safe-cell ${x}' data-g='${m}'>${m}</div>`}return`<div class='safe-attempt-row' style='display:flex;gap:6px;'>${u}</div>`}i.addEventListener("submit",h=>{if(h.preventDefault(),!le||le.solved)return;const d=n.map(u=>u.value||"").join("");if(d.length!==3){ls("Enter 3 digits");return}if(new Set(d.split("")).size!==3){ls("Digits must be unique");return}if(le.attempts.push(d),a(),d===le.code){le.solved=!0;const u=Pp();Ip(e,d,u),i.querySelector('button[type="submit"]').setAttribute("disabled","true")}n.forEach(u=>u.value=""),n[0].focus()}),a(),e.querySelector(".close-safe").addEventListener("click",()=>D()),t.addEventListener("click",h=>{h.target===t&&D()}),t.appendChild(e),document.body.appendChild(t),document.body.classList.add("modal-open"),Bp()}function Ip(s,t,e){var n;const i=document.createElement("div");i.style.position="absolute",i.style.inset="0",i.style.display="flex",i.style.flexDirection="column",i.style.alignItems="center",i.style.justifyContent="center",i.style.background="rgba(0,0,0,0.75)",i.innerHTML=`<div style='animation:pop .5s;max-width:380px;text-align:center;'>
    <h3 style='margin:0 0 6px;font-size:30px;color:#6ffd7f;'>Safe Cracked!</h3>
    <p style='margin:0 0 8px;font-size:15px;'>Code: <strong>${t}</strong></p>
    ${e?`<div style='margin:0 auto 14px;padding:10px 16px;background:#132d13;border:2px solid #37b544;border-radius:12px;color:#c8ffd1;font-weight:600;font-size:16px;'>Reward: ${e.label}</div>`:""}
    <button class='primary close-safe-finish' style='padding:10px 24px;font-size:16px;border-radius:28px;'>Great!</button>
  </div>`,s.appendChild(i),(n=i.querySelector(".close-safe-finish"))==null||n.addEventListener("click",()=>D()),Lp(s.parentElement)}function Lp(s){for(let t=0;t<60;t++){const e=document.createElement("div");e.className="safe-confetti";const i=40+Math.random()*60,n=5+Math.random()*7;Object.assign(e.style,{position:"absolute",top:"50%",left:"50%",width:n+"px",height:n+"px",background:`hsl(${i} 90% 60%)`,transform:"translate(-50%,-50%)",animation:"safeConfetti 2.2s linear forwards",borderRadius:Math.random()>.5?"50%":"2px",pointerEvents:"none"}),s.appendChild(e),setTimeout(()=>e.remove(),2300)}}let Ko=!1;function Bp(){if(Ko)return;Ko=!0;const s=document.createElement("style");s.textContent=`
@keyframes safeConfetti { 0% { transform:translate(-50%,-50%) scale(1) rotate(0deg); opacity:1;} 80%{opacity:1;} 100% { transform:translate(calc(-50% + (var(--dx, 0px))), calc(-50% + 260px)) scale(.5) rotate(720deg); opacity:0; } }
@keyframes pop { 0% { transform:scale(.6); opacity:0;} 60% { transform:scale(1.05); opacity:1;} 100% { transform:scale(1); } }
.safe-game-modal { position:relative; max-width:520px; width:100%; box-sizing:border-box; }
@media (max-width:560px){
  .safe-game-modal { max-width:95vw; }
  .safe-game-modal form.safe-wordle-form { gap:6px !important; }
  .safe-game-modal .safe-cell-input { width:56px !important; height:56px !important; font-size:26px !important; }
  .safe-attempt-row .safe-cell { width:46px; height:46px; font-size:20px; }
}
.safe-attempt-row .safe-cell { width:52px; height:52px; display:flex; align-items:center; justify-content:center; font-size:24px; font-weight:600; border-radius:10px; background:#222; border:2px solid #444; color:#fff; }
.safe-attempt-row .safe-cell.exact { background:#2f7d36; border-color:#37b544; box-shadow:0 0 0 2px #37b54455 inset; }
.safe-attempt-row .safe-cell.partial { background:#8a6a15; border-color:#d1a526; box-shadow:0 0 0 2px #d1a52655 inset; }
.safe-attempt-row .safe-cell.neutral { background:#333; }
`,document.head.appendChild(s)}function Rp(){H.cumulativeDays+=1,Oe()}function Fp(){H.consecutiveDays=0,Oe()}let P={day:1,rollUsed:!1};function zp(){try{const s=localStorage.getItem(Ol);if(!s)return;const t=JSON.parse(s);typeof t.day=="number"&&t.day>=1&&typeof t.rollUsed=="boolean"&&(P.day=Math.floor(t.day),P.rollUsed=t.rollUsed)}catch{}}function ii(){localStorage.setItem(Ol,JSON.stringify(P))}let De={level:1};function Dp(){try{const s=localStorage.getItem($l);if(s){const t=JSON.parse(s);typeof t.level=="number"&&t.level>=1&&(De.level=Math.floor(t.level))}}catch{}}function Hl(){localStorage.setItem($l,JSON.stringify(De))}let Ut=[];function Gp(){try{const s=localStorage.getItem(Gl);if(!s)return!1;const t=JSON.parse(s);if(Array.isArray(t)){Ut=t.filter(i=>typeof i.level=="number"&&i.level>=1&&i.level<=ot&&typeof i.category=="string"),Ut.forEach(i=>{i.tileId||(i.tileId=`tile_${i.level}`)});let e=!1;return Ut.forEach(i=>{(i.category==="extra_move"||i.category==="travel_back")&&(i.resolvedAs=void 0,i.category="mystery",e=!0)}),e&&pt(),Ut.length!==0}}catch{}return!1}function pt(){localStorage.setItem(Gl,JSON.stringify(Ut))}function Zo(s){for(let t=s.length-1;t>0;t--){const e=Math.floor(Math.random()*(t+1));[s[t],s[e]]=[s[e],s[t]]}return s}function gr(){const s=Array.from({length:ot},(a,l)=>l+1),t=Zo(s.slice(1)).slice(0,Et.length),e=new Set(t),i=t.map((a,l)=>({level:a,category:"minigame",minigame:Et[l],completed:!1,tileId:`tile_${a}`})),n=["instant_tokens","instant_prize","reveal","bonus_round","mystery"],r=Zo(s.slice(1).filter(a=>!e.has(a)));n.forEach((a,l)=>{if(r[l]!==void 0){const c=r[l];i.push({level:c,category:a,tileId:`tile_${c}`}),e.add(c)}}),i.push({level:1,category:"instant_tokens",completed:!1,tileId:"tile_1"}),e.add(1);const o=["instant_tokens","instant_prize","reveal","mystery","minigame"];s.forEach(a=>{if(!e.has(a)){const l=o[Math.floor(Math.random()*o.length)];if(l==="minigame"){const c=Et.filter(h=>!i.some(d=>d.minigame===h));c.length?i.push({level:a,category:"minigame",minigame:c[0],completed:!1,tileId:`tile_${a}`}):i.push({level:a,category:"instant_tokens",completed:!1,tileId:`tile_${a}`})}else i.push({level:a,category:l,tileId:`tile_${a}`})}}),Ut=i.sort((a,l)=>a.level-l.level),pt()}function Op(){Gp()||gr()}function de(s){return Ut.find(t=>t.level===s)}function $p(s){return Ut.find(t=>t.tileId===s)}window.forceTileReward=function(s,t){const e=$p(s);if(!e){console.warn("Tile not found for id",s);return}e.category!=="instant_prize"&&console.warn("Tile is not an instant_prize category; current:",e.category),e.forcedReward=t,pt(),console.log("Forced reward set on",s,t)};let Qn=null;window.overrideLandingCategoryOnce=function(s){Qn=s,console.log("Next landing category will be forced to",s)};const ct=[{kind:"freePlays",amount:1,label:"1 Free Play"},{kind:"freePlays",amount:5,label:"5 Free Plays"},{kind:"cash",amount:10,label:"10p Cash"},{kind:"cash",amount:100,label:"£1 Cash"},{kind:"bonus",amount:50,label:"50p Bonus Money"},{kind:"bonus",amount:100,label:"£1 Bonus Money"},{kind:"bonus",amount:500,label:"£5 Bonus Money"},{kind:"tokens",amount:10,label:"10 Tokens"},{kind:"tokens",amount:50,label:"50 Tokens"},{kind:"tokens",amount:100,label:"100 Tokens"},{kind:"nothing",label:"Nothing"}];let ni=0,ri=0,oi=0,ue=0,te=0;function Wp(){try{const s=localStorage.getItem(Dl);if(!s)return;const t=JSON.parse(s);typeof t.freePlays=="number"&&(ni=t.freePlays),typeof t.cashPence=="number"&&(ri=t.cashPence),typeof t.bonusPence=="number"&&(oi=t.bonusPence),typeof t.streakKeys=="number"&&(ue=t.streakKeys),typeof t.prizeStars=="number"&&(te=t.prizeStars)}catch{}}function Ct(){localStorage.setItem(Dl,JSON.stringify({freePlays:ni,cashPence:ri,bonusPence:oi,streakKeys:ue,prizeStars:te}))}function he(s){s>0&&(ni+=s,Ct(),rt())}function yr(s){s>0&&(ri+=s,Ct(),rt())}function xr(s){s>0&&(oi+=s,Ct(),rt())}function jl(s){s>0&&(P.rollUsed||(P.rollUsed=!0,ii()),ue+=s,H.consecutiveDays=Math.min(7,H.consecutiveDays+s),H.consecutiveDays===7&&Ap(),Ct(),Oe(),rt())}function qi(s){if(s>0){const t=H.milestoneProgress;H.milestoneProgress=(H.milestoneProgress+s)%30,Jn(),H.milestoneProgress;for(let e=1;e<=s;e++){const i=(t+e)%30;if(i===10||i===20)try{Np(i)}catch{}}H.milestoneProgress===0&&t+s>=30&&Cp(),Oe()}}function Np(s){const t=ct.filter(i=>i.kind!=="nothing"),e=t[Math.floor(Math.random()*t.length)];be(e);try{const i=document.querySelector(".milestone-midpoint-modal");i&&i.remove();const n=document.createElement("div");n.className="modal-backdrop milestone-midpoint-backdrop",Object.assign(n.style,{backdropFilter:"blur(5px)",animation:"fadeIn .35s"});const r=document.createElement("div");r.className="modal milestone-midpoint-modal",r.style.maxWidth="520px",r.style.width="100%",r.style.overflow="hidden";const o=s===10?"10 Day Milestone Achieved!":"20 Day Milestone Achieved!";r.innerHTML=`
      <div style="position:relative;padding:28px 28px 32px;text-align:center;background:radial-gradient(circle at 50% 0%, #ffe8a8, #ffbb55 60%, #d97100);color:#2b1a00;">
        <div class='milestone-burst' style="position:absolute;inset:0;pointer-events:none;">
          ${Array.from({length:18}).map((l,c)=>`<span style='--i:${c};position:absolute;top:50%;left:50%;width:6px;height:14px;background:#fff;border-radius:3px;transform-origin:center 38px;animation:burstSpin 1.6s ease-out forwards;'></span>`).join("")}
        </div>
        <h2 style='margin:0 0 10px;font-size:30px;letter-spacing:1px;'>${o}</h2>
        <p style='margin:0 0 18px;font-size:15px;line-height:1.4;'>Bonus Reward Unlocked:</p>
        <div style='display:inline-block;padding:14px 22px;background:#fffbe8;border:2px solid #ffcf66;border-radius:14px;box-shadow:0 4px 18px -4px rgba(0,0,0,.4),0 0 0 4px rgba(255,255,255,.4) inset;font-weight:600;font-size:18px;'>${e.label}</div>
        <div style='margin-top:26px;'>
          <button type='button' class='primary midpoint-close' style='font-size:16px;padding:10px 26px;border-radius:28px;'>Awesome!</button>
        </div>
      </div>`,n.appendChild(r),document.body.appendChild(n),document.body.classList.add("modal-open"),r.querySelector(".midpoint-close").addEventListener("click",()=>{D()}),Up(s,n),Hp()}catch{}}function Up(s,t){for(let e=0;e<40;e++){const i=document.createElement("div");i.className="milestone-confetti";const r=(s===10?40:280)+Math.random()*40-20,o=6+Math.random()*8;Object.assign(i.style,{position:"absolute",top:"50%",left:"50%",width:o+"px",height:o+"px",background:`hsl(${r} 90% 60%)`,transform:`translate(-50%,-50%) rotate(${Math.random()*360}deg)`,borderRadius:Math.random()>.5?"50%":"2px",pointerEvents:"none",animation:"confettiFloat 1.8s linear forwards",animationDelay:Math.random()*.4+"s"}),t.appendChild(i),setTimeout(()=>i.remove(),2200)}}let Jo=!1;function Hp(){if(Jo)return;Jo=!0;const s=document.createElement("style");s.textContent=`
  @keyframes confettiFloat { 0% { transform:translate(-50%,-50%) scale(1) rotate(0deg); opacity:1;} 70% {opacity:1;} 100% { transform:translate(calc(-50% + (var(--dx, 0px))), calc(-50% + 220px)) scale(.5) rotate(720deg); opacity:0;} }
  @keyframes burstSpin { from { opacity:0; transform: translate(-50%,-50%) rotate(calc(var(--i)*20deg)) scale(0);} 30% {opacity:1;} to { opacity:0; transform: translate(-50%,-50%) rotate(calc(var(--i)*20deg)) scale(1.6);} }
  .milestone-midpoint-backdrop { animation: fadeIn .3s ease; }
  `,document.head.appendChild(s)}function fe(){jl(1),qi(1),ne=!0;try{Kt()}catch{}}let ys=[];function xs(){localStorage.setItem(Sp,JSON.stringify(ys))}function Yl(){const s=Array.from({length:ot-1},(e,i)=>i+2);for(let e=s.length-1;e>0;e--){const i=Math.floor(Math.random()*(e+1));[s[e],s[i]]=[s[i],s[e]]}ys=s.slice(0,Et.length).map((e,i)=>({level:e,game:Et[i],completed:!1})),xs()}function jp(s){return ys.find(t=>t.level===s)}function pe(s){return s<100?s+"p":"£"+(s/100).toFixed(s%100===0?0:2)}function Yp(){if(et(P.day)){const s=ct.filter(t=>t.kind!=="nothing");return s[Math.floor(Math.random()*s.length)]}return ct[Math.floor(Math.random()*ct.length)]}function be(s){s.kind==="tokens"&&s.amount?$e(s.amount):s.kind==="freePlays"&&s.amount?he(s.amount):s.kind==="cash"&&s.amount?yr(s.amount):s.kind==="bonus"&&s.amount?xr(s.amount):s.kind==="streakKeys"&&s.amount?jl(s.amount):s.kind==="prizeStars"&&s.amount&&qi(s.amount),rt()}function bs(){return`<p class='meta-bonus-line' style="margin-top:10px;font-size:13px;opacity:.85;"><strong>+1 🔑 Streak Key</strong> & <strong>+1 ⭐ Prize Star</strong></p>`}const me=[],ee=[];function Vp(){try{const s=localStorage.getItem(Fl);if(!s)return{current:1};const t=JSON.parse(s);return typeof t.current!="number"||t.current<1||t.current>ot?{current:1}:t}catch{return{current:1}}}function _s(s){localStorage.setItem(Fl,JSON.stringify(s))}const R=Vp();let ti=!1;const Mn=[{x:-200},{x:-180},{x:-130},{x:-80},{x:-70},{x:-100},{x:-180},{x:-180},{x:-130},{x:-70},{x:-60},{x:-95},{x:-150},{x:-190},{x:-160},{x:-110},{x:-80},{x:-120},{x:-170},{x:-155},{x:-115},{x:-85},{x:-95},{x:-140},{x:-185},{x:-175},{x:-145},{x:-110},{x:-90},{x:-130}],qp=140;function br(){return qp}function Xi(s){const t=br(),e=400,i=[],n=t*(s-1)+as+ze;for(let r=0;r<s;r++){const o=Mn[r]||Mn[Mn.length-1],a=ze+r*t+(o.yOffset||0),l=n-a,c=e+o.x;i.push({x:c,y:l})}return i}let Pt=800,ht=900;function Vl(){Pt=Math.min(600,window.innerWidth-8),Pt=Math.max(360,Pt),ht=Math.min(window.innerHeight-12,1100),ht=Math.max(640,ht);const t=(Pt-360)/240;jt=30+8*us(t,0,1),ht<760?(as=120,ze=230):(as=140,ze=260)}Vl();let tt=0;function Xp(){try{const s=localStorage.getItem(zl);if(!s)return 0;const t=Number(s);return Number.isFinite(t)&&t>=0?Math.floor(t):0}catch{return 0}}function ai(){localStorage.setItem(zl,String(tt))}let cs=!1,Yt=!1,Hs=null;function ql(){Yt||tt<120||Nt()&&Ht||document.querySelector(".modal-backdrop")||(tt>=120&&(tt-=120,ai(),Ss()),Yt=!0,cs=!1,Nt()&&!Ht&&(Ht=!0,_r()),ei(),Kp())}function Xl(){Hs===null&&(Hs=window.setInterval(()=>{try{ql()}catch{}},800))}function Kp(){Hs!==null&&(clearInterval(Hs),Hs=null)}function Nt(){return P.day>8}function Zp(){return localStorage.getItem(Wl)==="1"}function _r(){localStorage.setItem(Wl,"1")}function Jp(){const s=localStorage.getItem(Nl);if(!s)return 0;const t=parseInt(s,10);return isNaN(t)?0:t}function Qp(s){localStorage.setItem(Nl,String(s))}let Ht=Zp(),Qo=Jp();function $e(s){if(s>0){const t=tt;if(tt+=s,ai(),Ss(),!Yt){const e=t<120&&tt>=120,i=t>=120&&tt>=120&&!Ht&&!Nt();(e||i)&&Xl()}}}tt=Xp();let q=Xi(ot),ws=Math.max(1600,Math.max(...q.map(s=>s.y))+400);const ge=new al,se=new it,Xe=new it,Ke=new it,Ze=new it,Je=new it,Qe=new it;se.addChild(Xe,Ke,Ze,Je,Qe);const yt=new it,hs=new it,li=new it,Kl=new it;yt.addChild(hs,li,Kl);ge.stage.addChild(se);ge.stage.addChild(yt);async function tm(){Wp(),zp(),Dp(),kp(),Op(),await ge.init({backgroundAlpha:0,antialias:!0,width:Pt,height:ht,autoDensity:!0});const s=document.getElementById("pixi-root");if(!s)throw new Error("Missing pixi-root");s.appendChild(ge.canvas),xm(s),window.addEventListener("resize",bm),_m(),await wr(),Ki(),Zi(),em(),cm(),lm(),am(s),Mm(),at(),tt>=120&&!Yt&&(!Nt()||Nt()&&!Ht)&&Xl();try{tt>=120&&!Yt&&(!Nt()||Nt()&&!Ht)&&(tt>=120&&(tt-=120,ai(),Ss()),Yt=!0,cs=!1,Nt()&&!Ht&&(Ht=!0,_r()),ei())}catch{}re(R.current,!0)}function Ki(){const s=new Fe;s.lineStyle(34,3097174,1),s.moveTo(q[0].x,q[0].y);for(let t=1;t<q.length;t++){const e=q[t],i=q[t-1],n=(i.x+e.x)/2+Math.sin(t*.7)*40,r=(i.y+e.y)/2+Math.cos(t*.45)*60;s.quadraticCurveTo(n,r,e.x,e.y)}s.alpha=.9,hs.addChild(s);for(let t=0;t<q.length-1;t++){const e=new Fe;ee.push({from:t+1,to:t+2,line:e}),hs.addChild(e)}ee.forEach(t=>Zl(t.line,t.from,t.to))}let Tn=null,Pn=null,En=null,In=null,Ln=null;async function wr(){if(Xe.removeChildren(),Ke.removeChildren(),Ze.removeChildren(),Je.removeChildren(),Qe.removeChildren(),!Tn)try{Tn=await Xt.load(pp)}catch(n){console.warn("Failed to load jungle",n)}if(!Pn)try{Pn=await Xt.load(mp)}catch(n){console.warn("Failed to load carnival",n)}if(!En)try{En=await Xt.load(bp)}catch(n){console.warn("Failed to load pirate",n)}if(!In)try{In=await Xt.load(_p)}catch(n){console.warn("Failed to load dark universe",n)}if(!Ln)try{Ln=await Xt.load(wp)}catch(n){console.warn("Failed to load tomorrowland",n)}const s=100,t=1.28,e=Pt+s;function i(n,r,o){if(!n)return;const a=e/n.width,l=Math.round(n.height*a*t);if(l<=0)return;o(l);const c=ws+ht+l;for(let h=0;h<c;h+=l){const d=new rs(n);d.x=-50,d.y=h,d.width=e,d.height=l,d.alpha=1,r.addChild(d)}}i(Tn,Xe,n=>n),i(Pn,Ke,n=>n),i(En,Ze,n=>n),i(In,Je,n=>n),i(Ln,Qe,n=>n),vs()}function Zl(s,t,e){s.clear();const i=q[t-1],n=q[e-1],r=ds(t),o=ds(e);let a=3688017;r==="completed"&&(a=5025616),r==="current"&&(a=16752451),r==="completed"&&(o==="current"||o==="unlocked"||o==="completed")&&(a=5025616),s.lineStyle(8,a,1),s.moveTo(i.x,i.y),s.lineTo(n.x,n.y),s.alpha=r==="locked"?.35:.95}function Jl(){const s=(jt-30)/8,t=Math.round(16+4*us(s,0,1));return new Re({fill:"#ffffff",fontSize:t,fontWeight:"600",stroke:"#000000"})}let Ql=Jl();function ds(s){return s<R.current?"completed":s===R.current?"current":s===R.current+1?"unlocked":"locked"}function Zi(){q.forEach((s,t)=>{const e=t+1,i=new it;i.x=s.x,i.y=s.y,i.eventMode="static",i.cursor="pointer";const n=new Fe,r=de(e);r?ec(n,r):tc(n,ds(e));const o=new Rl({text:String(e),style:Ql});o.anchor.set(.5),o.y=2,i.addChild(n,o),i.hitArea=new ji(0,0,jt),i.on("pointertap",()=>im(e)),i.on("pointerover",()=>i.scale.set(1.08)),i.on("pointerout",()=>i.scale.set(1)),li.addChild(i),me.push({level:e,container:i,circle:n,label:o})})}let ts=null;function em(){const s=new it;s.eventMode="none";const t=new Fe;t.beginFill(16752451),t.drawCircle(0,0,26),t.endFill();const e=new Rl({text:"YOU",style:new Re({fill:"#fff",fontSize:16,fontWeight:"700",stroke:"#000"})});e.anchor.set(.5),s.addChild(t,e),Kl.addChild(s),ts=s,ie(R.current,!0)}function ie(s,t=!1,e=600){const i=q[s-1];if(!ts)return;const n=jt+26+12,r=i.x+n,o=i.y+2;if(t){ts.position.set(r,o);return}ic(ts,{x:r,y:o},e,nc)}function Ti(s){var t;return((t=q[s-1])==null?void 0:t.y)??0}function sm(s){let t=1,e=1/0;for(let i=0;i<q.length;i++){const n=Math.abs(q[i].y-s);n<e&&(e=n,t=i+1)}return t}function vs(){const s=ot<=30||et(P.day),t=-yt.position.y+ht/2,e=q[R.current-1];e&&e.y;const i=t;Xe.alpha=Ke.alpha=Ze.alpha=Je.alpha=Qe.alpha=0;function n(p,g){p==="Jungle"?Xe.alpha=g:p==="Carnival"?Ke.alpha=g:p==="Pirate"?Ze.alpha=g:p==="DarkUniverse"?Je.alpha=g:p==="Tomorrowland"&&(Qe.alpha=g)}if(s){const p=Ti(30),g=Ti(1),y=260,b=(g+p)/2,_=i-b,S=us((_+y)/(y*2),0,1);n("Carnival",1-S),n("Jungle",S),je=S<.5?"Carnival":"Jungle";return}const r=sm(i),o=[{id:"Jungle",startLevel:1},{id:"Pirate",startLevel:100},{id:"DarkUniverse",startLevel:200},{id:"Tomorrowland",startLevel:300}];let a=o[0],l=null;for(let p=0;p<o.length;p++){const g=o[p];if(r>=g.startLevel)a=g;else{l=g;break}}if(!l){n(a.id,1),je=a.id;return}const c=Ti(a.startLevel),h=Ti(l.startLevel);if(!c||!h||c===h){n(a.id,1),je=a.id;return}let d;const u=ht,f=h+u,m=h;i>=f?d=0:i<=m?d=1:d=(f-i)/(f-m);const x=c-h;if(x<u*.6){let p=(c-i)/x;p=us(p,0,1),d=Math.max(d,p)}n(a.id,1-d),n(l.id,d),je=d<.5?a.id:l.id,Xe.alpha===0&&Ke.alpha===0&&Ze.alpha===0&&Je.alpha===0&&Qe.alpha===0&&(n(a.id,1),je=a.id)}function tc(s,t){s.clear();let e=4015180;t==="current"?e=16752451:t==="unlocked"?e=5923952:t==="completed"&&(e=4608605),s.lineStyle(4,1581096,1),s.beginFill(e),s.drawCircle(0,0,jt),s.endFill()}function ec(s,t){s.clear();const e=ds(t.level);let i=4015180;t.completed?i=5025616:e==="current"?i=16752451:e==="unlocked"?i=5923952:e==="completed"&&(i=4608605),s.lineStyle(4,1581096,1),s.beginFill(i);const n=jt;switch(t.category==="mystery"&&t.resolvedAs?t.resolvedAs:t.category){case"instant_tokens":s.drawCircle(0,0,n);break;case"instant_prize":s.drawRoundedRect(-n,-n,n*2,n*2,10);break;case"reveal":for(let o=0;o<6;o++){const a=Math.PI/3*o-Math.PI/6,l=Math.cos(a)*n,c=Math.sin(a)*n;o===0?s.moveTo(l,c):s.lineTo(l,c)}s.closePath();break;case"minigame":s.moveTo(0,-n),s.lineTo(n,0),s.lineTo(0,n),s.lineTo(-n,0),s.closePath();break;case"bonus_round":for(let o=0;o<10;o++){const a=Math.PI/5*o-Math.PI/2,l=o%2===0?n:n*.45,c=Math.cos(a)*l,h=Math.sin(a)*l;o===0?s.moveTo(c,h):s.lineTo(c,h)}s.closePath();break;case"mystery":for(let o=0;o<5;o++){const a=Math.PI*2/5*o-Math.PI/2,l=Math.cos(a)*n,c=Math.sin(a)*n;o===0?s.moveTo(l,c):s.lineTo(l,c)}s.closePath();break;case"extra_move":s.moveTo(0,-n),s.lineTo(n,n),s.lineTo(-n,n),s.closePath();break;case"travel_back":s.moveTo(-n,-n),s.lineTo(n,-n),s.lineTo(0,n),s.closePath();break}s.endFill()}function at(){me.forEach(s=>{const t=ds(s.level),e=de(s.level);e?ec(s.circle,e):tc(s.circle,t);const i=t==="current"||t==="completed"||t==="unlocked";s.container.eventMode=i?"static":"none",s.container.alpha=t==="locked"?.3:1}),ee.forEach(s=>Zl(s.line,s.from,s.to)),Sr()}function im(s){const t=ds(s);t!=="current"&&t!=="completed"||vr(s,!0)}function vr(s,t,e=0){const i=de(s);if(!i){mm(s);return}if(i.completed)return;if(i.category==="mystery"&&!i.resolvedAs){const r=["instant_tokens","instant_prize","reveal","minigame","bonus_round","extra_move","travel_back"];i.resolvedAs=r[Math.floor(Math.random()*r.length)],pt(),at()}const n=i.category==="mystery"&&i.resolvedAs?i.resolvedAs:i.category;if(n==="minigame"){(!i.minigame||!Et.includes(i.minigame))&&(i.minigame=Et[Math.floor(Math.random()*Et.length)],pt());let r=jp(i.level);r||(r={level:i.level,game:i.minigame,completed:!!i.completed},ys.push(r),xs()),r.completed?ks("Minigame","Already completed."):Ar(r);return}switch(n){case"instant_tokens":Fm(i);break;case"instant_prize":zm(i);break;case"reveal":Gm(i);break;case"bonus_round":{const r=et(P.day)?mt(P.day):null;if(r&&r.day===3){Pr(),i.completed=!0,pt(),at();break}Dm(i);break}case"extra_move":aa(i,!0);break;case"travel_back":aa(i,!1);break;default:e<2&&vr(s,t,e+1);break}}function nm(s){s===R.current&&R.current<ot&&(R.current+=1,_s(R),$e(1),at(),ie(R.current),re(R.current),setTimeout(()=>{js()},650))}function sc(s){if(s<=0)return;const t=Math.min(s,ot-R.current);if(t<=0)return;ti=!0;const e=mt(P.day);let i=t;if(e&&e.targetLevel>0){const a=e.targetLevel-R.current;a<i&&(i=Math.max(0,a))}const n=[];for(let a=0;a<i;a++)n.push(R.current+1+a);const r=520;function o(){n.length&&(R.current+=1,_s(R),$e(1),at(),ie(R.current,!1,r-50),re(R.current),n.length>1?(n.shift(),setTimeout(o,r)):(n.shift(),setTimeout(()=>{const a=mt(P.day),l=Qn||a&&a.forceLandingCategory;if(l){const d=de(R.current);d&&d.category!==l&&(d.category=l,d.category!=="minigame"&&delete d.minigame,d.completed=!1,pt(),at()),Qn=null}Hm();const c=xt("post_move"),h=de(R.current);if(c&&h){const d=h.category==="mystery"&&h.resolvedAs?h.resolvedAs:h.category;["bonus_round","instant_tokens","instant_prize","reveal"].includes(d)&&et(P.day)?(fs.add("post_move"),Ys||(Ys=()=>{js()})):js()}else js();setTimeout(()=>{ti=!1,Kt()},200)},r+120)))}o()}function rm(s){if(s<=0)return;const t=R.current-1,e=Math.min(s,t);if(e<=0)return;ti=!0;const i=[];for(let o=0;o<e;o++)i.push(R.current-1-o);const n=420;function r(){i.length&&(R.current-=1,_s(R),at(),ie(R.current,!1,n-60),re(R.current),i.length>1?(i.shift(),setTimeout(r,n)):(i.shift(),setTimeout(()=>{js()},n+120),setTimeout(()=>{ti=!1,Kt()},n+260)))}r()}function js(){const s=R.current,t=de(s);t&&(t.completed||es||(D(),vr(s,!1)))}const om=.47;function re(s,t=!1){const e=q[s-1],i=br(),n=ze*.55;let o=n+i*.3+jt;const a=7,l=s===1?jt*1.2:0,c=ht-l-as-a*i,h=n+jt+8;o=Math.min(o,Math.max(h,c));const d=ht-o,u=-(e.y-(d-l)),f=-(ws-ht),m=us(u,f,0),p=-(q.reduce((y,b)=>y+b.x,0)/q.length-Pt*om),g=()=>{se.y=yt.position.y,se.x=0,vs()};if(t){yt.position.set(p,m),g();return}ic(yt,{x:p,y:m},600,nc,g)}let Pi=!1,ta=0,ea=0;function sa(s){const t=-(ws-ht);return us(s,t,0)}function ia(s){yt.position.y=s,se.y=yt.position.y,vs()}function am(s){s.addEventListener("wheel",e=>{e.preventDefault();const n=sa(yt.position.y-e.deltaY*1);ia(n)},{passive:!1}),s.addEventListener("pointerdown",e=>{e.target.closest(".modal,.controls,.nav-fab")||(Pi=!0,ta=e.clientY,ea=yt.position.y,e.target.setPointerCapture(e.pointerId))}),s.addEventListener("pointermove",e=>{if(!Pi)return;const i=e.clientY-ta,n=sa(ea+i);ia(n)});const t=e=>{if(Pi){Pi=!1;try{e.target.releasePointerCapture(e.pointerId)}catch{}}};s.addEventListener("pointerup",t),s.addEventListener("pointerleave",t)}function lm(){var t;if(!document.querySelector(".nav-fab")){const e=document.createElement("button");e.className="nav-fab",e.type="button",e.title="Recenter on current level",e.ariaLabel="Recenter on current level",e.innerHTML="⤓",e.addEventListener("click",()=>re(R.current)),(t=document.getElementById("app"))==null||t.appendChild(e)}}function ic(s,t,e,i,n){const r=s.x,o=s.y,a=t.x??s.x,l=t.y??s.y,c=performance.now();function h(d){const u=Math.min(1,(d-c)/e),f=i(u);s.x=r+(a-r)*f,s.y=o+(l-o)*f,n&&n(),u<1&&requestAnimationFrame(h)}requestAnimationFrame(h)}function nc(s){return s<.5?4*s*s*s:1-Math.pow(-2*s+2,3)/2}function us(s,t,e){return Math.max(t,Math.min(e,s))}function cm(){var t;let s=document.querySelector(".controls");if(!s){if(s=document.createElement("div"),s.className="controls",s.innerHTML=`
      <div class="currency-bar vertical" aria-label="Currencies">
        <div class="currency-meta" aria-label="Meta Progress">
          <div class="currency day-counter pill" title="Current Day"><span class="label">Day</span><span class="day-count">1</span></div>
          <div class="currency level-counter pill" title="Player Level"><span class="label">Lvl</span><span class="level-count">1</span></div>
          <div class="progress-block prize-star-progress" title="Milestone Progress" aria-label="Milestone Progress" data-kind="milestone">
            <div class="progress-bar"><div class="progress-fill ps-progress-fill"></div></div>
            <div class="progress-label"><img src="${Xo}" alt="Star" class="progress-icon" /><span class="progress-count ps-progress-count">0/10</span></div>
          </div>
          <div class="progress-block streak-progress" title="7-Day Streak" aria-label="7-Day Streak">
            <div class="progress-bar"><div class="progress-fill sp-fill"></div></div>
            <div class="progress-label"><img src="${qo}" alt="Key" class="progress-icon" /><span class="progress-count sp-count">0/7</span></div>
          </div>
        </div>
        <div class="currency-group-card" aria-label="Reward Currencies">
          <div class="currency bonus-counter pill" title="Bonus Money"><img src="${yp}" alt="Bonus Money" class="currency-icon bonus-icon" /><span class="bonus-count">0</span></div>
          <div class="currency fp-counter pill" title="Free Plays"><img src="${xp}" alt="Free Plays" class="currency-icon fp-icon" /><span class="fp-count">0</span></div>
          <div class="currency sk-counter pill" title="Streak Keys"><img src="${qo}" alt="Streak Key" class="currency-icon key-icon" /><span class="sk-count">0</span></div>
          <div class="currency ps-counter pill" title="Prize Stars"><img src="${Xo}" alt="Prize Star" class="currency-icon star-icon" /><span class="ps-count">0</span></div>
          <div class="currency token-counter pill"><img src="${gp}" alt="Token" class="token-icon" /><span class="token-count">0</span></div>
          <div class="currency cash-counter pill" title="Cash Balance"><span class="label">💰</span><span class="cash-count">0</span></div>
          
        </div>
      </div>
      <div class="control-row" style="display:flex;gap:8px;margin-top:10px;">
        <button type="button" data-action="reset" class="reset" aria-label="Reset progress">Reset</button>
      </div>`,(t=document.getElementById("app"))==null||t.appendChild(s),!document.querySelector(".legend-fab")){const e=document.createElement("button");e.className="legend-fab",e.type="button",e.textContent="?",e.title="Tile Legend",e.ariaLabel="Tile Legend",Object.assign(e.style,{position:"fixed",right:"14px",bottom:"118px",width:"44px",height:"44px",borderRadius:"50%",background:"#182028",color:"#fff",border:"2px solid #ff9f43",fontWeight:"700",cursor:"pointer",zIndex:"250",boxShadow:"0 4px 10px rgba(0,0,0,0.45)"}),e.addEventListener("click",Tm),document.body.appendChild(e)}if(!document.getElementById("currency-pills-style")){const e=document.createElement("style");e.id="currency-pills-style",e.textContent=`.currency-bar{display:flex;gap:12px;align-items:flex-start;font-weight:600;font-size:13px;}
        .currency-bar.vertical{align-items:flex-start;flex-direction:row;flex-wrap:wrap;}
        .currency-bar .currency-meta{display:flex;flex-direction:column;gap:6px;padding:10px 12px;background:rgba(32,38,45,0.55);border:1px solid #2a333c;border-radius:18px;backdrop-filter:blur(6px);box-shadow:0 4px 12px rgba(0,0,0,0.35);}
        .currency-bar.vertical .currency-group-card{display:flex;flex-direction:column;gap:6px;padding:10px 12px;background:rgba(20,24,28,0.55);border:1px solid #2a333c;border-radius:18px;backdrop-filter:blur(6px);box-shadow:0 4px 12px rgba(0,0,0,0.4);}
        .currency-bar.vertical .pill{background:rgba(255,255,255,0.06);border:1px solid #333;}
        .currency-bar .pill{display:flex;align-items:center;gap:6px;padding:4px 10px;background:rgba(20,24,28,0.6);border:1px solid #2a333c;border-radius:18px;backdrop-filter:blur(4px);} 
        .currency-bar .pill .label{opacity:0.85;font-size:12px;letter-spacing:.5px;} 
        .currency-bar .cash-counter .label{font-size:15px;line-height:1;} 
    .currency-bar img.token-icon{width:18px;height:18px;display:block;}
    .currency-bar img.currency-icon{width:18px;height:18px;display:block;object-fit:contain;filter:drop-shadow(0 1px 2px rgba(0,0,0,0.6));}
    .currency-bar span{display:inline-block;min-width:14px;text-align:right;}
  .progress-block{position:relative;display:flex;flex-direction:column;padding:6px 8px 10px;background:rgba(15,18,22,0.55);border:1px solid #2a333c;border-radius:14px;min-width:160px;}
  .progress-block + .progress-block{margin-top:6px;}
  .progress-bar{position:relative;width:100%;height:12px;background:#1f262d;border:1px solid #36424d;border-radius:8px;overflow:hidden;}
  .progress-fill{position:absolute;left:0;top:0;bottom:0;width:0;transition:width .55s cubic-bezier(.4,.8,.2,1);}
  .prize-star-progress .progress-fill{background:linear-gradient(90deg,#ffcf9a,#ff9f43);box-shadow:0 0 6px rgba(255,159,67,0.5) inset,0 0 4px rgba(255,159,67,0.45);} 
  .streak-progress .progress-fill{background:linear-gradient(90deg,#57c1ff,#0077ff);box-shadow:0 0 6px rgba(87,193,255,0.5) inset,0 0 4px rgba(87,193,255,0.45);} 
  .progress-label{pointer-events:none;position:absolute;left:0;top:0;width:100%;height:100%;display:flex;align-items:center;justify-content:center;gap:6px;font-size:13px;font-weight:800;letter-spacing:.6px;color:#fff;text-shadow:0 1px 2px rgba(0,0,0,0.9),0 0 4px rgba(0,0,0,0.55);} 
  .progress-block .progress-icon{width:16px;height:16px;object-fit:contain;filter:drop-shadow(0 1px 2px rgba(0,0,0,.6));}
  .progress-count{display:inline-block;min-width:52px;text-align:center;}
  .prize-star-progress.ps-progress-complete .progress-label{color:#222;}
  .prize-star-progress.ps-progress-complete .progress-fill{filter:drop-shadow(0 0 6px #ff9f43) drop-shadow(0 0 12px rgba(255,159,67,.75));animation:psPulse 1.6s ease-in-out infinite alternate;}
  /* Level-up glow flash after jackpot */
  .prize-star-progress.ps-level-up .ps-progress-fill{animation:psLevelUpFlash 1.6s ease forwards;}
  @keyframes psLevelUpFlash{0%{filter:drop-shadow(0 0 0px #ff9f43) brightness(1);}40%{filter:drop-shadow(0 0 10px #ffcd8a) brightness(1.3);}70%{filter:drop-shadow(0 0 5px #ff9f43) brightness(1.1);}100%{filter:drop-shadow(0 0 0px #ff9f43) brightness(1);} }
  .prize-star-progress.ps-level-up{box-shadow:0 0 0 0 rgba(255,159,67,0.0),0 0 0 2px rgba(255,159,67,0.4);animation:psOuterPulse 1.6s ease forwards;}
  @keyframes psOuterPulse{0%{box-shadow:0 0 0 0 rgba(255,159,67,0.0),0 0 0 2px rgba(255,159,67,0.0);}35%{box-shadow:0 0 18px 6px rgba(255,159,67,0.55),0 0 0 2px rgba(255,159,67,0.65);}100%{box-shadow:0 0 0 0 rgba(255,159,67,0.0),0 0 0 2px rgba(255,159,67,0.15);} }
  /* Adjust vertical nudge of label here via translateY */
  .ps-progress-label{pointer-events:none;position:absolute;left:0;top:0;width:100%;height:100%;display:flex;align-items:center;justify-content:center;font-size:13px;font-weight:800;letter-spacing:.6px;color:#fff;text-shadow:0 1px 2px rgba(0,0,0,0.9),0 0 4px rgba(0,0,0,0.55);transform:translateY(-1px);} 
  .prize-star-progress .ps-progress-label .ps-progress-count{margin-right:4px;}
  .prize-star-progress.compact{padding:4px 6px 6px;}
  .ps-progress-complete .ps-progress-label{color:#222;}
  .ps-progress-complete .ps-progress-fill{filter:drop-shadow(0 0 6px #ff9f43) drop-shadow(0 0 12px rgba(255,159,67,.75));animation:psPulse 1.6s ease-in-out infinite alternate;}
  @keyframes psPulse{0%{opacity:1;}100%{opacity:.6;}}
        .controls button.next-day{background:#304050;color:#fff;border:1px solid #456075;padding:8px 14px;font-weight:600;border-radius:10px;cursor:pointer;transition:background .25s,box-shadow .25s;}
        .controls button.next-day:disabled{opacity:.35;cursor:default;box-shadow:none;}
        .controls button.next-day.ready{box-shadow:0 0 0 2px #ff9f43 inset,0 0 10px 2px rgba(255,159,67,0.55);}
        .controls button.reset{background:#402c2c;color:#fff;border:1px solid #664242;padding:8px 14px;font-weight:600;border-radius:10px;cursor:pointer;}
        .dice-bar .dice-btn.daily-used{background:#3a3f44 !important;border:0;color:#888;box-shadow:inset 0 0 0 2px #555;position:relative;}
        .dice-bar .dice-btn.daily-used::after{content:'Daily used';position:absolute;bottom:-18px;left:50%;transform:translateX(-50%);font-size:10px;font-weight:600;color:#bbb;letter-spacing:.5px;}
        @keyframes diceGlow{0%,100%{box-shadow:0 0 0 4px rgba(255,159,67,0.25),0 0 18px 4px rgba(255,159,67,0.55);}50%{box-shadow:0 0 0 2px rgba(255,159,67,0.55),0 0 10px 2px rgba(255,159,67,0.9);}}
        @keyframes diceShake{0%,100%{transform:translateY(-3px) rotateZ(-3deg);}25%{transform:translate(-3px,1px) rotateZ(5deg);}50%{transform:translate(3px,-2px) rotateZ(-6deg);}75%{transform:translate(-2px,2px) rotateZ(4deg);}}
        .dice-cube.can-roll{animation:diceGlow 2.8s ease-in-out infinite;position:relative;}
        .dice-cube.can-roll::after{content:'Roll!';position:absolute;bottom:-20px;left:50%;transform:translateX(-50%);font-size:11px;font-weight:600;color:#ffcf9a;letter-spacing:.5px;text-shadow:0 1px 2px #000;}
        .dice-cube.spinning{animation:diceShake 0.65s linear infinite;}
      `,document.head.appendChild(e)}}um(),Sr(),Ss(),ye()}function Sr(){const s=document.querySelector('[data-action="reset"]');s&&(s.disabled=R.current===1)}function hm(){D(),R.current=1,_s(R),Ut.forEach(t=>{t.completed=!1,t.category==="mystery"&&delete t.resolvedAs}),pt(),ys.forEach(t=>{t.completed=!1}),xs(),tt=0,ai(),ni=0,ri=0,oi=0,ue=0,te=0,Ct(),rt(),H.consecutiveDays=0,H.cumulativeDays=0,H.milestoneCycles=0,H.milestoneProgress=0,Oe(),typeof Jn=="function"&&Jn(),P.day=1,P.rollUsed=!1,ii(),ye(),De.level=1,Hl(),Ji(),document.querySelectorAll(".inline-next-day-btn").forEach(t=>t.remove());const s=document.querySelector(".dice-roll-btn");s&&(s.style.display="",s.disabled=!1,s.classList.remove("daily-used"),s.classList.add("can-roll")),typeof Lt<"u"&&(Lt=!1),ci=!1,ot=30,Yl(),gr(),at(),ie(R.current,!0),re(R.current,!0),hs.removeChildren(),li.removeChildren(),ee.splice(0,ee.length),me.splice(0,me.length),q=Xi(ot),ws=Math.max(1600,Math.max(...q.map(t=>t.y))+400),ge.renderer.resize(Pt,ht),Ki(),Zi(),at(),ie(R.current,!0),dm(),setTimeout(()=>xt("start_day"),450),Sr()}function dm(){try{tr.splice(0,tr.length),Ge.clear(),fs.clear(),es=null}catch{}}function um(){let s=document.querySelector(".reset-fab");return s||(s=document.createElement("button"),s.type="button",s.className="reset-fab",s.innerHTML='<span class="rf-icon" style="font-size:14px;line-height:1;">↺</span><span class="rf-label" style="margin-left:6px;">Reset</span>',s.title="Reset progress",s.ariaLabel="Reset progress",document.body.appendChild(s),s.addEventListener("click",()=>{confirm("Reset your progress?")&&hm()})),s}function rc(){try{D()}catch{}ot<300?lc():(R.current=30,_s(R),ie(R.current,!0),re(R.current,!0)),P.day=30,P.rollUsed=!1,ii(),ye();const s=document.querySelector(".skip-tutorial-fab");s&&s.remove(),vs(),console.log("[SkipTutorial] Skipped tutorial -> Day 30, Level 30, board expanded.")}window.skipTutorial=rc;function Ss(){const s=document.querySelector(".token-counter .token-count");s&&(s.textContent=String(tt))}function rt(){Ss();const s=document.querySelector(".fp-count");s&&(s.textContent=String(ni));const t=document.querySelector(".cash-count");t&&(t.textContent=pe(ri));const e=document.querySelector(".bonus-count");e&&(e.textContent=pe(oi));const i=document.querySelector(".sk-count");i&&(i.textContent=String(ue));const n=document.querySelector(".ps-count");n&&(n.textContent=String(te)),fm(),pm(),Ji()}function fm(){const s=document.querySelector(".prize-star-progress");if(!s)return;const t=s.querySelector(".ps-progress-fill"),e=s.querySelector(".ps-progress-count"),i=H.milestoneProgress,n=Math.floor(i/10),r=i-n*10,o=n===0?10:n===1?20:30;if(e&&(e.textContent=`${i}/${o}`),t){const a=r/10*100;t.style.width=a+"%",r===9?s.classList.add("ps-progress-complete"):s.classList.remove("ps-progress-complete")}}function pm(){const s=document.querySelector(".streak-progress");if(!s)return;const t=s.querySelector(".sp-fill"),e=s.querySelector(".sp-count"),i=H.consecutiveDays;e&&(e.textContent=`${i}/7`),t&&(t.style.width=i/7*100+"%")}function ye(){const s=document.querySelector(".day-count");s&&(s.textContent=String(P.day)),Ji();const t=document.querySelector(".dice-roll-btn");t&&(P.rollUsed?(t.classList.add("daily-used"),t.classList.remove("can-roll"),t.disabled=!0):(t.classList.remove("daily-used"),t.classList.add("can-roll"),Bi||(t.disabled=!1)))}function Ji(){const s=document.querySelector(".level-count");s&&(s.textContent=String(De.level))}function mm(s){var i,n;D();const t=document.createElement("div");t.className="modal-backdrop";const e=document.createElement("div");e.className="modal",e.setAttribute("role","dialog"),e.innerHTML=`
    <h2>Level ${s}</h2>
    <p>Placeholder content for level ${s}. Complete to advance.</p>
    <div class="modal-footer">
      <button class="secondary" type="button" data-action="cancel">Close</button>
      <button class="primary" type="button" data-action="complete">Complete Level</button>
    </div>`,t.addEventListener("click",r=>{r.target===t&&D()}),(i=e.querySelector('[data-action="cancel"]'))==null||i.addEventListener("click",D),(n=e.querySelector('[data-action="complete"]'))==null||n.addEventListener("click",()=>{nm(s),D()}),t.appendChild(e),document.body.appendChild(t),document.body.classList.add("modal-open"),setTimeout(()=>{var r;return(r=e.querySelector('[data-action="complete"]'))==null?void 0:r.focus()},30)}let $i=!1,wt=!1,Ie=!1,ne=!1,Ys=null;function D(){var t;(t=document.querySelector(".modal-backdrop"))==null||t.remove(),document.body.classList.remove("modal-open");let s=!1;if(wt?(wt=!1,s=!0,setTimeout(()=>{xt("post_instantwin"),Kt()},60)):Ie?(Ie=!1,s=!0,setTimeout(()=>{xt("post_bonus_round"),Kt()},60)):$i&&($i=!1,s=!0,setTimeout(()=>{xt("post_minigame"),Kt()},60)),!s&&Ys){const e=Ys;Ys=null,setTimeout(()=>{e()},40),s=!0}s||setTimeout(()=>{if(Kt(),Vs&&!document.querySelector(".modal-backdrop")&&(Vs=!1,!Lt))try{Wi()}catch{}try{ql()}catch{}},60),ne&&setTimeout(()=>{gm(),ne=!1},120),setTimeout(()=>{document.querySelector(".modal-backdrop")||cc()},40)}function gm(){try{if(!ts||!document.getElementById("app"))return;const t=ts.getGlobalPosition(),e=ge.canvas.getBoundingClientRect(),i=e.left+t.x,n=e.top+t.y;[{selector:".sk-counter",glyph:"🔑"},{selector:".ps-counter",glyph:"⭐"}].forEach(o=>{const a=document.querySelector(o.selector);if(!a)return;const l=a.getBoundingClientRect(),c=l.left+l.width/2,h=l.top+l.height/2,d=document.createElement("div");d.textContent=o.glyph,Object.assign(d.style,{position:"fixed",left:`${i}px`,top:`${n}px`,zIndex:"9999",fontSize:"20px",filter:"drop-shadow(0 2px 4px rgba(0,0,0,0.6))",transition:"transform 780ms cubic-bezier(.4,.8,.2,1), opacity 780ms ease",pointerEvents:"none",opacity:"1"}),document.body.appendChild(d),requestAnimationFrame(()=>{const u=c-i,f=h-n;d.style.transform=`translate(${u}px,${f}px) scale(0.6)`,d.style.opacity="0"}),setTimeout(()=>{d.remove()},820)})}catch(s){console.warn("Meta trail animation failed",s)}}function kr(){var n;if(wt||!et(P.day))return;const s=mt(P.day);if(!s)return;const t=(n=s.popups)==null?void 0:n.post_instantwin;if(!t)return;(Array.isArray(t)?t:[t]).some(r=>!Ge.has(`${s.day}:post_instantwin:${r}`))&&(wt=!0)}function ym(){var n;if(Ie||!et(P.day))return;const s=mt(P.day);if(!s)return;const t=(n=s.popups)==null?void 0:n.post_bonus_round;if(!t)return;(Array.isArray(t)?t:[t]).some(r=>!Ge.has(`${s.day}:post_bonus_round:${r}`))&&(Ie=!0)}function xm(s){let t=s.querySelector(".fade-top");t||(t=document.createElement("div"),t.className="fade-top",s.appendChild(t)),s.style.position="relative",t.style.position="absolute",t.style.top="0",t.style.left="0",t.style.right="auto",t.style.width="calc(100%)",t.style.margin="0 auto",t.style.height="170px",t.style.pointerEvents="none",t.style.zIndex="20",t.style.background="linear-gradient(to bottom, rgba(15,16,20,0.95) 0%, rgba(15,16,20,0.85) 22%, rgba(15,16,20,0.5) 60%, rgba(15,16,20,0) 100%)",t.style.mixBlendMode="normal"}function bm(){const s=R.current;Vl(),Ql=Jl(),q=Xi(ot),ws=Math.max(1600,Math.max(...q.map(t=>t.y))+400),ge.renderer.resize(Pt,ht),hs.removeChildren(),li.removeChildren(),ee.splice(0,ee.length),me.splice(0,me.length),Ki(),Zi(),at(),ie(s,!0),wr(),re(s,!0),se.y=yt.position.y,se.x=0,vs(),rt()}let Ei=!1,$t=null,Z=null;function _m(){window.addEventListener("keydown",s=>{if(s.key==="0")if(Ei=!Ei,Ei){if($t||($t=document.createElement("div"),$t.className="debug-overlay",document.body.appendChild($t),Object.assign($t.style,{position:"fixed",top:"8px",left:"8px",padding:"8px 10px",background:"rgba(0,0,0,0.55)",color:"#fff",font:"12px/1.3 monospace",zIndex:"9999",maxWidth:"240px",borderRadius:"6px",pointerEvents:"none",whiteSpace:"pre",backdropFilter:"blur(3px)"})),!Z){Z=document.createElement("div"),Z.className="debug-buttons",document.body.appendChild(Z),Object.assign(Z.style,{position:"fixed",bottom:"10px",right:"10px",display:"flex",flexDirection:"column",gap:"6px",zIndex:"10000",padding:"8px",background:"rgba(0,0,0,0.65)",border:"1px solid rgba(255,255,255,0.15)",borderRadius:"8px",font:"12px system-ui, sans-serif",boxShadow:"0 2px 6px rgba(0,0,0,0.4)"});const t=(f,m)=>{const x=document.createElement("button");return x.type="button",x.textContent=f,Object.assign(x.style,{cursor:"pointer",background:"#222",color:"#fff",border:"1px solid #444",padding:"4px 8px",borderRadius:"4px",fontSize:"12px",letterSpacing:"0.5px"}),x.addEventListener("mouseenter",()=>{x.style.background="#333"}),x.addEventListener("mouseleave",()=>{x.style.background="#222"}),x.addEventListener("click",()=>{Ar({level:-1,game:m,completed:!1})}),x};Z.appendChild(t("Force Slot","slot")),Z.appendChild(t("Force Spin Wheel","spin_wheel")),Z.appendChild(t("Force Loot Box","lootbox"));const e=document.createElement("button");e.type="button",e.textContent="Skip Tutorial",Object.assign(e.style,{cursor:"pointer",background:"#222",color:"#fff",border:"1px solid #444",padding:"4px 8px",borderRadius:"4px",fontSize:"12px",letterSpacing:"0.5px"}),e.addEventListener("mouseenter",()=>{e.style.background="#333"}),e.addEventListener("mouseleave",()=>{e.style.background="#222"}),e.addEventListener("click",()=>{et(P.day)&&(rc(),Ue())}),Z.appendChild(e);const i=document.createElement("button");i.type="button",i.textContent="Force Jackpot",Object.assign(i.style,{cursor:"pointer",background:"#222",color:"#fff",border:"1px solid #444",padding:"4px 8px",borderRadius:"4px",fontSize:"12px",letterSpacing:"0.5px"}),i.addEventListener("mouseenter",()=>{i.style.background="#333"}),i.addEventListener("mouseleave",()=>{i.style.background="#222"}),i.addEventListener("click",()=>{te=5,Lt=!1,Ct(),rt(),Wi()}),Z.appendChild(i);const n=document.createElement("button");n.type="button",n.textContent="Force Dual Choice",Object.assign(n.style,{cursor:"pointer",background:"#222",color:"#fff",border:"1px solid #444",padding:"4px 8px",borderRadius:"4px",fontSize:"12px",letterSpacing:"0.5px"}),n.addEventListener("mouseenter",()=>{n.style.background="#333"}),n.addEventListener("mouseleave",()=>{n.style.background="#222"}),n.addEventListener("click",()=>{cs=!0,Yt=!1,ei()}),Z.appendChild(n);const r=document.createElement("button");r.type="button",r.textContent="Force Special Scratch",Object.assign(r.style,{cursor:"pointer",background:"#222",color:"#fff",border:"1px solid #444",padding:"4px 8px",borderRadius:"4px",fontSize:"12px",letterSpacing:"0.5px"}),r.addEventListener("mouseenter",()=>{r.style.background="#333"}),r.addEventListener("mouseleave",()=>{r.style.background="#222"}),r.addEventListener("click",()=>{hc()}),Z.appendChild(r);const o=document.createElement("button");o.type="button",o.textContent="Force Mega Box",Object.assign(o.style,{cursor:"pointer",background:"#222",color:"#fff",border:"1px solid #444",padding:"4px 8px",borderRadius:"4px",fontSize:"12px",letterSpacing:"0.5px"}),o.addEventListener("mouseenter",()=>{o.style.background="#333"}),o.addEventListener("mouseleave",()=>{o.style.background="#222"}),o.addEventListener("click",()=>{Pr()}),Z.appendChild(o);const a=document.createElement("button");a.type="button",a.textContent="Skip Day",Object.assign(a.style,{cursor:"pointer",background:"#222",color:"#fff",border:"1px solid #444",padding:"4px 8px",borderRadius:"4px",fontSize:"12px",letterSpacing:"0.5px"}),a.addEventListener("mouseenter",()=>{a.style.background="#333"}),a.addEventListener("mouseleave",()=>{a.style.background="#222"}),a.addEventListener("click",()=>{if(P.rollUsed){ls("Can only skip before rolling.");return}Mr(!0),Ue()}),Z.appendChild(a);const l=document.createElement("button");l.type="button",l.textContent="+1 Key+Star",Object.assign(l.style,{cursor:"pointer",background:"#222",color:"#fff",border:"1px solid #444",padding:"4px 8px",borderRadius:"4px",fontSize:"12px",letterSpacing:"0.5px"}),l.addEventListener("mouseenter",()=>{l.style.background="#333"}),l.addEventListener("mouseleave",()=>{l.style.background="#222"}),l.addEventListener("click",()=>{fe(),Ue()}),Z.appendChild(l);const c=document.createElement("button");c.type="button",c.textContent="+1 Star",Object.assign(c.style,{cursor:"pointer",background:"#222",color:"#fff",border:"1px solid #444",padding:"4px 8px",borderRadius:"4px",fontSize:"12px",letterSpacing:"0.5px"}),c.addEventListener("mouseenter",()=>{c.style.background="#333"}),c.addEventListener("mouseleave",()=>{c.style.background="#222"}),c.addEventListener("click",()=>{qi(1),rt(),Ue()}),Z.appendChild(c);const h=document.createElement("button");h.type="button",h.textContent="+10 Tokens",Object.assign(h.style,{cursor:"pointer",background:"#224422",color:"#fff",border:"1px solid #2d6b2d",padding:"4px 8px",borderRadius:"4px",fontSize:"12px",letterSpacing:"0.5px"}),h.addEventListener("mouseenter",()=>{h.style.background="#2d5d2d"}),h.addEventListener("mouseleave",()=>{h.style.background="#224422"}),h.addEventListener("click",()=>{$e(10),rt()}),Z.appendChild(h);const d=document.createElement("button");d.type="button",d.textContent="-10 Tokens",Object.assign(d.style,{cursor:"pointer",background:"#442222",color:"#fff",border:"1px solid #6b2d2d",padding:"4px 8px",borderRadius:"4px",fontSize:"12px",letterSpacing:"0.5px"}),d.addEventListener("mouseenter",()=>{d.style.background="#5d2d2d"}),d.addEventListener("mouseleave",()=>{d.style.background="#442222"}),d.addEventListener("click",()=>{tt=Math.max(0,tt-10),Ct(),rt()}),Z.appendChild(d);const u=t("Close Debug (0)","slot");u.removeEventListener("click",()=>{}),u.addEventListener("click",()=>{window.dispatchEvent(new KeyboardEvent("keydown",{key:"0"}))}),Object.assign(u.style,{background:"#552222"}),Z.appendChild(u)}Ue()}else $t&&($t.remove(),$t=null,Z&&(Z.remove(),Z=null))}),setInterval(()=>{Ei&&Ue()},400),setInterval(()=>{try{!er&&tt>=120&&ei()}catch{}},5e3)}function Ue(){if(!$t)return;const s=br(),t=vp-1,e=ht-as-ze,i=yt.position.x.toFixed(1),n=yt.position.y.toFixed(1),r=R.current,o=Math.min(ot,r+7),a=`${r}-${o}`,l=ys.length,c=Ut.length;$t.textContent=`VIEW: ${Pt}x${ht}
TILE_RADIUS: ${jt.toFixed(1)}
spacing: ${s.toFixed(1)} (gaps:${t})
usable: ${e.toFixed(1)}
paddings T:${as} B:${ze}
camera: (${i}, ${n})
progress: ${r}/${ot} visible:${a}
categories: ${c} minigames: ${l}
day: ${P.day} rollUsed:${P.rollUsed} level:${De.level}
zone: ${je}`}function Ar(s){var i;D();const t=document.createElement("div");t.className="modal-backdrop";const e=document.createElement("div");e.className="modal",e.setAttribute("role","dialog"),e.innerHTML=`<h2>${wm(s.game)}</h2><div class="minigame" data-game="${s.game}"></div><div class="result"></div><div class="modal-footer"><button class="secondary" data-action="close" type="button">Close</button></div>`,t.addEventListener("click",n=>{n.target===t&&D()}),(i=e.querySelector('[data-action="close"]'))==null||i.addEventListener("click",D),t.appendChild(e),document.body.appendChild(t),document.body.classList.add("modal-open"),vm(s,e.querySelector(".minigame"),e.querySelector(".result")),setTimeout(()=>Sm(s,e),140)}function wm(s){switch(s){case"slot":return"3x1 Slot";case"spin_wheel":return"Spin Wheel";case"lootbox":return"Loot Box";default:return"Minigame"}}function vm(s,t,e){switch(Et.includes(s.game)||(s.game=Et[Math.floor(Math.random()*Et.length)],xs()),s.game){case"slot":return km(t,s,e);case"spin_wheel":return Am(t,s,e);case"lootbox":return Cm(t,s,e);default:t.innerHTML="<p style='text-align:center;'>Minigame unavailable.</p>"}}function Sm(s,t){var f,m;if(!et(P.day))return;const e=mt(P.day);if(!e||!e.popups||!e.popups.pre_minigame)return;const i=e.popups.pre_minigame,r=(Array.isArray(i)?i:[i]).filter(x=>{const p=`${e.day}:pre_minigame:${x}`;return Ge.has(p)?!1:(Ge.add(p),!0)});if(!r.length)return;Cr();const o=document.createElement("div");Object.assign(o.style,{position:"fixed",left:"0",top:"0",right:"0",bottom:"0",display:"flex",alignItems:"flex-start",justifyContent:"center",background:"rgba(0,0,0,0.45)",zIndex:"650",padding:"0",overflow:"auto"});const a=document.createElement("div");a.className="tutor-stage",a.style.minHeight="unset",a.style.width="100%",a.style.maxWidth="var(--tutor-stage-max)",a.style.marginTop="150px";const l=document.createElement("div");l.className="tutor-portrait-wrap",l.innerHTML=`<img src='${mr}' alt='Guide' class='tutor-character'/>`;const c=document.createElement("div");c.className="tutor-speech",c.innerHTML="<div class='tutor-speech-arrow'></div><div class='tutor-speech-inner'><h2>Minigame</h2><div class='stacked-copy'></div><div class='tutor-actions stacked-actions' style='display:flex;align-items:center;justify-content:space-between;gap:16px;'><div class='ts-progress' style='font-size:12px;font-weight:600;opacity:.75;letter-spacing:.5px;'></div><div class='nav-btns' style='display:flex;gap:8px;'><button type='button' class='secondary ts-prev' style='display:none;'>Back</button><button type='button' class='primary ts-next'>Next</button></div></div></div>";const h=c.querySelector(".stacked-copy");o.appendChild(a),a.appendChild(c),a.appendChild(l),t.appendChild(o);let d=0;function u(){h.innerHTML=`<div style='font-size:14px;line-height:1.55;'>${r[d]}</div>`;const x=c.querySelector(".ts-progress"),p=c.querySelector(".ts-prev"),g=c.querySelector(".ts-next");x.textContent=`Step ${d+1}/${r.length}`,p.style.display=d>0?"inline-flex":"none",g.textContent=d===r.length-1?"Finish":"Next"}(f=c.querySelector(".ts-prev"))==null||f.addEventListener("click",()=>{d>0&&(d--,u())}),(m=c.querySelector(".ts-next"))==null||m.addEventListener("click",()=>{d<r.length-1?(d++,u()):o.remove()}),u()}function na(s,t,e){if(s.completed){e.innerHTML="<p><strong>Already completed.</strong></p>";return}let i="";if(t){const r=Yp();r.kind==="nothing"?i="<p><strong>No reward this time.</strong></p>":(be(r),fe(),rt(),i=`<p><strong>Reward:</strong> ${r.label}</p>${bs()}`,ne=!0)}else i="<p><strong>Try again tomorrow!</strong></p>";s.completed=!0,xs();const n=de(s.level);n&&!n.completed&&(n.completed=!0,pt()),at(),e.innerHTML=i,ci=!0,$i=!0}function oc(s,t,e){if(s.completed)return;let i="";t?t.kind==="nothing"?i="<p><strong>No reward this time.</strong></p>":(be(t),fe(),rt(),i=`<p><strong>Reward:</strong> ${t.label}</p>${bs()}`,ne=!0):i="<p><strong>Try again tomorrow!</strong></p>",s.completed=!0,xs();const n=de(s.level);n&&!n.completed&&(n.completed=!0,pt()),at(),e.innerHTML=i,ci=!0,$i=!0}function km(s,t,e){var n;s.innerHTML=`<div class='slot' style='display:flex;gap:8px;justify-content:center;margin-bottom:8px;'>
    <div class='reel' data-r='0' style='width:46px;height:46px;background:#222;border:2px solid #555;display:flex;align-items:center;justify-content:center;font-size:24px;'>?</div>
    <div class='reel' data-r='1' style='width:46px;height:46px;background:#222;border:2px solid #555;display:flex;align-items:center;justify-content:center;font-size:24px;'>?</div>
    <div class='reel' data-r='2' style='width:46px;height:46px;background:#222;border:2px solid #555;display:flex;align-items:center;justify-content:center;font-size:24px;'>?</div>
  </div><button class='primary' data-action='spin'>Spin</button>`;const i=["🍒","⭐","7","🍋"];(n=s.querySelector('[data-action="spin"]'))==null||n.addEventListener("click",()=>{if(t.completed)return;let r=mt(P.day),o=null;if(r&&r.reward.kind==="minigame"&&r.reward.minigame==="slot"){const d=r.reward;Array.isArray(d.forceSlotSymbols)&&d.forceSlotSymbols.length===3?o=d.forceSlotSymbols:d.forceSlotSymbol&&(o=[d.forceSlotSymbol,d.forceSlotSymbol,d.forceSlotSymbol])}const a=o?!0:Math.random()<.5,l=Array.from(s.querySelectorAll(".reel"));let c=0;const h=setInterval(()=>{if(l.forEach(d=>d.textContent=i[Math.floor(Math.random()*i.length)]),c++,c>15)if(clearInterval(h),o)l.forEach((d,u)=>d.textContent=o[u]),na(t,!0,e);else{const d=a?"⭐":i[Math.floor(Math.random()*i.length)];l.forEach(u=>u.textContent=d),na(t,a,e)}},80)})}function Am(s,t,e){const i=ct.length,n=260;s.innerHTML=`<div style='position:relative;width:${n}px;height:${n}px;margin:0 auto 12px;'>
    <canvas class='spin-wheel-canvas' width='${n}' height='${n}' style='width:${n}px;height:${n}px;display:block;'></canvas>
    <div class='wheel-pointer' style='position:absolute;left:50%;bottom:-10px;transform:translateX(-50%);width:0;height:0;border-left:16px solid transparent;border-right:16px solid transparent;border-bottom:30px solid #ff9f43;filter:drop-shadow(0 2px 4px rgba(0,0,0,.6));'></div>
  </div>
  <button class='primary' data-action='spinwheel'>Spin</button>`;const o=s.querySelector(".spin-wheel-canvas").getContext("2d");if(!o)return;const a=o,l=n/2,c=n/2-4;let h=mt(P.day),d=Math.floor(Math.random()*i);if(et(P.day)){let g=0;for(;ct[d].kind==="nothing"&&g<25;)d=Math.floor(Math.random()*i),g++}if(h&&h.reward.kind==="minigame"&&h.reward.minigame==="spin_wheel"){const g=h.reward;if(g.forceSpinWheelLabel){const y=ct.findIndex(b=>b.label===g.forceSpinWheelLabel);y>=0&&(d=y)}else if(g.forceSpinWheelKind||g.forceSpinWheelAmount!==void 0){const y=ct.findIndex(b=>(g.forceSpinWheelKind?b.kind===g.forceSpinWheelKind:!0)&&(g.forceSpinWheelAmount!==void 0?b.amount===g.forceSpinWheelAmount:!0));y>=0&&(d=y)}}const u=["#243240","#2f4256","#364d63","#2a3947"];function f(g){a.clearRect(0,0,n,n),a.save(),a.translate(l,l),a.rotate(g);const y=Math.PI*2/i;for(let b=0;b<i;b++){a.beginPath(),a.moveTo(0,0),a.fillStyle=u[b%u.length],a.arc(0,0,c,b*y,(b+1)*y),a.closePath(),a.fill(),a.save(),a.rotate(b*y+y/2),a.translate(c*.62,0),a.rotate(Math.PI/2),a.fillStyle="#fff",a.font="12px system-ui, sans-serif",a.textAlign="center",a.textBaseline="middle";const _=ct[b],S=_.kind==="tokens"?`${_.amount}T`:_.kind==="freePlays"?`${_.amount}FP`:_.kind==="cash"?`${(_.amount||0)/100}£`:_.kind==="bonus"?`${(_.amount||0)/100}B`:_.kind==="streakKeys"?`${_.amount}K`:_.kind==="prizeStars"?`${_.amount}★`:"—",v=_.kind==="tokens"?"🪙":_.kind==="freePlays"?"▶️":_.kind==="cash"?"💷":_.kind==="bonus"?"🎟️":_.kind==="streakKeys"?"🔑":_.kind==="prizeStars"?"⭐":"Ø";m(a,v+`
`+S,0,0,70,12),a.restore()}a.restore()}function m(g,y,b,_,S,v){const w=y.split(" ");let C="";const T=[];for(const k of w){const F=C?C+" "+k:k;g.measureText(F).width>S?(T.push(C),C=k):C=F}C&&T.push(C);const A=-((T.length-1)*v)/2;T.forEach((k,F)=>g.fillText(k,b,_+A+F*v))}f(0);const x=s.querySelector('[data-action="spinwheel"]');let p=!1;x.addEventListener("click",()=>{if(p||t.completed)return;p=!0,x.disabled=!0,x.textContent="Spinning...";const g=Math.PI*2/i,y=6,b=d*g+g/2,_=Math.PI/2-b,S=y*Math.PI*2+_+(Math.random()*g-g/2)*.15,v=3800,w=performance.now();function C(k){return 1-Math.pow(1-k,4)}function T(k){const F=Math.min(1,(k-w)/v),L=C(F),$=S*L;f($),F<1?requestAnimationFrame(T):A()}requestAnimationFrame(T);function A(){let k=ct[d];if(et(P.day)&&k.kind==="nothing"){const L=[...ct.slice(d+1),...ct.slice(0,d)].find($=>$.kind!=="nothing");L&&(k=L)}oc(t,k,e)}})}function Cm(s,t,e){const i={common:{color:"#ddd",bg:"#2a2a2a"},uncommon:{color:"#b1f29d",bg:"#244a28"},rare:{color:"#82c7ff",bg:"#14344d"},epic:{color:"#d5a6ff",bg:"#41245b"},mythic:{color:"#ffdf7f",bg:"#5a430f"}},n=ct.map(p=>{let g="common",y=30;return p.kind==="nothing"?(g="common",y=et(P.day)?0:40):p.kind==="tokens"&&(p.amount||0)>=50?(g="uncommon",y=18):p.kind==="cash"&&(p.amount||0)>=100?(g="rare",y=10):p.kind==="bonus"&&(p.amount||0)>=500?(g="epic",y=4):p.kind==="tokens"&&(p.amount||0)>=100?(g="rare",y=8):p.kind==="freePlays"&&(p.amount||0)>=5?(g="rare",y=7):p.kind==="bonus"&&(p.amount||0)>=100&&(g="uncommon",y=16),{reward:p,weight:y,rarity:g}}),r=n.filter(p=>p.weight>0);function o(){const p=r.length?r:n,g=p.reduce((b,_)=>b+_.weight,0);let y=Math.random()*g;for(const b of p){if(y<b.weight)return b;y-=b.weight}return p[0]}let a=o();const l=mt(P.day);let c;if(l&&l.reward.kind==="minigame"&&l.reward.minigame==="lootbox"){const p=l.reward;let g;if(p.forceLootboxLabel&&(g=ct.find(y=>y.label===p.forceLootboxLabel)),!g&&(p.forceLootboxKind||p.forceLootboxAmount!==void 0)&&(g=ct.find(y=>(p.forceLootboxKind?y.kind===p.forceLootboxKind:!0)&&(p.forceLootboxAmount!==void 0?y.amount===p.forceLootboxAmount:!0))),g&&(a={reward:g,weight:1,rarity:"rare"}),et(P.day)&&P.day===1){const y=ct.find(b=>b.kind==="bonus"&&b.amount===50);y?(c=y,a={reward:y,weight:1,rarity:"rare"},console.debug("[Tutorial][Day1][Lootbox] Forcing final reward to 50p Bonus Money during reel construction.")):console.warn("[Tutorial][Day1][Lootbox] 50p Bonus Money reward not found in REWARDS list; falling back to earlier forced reward or random.")}}let h=48,d=40;const u=[];if(et(P.day)&&P.day===1&&c){for(let p=0;p<h;p++)u.push({reward:c,weight:1,rarity:"rare"});console.debug("[Tutorial][Day1][Lootbox] Constructed uniform reel (all 50p Bonus Money).")}else for(let p=0;p<h;p++)p===d?u.push(a):u.push(o());s.innerHTML=`<div style='display:flex;flex-direction:column;align-items:center;gap:14px;width:100%;'>
    <div class='lootbox-reel-wrapper' style='position:relative;width:320px;height:86px;overflow:hidden;border:3px solid #555;border-radius:14px;background:#111;'>
      <div class='indicator' style='position:absolute;left:50%;top:0;bottom:0;width:2px;background:#ff9f43;box-shadow:0 0 6px #ff9f43;transform:translateX(-50%);pointer-events:none;'></div>
      <div class='lootbox-track' style='display:flex;align-items:center;gap:8px;will-change:transform;padding:8px;'></div>
    </div>
  <button class='primary' data-action='open'>Start</button>
  </div>`;const f=s.querySelector(".lootbox-track");u.forEach(p=>{const g=i[p.rarity],y=document.createElement("div");y.className="lb-item",y.style.cssText=`flex:0 0 96px;height:60px;border:2px solid ${g.color};border-radius:10px;display:flex;flex-direction:column;align-items:center;justify-content:center;font-size:11px;font-weight:600;letter-spacing:.5px;text-align:center;color:${g.color};background:${g.bg};padding:4px;box-shadow:0 0 4px rgba(0,0,0,.6);`,y.innerHTML=`<span style='font-size:12px;'>${p.reward.label.replace(/\s+/g,"<br>")}</span>`,f.appendChild(y)});const m=s.querySelector('[data-action="open"]');let x=!1;m.addEventListener("click",()=>{if(x||t.completed)return;x=!0,m.disabled=!0,m.textContent="Opening...";const p=104,g=d*p-(320/2-p/2),y=4500,b=performance.now();function _(w){return 1-Math.pow(1-w,3)}function S(w){const C=Math.min(1,(w-b)/y),T=_(C),A=g*T;f.style.transform=`translateX(${-A}px)`,C<1?requestAnimationFrame(S):v()}requestAnimationFrame(S);function v(){const w=s.querySelector(".lootbox-reel-wrapper"),C=w.getBoundingClientRect().left+w.clientWidth/2;let T=0,A=1/0,k=null;Array.from(f.children).forEach(($,Dt)=>{const M=$.getBoundingClientRect(),B=M.left+M.width/2,oe=Math.abs(B-C);oe<A&&(A=oe,T=Dt,k=$)});const F=k||f.children[d];F.style.outline="3px solid #fff",F.animate([{transform:"scale(1)"},{transform:"scale(1.15)"},{transform:"scale(1)"}],{duration:600,easing:"ease"});let L=u[T].reward;et(P.day)&&P.day===1&&c&&(console.debug("[Tutorial][Day1][Lootbox] Overriding visually selected reward",L==null?void 0:L.label,"->",c.label),L=c,F&&(F.innerHTML=`<span style='font-size:12px;'>${L.label.replace(/\s+/g,"<br>")}</span>`)),oc(t,L,e)}})}let Bi=!1;function Mm(){var t;let s=document.querySelector(".dice-bar");if(!s){let e=function(){et(P.day)||P.rollUsed?n.style.display="none":n.style.display="inline-block"};s=document.createElement("div"),s.className="dice-bar",s.innerHTML=`
      <div class="dice-wrapper" style="display:flex;align-items:center;justify-content:center;gap:10px;">
        <button type="button" class="dice-cube dice-roll-btn" aria-label="Roll Dice" title="Roll Dice">-</button>
        <button type="button" class="skip-day-btn" title="Skip this day" style="display:none;padding:10px 14px;border-radius:14px;border:2px solid #55606c;background:#202830;color:#fff;font-weight:600;letter-spacing:.5px;cursor:pointer;font-size:12px;">Skip Day</button>
      </div>`,(t=document.getElementById("app"))==null||t.appendChild(s);const i=s.querySelector(".dice-roll-btn"),n=s.querySelector(".skip-day-btn"),r=i;if(!document.getElementById("dice-style")){const o=document.createElement("style");o.id="dice-style",o.textContent=`.dice-bar{display:flex;justify-content:center;margin-top:6px;}
        .dice-cube{width:72px;height:72px;background:#222;border:4px solid #ff9f43;border-radius:18px;display:flex;align-items:center;justify-content:center;font-size:26px;font-weight:800;color:#fff;cursor:pointer;box-shadow:0 4px 10px rgba(0,0,0,0.5);transition:transform .18s, background .25s, box-shadow .25s;}
        .dice-cube:hover:not(:disabled){transform:translateY(-3px) rotateZ(-3deg);}
        .dice-cube:disabled{opacity:.55;cursor:default;}
        .dice-cube.daily-used{background:#3a3f44 !important;color:#888;box-shadow:inset 0 0 0 3px #555;}
        .dice-cube.daily-used::after{content:'Daily used';position:absolute;bottom:-20px;left:50%;transform:translateX(-50%);font-size:11px;font-weight:600;color:#bbb;letter-spacing:.5px;}
      `,document.head.appendChild(o)}i.addEventListener("click",()=>{if(Bi)return;if(R.current>=ot){r.textContent="🏁";return}if(P.rollUsed)return;xt("pre_roll"),Bi=!0,i.disabled=!0,i.classList.remove("can-roll"),i.classList.add("spinning");let o=0,a=1+Math.floor(Math.random()*6);const l=mt(P.day);l&&l.forcedDice>=1&&l.forcedDice<=6&&(a=l.forcedDice);const c=setInterval(()=>{o++,r.textContent=String(1+Math.floor(Math.random()*6)),o>=10&&(clearInterval(c),r.textContent=String(a),xt("post_roll"),sc(a),P.rollUsed=!0,ii(),ye(),setTimeout(()=>{Bi=!1,i.classList.remove("spinning"),ye()},900))},80)}),n.addEventListener("click",()=>{et(P.day)||P.rollUsed||Mr(!0)}),setInterval(e,700)}}function Tm(){var i;D();const s=document.createElement("div");s.className="modal-backdrop";const t=document.createElement("div");t.className="modal",t.setAttribute("role","dialog");const e=[{cat:"instant_tokens",label:"Instant Tokens",desc:"Immediate token bundle."},{cat:"instant_prize",label:"Instant Prize",desc:"Immediate Free Plays / Cash / Bonus."},{cat:"reveal",label:"Reveal",desc:"Open a random reward reveal."},{cat:"minigame",label:"Minigame",desc:"Play for a reward."},{cat:"bonus_round",label:"Bonus Round",desc:"High-value reward chance."},{cat:"mystery",label:"Mystery",desc:"Transforms when landed on."},{cat:"extra_move",label:"Extra Move",desc:"Automatically roll forward again."},{cat:"travel_back",label:"Travel Back",desc:"Move backwards (no reward)."}];t.innerHTML=`<h2>Tile Legend</h2>
  <div class='legend-list' style='display:flex;flex-direction:column;gap:10px;max-height:360px;overflow:auto;'>
    ${e.map(n=>`<div style='display:flex;align-items:center;gap:10px;'>
      <canvas data-shape='${n.cat}' width='52' height='52' style='background:transparent;'></canvas>
      <div><strong>${n.label}</strong><br/><span style='font-size:12px;opacity:.85;'>${n.desc}</span></div>
    </div>`).join("")}
  </div><div class='modal-footer'><button class='primary' data-action='close'>Close</button></div>`,s.addEventListener("click",n=>{n.target===s&&D()}),(i=t.querySelector('[data-action="close"]'))==null||i.addEventListener("click",D),s.appendChild(t),document.body.appendChild(s),document.body.classList.add("modal-open"),setTimeout(()=>{t.querySelectorAll("canvas[data-shape]").forEach(n=>{const r=n.getContext("2d");if(!r)return;const o=20,a=n.dataset.shape;switch(r.lineWidth=3,r.strokeStyle="#182028",r.fillStyle="#5a6470",r.beginPath(),a){case"instant_tokens":Pm(r,26,26,o);break;case"instant_prize":Rm(r,6,6,40,40,10);break;case"reveal":ra(r,26,26,o,6,-Math.PI/6);break;case"minigame":Em(r,26,26,o);break;case"bonus_round":Im(r,26,26,o,5,.45);break;case"mystery":ra(r,26,26,o,5,-Math.PI/2);break;case"extra_move":Lm(r,26,26,o);break;case"travel_back":Bm(r,26,26,o);break}r.fill(),r.stroke()})},30)}function Pm(s,t,e,i){s.moveTo(t+i,e),s.arc(t,e,i,0,Math.PI*2)}function ra(s,t,e,i,n,r=0){for(let o=0;o<n;o++){const a=r+Math.PI*2*o/n,l=t+Math.cos(a)*i,c=e+Math.sin(a)*i;o===0?s.moveTo(l,c):s.lineTo(l,c)}s.closePath()}function Em(s,t,e,i){s.moveTo(t,e-i),s.lineTo(t+i,e),s.lineTo(t,e+i),s.lineTo(t-i,e),s.closePath()}function Im(s,t,e,i,n,r){for(let o=0;o<n*2;o++){const a=-Math.PI/2+Math.PI*o/n,l=o%2===0?i:i*r,c=t+Math.cos(a)*l,h=e+Math.sin(a)*l;o===0?s.moveTo(c,h):s.lineTo(c,h)}s.closePath()}function Lm(s,t,e,i){s.moveTo(t,e-i),s.lineTo(t+i,e+i),s.lineTo(t-i,e+i),s.closePath()}function Bm(s,t,e,i){s.moveTo(t-i,e-i),s.lineTo(t+i,e-i),s.lineTo(t,e+i),s.closePath()}function Rm(s,t,e,i,n,r){const o=Math.min(r,i/2,n/2);s.moveTo(t+o,e),s.lineTo(t+i-o,e),s.quadraticCurveTo(t+i,e,t+i,e+o),s.lineTo(t+i,e+n-o),s.quadraticCurveTo(t+i,e+n,t+i-o,e+n),s.lineTo(t+o,e+n),s.quadraticCurveTo(t,e+n,t,e+n-o),s.lineTo(t,e+o),s.quadraticCurveTo(t,e,t+o,e)}function St(s,t){return s+Math.floor(Math.random()*(t-s+1))}function ks(s,t,e){var o;D();const i=document.createElement("div");i.className="modal-backdrop";const n=document.createElement("div");n.className="modal",n.setAttribute("role","dialog"),et(P.day)&&(s==="Info"||s==="Tutorial")?(Cr(),n.classList.add("tutor-modal"),n.innerHTML=`<div class='tutor-stage'>
        <div class='tutor-portrait-wrap'>
          <img src='${mr}' alt='Guide' class='tutor-character'/>
        </div>
        <div class='tutor-speech'>
          <div class='tutor-speech-arrow'></div>
          <div class='tutor-speech-inner'>
            <h2>${s}</h2>
            <div class='tutor-text'>${t}</div>
            <div class='tutor-actions'><button class='primary' data-action='close'>Close</button></div>
          </div>
        </div>
      </div>`):n.innerHTML=`<h2>${s}</h2><div class='body'>${t}</div><div class='modal-footer'><button class='primary' data-action='close'>Close</button></div>`,i.addEventListener("click",a=>{}),(o=n.querySelector('[data-action="close"]'))==null||o.addEventListener("click",()=>{D(),e==null||e()}),i.appendChild(n),document.body.appendChild(i),document.body.classList.add("modal-open")}function Fm(s){const t=St(10,50);$e(t),ne=!0,s.completed=!0,pt(),at(),fe(),ks("Instant Tokens",`<p>You received <strong>${t} Tokens</strong>.</p>${bs()}`,()=>{const e=wt;kr(),(wt||e)&&(wt=!1,xt("post_instantwin"))})}function ac(){const s=["freePlays","bonus","cash"][St(0,2)];if(s==="freePlays"){const e=St(1,3);return{label:`${e} Free Play${e>1?"s":""}`,apply:()=>he(e)}}if(s==="bonus"){const e=St(1,50)*10;return{label:`${pe(e)} Bonus Money`,apply:()=>xr(e)}}const t=St(1,10)*100;return{label:`${pe(t)} Cash`,apply:()=>yr(t)}}function oa(){const s=[()=>{const i=St(20,100);return $e(i),`${i} Tokens`},()=>{const i=St(1,3);return he(i),`${i} Free Play${i>1?"s":""}`},()=>{const i=St(10,50)*10;return xr(i),`${pe(i)} Bonus`},()=>{const i=St(1,10)*100;return yr(i),`${pe(i)} Cash`}],t=s[St(0,s.length-1)];return{label:t(),apply:()=>{}}}function zm(s){let t;const e=mt(P.day);if(e&&e.day===2&&e.reward.kind==="freePlays"&&e.reward.amount===2)he(2),t="2 Free Plays",console.debug("[Tutorial][Day2][InstantPrize] Forced 2 Free Plays.");else if(s.forcedReward)be(s.forcedReward),t=s.forcedReward.label;else{const i=ac();i.apply(),t=i.label}ne=!0,s.completed=!0,pt(),at(),fe(),ks("Instant Prize",`<p>You won <strong>${t}</strong>.</p>${bs()}`,()=>{const i=wt;kr(),(wt||i)&&(wt=!1,xt("post_instantwin"))})}function Dm(s){const t=mt(P.day);let e=oa();if(t&&t.day===3&&t.forceBonusNoTokens){let i=0;for(;/Token/i.test(e.label)&&i<10;)e=oa(),i++;/Token/i.test(e.label)?(he(1),e={label:"1 Free Play",apply:()=>{}},console.debug("[Tutorial][Day3][BonusRound] Forced fallback Free Play to avoid token prize.")):console.debug("[Tutorial][Day3][BonusRound] Ensured non-token prize:",e.label)}ne=!0,fe(),s.completed=!0,pt(),at(),fe(),ks("BONUS ROUND",`<p><strong>${e.label}</strong></p>${bs()}`,()=>{const i=Ie;ym(),(Ie||i)&&(fs.add("post_bonus_round"),Ie=!1,xt("post_bonus_round"))})}function Gm(s){D();const t=ac();t.apply(),ne=!0,s.completed=!0,pt(),at(),fe(),ks("Reveal",`<p>You uncovered <strong>${t.label}</strong>.</p>${bs()}`,()=>{const e=wt;kr(),(wt||e)&&(wt=!1,xt("post_instantwin"))})}function aa(s,t){var l;D();const e=document.createElement("div");e.className="modal-backdrop";const i=document.createElement("div");i.className="modal",i.setAttribute("role","dialog"),i.innerHTML=`<h2>${t?"Extra Move":"Travel Back"}</h2><p>Rolling...</p>
    <div class='move-die' style='font-size:42px;font-weight:700;margin:14px auto;width:84px;height:84px;display:flex;align-items:center;justify-content:center;background:#222;border:3px solid #ff9f43;border-radius:16px;'>-</div>`;const n=i.querySelector(".move-die");let r=0;const o=St(1,6),a=setInterval(()=>{r++,n.textContent=String(St(1,6)),r>14&&(clearInterval(a),n.textContent=String(o),s.completed=!0,pt(),at(),setTimeout(()=>{D(),t?sc(o):rm(o)},650))},80);e.addEventListener("click",c=>{c.target===e&&D()}),(l=i.querySelector(".close-btn"))==null||l.addEventListener("click",D),e.appendChild(i),document.body.appendChild(e)}tm();setTimeout(()=>{xt("start_day")},800);function Cr(){if(document.getElementById("tutor-bubble-styles"))return;const s=document.createElement("style");s.id="tutor-bubble-styles",s.textContent=`
  .tutor-modal{background:transparent !important;box-shadow:none !important;padding:0 !important;max-width:none !important;width:100% !important;}
  :root{--tutor-char-width:340px;--tutor-char-width-mobile:230px;--tutor-char-max-vw:60vw;--tutor-stage-top-shift:100px;--tutor-bubble-max:560px;--tutor-stage-max:600px;--tutor-stage-right-extra:50px;}
  /* Centered tutorial layout */
  .tutor-stage{position:relative;display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:100dvh;padding: clamp(16px,4vh,40px) clamp(16px,5vw,48px);gap:32px;width:100%;max-width:var(--tutor-stage-max);margin:0 auto; box-sizing:border-box;}
  .tutor-speech{order:1;position:relative;max-width:var(--tutor-bubble-max);width:100%;margin:0 auto;display:flex;flex-direction:column;}
  .tutor-speech-inner{background:#1c232b;border:2px solid #ff9f43;border-radius:26px;padding:28px 30px 30px;box-shadow:0 14px 34px rgba(0,0,0,0.6);font-size:15px;line-height:1.6;}
  .tutor-speech-inner h2{margin:0 0 12px;font-size:22px;}
  .tutor-text{font-size:15px;}
  .tutor-actions{margin-top:22px;display:flex;justify-content:flex-end;}
  /* Arrow removed when centered */
  .tutor-speech-arrow{display:none;}
  .tutor-speech-arrow:after{display:none;}
  .tutor-portrait-wrap{order:2;display:flex;align-items:flex-end;justify-content:center;margin-top:12px;}
  .tutor-character{width:var(--tutor-char-width);max-width:var(--tutor-char-max-vw);height:auto;filter:drop-shadow(0 10px 18px rgba(0,0,0,.7));transition:transform .45s ease;image-rendering:auto;}
  .tutor-stage:hover .tutor-character{transform:translateY(4px);} 
  /* Responsive adjustments */
  @media (max-width:900px){
    .tutor-stage{padding: clamp(16px,4vh,34px) clamp(16px,5vw,42px);}
    .tutor-character{width:calc(var(--tutor-char-width) - 60px);}
    .tutor-speech-inner{padding:26px 24px 28px;font-size:14px;}
    .tutor-speech-inner h2{font-size:20px;}
  }
  @media (max-width:560px){
    .tutor-stage{padding: clamp(12px,3vh,30px) 16px;}
    .tutor-character{width:var(--tutor-char-width-mobile);}
    .tutor-speech-inner{padding:22px 20px 24px;font-size:13px;}
    .tutor-speech-inner h2{font-size:19px;}
  }
  @media (min-width:1280px){
    .tutor-stage{min-height:100dvh;}
    .tutor-character{width:380px;max-width:50vw;}
  }
  `,document.head.appendChild(s)}function Om(){let s=document.getElementById("day-fader");return s||(s=document.createElement("div"),s.id="day-fader",Object.assign(s.style,{position:"fixed",left:"0",top:"0",right:"0",bottom:"0",background:"#000",opacity:"0",transition:"opacity 420ms ease",zIndex:"9998",pointerEvents:"none"}),document.body.appendChild(s)),s}function Mr(s=!1){const t=Om();t.style.pointerEvents="auto";const e="day-fader-label";let i=document.getElementById(e);i||(i=document.createElement("div"),i.id=e,Object.assign(i.style,{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%,-50%)",color:"#fff",fontSize:"48px",fontWeight:"700",fontFamily:"system-ui, sans-serif",textShadow:"0 4px 12px rgba(0,0,0,0.6)",opacity:"0",transition:"opacity 500ms ease"}),t.appendChild(i)),requestAnimationFrame(()=>{t.style.opacity="1"});const n=P.day;setTimeout(()=>{!s&&P.rollUsed?Rp():s&&(Fp(),ue>0&&(ue=0,Ct(),rt())),xt("end_day"),P.day+=1,P.rollUsed=!1,ii(),typeof Lt<"u"&&(Lt=!1),n===8&&P.day===9&&lc(),ci=!1;const r=document.querySelector(".dice-roll-btn");r&&(r.style.display=""),document.querySelectorAll(".inline-next-day-btn").forEach(o=>o.remove()),ye(),i&&(i.textContent=`Day ${P.day}`,i.style.opacity="1"),setTimeout(()=>{i&&(i.style.opacity="0"),t.style.opacity="0",setTimeout(()=>{t.style.pointerEvents="none",xt("start_day")},500)},3e3)},500)}function lc(){ot=300,R.current=30,_s(R),Yl(),gr(),q=Xi(ot),ws=Math.max(1600,Math.max(...q.map(s=>s.y))+400),ge.renderer.resize(Pt,ht),hs.removeChildren(),li.removeChildren(),ee.splice(0,ee.length),me.splice(0,me.length),Ki(),Zi(),at(),ie(R.current,!0),wr(),re(R.current,!0),se.y=yt.position.y,se.x=0,vs(),console.log("[Transition] Tutorial complete. Main board activated (levels 1-100, starting at 30).")}const tr=[],Ge=new Set,fs=new Set;let es=null;function cc(){if(!es||document.querySelector(".modal-backdrop"))return;const s=es;es=null,Ar({level:R.current,game:s,completed:!1})}function xt(s){if(!et(P.day))return!1;const t=P.day,e=[],i=fs.has(s);i&&fs.delete(s);const n=mt(t);if(n&&n.popups&&n.popups[s]){const o=n.popups[s];(Array.isArray(o)?o:[o]).forEach(l=>{const c=`${t}:${s}:${l}`;if(i){e.push(l);return}Ge.has(c)||(Ge.add(c),e.push(l))})}return tr.filter(o=>o.day===t&&o.phase===s).forEach(o=>e.push(o.html)),e.length===0?!1:e.length===1?(ks("Info",e[0]),!0):($m(e),!0)}function $m(s){D();let t=0;const e=document.createElement("div");e.className="modal-backdrop";const i=document.createElement("div");i.className="modal",i.setAttribute("role","dialog");const n=et(P.day);n&&Cr(),n?(i.classList.add("tutor-modal"),e.classList.add("tutor-backdrop"),e.classList.add("tutor-backdrop"),i.innerHTML=`<div class='tutor-stage'>
        <div class='tutor-portrait-wrap'>
          <img src='${mr}' alt='Guide' class='tutor-character'/>
        </div>
        <div class='tutor-speech'>
          <div class='tutor-speech-arrow'></div>
          <div class='tutor-speech-inner'>
            <h2>Tutorial</h2>
            <div class='tutor-copy'></div>
            <div class='tutor-actions chain-actions'>
              <div class='progress-indicator'></div>
              <div class='nav-btns'>
                <button class='secondary prev-btn' type='button' style='display:none;'>Back</button>
                <button class='primary next-btn' type='button'>Next</button>
              </div>
            </div>
          </div>
        </div>
      </div>`):i.innerHTML=`<h2>Tutorial</h2>
      <div class='body multi-body'><div class='tutor-copy'></div></div>
      <div class='modal-footer' style='display:flex;justify-content:space-between;align-items:center;width:100%;'>
        <div class='progress-indicator' style='font-size:12px;font-weight:600;letter-spacing:.5px;opacity:.75;'></div>
        <div style='display:flex;gap:8px;'>
          <button class='secondary prev-btn' type='button' style='display:none;'>Back</button>
          <button class='primary next-btn' type='button'>Next</button>
        </div>
      </div>`,e.addEventListener("click",()=>{}),e.appendChild(i),document.body.appendChild(e),document.body.classList.add("modal-open");const r=i.querySelector(".tutor-copy"),o=i.querySelector(".next-btn"),a=i.querySelector(".prev-btn"),l=i.querySelector(".progress-indicator");function c(){if(r)r.innerHTML=s[t];else{const h=i.querySelector(".multi-body");h&&(h.innerHTML=s[t])}l&&(l.textContent=`Step ${t+1} / ${s.length}`),a&&(a.style.display=t>0?"inline-block":"none"),o&&(o.textContent=t===s.length-1?"Finish":"Next")}o==null||o.addEventListener("click",()=>{t<s.length-1?(t++,c()):D()}),a==null||a.addEventListener("click",()=>{t>0&&(t--,c())}),c()}let ci=!1;function Kt(){if(ti)return;const s=mt(P.day),t=s&&s.reward.kind==="minigame"&&s.reward.minigame;if(!P.rollUsed||t&&!ci)return;if(cs&&!Yt&&!document.querySelector(".modal-backdrop")){tt>=120&&(tt-=120,ai(),Ss()),Yt=!0,cs=!1,Nt()&&!Ht&&(Ht=!0,_r()),ei();return}const e=document.querySelector(".dice-roll-btn");if(e&&e.parentElement&&e.style.display!=="none"){e.style.display="none";const i=e.parentElement;let n=i.querySelector(".inline-next-day-btn");n||(n=document.createElement("button"),n.type="button",n.className="inline-next-day-btn",n.textContent="Next Day",Object.assign(n.style,{width:"140px",height:"72px",background:"#ff9f43",border:"4px solid #ffcf9a",borderRadius:"18px",fontWeight:"800",fontSize:"18px",cursor:"pointer",color:"#111",boxShadow:"0 4px 10px rgba(0,0,0,0.45)"}),n.addEventListener("click",()=>{Mr()}),i.appendChild(n))}}const Wm=ye;ye=function(){Wm(),Kt()};let Lt=!1,Vs=!1;function la(){return!!document.querySelector(".modal-backdrop")}function Wi(){if(Lt)return;Lt=!0,Nt()&&(Qo++,Qp(Qo));const s=document.querySelector(".prize-star-progress");s&&(s.classList.add("ps-progress-activating"),s.animate([{boxShadow:"0 0 0 0 rgba(255,159,67,0.0)"},{boxShadow:"0 0 14px 4px rgba(255,159,67,0.85)"},{boxShadow:"0 0 0 0 rgba(255,159,67,0.0)"}],{duration:1400,easing:"ease"})),Nm()}function Nm(){D();const s=document.createElement("div");s.className="modal-backdrop jackpot-backdrop",s.style.backdropFilter="blur(4px)",s.style.zIndex="12000";const t=document.createElement("div");t.className="modal jackpot-modal",t.style.maxWidth="640px",t.style.width="100%",t.style.zIndex="12001",t.innerHTML=`<h2 style='text-align:center;margin-bottom:8px;'>Streak Jackpot</h2>
    <p style='text-align:center;margin:0 0 18px;font-size:14px;line-height:1.5;'>Scratch 3 panels to reveal your guaranteed big reward! (Closes automatically)</p>
    <div class='scratch-grid' style='display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin:0 auto 20px;max-width:420px;'></div>
    <div class='jackpot-result' style='text-align:center;font-weight:600;font-size:16px;min-height:32px;'></div>`;const e=t.querySelector(".scratch-grid"),i=t.querySelector(".jackpot-result"),r=[...[{kind:"freePlays",amount:10,label:"10 Free Plays"},{kind:"bonus",amount:1e3,label:"£10 Bonus Money"},{kind:"cash",amount:500,label:"£5 Cash"}]],o=9;let a=0,l=null;for(let c=0;c<o;c++){const h=document.createElement("button");h.type="button",h.className="scratch-panel",Object.assign(h.style,{position:"relative",height:"90px",background:"#222",border:"2px solid #555",borderRadius:"12px",cursor:"pointer",fontWeight:"700",color:"#ffcf9a",fontSize:"15px",letterSpacing:".5px",display:"flex",alignItems:"center",justifyContent:"center"}),h.textContent="SCRATCH",h.addEventListener("click",()=>{if(h.dataset.revealed!=="1"){if(h.dataset.revealed="1",a++,l)h.textContent=l.label;else if(a<=3){const d=r.shift();h.textContent=d.label,a===3&&(l=d,Um(l,i))}else h.textContent="—";h.style.background="#333",h.style.borderColor="#ff9f43"}}),e.appendChild(h)}s.appendChild(t),document.body.appendChild(s),document.body.classList.add("modal-open")}function Um(s,t){be(s),t.innerHTML=`<p><strong>Congrats!</strong> You won ${s.label}!</p>`,te=0,ue=0,Ct(),rt(),Lt=!1,De.level<ot&&(De.level+=1,Hl(),Ji());try{const e=document.querySelector(".prize-star-progress");e&&(e.classList.remove("ps-level-up"),e.offsetWidth,e.classList.add("ps-level-up"),setTimeout(()=>e.classList.remove("ps-level-up"),1800))}catch{}setTimeout(()=>{D(),Kt()},1400)}let er=!1;function ei(){var o,a;if(Tr(),er||document.querySelector(".modal-backdrop"))return;D(),tt>=120&&(tt-=120,Ct(),rt()),er=!0,Yt=!0,cs=!1;const s=document.createElement("div");s.className="modal-backdrop dual-choice-backdrop";const t=document.createElement("div");t.className="dual-choice-wrap",t.innerHTML=`
    <div class='dual-choice-header'>
      <h1>Milestone Unlocked!</h1>
      <p>You reached 120 Tokens. Choose ONE premium bonus game.</p>
    </div>
    <div class='dual-choice-inner'>
      <div class='choice left-choice' tabindex='0'>
        <div class='dual-choice-badges'><span class='dual-choice-badge'>Guaranteed Win</span><span class='dual-choice-badge'>High Value</span></div>
        <h2>Scratch Jackpot</h2>
        <p>Scratch 3 premium panels. One high-tier reward is yours—no duds.</p>
        <button type='button' class='primary play-left'>Play Scratch</button>
      </div>
      <div class='choice right-choice' tabindex='0'>
        <div class='dual-choice-badges'><span class='dual-choice-badge'>Tension Build</span><span class='dual-choice-badge'>Big Range</span></div>
        <h2>Mega Box Pick</h2>
        <p>Keep one box, eliminate the rest, then decide: stay or switch at the end.</p>
        <button type='button' class='primary play-right'>Play Mega Box</button>
      </div>
    </div>`,s.appendChild(t),document.body.appendChild(s),document.body.classList.add("modal-open");const e=()=>{D(),hc()},i=()=>{D(),Pr()};(o=t.querySelector(".play-left"))==null||o.addEventListener("click",e),(a=t.querySelector(".play-right"))==null||a.addEventListener("click",i);const n=t.querySelector(".left-choice"),r=t.querySelector(".right-choice");n&&n.addEventListener("keydown",l=>{const c=l.key||l.code;(c==="Enter"||c===" ")&&(l.preventDefault(),e())}),r&&r.addEventListener("keydown",l=>{const c=l.key||l.code;(c==="Enter"||c===" ")&&(l.preventDefault(),i())}),n==null||n.focus()}function Tr(){let s=document.getElementById("dual-choice-styles");s||(s=document.createElement("style"),s.id="dual-choice-styles",document.head.appendChild(s)),s.textContent=`
  .dual-choice-backdrop{backdrop-filter:blur(6px);}
  .dual-choice-wrap{width:100%;max-width:1000px;display:flex;flex-direction:column;align-items:stretch;padding:28px 26px 34px;gap:26px;}
  .dual-choice-header{text-align:center;}
  .dual-choice-header h1{margin:0 0 8px;font-size:30px;background:linear-gradient(90deg,#ffb25b,#ff6d3b);-webkit-background-clip:text;color:transparent;letter-spacing:1px;font-weight:800;}
  .dual-choice-header p{margin:0;font-size:15px;opacity:.85;letter-spacing:.5px;}
  .dual-choice-inner{display:flex;gap:34px;flex-wrap:wrap;justify-content:center;width:100%;}
  .dual-choice-inner .choice{position:relative;flex:1 1 360px;max-width:440px;background:linear-gradient(155deg,#111b23,#0c1217 60%,#181f26);border:2px solid rgba(255,159,67,0.65);border-radius:26px;padding:26px 28px 28px;display:flex;flex-direction:column;gap:14px;box-shadow:0 18px 40px -14px rgba(0,0,0,0.75),0 0 0 1px rgba(255,159,67,0.15);overflow:hidden;}
  .dual-choice-inner .choice:before{content:'';position:absolute;inset:0;background:radial-gradient(circle at 28% 18%,rgba(255,159,67,0.18),transparent 60%);pointer-events:none;}
  .dual-choice-inner .choice h2{margin:0 0 4px;font-size:24px;letter-spacing:.5px;}
  .dual-choice-inner .choice p{margin:0 0 10px;font-size:15px;line-height:1.55;opacity:.9;}
  .dual-choice-inner .choice button{align-self:flex-start;transition:transform .18s ease,background .2s;}
  .dual-choice-inner .choice:hover{border-color:#ffbc6e;box-shadow:0 18px 42px -14px rgba(0,0,0,0.8),0 0 0 1px rgba(255,188,110,0.35);}
  .dual-choice-inner .choice:hover button{transform:translateY(-2px);}
  .dual-choice-badges{display:flex;gap:10px;flex-wrap:wrap;}
  .dual-choice-badge{background:#1f2d36;padding:4px 10px;border-radius:30px;font-size:11px;letter-spacing:.7px;font-weight:600;text-transform:uppercase;border:1px solid #314149;color:#ffb56a;}
  @media(max-width:760px){ .dual-choice-inner{flex-direction:column;} .dual-choice-header h1{font-size:24px;} }
  .special-scratch{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;max-width:420px;margin:0 auto 20px;}
  .special-scratch button{position:relative;height:90px;background:#222;border:2px solid #555;border-radius:14px;cursor:pointer;font-weight:700;color:#ffcf9a;font-size:15px;letter-spacing:.5px;display:flex;align-items:center;justify-content:center;transition:background .2s,border-color .2s,transform .18s;}
  .special-scratch button:not(.revealed):hover{background:#2b2b2b;transform:translateY(-3px);} 
  .special-scratch button.revealed{background:#333;border-color:#ff9f43;}
  .mega-box-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:12px;max-width:640px;margin:0 auto 16px;}
  .mega-box-grid button{height:86px;background:#1b2228;border:2px solid #3a4550;border-radius:12px;color:#fff;font-weight:600;cursor:pointer;letter-spacing:.5px;font-size:14px;position:relative;transition:background .18s,border-color .18s,transform .18s;}
  .mega-box-grid button:not(.opened):hover{background:#25323a;transform:translateY(-3px);} 
  .mega-box-grid button.kept{outline:3px solid #ff9f43;}
  .mega-box-grid button.eliminated{background:#101417;border-color:#222;color:#555;}
  .mega-box-grid button.final{animation:pulseFinal 1.4s ease-in-out infinite alternate;}
  @keyframes pulseFinal{0%{box-shadow:0 0 0 0 rgba(255,159,67,0.4);}100%{box-shadow:0 0 0 6px rgba(255,159,67,0.0);} }
  .mega-status{min-height:52px;text-align:center;font-size:15px;font-weight:600;letter-spacing:.5px;}
  .mega-decisions{display:flex;justify-content:center;gap:18px;margin:6px 0 10px;}
  .mega-decisions button{min-width:140px;}
  .mega-close-row{display:flex;justify-content:center;margin-top:8px;}
  .mega-close-row button{min-width:160px;}
  `}function hc(){Tr(),D();const s=document.createElement("div");s.className="modal-backdrop";const t=document.createElement("div");t.className="modal",t.style.maxWidth="680px",t.innerHTML=`<h2 style='text-align:center;margin:0 0 10px;'>Grand Scratch Bonus</h2>
    <p style='text-align:center;margin:0 0 16px;font-size:14px;'>Scratch any 3 panels. One of the displayed rewards will be yours!</p>
    <div class='special-scratch'></div>
    <div class='jackpot-result' style='text-align:center;font-weight:600;font-size:16px;min-height:34px;'></div>
    <div class='modal-footer' style='justify-content:center;'><button class='primary close-special' type='button' disabled>Close</button></div>`;const e=t.querySelector(".special-scratch"),i=t.querySelector(".jackpot-result"),n=t.querySelector(".close-special"),r=[{kind:"freePlays",amount:15,label:"15 Free Plays"},{kind:"bonus",amount:1500,label:"£15 Bonus Money"},{kind:"cash",amount:1e3,label:"£10 Cash"}];let o=0,a=null;for(let l=0;l<9;l++){const c=document.createElement("button");c.type="button",c.textContent="SCRATCH",c.addEventListener("click",()=>{if(!c.classList.contains("revealed"))if(o++,o<=3){const h=r[o-1];c.textContent=h.label,a=h,c.classList.add("revealed"),o===3&&a&&(be(a),i.innerHTML=`<p><strong>You won ${a.label}!</strong></p>`,n.disabled=!1)}else c.textContent="—",c.classList.add("revealed")}),e.appendChild(c)}s.appendChild(t),document.body.appendChild(s),document.body.classList.add("modal-open"),n.addEventListener("click",()=>{n.disabled||D()})}function Pr(){Tr(),D();const s=document.createElement("div");s.className="modal-backdrop";const t=document.createElement("div");t.className="modal",t.style.maxWidth="860px",t.innerHTML=`<button class='close-x' aria-label='Close' style='position:absolute;top:10px;right:10px;background:#222;border:1px solid #444;color:#fff;border-radius:50%;width:34px;height:34px;font-size:16px;cursor:pointer;'>&times;</button>
    <h2 style='text-align:center;margin:0 0 10px;'>Mega Box Pick</h2>
    <p style='text-align:center;margin:0 0 14px;font-size:14px;'>Pick a box to keep. Eliminate the rest. When only one other box remains, decide to <strong>Keep</strong> or <strong>Switch</strong>. The unchosen final box will always be Nothing.</p>
    <div class='mega-box-grid'></div>
    <div class='mega-status'></div>
    <div class='mega-decisions' style='display:none;'>
      <button type='button' class='primary keep-choice' disabled>Keep My Box</button>
      <button type='button' class='secondary switch-choice' disabled>Switch Boxes</button>
    </div>
    <div class='mega-close-row' style='display:none;'>
      <button type='button' class='primary close-mega'>Close</button>
    </div>`;const e=t.querySelector(".mega-box-grid"),i=t.querySelector(".mega-status"),n=t.querySelector(".keep-choice"),r=t.querySelector(".switch-choice"),o=t.querySelector(".mega-decisions"),a=t.querySelector(".mega-close-row"),l=t.querySelector(".close-x"),c=t.querySelector(".close-mega");l.addEventListener("click",D),c.addEventListener("click",D);const h=[{kind:"cash",amount:2e3,label:"£20 Cash"},{kind:"bonus",amount:2500,label:"£25 Bonus"},{kind:"freePlays",amount:20,label:"20 Free Plays"},{kind:"cash",amount:1e3,label:"£10 Cash"},{kind:"bonus",amount:1500,label:"£15 Bonus"},{kind:"freePlays",amount:10,label:"10 Free Plays"},{kind:"tokens",amount:200,label:"200 Tokens"},{kind:"bonus",amount:500,label:"£5 Bonus"},{kind:"cash",amount:500,label:"£5 Cash"},{kind:"freePlays",amount:5,label:"5 Free Plays"},{kind:"tokens",amount:100,label:"100 Tokens"},{kind:"bonus",amount:1e3,label:"£10 Bonus"}];for(let g=h.length-1;g>0;g--){const y=Math.floor(Math.random()*(g+1));[h[g],h[y]]=[h[y],h[g]]}const d=h.map((g,y)=>{const b=document.createElement("button");return b.type="button",b.textContent=String(y+1),e.appendChild(b),{idx:y,reward:g,el:b}});let u=null,f=null,m=!1;function x(g){i.innerHTML=`<p>${g}</p>`}x("Select a box to keep."),d.forEach(g=>{g.el.addEventListener("click",()=>{if(m)return;if(!u){u=g,g.kept=!0,g.el.classList.add("kept"),x("Now open every other box.");return}if(g===u||g.opened)return;g.opened=!0,g.el.classList.add("eliminated"),g.el.textContent=g.reward.label,g.el.classList.add("opened");const y=d.filter(b=>!b.opened&&b!==u);y.length===1&&(f=y[0],f.el.classList.add("final"),u.el.classList.add("final"),x("Final decision: Keep your box or Switch?"),o.style.display="flex",n.disabled=!1,r.disabled=!1,n.focus())})});function p(g,y){m||(m=!0,be(g.reward),g.el.textContent=g.reward.label+" (Won)",y.el.textContent="Nothing",y.el.classList.add("eliminated"),d.forEach(b=>b.el.classList.remove("kept")),g.el.classList.add("kept"),y.el.classList.remove("kept"),x(`<strong>You won ${g.reward.label}!</strong>`),o.style.display="none",a.style.display="flex",c.focus())}n.addEventListener("click",()=>{!u||!f||p(u,f)}),r.addEventListener("click",()=>{!u||!f||p(f,u)}),s.appendChild(t),document.body.appendChild(s),document.body.classList.add("modal-open")}function Hm(s){if(!et(P.day))return;const t=mt(P.day);if(!t)return;const e=`tutorialRewardApplied_${t.day}`;window[e]||(jm(t),window[e]=!0,t.reward.kind==="minigame"&&t.reward.minigame&&(es=t.reward.minigame,setTimeout(()=>{cc()},450)))}function jm(s){const t=s.reward;switch(t.kind){case"tokens":t.amount&&$e(t.amount);break;case"prize":{t.amount?he(t.amount):t.prizeId&&he(1);break}case"freePlays":t.amount&&he(t.amount);break;case"streak_boost":t.amount&&qi(Math.min(5,t.amount));break;case"nothing":default:break;case"minigame":break}}export{nh as $,il as A,gt as B,it as C,j as D,I as E,Ta as F,Ui as G,qr as H,rs as I,Mh as J,zh as K,si as L,G as M,Q as N,X as O,ut as P,td as Q,Nn as R,vd as S,bi as T,Gn as U,Kr as V,cn as W,Zr as X,oh as Y,is as Z,st as _,Bt as a,ka as a0,nl as a1,z as a2,N as a3,rd as a4,Ld as a5,Ad as a6,Zd as a7,Qd as a8,nu as a9,ou as aa,au as ab,bl as ac,uo as ad,co as ae,Do as af,Wt as ag,hf as ah,Y as ai,Fe as aj,Mc as ak,Re as al,Vo as am,vl as an,Zs as b,Li as c,rr as d,dt as e,ho as f,bd as g,tl as h,Fa as i,Rt as j,Xa as k,Qs as l,Kd as m,Jd as n,su as o,ru as p,or as q,Wc as r,O as s,ja as t,Cc as u,cu as v,V as w,At as x,wa as y,It as z};
