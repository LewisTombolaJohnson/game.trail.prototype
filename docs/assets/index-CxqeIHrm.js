const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/browserAll-CHiPWuQL.js","assets/webworkerAll-Bz2et34V.js","assets/colorToUniform-DmtBy-2V.js","assets/WebGPURenderer-BLR9bTDW.js","assets/SharedSystems-DepYFOQD.js","assets/WebGLRenderer-BrXLOcNk.js"])))=>i.map(i=>d[i]);
(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function e(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(n){if(n.ep)return;n.ep=!0;const r=e(n);fetch(n.href,r)}})();const Ul="modulepreload",Hl=function(s){return"/game.trail.prototype/"+s},gr={},bi=function(t,e,i){let n=Promise.resolve();if(e&&e.length>0){document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),a=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));n=Promise.allSettled(e.map(l=>{if(l=Hl(l),l in gr)return;gr[l]=!0;const c=l.endsWith(".css"),h=c?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${h}`))return;const d=document.createElement("link");if(d.rel=c?"stylesheet":Ul,c||(d.as="script"),d.crossOrigin="",d.href=l,a&&d.setAttribute("nonce",a),document.head.appendChild(d),c)return new Promise((f,u)=>{d.addEventListener("load",f),d.addEventListener("error",()=>u(new Error(`Unable to preload CSS for ${l}`)))})}))}function r(o){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=o,window.dispatchEvent(a),!a.defaultPrevented)throw o}return n.then(o=>{for(const a of o||[])a.status==="rejected"&&r(a.reason);return t().catch(r)})};var E=(s=>(s.Application="application",s.WebGLPipes="webgl-pipes",s.WebGLPipesAdaptor="webgl-pipes-adaptor",s.WebGLSystem="webgl-system",s.WebGPUPipes="webgpu-pipes",s.WebGPUPipesAdaptor="webgpu-pipes-adaptor",s.WebGPUSystem="webgpu-system",s.CanvasSystem="canvas-system",s.CanvasPipesAdaptor="canvas-pipes-adaptor",s.CanvasPipes="canvas-pipes",s.Asset="asset",s.LoadParser="load-parser",s.ResolveParser="resolve-parser",s.CacheParser="cache-parser",s.DetectionParser="detection-parser",s.MaskEffect="mask-effect",s.BlendMode="blend-mode",s.TextureSource="texture-source",s.Environment="environment",s.ShapeBuilder="shape-builder",s.Batcher="batcher",s))(E||{});const xn=s=>{if(typeof s=="function"||typeof s=="object"&&s.extension){if(!s.extension)throw new Error("Extension class must have an extension object");s={...typeof s.extension!="object"?{type:s.extension}:s.extension,ref:s}}if(typeof s=="object")s={...s};else throw new Error("Invalid extension type");return typeof s.type=="string"&&(s.type=[s.type]),s},Js=(s,t)=>xn(s).priority??t,st={_addHandlers:{},_removeHandlers:{},_queue:{},remove(...s){return s.map(xn).forEach(t=>{t.type.forEach(e=>{var i,n;return(n=(i=this._removeHandlers)[e])==null?void 0:n.call(i,t)})}),this},add(...s){return s.map(xn).forEach(t=>{t.type.forEach(e=>{var r,o;const i=this._addHandlers,n=this._queue;i[e]?(o=i[e])==null||o.call(i,t):(n[e]=n[e]||[],(r=n[e])==null||r.push(t))})}),this},handle(s,t,e){var o;const i=this._addHandlers,n=this._removeHandlers;if(i[s]||n[s])throw new Error(`Extension type ${s} already has a handler`);i[s]=t,n[s]=e;const r=this._queue;return r[s]&&((o=r[s])==null||o.forEach(a=>t(a)),delete r[s]),this},handleByMap(s,t){return this.handle(s,e=>{e.name&&(t[e.name]=e.ref)},e=>{e.name&&delete t[e.name]})},handleByNamedList(s,t,e=-1){return this.handle(s,i=>{t.findIndex(r=>r.name===i.name)>=0||(t.push({name:i.name,value:i.ref}),t.sort((r,o)=>Js(o.value,e)-Js(r.value,e)))},i=>{const n=t.findIndex(r=>r.name===i.name);n!==-1&&t.splice(n,1)})},handleByList(s,t,e=-1){return this.handle(s,i=>{t.includes(i.ref)||(t.push(i.ref),t.sort((n,r)=>Js(r,e)-Js(n,e)))},i=>{const n=t.indexOf(i.ref);n!==-1&&t.splice(n,1)})},mixin(s,...t){for(const e of t)Object.defineProperties(s.prototype,Object.getOwnPropertyDescriptors(e))}},Yl={extension:{type:E.Environment,name:"browser",priority:-1},test:()=>!0,load:async()=>{await bi(()=>import("./browserAll-CHiPWuQL.js"),__vite__mapDeps([0,1,2]))}},Vl={extension:{type:E.Environment,name:"webworker",priority:0},test:()=>typeof self<"u"&&self.WorkerGlobalScope!==void 0,load:async()=>{await bi(()=>import("./webworkerAll-Bz2et34V.js"),__vite__mapDeps([1,2]))}};class tt{constructor(t,e,i){this._x=e||0,this._y=i||0,this._observer=t}clone(t){return new tt(t??this._observer,this._x,this._y)}set(t=0,e=t){return(this._x!==t||this._y!==e)&&(this._x=t,this._y=e,this._observer._onUpdate(this)),this}copyFrom(t){return(this._x!==t.x||this._y!==t.y)&&(this._x=t.x,this._y=t.y,this._observer._onUpdate(this)),this}copyTo(t){return t.set(this._x,this._y),t}equals(t){return t.x===this._x&&t.y===this._y}toString(){return`[pixi.js/math:ObservablePoint x=${this._x} y=${this._y} scope=${this._observer}]`}get x(){return this._x}set x(t){this._x!==t&&(this._x=t,this._observer._onUpdate(this))}get y(){return this._y}set y(t){this._y!==t&&(this._y=t,this._observer._onUpdate(this))}}function No(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var Uo={exports:{}};(function(s){var t=Object.prototype.hasOwnProperty,e="~";function i(){}Object.create&&(i.prototype=Object.create(null),new i().__proto__||(e=!1));function n(l,c,h){this.fn=l,this.context=c,this.once=h||!1}function r(l,c,h,d,f){if(typeof h!="function")throw new TypeError("The listener must be a function");var u=new n(h,d||l,f),m=e?e+c:c;return l._events[m]?l._events[m].fn?l._events[m]=[l._events[m],u]:l._events[m].push(u):(l._events[m]=u,l._eventsCount++),l}function o(l,c){--l._eventsCount===0?l._events=new i:delete l._events[c]}function a(){this._events=new i,this._eventsCount=0}a.prototype.eventNames=function(){var c=[],h,d;if(this._eventsCount===0)return c;for(d in h=this._events)t.call(h,d)&&c.push(e?d.slice(1):d);return Object.getOwnPropertySymbols?c.concat(Object.getOwnPropertySymbols(h)):c},a.prototype.listeners=function(c){var h=e?e+c:c,d=this._events[h];if(!d)return[];if(d.fn)return[d.fn];for(var f=0,u=d.length,m=new Array(u);f<u;f++)m[f]=d[f].fn;return m},a.prototype.listenerCount=function(c){var h=e?e+c:c,d=this._events[h];return d?d.fn?1:d.length:0},a.prototype.emit=function(c,h,d,f,u,m){var y=e?e+c:c;if(!this._events[y])return!1;var p=this._events[y],g=arguments.length,x,b;if(p.fn){switch(p.once&&this.removeListener(c,p.fn,void 0,!0),g){case 1:return p.fn.call(p.context),!0;case 2:return p.fn.call(p.context,h),!0;case 3:return p.fn.call(p.context,h,d),!0;case 4:return p.fn.call(p.context,h,d,f),!0;case 5:return p.fn.call(p.context,h,d,f,u),!0;case 6:return p.fn.call(p.context,h,d,f,u,m),!0}for(b=1,x=new Array(g-1);b<g;b++)x[b-1]=arguments[b];p.fn.apply(p.context,x)}else{var _=p.length,S;for(b=0;b<_;b++)switch(p[b].once&&this.removeListener(c,p[b].fn,void 0,!0),g){case 1:p[b].fn.call(p[b].context);break;case 2:p[b].fn.call(p[b].context,h);break;case 3:p[b].fn.call(p[b].context,h,d);break;case 4:p[b].fn.call(p[b].context,h,d,f);break;default:if(!x)for(S=1,x=new Array(g-1);S<g;S++)x[S-1]=arguments[S];p[b].fn.apply(p[b].context,x)}}return!0},a.prototype.on=function(c,h,d){return r(this,c,h,d,!1)},a.prototype.once=function(c,h,d){return r(this,c,h,d,!0)},a.prototype.removeListener=function(c,h,d,f){var u=e?e+c:c;if(!this._events[u])return this;if(!h)return o(this,u),this;var m=this._events[u];if(m.fn)m.fn===h&&(!f||m.once)&&(!d||m.context===d)&&o(this,u);else{for(var y=0,p=[],g=m.length;y<g;y++)(m[y].fn!==h||f&&!m[y].once||d&&m[y].context!==d)&&p.push(m[y]);p.length?this._events[u]=p.length===1?p[0]:p:o(this,u)}return this},a.prototype.removeAllListeners=function(c){var h;return c?(h=e?e+c:c,this._events[h]&&o(this,h)):(this._events=new i,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=e,a.EventEmitter=a,s.exports=a})(Uo);var jl=Uo.exports;const Rt=No(jl),Xl=Math.PI*2,ql=180/Math.PI,Kl=Math.PI/180;class rt{constructor(t=0,e=0){this.x=0,this.y=0,this.x=t,this.y=e}clone(){return new rt(this.x,this.y)}copyFrom(t){return this.set(t.x,t.y),this}copyTo(t){return t.set(this.x,this.y),t}equals(t){return t.x===this.x&&t.y===this.y}set(t=0,e=t){return this.x=t,this.y=e,this}toString(){return`[pixi.js/math:Point x=${this.x} y=${this.y}]`}static get shared(){return Ni.x=0,Ni.y=0,Ni}}const Ni=new rt;class G{constructor(t=1,e=0,i=0,n=1,r=0,o=0){this.array=null,this.a=t,this.b=e,this.c=i,this.d=n,this.tx=r,this.ty=o}fromArray(t){this.a=t[0],this.b=t[1],this.c=t[3],this.d=t[4],this.tx=t[2],this.ty=t[5]}set(t,e,i,n,r,o){return this.a=t,this.b=e,this.c=i,this.d=n,this.tx=r,this.ty=o,this}toArray(t,e){this.array||(this.array=new Float32Array(9));const i=e||this.array;return t?(i[0]=this.a,i[1]=this.b,i[2]=0,i[3]=this.c,i[4]=this.d,i[5]=0,i[6]=this.tx,i[7]=this.ty,i[8]=1):(i[0]=this.a,i[1]=this.c,i[2]=this.tx,i[3]=this.b,i[4]=this.d,i[5]=this.ty,i[6]=0,i[7]=0,i[8]=1),i}apply(t,e){e=e||new rt;const i=t.x,n=t.y;return e.x=this.a*i+this.c*n+this.tx,e.y=this.b*i+this.d*n+this.ty,e}applyInverse(t,e){e=e||new rt;const i=this.a,n=this.b,r=this.c,o=this.d,a=this.tx,l=this.ty,c=1/(i*o+r*-n),h=t.x,d=t.y;return e.x=o*c*h+-r*c*d+(l*r-a*o)*c,e.y=i*c*d+-n*c*h+(-l*i+a*n)*c,e}translate(t,e){return this.tx+=t,this.ty+=e,this}scale(t,e){return this.a*=t,this.d*=e,this.c*=t,this.b*=e,this.tx*=t,this.ty*=e,this}rotate(t){const e=Math.cos(t),i=Math.sin(t),n=this.a,r=this.c,o=this.tx;return this.a=n*e-this.b*i,this.b=n*i+this.b*e,this.c=r*e-this.d*i,this.d=r*i+this.d*e,this.tx=o*e-this.ty*i,this.ty=o*i+this.ty*e,this}append(t){const e=this.a,i=this.b,n=this.c,r=this.d;return this.a=t.a*e+t.b*n,this.b=t.a*i+t.b*r,this.c=t.c*e+t.d*n,this.d=t.c*i+t.d*r,this.tx=t.tx*e+t.ty*n+this.tx,this.ty=t.tx*i+t.ty*r+this.ty,this}appendFrom(t,e){const i=t.a,n=t.b,r=t.c,o=t.d,a=t.tx,l=t.ty,c=e.a,h=e.b,d=e.c,f=e.d;return this.a=i*c+n*d,this.b=i*h+n*f,this.c=r*c+o*d,this.d=r*h+o*f,this.tx=a*c+l*d+e.tx,this.ty=a*h+l*f+e.ty,this}setTransform(t,e,i,n,r,o,a,l,c){return this.a=Math.cos(a+c)*r,this.b=Math.sin(a+c)*r,this.c=-Math.sin(a-l)*o,this.d=Math.cos(a-l)*o,this.tx=t-(i*this.a+n*this.c),this.ty=e-(i*this.b+n*this.d),this}prepend(t){const e=this.tx;if(t.a!==1||t.b!==0||t.c!==0||t.d!==1){const i=this.a,n=this.c;this.a=i*t.a+this.b*t.c,this.b=i*t.b+this.b*t.d,this.c=n*t.a+this.d*t.c,this.d=n*t.b+this.d*t.d}return this.tx=e*t.a+this.ty*t.c+t.tx,this.ty=e*t.b+this.ty*t.d+t.ty,this}decompose(t){const e=this.a,i=this.b,n=this.c,r=this.d,o=t.pivot,a=-Math.atan2(-n,r),l=Math.atan2(i,e),c=Math.abs(a+l);return c<1e-5||Math.abs(Xl-c)<1e-5?(t.rotation=l,t.skew.x=t.skew.y=0):(t.rotation=0,t.skew.x=a,t.skew.y=l),t.scale.x=Math.sqrt(e*e+i*i),t.scale.y=Math.sqrt(n*n+r*r),t.position.x=this.tx+(o.x*e+o.y*n),t.position.y=this.ty+(o.x*i+o.y*r),t}invert(){const t=this.a,e=this.b,i=this.c,n=this.d,r=this.tx,o=t*n-e*i;return this.a=n/o,this.b=-e/o,this.c=-i/o,this.d=t/o,this.tx=(i*this.ty-n*r)/o,this.ty=-(t*this.ty-e*r)/o,this}isIdentity(){return this.a===1&&this.b===0&&this.c===0&&this.d===1&&this.tx===0&&this.ty===0}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this}clone(){const t=new G;return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyTo(t){return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyFrom(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this}equals(t){return t.a===this.a&&t.b===this.b&&t.c===this.c&&t.d===this.d&&t.tx===this.tx&&t.ty===this.ty}toString(){return`[pixi.js:Matrix a=${this.a} b=${this.b} c=${this.c} d=${this.d} tx=${this.tx} ty=${this.ty}]`}static get IDENTITY(){return Ql.identity()}static get shared(){return Zl.identity()}}const Zl=new G,Ql=new G,ge=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],ye=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],xe=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],be=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],bn=[],Ho=[],ti=Math.sign;function Jl(){for(let s=0;s<16;s++){const t=[];bn.push(t);for(let e=0;e<16;e++){const i=ti(ge[s]*ge[e]+xe[s]*ye[e]),n=ti(ye[s]*ge[e]+be[s]*ye[e]),r=ti(ge[s]*xe[e]+xe[s]*be[e]),o=ti(ye[s]*xe[e]+be[s]*be[e]);for(let a=0;a<16;a++)if(ge[a]===i&&ye[a]===n&&xe[a]===r&&be[a]===o){t.push(a);break}}}for(let s=0;s<16;s++){const t=new G;t.set(ge[s],ye[s],xe[s],be[s],0,0),Ho.push(t)}}Jl();const U={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:s=>ge[s],uY:s=>ye[s],vX:s=>xe[s],vY:s=>be[s],inv:s=>s&8?s&15:-s&7,add:(s,t)=>bn[s][t],sub:(s,t)=>bn[s][U.inv(t)],rotate180:s=>s^4,isVertical:s=>(s&3)===2,byDirection:(s,t)=>Math.abs(s)*2<=Math.abs(t)?t>=0?U.S:U.N:Math.abs(t)*2<=Math.abs(s)?s>0?U.E:U.W:t>0?s>0?U.SE:U.SW:s>0?U.NE:U.NW,matrixAppendRotationInv:(s,t,e=0,i=0)=>{const n=Ho[U.inv(t)];n.tx=e,n.ty=i,s.append(n)},transformRectCoords:(s,t,e,i)=>{const{x:n,y:r,width:o,height:a}=s,{x:l,y:c,width:h,height:d}=t;return e===U.E?(i.set(n+l,r+c,o,a),i):e===U.S?i.set(h-r-a+l,n+c,a,o):e===U.W?i.set(h-n-o+l,d-r-a+c,o,a):e===U.N?i.set(r+l,d-n-o+c,a,o):i.set(n+l,r+c,o,a)}},ei=[new rt,new rt,new rt,new rt];class j{constructor(t=0,e=0,i=0,n=0){this.type="rectangle",this.x=Number(t),this.y=Number(e),this.width=Number(i),this.height=Number(n)}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}isEmpty(){return this.left===this.right||this.top===this.bottom}static get EMPTY(){return new j(0,0,0,0)}clone(){return new j(this.x,this.y,this.width,this.height)}copyFromBounds(t){return this.x=t.minX,this.y=t.minY,this.width=t.maxX-t.minX,this.height=t.maxY-t.minY,this}copyFrom(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this}copyTo(t){return t.copyFrom(this),t}contains(t,e){return this.width<=0||this.height<=0?!1:t>=this.x&&t<this.x+this.width&&e>=this.y&&e<this.y+this.height}strokeContains(t,e,i,n=.5){const{width:r,height:o}=this;if(r<=0||o<=0)return!1;const a=this.x,l=this.y,c=i*(1-n),h=i-c,d=a-c,f=a+r+c,u=l-c,m=l+o+c,y=a+h,p=a+r-h,g=l+h,x=l+o-h;return t>=d&&t<=f&&e>=u&&e<=m&&!(t>y&&t<p&&e>g&&e<x)}intersects(t,e){if(!e){const C=this.x<t.x?t.x:this.x;if((this.right>t.right?t.right:this.right)<=C)return!1;const k=this.y<t.y?t.y:this.y;return(this.bottom>t.bottom?t.bottom:this.bottom)>k}const i=this.left,n=this.right,r=this.top,o=this.bottom;if(n<=i||o<=r)return!1;const a=ei[0].set(t.left,t.top),l=ei[1].set(t.left,t.bottom),c=ei[2].set(t.right,t.top),h=ei[3].set(t.right,t.bottom);if(c.x<=a.x||l.y<=a.y)return!1;const d=Math.sign(e.a*e.d-e.b*e.c);if(d===0||(e.apply(a,a),e.apply(l,l),e.apply(c,c),e.apply(h,h),Math.max(a.x,l.x,c.x,h.x)<=i||Math.min(a.x,l.x,c.x,h.x)>=n||Math.max(a.y,l.y,c.y,h.y)<=r||Math.min(a.y,l.y,c.y,h.y)>=o))return!1;const f=d*(l.y-a.y),u=d*(a.x-l.x),m=f*i+u*r,y=f*n+u*r,p=f*i+u*o,g=f*n+u*o;if(Math.max(m,y,p,g)<=f*a.x+u*a.y||Math.min(m,y,p,g)>=f*h.x+u*h.y)return!1;const x=d*(a.y-c.y),b=d*(c.x-a.x),_=x*i+b*r,S=x*n+b*r,v=x*i+b*o,w=x*n+b*o;return!(Math.max(_,S,v,w)<=x*a.x+b*a.y||Math.min(_,S,v,w)>=x*h.x+b*h.y)}pad(t=0,e=t){return this.x-=t,this.y-=e,this.width+=t*2,this.height+=e*2,this}fit(t){const e=Math.max(this.x,t.x),i=Math.min(this.x+this.width,t.x+t.width),n=Math.max(this.y,t.y),r=Math.min(this.y+this.height,t.y+t.height);return this.x=e,this.width=Math.max(i-e,0),this.y=n,this.height=Math.max(r-n,0),this}ceil(t=1,e=.001){const i=Math.ceil((this.x+this.width-e)*t)/t,n=Math.ceil((this.y+this.height-e)*t)/t;return this.x=Math.floor((this.x+e)*t)/t,this.y=Math.floor((this.y+e)*t)/t,this.width=i-this.x,this.height=n-this.y,this}scale(t,e=t){return this.x*=t,this.y*=e,this.width*=t,this.height*=e,this}enlarge(t){const e=Math.min(this.x,t.x),i=Math.max(this.x+this.width,t.x+t.width),n=Math.min(this.y,t.y),r=Math.max(this.y+this.height,t.y+t.height);return this.x=e,this.width=i-e,this.y=n,this.height=r-n,this}getBounds(t){return t||(t=new j),t.copyFrom(this),t}containsRect(t){if(this.width<=0||this.height<=0)return!1;const e=t.x,i=t.y,n=t.x+t.width,r=t.y+t.height;return e>=this.x&&e<this.x+this.width&&i>=this.y&&i<this.y+this.height&&n>=this.x&&n<this.x+this.width&&r>=this.y&&r<this.y+this.height}set(t,e,i,n){return this.x=t,this.y=e,this.width=i,this.height=n,this}toString(){return`[pixi.js/math:Rectangle x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`}}const Ui={default:-1};function K(s="default"){return Ui[s]===void 0&&(Ui[s]=-1),++Ui[s]}const yr=new Set,N="8.0.0",tc="8.3.4",Re={quiet:!1,noColor:!1},z=(s,t,e=3)=>{if(Re.quiet||yr.has(t))return;let i=new Error().stack;const n=`${t}
Deprecated since v${s}`,r=typeof console.groupCollapsed=="function"&&!Re.noColor;typeof i>"u"?console.warn("PixiJS Deprecation Warning: ",n):(i=i.split(`
`).splice(e).join(`
`),r?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",n),console.warn(i),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",n),console.warn(i))),yr.add(t)};Object.defineProperties(z,{quiet:{get:()=>Re.quiet,set:s=>{Re.quiet=s},enumerable:!0,configurable:!1},noColor:{get:()=>Re.noColor,set:s=>{Re.noColor=s},enumerable:!0,configurable:!1}});const Yo=()=>{};function $e(s){return s+=s===0?1:0,--s,s|=s>>>1,s|=s>>>2,s|=s>>>4,s|=s>>>8,s|=s>>>16,s+1}function xr(s){return!(s&s-1)&&!!s}function Vo(s){const t={};for(const e in s)s[e]!==void 0&&(t[e]=s[e]);return t}const br=Object.create(null);function ec(s){const t=br[s];return t===void 0&&(br[s]=K("resource")),t}const jo=class Xo extends Rt{constructor(t={}){super(),this._resourceType="textureSampler",this._touched=0,this._maxAnisotropy=1,this.destroyed=!1,t={...Xo.defaultOptions,...t},this.addressMode=t.addressMode,this.addressModeU=t.addressModeU??this.addressModeU,this.addressModeV=t.addressModeV??this.addressModeV,this.addressModeW=t.addressModeW??this.addressModeW,this.scaleMode=t.scaleMode,this.magFilter=t.magFilter??this.magFilter,this.minFilter=t.minFilter??this.minFilter,this.mipmapFilter=t.mipmapFilter??this.mipmapFilter,this.lodMinClamp=t.lodMinClamp,this.lodMaxClamp=t.lodMaxClamp,this.compare=t.compare,this.maxAnisotropy=t.maxAnisotropy??1}set addressMode(t){this.addressModeU=t,this.addressModeV=t,this.addressModeW=t}get addressMode(){return this.addressModeU}set wrapMode(t){z(N,"TextureStyle.wrapMode is now TextureStyle.addressMode"),this.addressMode=t}get wrapMode(){return this.addressMode}set scaleMode(t){this.magFilter=t,this.minFilter=t,this.mipmapFilter=t}get scaleMode(){return this.magFilter}set maxAnisotropy(t){this._maxAnisotropy=Math.min(t,16),this._maxAnisotropy>1&&(this.scaleMode="linear")}get maxAnisotropy(){return this._maxAnisotropy}get _resourceId(){return this._sharedResourceId||this._generateResourceId()}update(){this.emit("change",this),this._sharedResourceId=null}_generateResourceId(){const t=`${this.addressModeU}-${this.addressModeV}-${this.addressModeW}-${this.magFilter}-${this.minFilter}-${this.mipmapFilter}-${this.lodMinClamp}-${this.lodMaxClamp}-${this.compare}-${this._maxAnisotropy}`;return this._sharedResourceId=ec(t),this._resourceId}destroy(){this.destroyed=!0,this.emit("destroy",this),this.emit("change",this),this.removeAllListeners()}};jo.defaultOptions={addressMode:"clamp-to-edge",scaleMode:"linear"};let We=jo;const qo=class Ko extends Rt{constructor(t={}){super(),this.options=t,this.uid=K("textureSource"),this._resourceType="textureSource",this._resourceId=K("resource"),this.uploadMethodId="unknown",this._resolution=1,this.pixelWidth=1,this.pixelHeight=1,this.width=1,this.height=1,this.sampleCount=1,this.mipLevelCount=1,this.autoGenerateMipmaps=!1,this.format="rgba8unorm",this.dimension="2d",this.antialias=!1,this._touched=0,this._batchTick=-1,this._textureBindLocation=-1,t={...Ko.defaultOptions,...t},this.label=t.label??"",this.resource=t.resource,this.autoGarbageCollect=t.autoGarbageCollect,this._resolution=t.resolution,t.width?this.pixelWidth=t.width*this._resolution:this.pixelWidth=this.resource?this.resourceWidth??1:1,t.height?this.pixelHeight=t.height*this._resolution:this.pixelHeight=this.resource?this.resourceHeight??1:1,this.width=this.pixelWidth/this._resolution,this.height=this.pixelHeight/this._resolution,this.format=t.format,this.dimension=t.dimensions,this.mipLevelCount=t.mipLevelCount,this.autoGenerateMipmaps=t.autoGenerateMipmaps,this.sampleCount=t.sampleCount,this.antialias=t.antialias,this.alphaMode=t.alphaMode,this.style=new We(Vo(t)),this.destroyed=!1,this._refreshPOT()}get source(){return this}get style(){return this._style}set style(t){var e,i;this.style!==t&&((e=this._style)==null||e.off("change",this._onStyleChange,this),this._style=t,(i=this._style)==null||i.on("change",this._onStyleChange,this),this._onStyleChange())}set maxAnisotropy(t){this._style.maxAnisotropy=t}get maxAnisotropy(){return this._style.maxAnisotropy}get addressMode(){return this._style.addressMode}set addressMode(t){this._style.addressMode=t}get repeatMode(){return this._style.addressMode}set repeatMode(t){this._style.addressMode=t}get magFilter(){return this._style.magFilter}set magFilter(t){this._style.magFilter=t}get minFilter(){return this._style.minFilter}set minFilter(t){this._style.minFilter=t}get mipmapFilter(){return this._style.mipmapFilter}set mipmapFilter(t){this._style.mipmapFilter=t}get lodMinClamp(){return this._style.lodMinClamp}set lodMinClamp(t){this._style.lodMinClamp=t}get lodMaxClamp(){return this._style.lodMaxClamp}set lodMaxClamp(t){this._style.lodMaxClamp=t}_onStyleChange(){this.emit("styleChange",this)}update(){if(this.resource){const t=this._resolution;if(this.resize(this.resourceWidth/t,this.resourceHeight/t))return}this.emit("update",this)}destroy(){this.destroyed=!0,this.emit("destroy",this),this.emit("change",this),this._style&&(this._style.destroy(),this._style=null),this.uploadMethodId=null,this.resource=null,this.removeAllListeners()}unload(){this._resourceId=K("resource"),this.emit("change",this),this.emit("unload",this)}get resourceWidth(){const{resource:t}=this;return t.naturalWidth||t.videoWidth||t.displayWidth||t.width}get resourceHeight(){const{resource:t}=this;return t.naturalHeight||t.videoHeight||t.displayHeight||t.height}get resolution(){return this._resolution}set resolution(t){this._resolution!==t&&(this._resolution=t,this.width=this.pixelWidth/t,this.height=this.pixelHeight/t)}resize(t,e,i){i||(i=this._resolution),t||(t=this.width),e||(e=this.height);const n=Math.round(t*i),r=Math.round(e*i);return this.width=n/i,this.height=r/i,this._resolution=i,this.pixelWidth===n&&this.pixelHeight===r?!1:(this._refreshPOT(),this.pixelWidth=n,this.pixelHeight=r,this.emit("resize",this),this._resourceId=K("resource"),this.emit("change",this),!0)}updateMipmaps(){this.autoGenerateMipmaps&&this.mipLevelCount>1&&this.emit("updateMipmaps",this)}set wrapMode(t){this._style.wrapMode=t}get wrapMode(){return this._style.wrapMode}set scaleMode(t){this._style.scaleMode=t}get scaleMode(){return this._style.scaleMode}_refreshPOT(){this.isPowerOfTwo=xr(this.pixelWidth)&&xr(this.pixelHeight)}static test(t){throw new Error("Unimplemented")}};qo.defaultOptions={resolution:1,format:"bgra8unorm",alphaMode:"premultiply-alpha-on-upload",dimensions:"2d",mipLevelCount:1,autoGenerateMipmaps:!1,sampleCount:1,antialias:!1,autoGarbageCollect:!1};let Ft=qo;class Dn extends Ft{constructor(t){const e=t.resource||new Float32Array(t.width*t.height*4);let i=t.format;i||(e instanceof Float32Array?i="rgba32float":e instanceof Int32Array||e instanceof Uint32Array?i="rgba32uint":e instanceof Int16Array||e instanceof Uint16Array?i="rgba16uint":(e instanceof Int8Array,i="bgra8unorm")),super({...t,resource:e,format:i}),this.uploadMethodId="buffer"}static test(t){return t instanceof Int8Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray||t instanceof Int16Array||t instanceof Uint16Array||t instanceof Int32Array||t instanceof Uint32Array||t instanceof Float32Array}}Dn.extension=E.TextureSource;const _r=new G;class sc{constructor(t,e){this.mapCoord=new G,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,typeof e>"u"?this.clampMargin=t.width<10?0:.5:this.clampMargin=e,this.isSimple=!1,this.texture=t}get texture(){return this._texture}set texture(t){var e;this.texture!==t&&((e=this._texture)==null||e.removeListener("update",this.update,this),this._texture=t,this._texture.addListener("update",this.update,this),this.update())}multiplyUvs(t,e){e===void 0&&(e=t);const i=this.mapCoord;for(let n=0;n<t.length;n+=2){const r=t[n],o=t[n+1];e[n]=r*i.a+o*i.c+i.tx,e[n+1]=r*i.b+o*i.d+i.ty}return e}update(){const t=this._texture;this._updateID++;const e=t.uvs;this.mapCoord.set(e.x1-e.x0,e.y1-e.y0,e.x3-e.x0,e.y3-e.y0,e.x0,e.y0);const i=t.orig,n=t.trim;n&&(_r.set(i.width/n.width,0,0,i.height/n.height,-n.x/n.width,-n.y/n.height),this.mapCoord.append(_r));const r=t.source,o=this.uClampFrame,a=this.clampMargin/r._resolution,l=this.clampOffset/r._resolution;return o[0]=(t.frame.x+a+l)/r.width,o[1]=(t.frame.y+a+l)/r.height,o[2]=(t.frame.x+t.frame.width-a+l)/r.width,o[3]=(t.frame.y+t.frame.height-a+l)/r.height,this.uClampOffset[0]=this.clampOffset/r.pixelWidth,this.uClampOffset[1]=this.clampOffset/r.pixelHeight,this.isSimple=t.frame.width===r.width&&t.frame.height===r.height&&t.rotate===0,!0}}class O extends Rt{constructor({source:t,label:e,frame:i,orig:n,trim:r,defaultAnchor:o,defaultBorders:a,rotate:l,dynamic:c}={}){if(super(),this.uid=K("texture"),this.uvs={x0:0,y0:0,x1:0,y1:0,x2:0,y2:0,x3:0,y3:0},this.frame=new j,this.noFrame=!1,this.dynamic=!1,this.isTexture=!0,this.label=e,this.source=(t==null?void 0:t.source)??new Ft,this.noFrame=!i,i)this.frame.copyFrom(i);else{const{width:h,height:d}=this._source;this.frame.width=h,this.frame.height=d}this.orig=n||this.frame,this.trim=r,this.rotate=l??0,this.defaultAnchor=o,this.defaultBorders=a,this.destroyed=!1,this.dynamic=c||!1,this.updateUvs()}set source(t){this._source&&this._source.off("resize",this.update,this),this._source=t,t.on("resize",this.update,this),this.emit("update",this)}get source(){return this._source}get textureMatrix(){return this._textureMatrix||(this._textureMatrix=new sc(this)),this._textureMatrix}get width(){return this.orig.width}get height(){return this.orig.height}updateUvs(){const{uvs:t,frame:e}=this,{width:i,height:n}=this._source,r=e.x/i,o=e.y/n,a=e.width/i,l=e.height/n;let c=this.rotate;if(c){const h=a/2,d=l/2,f=r+h,u=o+d;c=U.add(c,U.NW),t.x0=f+h*U.uX(c),t.y0=u+d*U.uY(c),c=U.add(c,2),t.x1=f+h*U.uX(c),t.y1=u+d*U.uY(c),c=U.add(c,2),t.x2=f+h*U.uX(c),t.y2=u+d*U.uY(c),c=U.add(c,2),t.x3=f+h*U.uX(c),t.y3=u+d*U.uY(c)}else t.x0=r,t.y0=o,t.x1=r+a,t.y1=o,t.x2=r+a,t.y2=o+l,t.x3=r,t.y3=o+l}destroy(t=!1){this._source&&t&&(this._source.destroy(),this._source=null),this._textureMatrix=null,this.destroyed=!0,this.emit("destroy",this),this.removeAllListeners()}update(){this.noFrame&&(this.frame.width=this._source.width,this.frame.height=this._source.height),this.updateUvs(),this.emit("update",this)}get baseTexture(){return z(N,"Texture.baseTexture is now Texture.source"),this._source}}O.EMPTY=new O({label:"EMPTY",source:new Ft({label:"EMPTY"})});O.EMPTY.destroy=Yo;O.WHITE=new O({source:new Dn({resource:new Uint8Array([255,255,255,255]),width:1,height:1,alphaMode:"premultiply-alpha-on-upload",label:"WHITE"}),label:"WHITE"});O.WHITE.destroy=Yo;function ic(s,t,e){const{width:i,height:n}=e.orig,r=e.trim;if(r){const o=r.width,a=r.height;s.minX=r.x-t._x*i,s.maxX=s.minX+o,s.minY=r.y-t._y*n,s.maxY=s.minY+a}else s.minX=-t._x*i,s.maxX=s.minX+i,s.minY=-t._y*n,s.maxY=s.minY+n}const wr=new G;class Lt{constructor(t=1/0,e=1/0,i=-1/0,n=-1/0){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.matrix=wr,this.minX=t,this.minY=e,this.maxX=i,this.maxY=n}isEmpty(){return this.minX>this.maxX||this.minY>this.maxY}get rectangle(){this._rectangle||(this._rectangle=new j);const t=this._rectangle;return this.minX>this.maxX||this.minY>this.maxY?(t.x=0,t.y=0,t.width=0,t.height=0):t.copyFromBounds(this),t}clear(){return this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.matrix=wr,this}set(t,e,i,n){this.minX=t,this.minY=e,this.maxX=i,this.maxY=n}addFrame(t,e,i,n,r){r||(r=this.matrix);const o=r.a,a=r.b,l=r.c,c=r.d,h=r.tx,d=r.ty;let f=this.minX,u=this.minY,m=this.maxX,y=this.maxY,p=o*t+l*e+h,g=a*t+c*e+d;p<f&&(f=p),g<u&&(u=g),p>m&&(m=p),g>y&&(y=g),p=o*i+l*e+h,g=a*i+c*e+d,p<f&&(f=p),g<u&&(u=g),p>m&&(m=p),g>y&&(y=g),p=o*t+l*n+h,g=a*t+c*n+d,p<f&&(f=p),g<u&&(u=g),p>m&&(m=p),g>y&&(y=g),p=o*i+l*n+h,g=a*i+c*n+d,p<f&&(f=p),g<u&&(u=g),p>m&&(m=p),g>y&&(y=g),this.minX=f,this.minY=u,this.maxX=m,this.maxY=y}addRect(t,e){this.addFrame(t.x,t.y,t.x+t.width,t.y+t.height,e)}addBounds(t,e){this.addFrame(t.minX,t.minY,t.maxX,t.maxY,e)}addBoundsMask(t){this.minX=this.minX>t.minX?this.minX:t.minX,this.minY=this.minY>t.minY?this.minY:t.minY,this.maxX=this.maxX<t.maxX?this.maxX:t.maxX,this.maxY=this.maxY<t.maxY?this.maxY:t.maxY}applyMatrix(t){const e=this.minX,i=this.minY,n=this.maxX,r=this.maxY,{a:o,b:a,c:l,d:c,tx:h,ty:d}=t;let f=o*e+l*i+h,u=a*e+c*i+d;this.minX=f,this.minY=u,this.maxX=f,this.maxY=u,f=o*n+l*i+h,u=a*n+c*i+d,this.minX=f<this.minX?f:this.minX,this.minY=u<this.minY?u:this.minY,this.maxX=f>this.maxX?f:this.maxX,this.maxY=u>this.maxY?u:this.maxY,f=o*e+l*r+h,u=a*e+c*r+d,this.minX=f<this.minX?f:this.minX,this.minY=u<this.minY?u:this.minY,this.maxX=f>this.maxX?f:this.maxX,this.maxY=u>this.maxY?u:this.maxY,f=o*n+l*r+h,u=a*n+c*r+d,this.minX=f<this.minX?f:this.minX,this.minY=u<this.minY?u:this.minY,this.maxX=f>this.maxX?f:this.maxX,this.maxY=u>this.maxY?u:this.maxY}fit(t){return this.minX<t.left&&(this.minX=t.left),this.maxX>t.right&&(this.maxX=t.right),this.minY<t.top&&(this.minY=t.top),this.maxY>t.bottom&&(this.maxY=t.bottom),this}fitBounds(t,e,i,n){return this.minX<t&&(this.minX=t),this.maxX>e&&(this.maxX=e),this.minY<i&&(this.minY=i),this.maxY>n&&(this.maxY=n),this}pad(t,e=t){return this.minX-=t,this.maxX+=t,this.minY-=e,this.maxY+=e,this}ceil(){return this.minX=Math.floor(this.minX),this.minY=Math.floor(this.minY),this.maxX=Math.ceil(this.maxX),this.maxY=Math.ceil(this.maxY),this}clone(){return new Lt(this.minX,this.minY,this.maxX,this.maxY)}scale(t,e=t){return this.minX*=t,this.minY*=e,this.maxX*=t,this.maxY*=e,this}get x(){return this.minX}set x(t){const e=this.maxX-this.minX;this.minX=t,this.maxX=t+e}get y(){return this.minY}set y(t){const e=this.maxY-this.minY;this.minY=t,this.maxY=t+e}get width(){return this.maxX-this.minX}set width(t){this.maxX=this.minX+t}get height(){return this.maxY-this.minY}set height(t){this.maxY=this.minY+t}get left(){return this.minX}get right(){return this.maxX}get top(){return this.minY}get bottom(){return this.maxY}get isPositive(){return this.maxX-this.minX>0&&this.maxY-this.minY>0}get isValid(){return this.minX+this.minY!==1/0}addVertexData(t,e,i,n){let r=this.minX,o=this.minY,a=this.maxX,l=this.maxY;n||(n=this.matrix);const c=n.a,h=n.b,d=n.c,f=n.d,u=n.tx,m=n.ty;for(let y=e;y<i;y+=2){const p=t[y],g=t[y+1],x=c*p+d*g+u,b=h*p+f*g+m;r=x<r?x:r,o=b<o?b:o,a=x>a?x:a,l=b>l?b:l}this.minX=r,this.minY=o,this.maxX=a,this.maxY=l}containsPoint(t,e){return this.minX<=t&&this.minY<=e&&this.maxX>=t&&this.maxY>=e}toString(){return`[pixi.js:Bounds minX=${this.minX} minY=${this.minY} maxX=${this.maxX} maxY=${this.maxY} width=${this.width} height=${this.height}]`}copyFrom(t){return this.minX=t.minX,this.minY=t.minY,this.maxX=t.maxX,this.maxY=t.maxY,this}}var nc={grad:.9,turn:360,rad:360/(2*Math.PI)},Ht=function(s){return typeof s=="string"?s.length>0:typeof s=="number"},J=function(s,t,e){return t===void 0&&(t=0),e===void 0&&(e=Math.pow(10,t)),Math.round(e*s)/e+0},vt=function(s,t,e){return t===void 0&&(t=0),e===void 0&&(e=1),s>e?e:s>t?s:t},Zo=function(s){return(s=isFinite(s)?s%360:0)>0?s:s+360},vr=function(s){return{r:vt(s.r,0,255),g:vt(s.g,0,255),b:vt(s.b,0,255),a:vt(s.a)}},Hi=function(s){return{r:J(s.r),g:J(s.g),b:J(s.b),a:J(s.a,3)}},rc=/^#([0-9a-f]{3,8})$/i,si=function(s){var t=s.toString(16);return t.length<2?"0"+t:t},Qo=function(s){var t=s.r,e=s.g,i=s.b,n=s.a,r=Math.max(t,e,i),o=r-Math.min(t,e,i),a=o?r===t?(e-i)/o:r===e?2+(i-t)/o:4+(t-e)/o:0;return{h:60*(a<0?a+6:a),s:r?o/r*100:0,v:r/255*100,a:n}},Jo=function(s){var t=s.h,e=s.s,i=s.v,n=s.a;t=t/360*6,e/=100,i/=100;var r=Math.floor(t),o=i*(1-e),a=i*(1-(t-r)*e),l=i*(1-(1-t+r)*e),c=r%6;return{r:255*[i,a,o,o,l,i][c],g:255*[l,i,i,a,o,o][c],b:255*[o,o,l,i,i,a][c],a:n}},Sr=function(s){return{h:Zo(s.h),s:vt(s.s,0,100),l:vt(s.l,0,100),a:vt(s.a)}},Ar=function(s){return{h:J(s.h),s:J(s.s),l:J(s.l),a:J(s.a,3)}},kr=function(s){return Jo((e=(t=s).s,{h:t.h,s:(e*=((i=t.l)<50?i:100-i)/100)>0?2*e/(i+e)*100:0,v:i+e,a:t.a}));var t,e,i},vs=function(s){return{h:(t=Qo(s)).h,s:(n=(200-(e=t.s))*(i=t.v)/100)>0&&n<200?e*i/100/(n<=100?n:200-n)*100:0,l:n/2,a:t.a};var t,e,i,n},oc=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,ac=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,lc=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,cc=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,_n={string:[[function(s){var t=rc.exec(s);return t?(s=t[1]).length<=4?{r:parseInt(s[0]+s[0],16),g:parseInt(s[1]+s[1],16),b:parseInt(s[2]+s[2],16),a:s.length===4?J(parseInt(s[3]+s[3],16)/255,2):1}:s.length===6||s.length===8?{r:parseInt(s.substr(0,2),16),g:parseInt(s.substr(2,2),16),b:parseInt(s.substr(4,2),16),a:s.length===8?J(parseInt(s.substr(6,2),16)/255,2):1}:null:null},"hex"],[function(s){var t=lc.exec(s)||cc.exec(s);return t?t[2]!==t[4]||t[4]!==t[6]?null:vr({r:Number(t[1])/(t[2]?100/255:1),g:Number(t[3])/(t[4]?100/255:1),b:Number(t[5])/(t[6]?100/255:1),a:t[7]===void 0?1:Number(t[7])/(t[8]?100:1)}):null},"rgb"],[function(s){var t=oc.exec(s)||ac.exec(s);if(!t)return null;var e,i,n=Sr({h:(e=t[1],i=t[2],i===void 0&&(i="deg"),Number(e)*(nc[i]||1)),s:Number(t[3]),l:Number(t[4]),a:t[5]===void 0?1:Number(t[5])/(t[6]?100:1)});return kr(n)},"hsl"]],object:[[function(s){var t=s.r,e=s.g,i=s.b,n=s.a,r=n===void 0?1:n;return Ht(t)&&Ht(e)&&Ht(i)?vr({r:Number(t),g:Number(e),b:Number(i),a:Number(r)}):null},"rgb"],[function(s){var t=s.h,e=s.s,i=s.l,n=s.a,r=n===void 0?1:n;if(!Ht(t)||!Ht(e)||!Ht(i))return null;var o=Sr({h:Number(t),s:Number(e),l:Number(i),a:Number(r)});return kr(o)},"hsl"],[function(s){var t=s.h,e=s.s,i=s.v,n=s.a,r=n===void 0?1:n;if(!Ht(t)||!Ht(e)||!Ht(i))return null;var o=function(a){return{h:Zo(a.h),s:vt(a.s,0,100),v:vt(a.v,0,100),a:vt(a.a)}}({h:Number(t),s:Number(e),v:Number(i),a:Number(r)});return Jo(o)},"hsv"]]},Cr=function(s,t){for(var e=0;e<t.length;e++){var i=t[e][0](s);if(i)return[i,t[e][1]]}return[null,void 0]},hc=function(s){return typeof s=="string"?Cr(s.trim(),_n.string):typeof s=="object"&&s!==null?Cr(s,_n.object):[null,void 0]},Yi=function(s,t){var e=vs(s);return{h:e.h,s:vt(e.s+100*t,0,100),l:e.l,a:e.a}},Vi=function(s){return(299*s.r+587*s.g+114*s.b)/1e3/255},Mr=function(s,t){var e=vs(s);return{h:e.h,s:e.s,l:vt(e.l+100*t,0,100),a:e.a}},wn=function(){function s(t){this.parsed=hc(t)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return s.prototype.isValid=function(){return this.parsed!==null},s.prototype.brightness=function(){return J(Vi(this.rgba),2)},s.prototype.isDark=function(){return Vi(this.rgba)<.5},s.prototype.isLight=function(){return Vi(this.rgba)>=.5},s.prototype.toHex=function(){return t=Hi(this.rgba),e=t.r,i=t.g,n=t.b,o=(r=t.a)<1?si(J(255*r)):"","#"+si(e)+si(i)+si(n)+o;var t,e,i,n,r,o},s.prototype.toRgb=function(){return Hi(this.rgba)},s.prototype.toRgbString=function(){return t=Hi(this.rgba),e=t.r,i=t.g,n=t.b,(r=t.a)<1?"rgba("+e+", "+i+", "+n+", "+r+")":"rgb("+e+", "+i+", "+n+")";var t,e,i,n,r},s.prototype.toHsl=function(){return Ar(vs(this.rgba))},s.prototype.toHslString=function(){return t=Ar(vs(this.rgba)),e=t.h,i=t.s,n=t.l,(r=t.a)<1?"hsla("+e+", "+i+"%, "+n+"%, "+r+")":"hsl("+e+", "+i+"%, "+n+"%)";var t,e,i,n,r},s.prototype.toHsv=function(){return t=Qo(this.rgba),{h:J(t.h),s:J(t.s),v:J(t.v),a:J(t.a,3)};var t},s.prototype.invert=function(){return Gt({r:255-(t=this.rgba).r,g:255-t.g,b:255-t.b,a:t.a});var t},s.prototype.saturate=function(t){return t===void 0&&(t=.1),Gt(Yi(this.rgba,t))},s.prototype.desaturate=function(t){return t===void 0&&(t=.1),Gt(Yi(this.rgba,-t))},s.prototype.grayscale=function(){return Gt(Yi(this.rgba,-1))},s.prototype.lighten=function(t){return t===void 0&&(t=.1),Gt(Mr(this.rgba,t))},s.prototype.darken=function(t){return t===void 0&&(t=.1),Gt(Mr(this.rgba,-t))},s.prototype.rotate=function(t){return t===void 0&&(t=15),this.hue(this.hue()+t)},s.prototype.alpha=function(t){return typeof t=="number"?Gt({r:(e=this.rgba).r,g:e.g,b:e.b,a:t}):J(this.rgba.a,3);var e},s.prototype.hue=function(t){var e=vs(this.rgba);return typeof t=="number"?Gt({h:t,s:e.s,l:e.l,a:e.a}):J(e.h)},s.prototype.isEqual=function(t){return this.toHex()===Gt(t).toHex()},s}(),Gt=function(s){return s instanceof wn?s:new wn(s)},Tr=[],dc=function(s){s.forEach(function(t){Tr.indexOf(t)<0&&(t(wn,_n),Tr.push(t))})};function uc(s,t){var e={white:"#ffffff",bisque:"#ffe4c4",blue:"#0000ff",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",antiquewhite:"#faebd7",aqua:"#00ffff",azure:"#f0ffff",whitesmoke:"#f5f5f5",papayawhip:"#ffefd5",plum:"#dda0dd",blanchedalmond:"#ffebcd",black:"#000000",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",cornsilk:"#fff8dc",cornflowerblue:"#6495ed",burlywood:"#deb887",aquamarine:"#7fffd4",beige:"#f5f5dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkkhaki:"#bdb76b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",peachpuff:"#ffdab9",darkmagenta:"#8b008b",darkred:"#8b0000",darkorchid:"#9932cc",darkorange:"#ff8c00",darkslateblue:"#483d8b",gray:"#808080",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",deeppink:"#ff1493",deepskyblue:"#00bfff",wheat:"#f5deb3",firebrick:"#b22222",floralwhite:"#fffaf0",ghostwhite:"#f8f8ff",darkviolet:"#9400d3",magenta:"#ff00ff",green:"#008000",dodgerblue:"#1e90ff",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",blueviolet:"#8a2be2",forestgreen:"#228b22",lawngreen:"#7cfc00",indianred:"#cd5c5c",indigo:"#4b0082",fuchsia:"#ff00ff",brown:"#a52a2a",maroon:"#800000",mediumblue:"#0000cd",lightcoral:"#f08080",darkturquoise:"#00ced1",lightcyan:"#e0ffff",ivory:"#fffff0",lightyellow:"#ffffe0",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",linen:"#faf0e6",mediumaquamarine:"#66cdaa",lemonchiffon:"#fffacd",lime:"#00ff00",khaki:"#f0e68c",mediumseagreen:"#3cb371",limegreen:"#32cd32",mediumspringgreen:"#00fa9a",lightskyblue:"#87cefa",lightblue:"#add8e6",midnightblue:"#191970",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",mintcream:"#f5fffa",lightslategray:"#778899",lightslategrey:"#778899",navajowhite:"#ffdead",navy:"#000080",mediumvioletred:"#c71585",powderblue:"#b0e0e6",palegoldenrod:"#eee8aa",oldlace:"#fdf5e6",paleturquoise:"#afeeee",mediumturquoise:"#48d1cc",mediumorchid:"#ba55d3",rebeccapurple:"#663399",lightsteelblue:"#b0c4de",mediumslateblue:"#7b68ee",thistle:"#d8bfd8",tan:"#d2b48c",orchid:"#da70d6",mediumpurple:"#9370db",purple:"#800080",pink:"#ffc0cb",skyblue:"#87ceeb",springgreen:"#00ff7f",palegreen:"#98fb98",red:"#ff0000",yellow:"#ffff00",slateblue:"#6a5acd",lavenderblush:"#fff0f5",peru:"#cd853f",palevioletred:"#db7093",violet:"#ee82ee",teal:"#008080",slategray:"#708090",slategrey:"#708090",aliceblue:"#f0f8ff",darkseagreen:"#8fbc8f",darkolivegreen:"#556b2f",greenyellow:"#adff2f",seagreen:"#2e8b57",seashell:"#fff5ee",tomato:"#ff6347",silver:"#c0c0c0",sienna:"#a0522d",lavender:"#e6e6fa",lightgreen:"#90ee90",orange:"#ffa500",orangered:"#ff4500",steelblue:"#4682b4",royalblue:"#4169e1",turquoise:"#40e0d0",yellowgreen:"#9acd32",salmon:"#fa8072",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",darksalmon:"#e9967a",lightgoldenrodyellow:"#fafad2",snow:"#fffafa",lightgrey:"#d3d3d3",lightgray:"#d3d3d3",dimgray:"#696969",dimgrey:"#696969",olivedrab:"#6b8e23",olive:"#808000"},i={};for(var n in e)i[e[n]]=n;var r={};s.prototype.toName=function(o){if(!(this.rgba.a||this.rgba.r||this.rgba.g||this.rgba.b))return"transparent";var a,l,c=i[this.toHex()];if(c)return c;if(o!=null&&o.closest){var h=this.toRgb(),d=1/0,f="black";if(!r.length)for(var u in e)r[u]=new s(e[u]).toRgb();for(var m in e){var y=(a=h,l=r[m],Math.pow(a.r-l.r,2)+Math.pow(a.g-l.g,2)+Math.pow(a.b-l.b,2));y<d&&(d=y,f=m)}return f}},t.string.push([function(o){var a=o.toLowerCase(),l=a==="transparent"?"#0000":e[a];return l?new s(l).toRgb():null},"name"])}dc([uc]);const Ne=class xs{constructor(t=16777215){this._value=null,this._components=new Float32Array(4),this._components.fill(1),this._int=16777215,this.value=t}get red(){return this._components[0]}get green(){return this._components[1]}get blue(){return this._components[2]}get alpha(){return this._components[3]}setValue(t){return this.value=t,this}set value(t){if(t instanceof xs)this._value=this._cloneSource(t._value),this._int=t._int,this._components.set(t._components);else{if(t===null)throw new Error("Cannot set Color#value to null");(this._value===null||!this._isSourceEqual(this._value,t))&&(this._value=this._cloneSource(t),this._normalize(this._value))}}get value(){return this._value}_cloneSource(t){return typeof t=="string"||typeof t=="number"||t instanceof Number||t===null?t:Array.isArray(t)||ArrayBuffer.isView(t)?t.slice(0):typeof t=="object"&&t!==null?{...t}:t}_isSourceEqual(t,e){const i=typeof t;if(i!==typeof e)return!1;if(i==="number"||i==="string"||t instanceof Number)return t===e;if(Array.isArray(t)&&Array.isArray(e)||ArrayBuffer.isView(t)&&ArrayBuffer.isView(e))return t.length!==e.length?!1:t.every((r,o)=>r===e[o]);if(t!==null&&e!==null){const r=Object.keys(t),o=Object.keys(e);return r.length!==o.length?!1:r.every(a=>t[a]===e[a])}return t===e}toRgba(){const[t,e,i,n]=this._components;return{r:t,g:e,b:i,a:n}}toRgb(){const[t,e,i]=this._components;return{r:t,g:e,b:i}}toRgbaString(){const[t,e,i]=this.toUint8RgbArray();return`rgba(${t},${e},${i},${this.alpha})`}toUint8RgbArray(t){const[e,i,n]=this._components;return this._arrayRgb||(this._arrayRgb=[]),t||(t=this._arrayRgb),t[0]=Math.round(e*255),t[1]=Math.round(i*255),t[2]=Math.round(n*255),t}toArray(t){this._arrayRgba||(this._arrayRgba=[]),t||(t=this._arrayRgba);const[e,i,n,r]=this._components;return t[0]=e,t[1]=i,t[2]=n,t[3]=r,t}toRgbArray(t){this._arrayRgb||(this._arrayRgb=[]),t||(t=this._arrayRgb);const[e,i,n]=this._components;return t[0]=e,t[1]=i,t[2]=n,t}toNumber(){return this._int}toBgrNumber(){const[t,e,i]=this.toUint8RgbArray();return(i<<16)+(e<<8)+t}toLittleEndianNumber(){const t=this._int;return(t>>16)+(t&65280)+((t&255)<<16)}multiply(t){const[e,i,n,r]=xs._temp.setValue(t)._components;return this._components[0]*=e,this._components[1]*=i,this._components[2]*=n,this._components[3]*=r,this._refreshInt(),this._value=null,this}premultiply(t,e=!0){return e&&(this._components[0]*=t,this._components[1]*=t,this._components[2]*=t),this._components[3]=t,this._refreshInt(),this._value=null,this}toPremultiplied(t,e=!0){if(t===1)return(255<<24)+this._int;if(t===0)return e?0:this._int;let i=this._int>>16&255,n=this._int>>8&255,r=this._int&255;return e&&(i=i*t+.5|0,n=n*t+.5|0,r=r*t+.5|0),(t*255<<24)+(i<<16)+(n<<8)+r}toHex(){const t=this._int.toString(16);return`#${"000000".substring(0,6-t.length)+t}`}toHexa(){const e=Math.round(this._components[3]*255).toString(16);return this.toHex()+"00".substring(0,2-e.length)+e}setAlpha(t){return this._components[3]=this._clamp(t),this}_normalize(t){let e,i,n,r;if((typeof t=="number"||t instanceof Number)&&t>=0&&t<=16777215){const o=t;e=(o>>16&255)/255,i=(o>>8&255)/255,n=(o&255)/255,r=1}else if((Array.isArray(t)||t instanceof Float32Array)&&t.length>=3&&t.length<=4)t=this._clamp(t),[e,i,n,r=1]=t;else if((t instanceof Uint8Array||t instanceof Uint8ClampedArray)&&t.length>=3&&t.length<=4)t=this._clamp(t,0,255),[e,i,n,r=255]=t,e/=255,i/=255,n/=255,r/=255;else if(typeof t=="string"||typeof t=="object"){if(typeof t=="string"){const a=xs.HEX_PATTERN.exec(t);a&&(t=`#${a[2]}`)}const o=Gt(t);o.isValid()&&({r:e,g:i,b:n,a:r}=o.rgba,e/=255,i/=255,n/=255)}if(e!==void 0)this._components[0]=e,this._components[1]=i,this._components[2]=n,this._components[3]=r,this._refreshInt();else throw new Error(`Unable to convert color ${t}`)}_refreshInt(){this._clamp(this._components);const[t,e,i]=this._components;this._int=(t*255<<16)+(e*255<<8)+(i*255|0)}_clamp(t,e=0,i=1){return typeof t=="number"?Math.min(Math.max(t,e),i):(t.forEach((n,r)=>{t[r]=Math.min(Math.max(n,e),i)}),t)}static isColorLike(t){return typeof t=="number"||typeof t=="string"||t instanceof Number||t instanceof xs||Array.isArray(t)||t instanceof Uint8Array||t instanceof Uint8ClampedArray||t instanceof Float32Array||t.r!==void 0&&t.g!==void 0&&t.b!==void 0||t.r!==void 0&&t.g!==void 0&&t.b!==void 0&&t.a!==void 0||t.h!==void 0&&t.s!==void 0&&t.l!==void 0||t.h!==void 0&&t.s!==void 0&&t.l!==void 0&&t.a!==void 0||t.h!==void 0&&t.s!==void 0&&t.v!==void 0||t.h!==void 0&&t.s!==void 0&&t.v!==void 0&&t.a!==void 0}};Ne.shared=new Ne;Ne._temp=new Ne;Ne.HEX_PATTERN=/^(#|0x)?(([a-f0-9]{3}){1,2}([a-f0-9]{2})?)$/i;let Q=Ne;const fc={cullArea:null,cullable:!1,cullableChildren:!0};let ji=0;const Pr=500;function V(...s){ji!==Pr&&(ji++,ji===Pr?console.warn("PixiJS Warning: too many warnings, no more warnings will be reported to the console by PixiJS."):console.warn("PixiJS Warning: ",...s))}const $s={_registeredResources:new Set,register(s){this._registeredResources.add(s)},unregister(s){this._registeredResources.delete(s)},release(){this._registeredResources.forEach(s=>s.clear())},get registeredCount(){return this._registeredResources.size},isRegistered(s){return this._registeredResources.has(s)},reset(){this._registeredResources.clear()}};class pc{constructor(t,e){this._pool=[],this._count=0,this._index=0,this._classType=t,e&&this.prepopulate(e)}prepopulate(t){for(let e=0;e<t;e++)this._pool[this._index++]=new this._classType;this._count+=t}get(t){var i;let e;return this._index>0?e=this._pool[--this._index]:e=new this._classType,(i=e.init)==null||i.call(e,t),e}return(t){var e;(e=t.reset)==null||e.call(t),this._pool[this._index++]=t}get totalSize(){return this._count}get totalFree(){return this._index}get totalUsed(){return this._count-this._index}clear(){if(this._pool.length>0&&this._pool[0].destroy)for(let t=0;t<this._index;t++)this._pool[t].destroy();this._pool.length=0,this._count=0,this._index=0}}class mc{constructor(){this._poolsByClass=new Map}prepopulate(t,e){this.getPool(t).prepopulate(e)}get(t,e){return this.getPool(t).get(e)}return(t){this.getPool(t.constructor).return(t)}getPool(t){return this._poolsByClass.has(t)||this._poolsByClass.set(t,new pc(t)),this._poolsByClass.get(t)}stats(){const t={};return this._poolsByClass.forEach(e=>{const i=t[e._classType.name]?e._classType.name+e._classType.ID:e._classType.name;t[i]={free:e.totalFree,used:e.totalUsed,size:e.totalSize}}),t}clear(){this._poolsByClass.forEach(t=>t.clear()),this._poolsByClass.clear()}}const St=new mc;$s.register(St);const gc={get isCachedAsTexture(){var s;return!!((s=this.renderGroup)!=null&&s.isCachedAsTexture)},cacheAsTexture(s){typeof s=="boolean"&&s===!1?this.disableRenderGroup():(this.enableRenderGroup(),this.renderGroup.enableCacheAsTexture(s===!0?{}:s))},updateCacheTexture(){var s;(s=this.renderGroup)==null||s.updateCacheTexture()},get cacheAsBitmap(){return this.isCachedAsTexture},set cacheAsBitmap(s){z("v8.6.0","cacheAsBitmap is deprecated, use cacheAsTexture instead."),this.cacheAsTexture(s)}};function yc(s,t,e){const i=s.length;let n;if(t>=i||e===0)return;e=t+e>i?i-t:e;const r=i-e;for(n=t;n<r;++n)s[n]=s[n+e];s.length=r}const xc={allowChildren:!0,removeChildren(s=0,t){var r;const e=t??this.children.length,i=e-s,n=[];if(i>0&&i<=e){for(let a=e-1;a>=s;a--){const l=this.children[a];l&&(n.push(l),l.parent=null)}yc(this.children,s,e);const o=this.renderGroup||this.parentRenderGroup;o&&o.removeChildren(n);for(let a=0;a<n.length;++a){const l=n[a];(r=l.parentRenderLayer)==null||r.detach(l),this.emit("childRemoved",l,this,a),n[a].emit("removed",this)}return n.length>0&&this._didViewChangeTick++,n}else if(i===0&&this.children.length===0)return n;throw new RangeError("removeChildren: numeric values are outside the acceptable range.")},removeChildAt(s){const t=this.getChildAt(s);return this.removeChild(t)},getChildAt(s){if(s<0||s>=this.children.length)throw new Error(`getChildAt: Index (${s}) does not exist.`);return this.children[s]},setChildIndex(s,t){if(t<0||t>=this.children.length)throw new Error(`The index ${t} supplied is out of bounds ${this.children.length}`);this.getChildIndex(s),this.addChildAt(s,t)},getChildIndex(s){const t=this.children.indexOf(s);if(t===-1)throw new Error("The supplied Container must be a child of the caller");return t},addChildAt(s,t){this.allowChildren||z(N,"addChildAt: Only Containers will be allowed to add children in v8.0.0");const{children:e}=this;if(t<0||t>e.length)throw new Error(`${s}addChildAt: The index ${t} supplied is out of bounds ${e.length}`);if(s.parent){const n=s.parent.children.indexOf(s);if(s.parent===this&&n===t)return s;n!==-1&&s.parent.children.splice(n,1)}t===e.length?e.push(s):e.splice(t,0,s),s.parent=this,s.didChange=!0,s._updateFlags=15;const i=this.renderGroup||this.parentRenderGroup;return i&&i.addChild(s),this.sortableChildren&&(this.sortDirty=!0),this.emit("childAdded",s,this,t),s.emit("added",this),s},swapChildren(s,t){if(s===t)return;const e=this.getChildIndex(s),i=this.getChildIndex(t);this.children[e]=t,this.children[i]=s;const n=this.renderGroup||this.parentRenderGroup;n&&(n.structureDidChange=!0),this._didContainerChangeTick++},removeFromParent(){var s;(s=this.parent)==null||s.removeChild(this)},reparentChild(...s){return s.length===1?this.reparentChildAt(s[0],this.children.length):(s.forEach(t=>this.reparentChildAt(t,this.children.length)),s[0])},reparentChildAt(s,t){if(s.parent===this)return this.setChildIndex(s,t),s;const e=s.worldTransform.clone();s.removeFromParent(),this.addChildAt(s,t);const i=this.worldTransform.clone();return i.invert(),e.prepend(i),s.setFromMatrix(e),s},replaceChild(s,t){s.updateLocalTransform(),this.addChildAt(t,this.getChildIndex(s)),t.setFromMatrix(s.localTransform),t.updateLocalTransform(),this.removeChild(s)}},bc={collectRenderables(s,t,e){this.parentRenderLayer&&this.parentRenderLayer!==e||this.globalDisplayStatus<7||!this.includeInBuild||(this.sortableChildren&&this.sortChildren(),this.isSimple?this.collectRenderablesSimple(s,t,e):this.renderGroup?t.renderPipes.renderGroup.addRenderGroup(this.renderGroup,s):this.collectRenderablesWithEffects(s,t,e))},collectRenderablesSimple(s,t,e){const i=this.children,n=i.length;for(let r=0;r<n;r++)i[r].collectRenderables(s,t,e)},collectRenderablesWithEffects(s,t,e){const{renderPipes:i}=t;for(let n=0;n<this.effects.length;n++){const r=this.effects[n];i[r.pipe].push(r,this,s)}this.collectRenderablesSimple(s,t,e);for(let n=this.effects.length-1;n>=0;n--){const r=this.effects[n];i[r.pipe].pop(r,this,s)}}};class Er{constructor(){this.pipe="filter",this.priority=1}destroy(){for(let t=0;t<this.filters.length;t++)this.filters[t].destroy();this.filters=null,this.filterArea=null}}class _c{constructor(){this._effectClasses=[],this._tests=[],this._initialized=!1}init(){this._initialized||(this._initialized=!0,this._effectClasses.forEach(t=>{this.add({test:t.test,maskClass:t})}))}add(t){this._tests.push(t)}getMaskEffect(t){this._initialized||this.init();for(let e=0;e<this._tests.length;e++){const i=this._tests[e];if(i.test(t))return St.get(i.maskClass,t)}return t}returnMaskEffect(t){St.return(t)}}const vn=new _c;st.handleByList(E.MaskEffect,vn._effectClasses);const wc={_maskEffect:null,_maskOptions:{inverse:!1},_filterEffect:null,effects:[],_markStructureAsChanged(){const s=this.renderGroup||this.parentRenderGroup;s&&(s.structureDidChange=!0)},addEffect(s){this.effects.indexOf(s)===-1&&(this.effects.push(s),this.effects.sort((e,i)=>e.priority-i.priority),this._markStructureAsChanged(),this._updateIsSimple())},removeEffect(s){const t=this.effects.indexOf(s);t!==-1&&(this.effects.splice(t,1),this._markStructureAsChanged(),this._updateIsSimple())},set mask(s){const t=this._maskEffect;(t==null?void 0:t.mask)!==s&&(t&&(this.removeEffect(t),vn.returnMaskEffect(t),this._maskEffect=null),s!=null&&(this._maskEffect=vn.getMaskEffect(s),this.addEffect(this._maskEffect)))},get mask(){var s;return(s=this._maskEffect)==null?void 0:s.mask},setMask(s){this._maskOptions={...this._maskOptions,...s},s.mask&&(this.mask=s.mask),this._markStructureAsChanged()},set filters(s){var r;!Array.isArray(s)&&s&&(s=[s]);const t=this._filterEffect||(this._filterEffect=new Er);s=s;const e=(s==null?void 0:s.length)>0,i=((r=t.filters)==null?void 0:r.length)>0,n=e!==i;s=Array.isArray(s)?s.slice(0):s,t.filters=Object.freeze(s),n&&(e?this.addEffect(t):(this.removeEffect(t),t.filters=s??null))},get filters(){var s;return(s=this._filterEffect)==null?void 0:s.filters},set filterArea(s){this._filterEffect||(this._filterEffect=new Er),this._filterEffect.filterArea=s},get filterArea(){var s;return(s=this._filterEffect)==null?void 0:s.filterArea}},vc={label:null,get name(){return z(N,"Container.name property has been removed, use Container.label instead"),this.label},set name(s){z(N,"Container.name property has been removed, use Container.label instead"),this.label=s},getChildByName(s,t=!1){return this.getChildByLabel(s,t)},getChildByLabel(s,t=!1){const e=this.children;for(let i=0;i<e.length;i++){const n=e[i];if(n.label===s||s instanceof RegExp&&s.test(n.label))return n}if(t)for(let i=0;i<e.length;i++){const r=e[i].getChildByLabel(s,!0);if(r)return r}return null},getChildrenByLabel(s,t=!1,e=[]){const i=this.children;for(let n=0;n<i.length;n++){const r=i[n];(r.label===s||s instanceof RegExp&&s.test(r.label))&&e.push(r)}if(t)for(let n=0;n<i.length;n++)i[n].getChildrenByLabel(s,!0,e);return e}},ct=St.getPool(G),Vt=St.getPool(Lt),Sc=new G,Ac={getFastGlobalBounds(s,t){t||(t=new Lt),t.clear(),this._getGlobalBoundsRecursive(!!s,t,this.parentRenderLayer),t.isValid||t.set(0,0,0,0);const e=this.renderGroup||this.parentRenderGroup;return t.applyMatrix(e.worldTransform),t},_getGlobalBoundsRecursive(s,t,e){let i=t;if(s&&this.parentRenderLayer&&this.parentRenderLayer!==e||this.localDisplayStatus!==7||!this.measurable)return;const n=!!this.effects.length;if((this.renderGroup||n)&&(i=Vt.get().clear()),this.boundsArea)t.addRect(this.boundsArea,this.worldTransform);else{if(this.renderPipeId){const o=this.bounds;i.addFrame(o.minX,o.minY,o.maxX,o.maxY,this.groupTransform)}const r=this.children;for(let o=0;o<r.length;o++)r[o]._getGlobalBoundsRecursive(s,i,e)}if(n){let r=!1;const o=this.renderGroup||this.parentRenderGroup;for(let a=0;a<this.effects.length;a++)this.effects[a].addBounds&&(r||(r=!0,i.applyMatrix(o.worldTransform)),this.effects[a].addBounds(i,!0));r&&i.applyMatrix(o.worldTransform.copyTo(Sc).invert()),t.addBounds(i),Vt.return(i)}else this.renderGroup&&(t.addBounds(i,this.relativeGroupTransform),Vt.return(i))}};function ta(s,t,e){e.clear();let i,n;return s.parent?t?i=s.parent.worldTransform:(n=ct.get().identity(),i=$n(s,n)):i=G.IDENTITY,ea(s,e,i,t),n&&ct.return(n),e.isValid||e.set(0,0,0,0),e}function ea(s,t,e,i){var a,l;if(!s.visible||!s.measurable)return;let n;i?n=s.worldTransform:(s.updateLocalTransform(),n=ct.get(),n.appendFrom(s.localTransform,e));const r=t,o=!!s.effects.length;if(o&&(t=Vt.get().clear()),s.boundsArea)t.addRect(s.boundsArea,n);else{const c=s.bounds;c&&!c.isEmpty()&&(t.matrix=n,t.addBounds(c));for(let h=0;h<s.children.length;h++)ea(s.children[h],t,n,i)}if(o){for(let c=0;c<s.effects.length;c++)(l=(a=s.effects[c]).addBounds)==null||l.call(a,t);r.addBounds(t,G.IDENTITY),Vt.return(t)}i||ct.return(n)}function $n(s,t){const e=s.parent;return e&&($n(e,t),e.updateLocalTransform(),t.append(e.localTransform)),t}function sa(s,t){if(s===16777215||!t)return t;if(t===16777215||!s)return s;const e=s>>16&255,i=s>>8&255,n=s&255,r=t>>16&255,o=t>>8&255,a=t&255,l=e*r/255|0,c=i*o/255|0,h=n*a/255|0;return(l<<16)+(c<<8)+h}const Ir=16777215;function Lr(s,t){return s===Ir?t:t===Ir?s:sa(s,t)}function gi(s){return((s&255)<<16)+(s&65280)+(s>>16&255)}const kc={getGlobalAlpha(s){if(s)return this.renderGroup?this.renderGroup.worldAlpha:this.parentRenderGroup?this.parentRenderGroup.worldAlpha*this.alpha:this.alpha;let t=this.alpha,e=this.parent;for(;e;)t*=e.alpha,e=e.parent;return t},getGlobalTransform(s=new G,t){if(t)return s.copyFrom(this.worldTransform);this.updateLocalTransform();const e=$n(this,ct.get().identity());return s.appendFrom(this.localTransform,e),ct.return(e),s},getGlobalTint(s){if(s)return this.renderGroup?gi(this.renderGroup.worldColor):this.parentRenderGroup?gi(Lr(this.localColor,this.parentRenderGroup.worldColor)):this.tint;let t=this.localColor,e=this.parent;for(;e;)t=Lr(t,e.localColor),e=e.parent;return gi(t)}};function ia(s,t,e){return t.clear(),e||(e=G.IDENTITY),na(s,t,e,s,!0),t.isValid||t.set(0,0,0,0),t}function na(s,t,e,i,n){var l,c;let r;if(n)r=ct.get(),r=e.copyTo(r);else{if(!s.visible||!s.measurable)return;s.updateLocalTransform();const h=s.localTransform;r=ct.get(),r.appendFrom(h,e)}const o=t,a=!!s.effects.length;if(a&&(t=Vt.get().clear()),s.boundsArea)t.addRect(s.boundsArea,r);else{s.renderPipeId&&(t.matrix=r,t.addBounds(s.bounds));const h=s.children;for(let d=0;d<h.length;d++)na(h[d],t,r,i,!1)}if(a){for(let h=0;h<s.effects.length;h++)(c=(l=s.effects[h]).addLocalBounds)==null||c.call(l,t,i);o.addBounds(t,G.IDENTITY),Vt.return(t)}ct.return(r)}function ra(s,t){const e=s.children;for(let i=0;i<e.length;i++){const n=e[i],r=n.uid,o=(n._didViewChangeTick&65535)<<16|n._didContainerChangeTick&65535,a=t.index;(t.data[a]!==r||t.data[a+1]!==o)&&(t.data[t.index]=r,t.data[t.index+1]=o,t.didChange=!0),t.index=a+2,n.children.length&&ra(n,t)}return t.didChange}const Cc=new G,Mc={_localBoundsCacheId:-1,_localBoundsCacheData:null,_setWidth(s,t){const e=Math.sign(this.scale.x)||1;t!==0?this.scale.x=s/t*e:this.scale.x=e},_setHeight(s,t){const e=Math.sign(this.scale.y)||1;t!==0?this.scale.y=s/t*e:this.scale.y=e},getLocalBounds(){this._localBoundsCacheData||(this._localBoundsCacheData={data:[],index:1,didChange:!1,localBounds:new Lt});const s=this._localBoundsCacheData;return s.index=1,s.didChange=!1,s.data[0]!==this._didViewChangeTick&&(s.didChange=!0,s.data[0]=this._didViewChangeTick),ra(this,s),s.didChange&&ia(this,s.localBounds,Cc),s.localBounds},getBounds(s,t){return ta(this,s,t||new Lt)}},Tc={_onRender:null,set onRender(s){const t=this.renderGroup||this.parentRenderGroup;if(!s){this._onRender&&(t==null||t.removeOnRender(this)),this._onRender=null;return}this._onRender||t==null||t.addOnRender(this),this._onRender=s},get onRender(){return this._onRender}},Pc={_zIndex:0,sortDirty:!1,sortableChildren:!1,get zIndex(){return this._zIndex},set zIndex(s){this._zIndex!==s&&(this._zIndex=s,this.depthOfChildModified())},depthOfChildModified(){this.parent&&(this.parent.sortableChildren=!0,this.parent.sortDirty=!0),this.parentRenderGroup&&(this.parentRenderGroup.structureDidChange=!0)},sortChildren(){this.sortDirty&&(this.sortDirty=!1,this.children.sort(Ec))}};function Ec(s,t){return s._zIndex-t._zIndex}const Ic={getGlobalPosition(s=new rt,t=!1){return this.parent?this.parent.toGlobal(this._position,s,t):(s.x=this._position.x,s.y=this._position.y),s},toGlobal(s,t,e=!1){const i=this.getGlobalTransform(ct.get(),e);return t=i.apply(s,t),ct.return(i),t},toLocal(s,t,e,i){t&&(s=t.toGlobal(s,e,i));const n=this.getGlobalTransform(ct.get(),i);return e=n.applyInverse(s,e),ct.return(n),e}};class oa{constructor(){this.uid=K("instructionSet"),this.instructions=[],this.instructionSize=0,this.renderables=[],this.gcTick=0}reset(){this.instructionSize=0}destroy(){this.instructions.length=0,this.renderables.length=0,this.renderPipes=null,this.gcTick=0}add(t){this.instructions[this.instructionSize++]=t}log(){this.instructions.length=this.instructionSize,console.table(this.instructions,["type","action"])}}let Lc=0;class Bc{constructor(t){this._poolKeyHash=Object.create(null),this._texturePool={},this.textureOptions=t||{},this.enableFullScreen=!1,this.textureStyle=new We(this.textureOptions)}createTexture(t,e,i){const n=new Ft({...this.textureOptions,width:t,height:e,resolution:1,antialias:i,autoGarbageCollect:!1});return new O({source:n,label:`texturePool_${Lc++}`})}getOptimalTexture(t,e,i=1,n){let r=Math.ceil(t*i-1e-6),o=Math.ceil(e*i-1e-6);r=$e(r),o=$e(o);const a=(r<<17)+(o<<1)+(n?1:0);this._texturePool[a]||(this._texturePool[a]=[]);let l=this._texturePool[a].pop();return l||(l=this.createTexture(r,o,n)),l.source._resolution=i,l.source.width=r/i,l.source.height=o/i,l.source.pixelWidth=r,l.source.pixelHeight=o,l.frame.x=0,l.frame.y=0,l.frame.width=t,l.frame.height=e,l.updateUvs(),this._poolKeyHash[l.uid]=a,l}getSameSizeTexture(t,e=!1){const i=t.source;return this.getOptimalTexture(t.width,t.height,i._resolution,e)}returnTexture(t,e=!1){const i=this._poolKeyHash[t.uid];e&&(t.source.style=this.textureStyle),this._texturePool[i].push(t)}clear(t){if(t=t!==!1,t)for(const e in this._texturePool){const i=this._texturePool[e];if(i)for(let n=0;n<i.length;n++)i[n].destroy(!0)}this._texturePool={}}}const aa=new Bc;$s.register(aa);class Rc{constructor(){this.renderPipeId="renderGroup",this.root=null,this.canBundle=!1,this.renderGroupParent=null,this.renderGroupChildren=[],this.worldTransform=new G,this.worldColorAlpha=4294967295,this.worldColor=16777215,this.worldAlpha=1,this.childrenToUpdate=Object.create(null),this.updateTick=0,this.gcTick=0,this.childrenRenderablesToUpdate={list:[],index:0},this.structureDidChange=!0,this.instructionSet=new oa,this._onRenderContainers=[],this.textureNeedsUpdate=!0,this.isCachedAsTexture=!1,this._matrixDirty=7}init(t){this.root=t,t._onRender&&this.addOnRender(t),t.didChange=!0;const e=t.children;for(let i=0;i<e.length;i++){const n=e[i];n._updateFlags=15,this.addChild(n)}}enableCacheAsTexture(t={}){this.textureOptions=t,this.isCachedAsTexture=!0,this.textureNeedsUpdate=!0}disableCacheAsTexture(){this.isCachedAsTexture=!1,this.texture&&(aa.returnTexture(this.texture,!0),this.texture=null)}updateCacheTexture(){this.textureNeedsUpdate=!0;const t=this._parentCacheAsTextureRenderGroup;t&&!t.textureNeedsUpdate&&t.updateCacheTexture()}reset(){this.renderGroupChildren.length=0;for(const t in this.childrenToUpdate){const e=this.childrenToUpdate[t];e.list.fill(null),e.index=0}this.childrenRenderablesToUpdate.index=0,this.childrenRenderablesToUpdate.list.fill(null),this.root=null,this.updateTick=0,this.structureDidChange=!0,this._onRenderContainers.length=0,this.renderGroupParent=null,this.disableCacheAsTexture()}get localTransform(){return this.root.localTransform}addRenderGroupChild(t){t.renderGroupParent&&t.renderGroupParent._removeRenderGroupChild(t),t.renderGroupParent=this,this.renderGroupChildren.push(t)}_removeRenderGroupChild(t){const e=this.renderGroupChildren.indexOf(t);e>-1&&this.renderGroupChildren.splice(e,1),t.renderGroupParent=null}addChild(t){if(this.structureDidChange=!0,t.parentRenderGroup=this,t.updateTick=-1,t.parent===this.root?t.relativeRenderGroupDepth=1:t.relativeRenderGroupDepth=t.parent.relativeRenderGroupDepth+1,t.didChange=!0,this.onChildUpdate(t),t.renderGroup){this.addRenderGroupChild(t.renderGroup);return}t._onRender&&this.addOnRender(t);const e=t.children;for(let i=0;i<e.length;i++)this.addChild(e[i])}removeChild(t){if(this.structureDidChange=!0,t._onRender&&(t.renderGroup||this.removeOnRender(t)),t.parentRenderGroup=null,t.renderGroup){this._removeRenderGroupChild(t.renderGroup);return}const e=t.children;for(let i=0;i<e.length;i++)this.removeChild(e[i])}removeChildren(t){for(let e=0;e<t.length;e++)this.removeChild(t[e])}onChildUpdate(t){let e=this.childrenToUpdate[t.relativeRenderGroupDepth];e||(e=this.childrenToUpdate[t.relativeRenderGroupDepth]={index:0,list:[]}),e.list[e.index++]=t}updateRenderable(t){t.globalDisplayStatus<7||(this.instructionSet.renderPipes[t.renderPipeId].updateRenderable(t),t.didViewUpdate=!1)}onChildViewUpdate(t){this.childrenRenderablesToUpdate.list[this.childrenRenderablesToUpdate.index++]=t}get isRenderable(){return this.root.localDisplayStatus===7&&this.worldAlpha>0}addOnRender(t){this._onRenderContainers.push(t)}removeOnRender(t){this._onRenderContainers.splice(this._onRenderContainers.indexOf(t),1)}runOnRender(t){for(let e=0;e<this._onRenderContainers.length;e++)this._onRenderContainers[e]._onRender(t)}destroy(){this.disableCacheAsTexture(),this.renderGroupParent=null,this.root=null,this.childrenRenderablesToUpdate=null,this.childrenToUpdate=null,this.renderGroupChildren=null,this._onRenderContainers=null,this.instructionSet=null}getChildren(t=[]){const e=this.root.children;for(let i=0;i<e.length;i++)this._getChildren(e[i],t);return t}_getChildren(t,e=[]){if(e.push(t),t.renderGroup)return e;const i=t.children;for(let n=0;n<i.length;n++)this._getChildren(i[n],e);return e}invalidateMatrices(){this._matrixDirty=7}get inverseWorldTransform(){return this._matrixDirty&1?(this._matrixDirty&=-2,this._inverseWorldTransform||(this._inverseWorldTransform=new G),this._inverseWorldTransform.copyFrom(this.worldTransform).invert()):this._inverseWorldTransform}get textureOffsetInverseTransform(){return this._matrixDirty&2?(this._matrixDirty&=-3,this._textureOffsetInverseTransform||(this._textureOffsetInverseTransform=new G),this._textureOffsetInverseTransform.copyFrom(this.inverseWorldTransform).translate(-this._textureBounds.x,-this._textureBounds.y)):this._textureOffsetInverseTransform}get inverseParentTextureTransform(){if(!(this._matrixDirty&4))return this._inverseParentTextureTransform;this._matrixDirty&=-5;const t=this._parentCacheAsTextureRenderGroup;return t?(this._inverseParentTextureTransform||(this._inverseParentTextureTransform=new G),this._inverseParentTextureTransform.copyFrom(this.worldTransform).prepend(t.inverseWorldTransform).translate(-t._textureBounds.x,-t._textureBounds.y)):this.worldTransform}get cacheToLocalTransform(){return this.isCachedAsTexture?this.textureOffsetInverseTransform:this._parentCacheAsTextureRenderGroup?this._parentCacheAsTextureRenderGroup.textureOffsetInverseTransform:null}}function Fc(s,t,e={}){for(const i in t)!e[i]&&t[i]!==void 0&&(s[i]=t[i])}const Xi=new tt(null),ii=new tt(null),qi=new tt(null,1,1),ni=new tt(null),Br=1,zc=2,Ki=4;class lt extends Rt{constructor(t={}){var e,i;super(),this.uid=K("renderable"),this._updateFlags=15,this.renderGroup=null,this.parentRenderGroup=null,this.parentRenderGroupIndex=0,this.didChange=!1,this.didViewUpdate=!1,this.relativeRenderGroupDepth=0,this.children=[],this.parent=null,this.includeInBuild=!0,this.measurable=!0,this.isSimple=!0,this.updateTick=-1,this.localTransform=new G,this.relativeGroupTransform=new G,this.groupTransform=this.relativeGroupTransform,this.destroyed=!1,this._position=new tt(this,0,0),this._scale=qi,this._pivot=ii,this._origin=ni,this._skew=Xi,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._rotation=0,this.localColor=16777215,this.localAlpha=1,this.groupAlpha=1,this.groupColor=16777215,this.groupColorAlpha=4294967295,this.localBlendMode="inherit",this.groupBlendMode="normal",this.localDisplayStatus=7,this.globalDisplayStatus=7,this._didContainerChangeTick=0,this._didViewChangeTick=0,this._didLocalTransformChangeId=-1,this.effects=[],Fc(this,t,{children:!0,parent:!0,effects:!0}),(e=t.children)==null||e.forEach(n=>this.addChild(n)),(i=t.parent)==null||i.addChild(this)}static mixin(t){z("8.8.0","Container.mixin is deprecated, please use extensions.mixin instead."),st.mixin(lt,t)}set _didChangeId(t){this._didViewChangeTick=t>>12&4095,this._didContainerChangeTick=t&4095}get _didChangeId(){return this._didContainerChangeTick&4095|(this._didViewChangeTick&4095)<<12}addChild(...t){if(this.allowChildren||z(N,"addChild: Only Containers will be allowed to add children in v8.0.0"),t.length>1){for(let n=0;n<t.length;n++)this.addChild(t[n]);return t[0]}const e=t[0],i=this.renderGroup||this.parentRenderGroup;return e.parent===this?(this.children.splice(this.children.indexOf(e),1),this.children.push(e),i&&(i.structureDidChange=!0),e):(e.parent&&e.parent.removeChild(e),this.children.push(e),this.sortableChildren&&(this.sortDirty=!0),e.parent=this,e.didChange=!0,e._updateFlags=15,i&&i.addChild(e),this.emit("childAdded",e,this,this.children.length-1),e.emit("added",this),this._didViewChangeTick++,e._zIndex!==0&&e.depthOfChildModified(),e)}removeChild(...t){if(t.length>1){for(let n=0;n<t.length;n++)this.removeChild(t[n]);return t[0]}const e=t[0],i=this.children.indexOf(e);return i>-1&&(this._didViewChangeTick++,this.children.splice(i,1),this.renderGroup?this.renderGroup.removeChild(e):this.parentRenderGroup&&this.parentRenderGroup.removeChild(e),e.parentRenderLayer&&e.parentRenderLayer.detach(e),e.parent=null,this.emit("childRemoved",e,this,i),e.emit("removed",this)),e}_onUpdate(t){t&&t===this._skew&&this._updateSkew(),this._didContainerChangeTick++,!this.didChange&&(this.didChange=!0,this.parentRenderGroup&&this.parentRenderGroup.onChildUpdate(this))}set isRenderGroup(t){!!this.renderGroup!==t&&(t?this.enableRenderGroup():this.disableRenderGroup())}get isRenderGroup(){return!!this.renderGroup}enableRenderGroup(){if(this.renderGroup)return;const t=this.parentRenderGroup;t==null||t.removeChild(this),this.renderGroup=St.get(Rc,this),this.groupTransform=G.IDENTITY,t==null||t.addChild(this),this._updateIsSimple()}disableRenderGroup(){if(!this.renderGroup)return;const t=this.parentRenderGroup;t==null||t.removeChild(this),St.return(this.renderGroup),this.renderGroup=null,this.groupTransform=this.relativeGroupTransform,t==null||t.addChild(this),this._updateIsSimple()}_updateIsSimple(){this.isSimple=!this.renderGroup&&this.effects.length===0}get worldTransform(){return this._worldTransform||(this._worldTransform=new G),this.renderGroup?this._worldTransform.copyFrom(this.renderGroup.worldTransform):this.parentRenderGroup&&this._worldTransform.appendFrom(this.relativeGroupTransform,this.parentRenderGroup.worldTransform),this._worldTransform}get x(){return this._position.x}set x(t){this._position.x=t}get y(){return this._position.y}set y(t){this._position.y=t}get position(){return this._position}set position(t){this._position.copyFrom(t)}get rotation(){return this._rotation}set rotation(t){this._rotation!==t&&(this._rotation=t,this._onUpdate(this._skew))}get angle(){return this.rotation*ql}set angle(t){this.rotation=t*Kl}get pivot(){return this._pivot===ii&&(this._pivot=new tt(this,0,0)),this._pivot}set pivot(t){this._pivot===ii&&(this._pivot=new tt(this,0,0),this._origin!==ni&&V("Setting both a pivot and origin on a Container is not recommended. This can lead to unexpected behavior if not handled carefully.")),typeof t=="number"?this._pivot.set(t):this._pivot.copyFrom(t)}get skew(){return this._skew===Xi&&(this._skew=new tt(this,0,0)),this._skew}set skew(t){this._skew===Xi&&(this._skew=new tt(this,0,0)),this._skew.copyFrom(t)}get scale(){return this._scale===qi&&(this._scale=new tt(this,1,1)),this._scale}set scale(t){this._scale===qi&&(this._scale=new tt(this,0,0)),typeof t=="string"&&(t=parseFloat(t)),typeof t=="number"?this._scale.set(t):this._scale.copyFrom(t)}get origin(){return this._origin===ni&&(this._origin=new tt(this,0,0)),this._origin}set origin(t){this._origin===ni&&(this._origin=new tt(this,0,0),this._pivot!==ii&&V("Setting both a pivot and origin on a Container is not recommended. This can lead to unexpected behavior if not handled carefully.")),typeof t=="number"?this._origin.set(t):this._origin.copyFrom(t)}get width(){return Math.abs(this.scale.x*this.getLocalBounds().width)}set width(t){const e=this.getLocalBounds().width;this._setWidth(t,e)}get height(){return Math.abs(this.scale.y*this.getLocalBounds().height)}set height(t){const e=this.getLocalBounds().height;this._setHeight(t,e)}getSize(t){t||(t={});const e=this.getLocalBounds();return t.width=Math.abs(this.scale.x*e.width),t.height=Math.abs(this.scale.y*e.height),t}setSize(t,e){const i=this.getLocalBounds();typeof t=="object"?(e=t.height??t.width,t=t.width):e??(e=t),t!==void 0&&this._setWidth(t,i.width),e!==void 0&&this._setHeight(e,i.height)}_updateSkew(){const t=this._rotation,e=this._skew;this._cx=Math.cos(t+e._y),this._sx=Math.sin(t+e._y),this._cy=-Math.sin(t-e._x),this._sy=Math.cos(t-e._x)}updateTransform(t){return this.position.set(typeof t.x=="number"?t.x:this.position.x,typeof t.y=="number"?t.y:this.position.y),this.scale.set(typeof t.scaleX=="number"?t.scaleX||1:this.scale.x,typeof t.scaleY=="number"?t.scaleY||1:this.scale.y),this.rotation=typeof t.rotation=="number"?t.rotation:this.rotation,this.skew.set(typeof t.skewX=="number"?t.skewX:this.skew.x,typeof t.skewY=="number"?t.skewY:this.skew.y),this.pivot.set(typeof t.pivotX=="number"?t.pivotX:this.pivot.x,typeof t.pivotY=="number"?t.pivotY:this.pivot.y),this.origin.set(typeof t.originX=="number"?t.originX:this.origin.x,typeof t.originY=="number"?t.originY:this.origin.y),this}setFromMatrix(t){t.decompose(this)}updateLocalTransform(){const t=this._didContainerChangeTick;if(this._didLocalTransformChangeId===t)return;this._didLocalTransformChangeId=t;const e=this.localTransform,i=this._scale,n=this._pivot,r=this._origin,o=this._position,a=i._x,l=i._y,c=n._x,h=n._y,d=-r._x,f=-r._y;e.a=this._cx*a,e.b=this._sx*a,e.c=this._cy*l,e.d=this._sy*l,e.tx=o._x-(c*e.a+h*e.c)+(d*e.a+f*e.c)-d,e.ty=o._y-(c*e.b+h*e.d)+(d*e.b+f*e.d)-f}set alpha(t){t!==this.localAlpha&&(this.localAlpha=t,this._updateFlags|=Br,this._onUpdate())}get alpha(){return this.localAlpha}set tint(t){const i=Q.shared.setValue(t??16777215).toBgrNumber();i!==this.localColor&&(this.localColor=i,this._updateFlags|=Br,this._onUpdate())}get tint(){return gi(this.localColor)}set blendMode(t){this.localBlendMode!==t&&(this.parentRenderGroup&&(this.parentRenderGroup.structureDidChange=!0),this._updateFlags|=zc,this.localBlendMode=t,this._onUpdate())}get blendMode(){return this.localBlendMode}get visible(){return!!(this.localDisplayStatus&2)}set visible(t){const e=t?2:0;(this.localDisplayStatus&2)!==e&&(this.parentRenderGroup&&(this.parentRenderGroup.structureDidChange=!0),this._updateFlags|=Ki,this.localDisplayStatus^=2,this._onUpdate())}get culled(){return!(this.localDisplayStatus&4)}set culled(t){const e=t?0:4;(this.localDisplayStatus&4)!==e&&(this.parentRenderGroup&&(this.parentRenderGroup.structureDidChange=!0),this._updateFlags|=Ki,this.localDisplayStatus^=4,this._onUpdate())}get renderable(){return!!(this.localDisplayStatus&1)}set renderable(t){const e=t?1:0;(this.localDisplayStatus&1)!==e&&(this._updateFlags|=Ki,this.localDisplayStatus^=1,this.parentRenderGroup&&(this.parentRenderGroup.structureDidChange=!0),this._onUpdate())}get isRenderable(){return this.localDisplayStatus===7&&this.groupAlpha>0}destroy(t=!1){var n;if(this.destroyed)return;this.destroyed=!0;let e;if(this.children.length&&(e=this.removeChildren(0,this.children.length)),this.removeFromParent(),this.parent=null,this._maskEffect=null,this._filterEffect=null,this.effects=null,this._position=null,this._scale=null,this._pivot=null,this._origin=null,this._skew=null,this.emit("destroyed",this),this.removeAllListeners(),(typeof t=="boolean"?t:t==null?void 0:t.children)&&e)for(let r=0;r<e.length;++r)e[r].destroy(t);(n=this.renderGroup)==null||n.destroy(),this.renderGroup=null}}st.mixin(lt,xc,Ac,Ic,Tc,Mc,wc,vc,Pc,fc,gc,kc,bc);class Wn extends lt{constructor(t){super(t),this.canBundle=!0,this.allowChildren=!1,this._roundPixels=0,this._lastUsed=-1,this._gpuData=Object.create(null),this._bounds=new Lt(0,1,0,0),this._boundsDirty=!0}get bounds(){return this._boundsDirty?(this.updateBounds(),this._boundsDirty=!1,this._bounds):this._bounds}get roundPixels(){return!!this._roundPixels}set roundPixels(t){this._roundPixels=t?1:0}containsPoint(t){const e=this.bounds,{x:i,y:n}=t;return i>=e.minX&&i<=e.maxX&&n>=e.minY&&n<=e.maxY}onViewUpdate(){if(this._didViewChangeTick++,this._boundsDirty=!0,this.didViewUpdate)return;this.didViewUpdate=!0;const t=this.renderGroup||this.parentRenderGroup;t&&t.onChildViewUpdate(this)}destroy(t){var e,i;super.destroy(t),this._bounds=null;for(const n in this._gpuData)(i=(e=this._gpuData[n]).destroy)==null||i.call(e);this._gpuData=null}collectRenderablesSimple(t,e,i){const{renderPipes:n}=e;n.blendMode.pushBlendMode(this,this.groupBlendMode,t),n[this.renderPipeId].addRenderable(this,t),this.didViewUpdate=!1;const o=this.children,a=o.length;for(let l=0;l<a;l++)o[l].collectRenderables(t,e,i);n.blendMode.popBlendMode(t)}}class Ue extends Wn{constructor(t=O.EMPTY){t instanceof O&&(t={texture:t});const{texture:e=O.EMPTY,anchor:i,roundPixels:n,width:r,height:o,...a}=t;super({label:"Sprite",...a}),this.renderPipeId="sprite",this.batched=!0,this._visualBounds={minX:0,maxX:1,minY:0,maxY:0},this._anchor=new tt({_onUpdate:()=>{this.onViewUpdate()}}),i?this.anchor=i:e.defaultAnchor&&(this.anchor=e.defaultAnchor),this.texture=e,this.allowChildren=!1,this.roundPixels=n??!1,r!==void 0&&(this.width=r),o!==void 0&&(this.height=o)}static from(t,e=!1){return t instanceof O?new Ue(t):new Ue(O.from(t,e))}set texture(t){t||(t=O.EMPTY);const e=this._texture;e!==t&&(e&&e.dynamic&&e.off("update",this.onViewUpdate,this),t.dynamic&&t.on("update",this.onViewUpdate,this),this._texture=t,this._width&&this._setWidth(this._width,this._texture.orig.width),this._height&&this._setHeight(this._height,this._texture.orig.height),this.onViewUpdate())}get texture(){return this._texture}get visualBounds(){return ic(this._visualBounds,this._anchor,this._texture),this._visualBounds}get sourceBounds(){return z("8.6.1","Sprite.sourceBounds is deprecated, use visualBounds instead."),this.visualBounds}updateBounds(){const t=this._anchor,e=this._texture,i=this._bounds,{width:n,height:r}=e.orig;i.minX=-t._x*n,i.maxX=i.minX+n,i.minY=-t._y*r,i.maxY=i.minY+r}destroy(t=!1){if(super.destroy(t),typeof t=="boolean"?t:t==null?void 0:t.texture){const i=typeof t=="boolean"?t:t==null?void 0:t.textureSource;this._texture.destroy(i)}this._texture=null,this._visualBounds=null,this._bounds=null,this._anchor=null,this._gpuData=null}get anchor(){return this._anchor}set anchor(t){typeof t=="number"?this._anchor.set(t):this._anchor.copyFrom(t)}get width(){return Math.abs(this.scale.x)*this._texture.orig.width}set width(t){this._setWidth(t,this._texture.orig.width),this._width=t}get height(){return Math.abs(this.scale.y)*this._texture.orig.height}set height(t){this._setHeight(t,this._texture.orig.height),this._height=t}getSize(t){return t||(t={}),t.width=Math.abs(this.scale.x)*this._texture.orig.width,t.height=Math.abs(this.scale.y)*this._texture.orig.height,t}setSize(t,e){typeof t=="object"?(e=t.height??t.width,t=t.width):e??(e=t),t!==void 0&&this._setWidth(t,this._texture.orig.width),e!==void 0&&this._setHeight(e,this._texture.orig.height)}}const Gc=new Lt;function la(s,t,e){const i=Gc;s.measurable=!0,ta(s,e,i),t.addBoundsMask(i),s.measurable=!1}function ca(s,t,e){const i=Vt.get();s.measurable=!0;const n=ct.get().identity(),r=ha(s,e,n);ia(s,i,r),s.measurable=!1,t.addBoundsMask(i),ct.return(n),Vt.return(i)}function ha(s,t,e){return s?(s!==t&&(ha(s.parent,t,e),s.updateLocalTransform(),e.append(s.localTransform)),e):(V("Mask bounds, renderable is not inside the root container"),e)}class da{constructor(t){this.priority=0,this.inverse=!1,this.pipe="alphaMask",t!=null&&t.mask&&this.init(t.mask)}init(t){this.mask=t,this.renderMaskToTexture=!(t instanceof Ue),this.mask.renderable=this.renderMaskToTexture,this.mask.includeInBuild=!this.renderMaskToTexture,this.mask.measurable=!1}reset(){this.mask.measurable=!0,this.mask=null}addBounds(t,e){this.inverse||la(this.mask,t,e)}addLocalBounds(t,e){ca(this.mask,t,e)}containsPoint(t,e){const i=this.mask;return e(i,t)}destroy(){this.reset()}static test(t){return t instanceof Ue}}da.extension=E.MaskEffect;class ua{constructor(t){this.priority=0,this.pipe="colorMask",t!=null&&t.mask&&this.init(t.mask)}init(t){this.mask=t}destroy(){}static test(t){return typeof t=="number"}}ua.extension=E.MaskEffect;class fa{constructor(t){this.priority=0,this.pipe="stencilMask",t!=null&&t.mask&&this.init(t.mask)}init(t){this.mask=t,this.mask.includeInBuild=!1,this.mask.measurable=!1}reset(){this.mask.measurable=!0,this.mask.includeInBuild=!0,this.mask=null}addBounds(t,e){la(this.mask,t,e)}addLocalBounds(t,e){ca(this.mask,t,e)}containsPoint(t,e){const i=this.mask;return e(i,t)}destroy(){this.reset()}static test(t){return t instanceof lt}}fa.extension=E.MaskEffect;const Oc={createCanvas:(s,t)=>{const e=document.createElement("canvas");return e.width=s,e.height=t,e},createImage:()=>new Image,getCanvasRenderingContext2D:()=>CanvasRenderingContext2D,getWebGLRenderingContext:()=>WebGLRenderingContext,getNavigator:()=>navigator,getBaseUrl:()=>document.baseURI??window.location.href,getFontFaceSet:()=>document.fonts,fetch:(s,t)=>fetch(s,t),parseXML:s=>new DOMParser().parseFromString(s,"text/xml")};let Rr=Oc;const H={get(){return Rr},set(s){Rr=s}};class pa extends Ft{constructor(t){t.resource||(t.resource=H.get().createCanvas()),t.width||(t.width=t.resource.width,t.autoDensity||(t.width/=t.resolution)),t.height||(t.height=t.resource.height,t.autoDensity||(t.height/=t.resolution)),super(t),this.uploadMethodId="image",this.autoDensity=t.autoDensity,this.resizeCanvas(),this.transparent=!!t.transparent}resizeCanvas(){this.autoDensity&&"style"in this.resource&&(this.resource.style.width=`${this.width}px`,this.resource.style.height=`${this.height}px`),(this.resource.width!==this.pixelWidth||this.resource.height!==this.pixelHeight)&&(this.resource.width=this.pixelWidth,this.resource.height=this.pixelHeight)}resize(t=this.width,e=this.height,i=this._resolution){const n=super.resize(t,e,i);return n&&this.resizeCanvas(),n}static test(t){return globalThis.HTMLCanvasElement&&t instanceof HTMLCanvasElement||globalThis.OffscreenCanvas&&t instanceof OffscreenCanvas}get context2D(){return this._context2D||(this._context2D=this.resource.getContext("2d"))}}pa.extension=E.TextureSource;class ve extends Ft{constructor(t){super(t),this.uploadMethodId="image",this.autoGarbageCollect=!0}static test(t){return globalThis.HTMLImageElement&&t instanceof HTMLImageElement||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||globalThis.VideoFrame&&t instanceof VideoFrame}}ve.extension=E.TextureSource;var Sn=(s=>(s[s.INTERACTION=50]="INTERACTION",s[s.HIGH=25]="HIGH",s[s.NORMAL=0]="NORMAL",s[s.LOW=-25]="LOW",s[s.UTILITY=-50]="UTILITY",s))(Sn||{});class Zi{constructor(t,e=null,i=0,n=!1){this.next=null,this.previous=null,this._destroyed=!1,this._fn=t,this._context=e,this.priority=i,this._once=n}match(t,e=null){return this._fn===t&&this._context===e}emit(t){this._fn&&(this._context?this._fn.call(this._context,t):this._fn(t));const e=this.next;return this._once&&this.destroy(!0),this._destroyed&&(this.next=null),e}connect(t){this.previous=t,t.next&&(t.next.previous=this),this.next=t.next,t.next=this}destroy(t=!1){this._destroyed=!0,this._fn=null,this._context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);const e=this.next;return this.next=t?null:e,this.previous=null,e}}const ma=class mt{constructor(){this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new Zi(null,null,1/0),this.deltaMS=1/mt.targetFPMS,this.elapsedMS=1/mt.targetFPMS,this._tick=t=>{this._requestId=null,this.started&&(this.update(t),this.started&&this._requestId===null&&this._head.next&&(this._requestId=requestAnimationFrame(this._tick)))}}_requestIfNeeded(){this._requestId===null&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))}_cancelIfNeeded(){this._requestId!==null&&(cancelAnimationFrame(this._requestId),this._requestId=null)}_startIfPossible(){this.started?this._requestIfNeeded():this.autoStart&&this.start()}add(t,e,i=Sn.NORMAL){return this._addListener(new Zi(t,e,i))}addOnce(t,e,i=Sn.NORMAL){return this._addListener(new Zi(t,e,i,!0))}_addListener(t){let e=this._head.next,i=this._head;if(!e)t.connect(i);else{for(;e;){if(t.priority>e.priority){t.connect(i);break}i=e,e=e.next}t.previous||t.connect(i)}return this._startIfPossible(),this}remove(t,e){let i=this._head.next;for(;i;)i.match(t,e)?i=i.destroy():i=i.next;return this._head.next||this._cancelIfNeeded(),this}get count(){if(!this._head)return 0;let t=0,e=this._head;for(;e=e.next;)t++;return t}start(){this.started||(this.started=!0,this._requestIfNeeded())}stop(){this.started&&(this.started=!1,this._cancelIfNeeded())}destroy(){if(!this._protected){this.stop();let t=this._head.next;for(;t;)t=t.destroy(!0);this._head.destroy(),this._head=null}}update(t=performance.now()){let e;if(t>this.lastTime){if(e=this.elapsedMS=t-this.lastTime,e>this._maxElapsedMS&&(e=this._maxElapsedMS),e*=this.speed,this._minElapsedMS){const r=t-this._lastFrame|0;if(r<this._minElapsedMS)return;this._lastFrame=t-r%this._minElapsedMS}this.deltaMS=e,this.deltaTime=this.deltaMS*mt.targetFPMS;const i=this._head;let n=i.next;for(;n;)n=n.emit(this);i.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=t}get FPS(){return 1e3/this.elapsedMS}get minFPS(){return 1e3/this._maxElapsedMS}set minFPS(t){const e=Math.min(this.maxFPS,t),i=Math.min(Math.max(0,e)/1e3,mt.targetFPMS);this._maxElapsedMS=1/i}get maxFPS(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0}set maxFPS(t){if(t===0)this._minElapsedMS=0;else{const e=Math.max(this.minFPS,t);this._minElapsedMS=1/(e/1e3)}}static get shared(){if(!mt._shared){const t=mt._shared=new mt;t.autoStart=!0,t._protected=!0}return mt._shared}static get system(){if(!mt._system){const t=mt._system=new mt;t.autoStart=!0,t._protected=!0}return mt._system}};ma.targetFPMS=.06;let ri=ma,Qi;async function ga(){return Qi??(Qi=(async()=>{var o;const t=H.get().createCanvas(1,1).getContext("webgl");if(!t)return"premultiply-alpha-on-upload";const e=await new Promise(a=>{const l=document.createElement("video");l.onloadeddata=()=>a(l),l.onerror=()=>a(null),l.autoplay=!1,l.crossOrigin="anonymous",l.preload="auto",l.src="data:video/webm;base64,GkXfo59ChoEBQveBAULygQRC84EIQoKEd2VibUKHgQJChYECGFOAZwEAAAAAAAHTEU2bdLpNu4tTq4QVSalmU6yBoU27i1OrhBZUrmtTrIHGTbuMU6uEElTDZ1OsggEXTbuMU6uEHFO7a1OsggG97AEAAAAAAABZAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVSalmoCrXsYMPQkBNgIRMYXZmV0GETGF2ZkSJiEBEAAAAAAAAFlSua8yuAQAAAAAAAEPXgQFzxYgAAAAAAAAAAZyBACK1nIN1bmSIgQCGhVZfVlA5g4EBI+ODhAJiWgDglLCBArqBApqBAlPAgQFVsIRVuYEBElTDZ9Vzc9JjwItjxYgAAAAAAAAAAWfInEWjh0VOQ09ERVJEh49MYXZjIGxpYnZweC12cDlnyKJFo4hEVVJBVElPTkSHlDAwOjAwOjAwLjA0MDAwMDAwMAAAH0O2dcfngQCgwqGggQAAAIJJg0IAABAAFgA4JBwYSgAAICAAEb///4r+AAB1oZ2mm+6BAaWWgkmDQgAAEAAWADgkHBhKAAAgIABIQBxTu2uRu4+zgQC3iveBAfGCAXHwgQM=",l.load()});if(!e)return"premultiply-alpha-on-upload";const i=t.createTexture();t.bindTexture(t.TEXTURE_2D,i);const n=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,n),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,i,0),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,t.NONE),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e);const r=new Uint8Array(4);return t.readPixels(0,0,1,1,t.RGBA,t.UNSIGNED_BYTE,r),t.deleteFramebuffer(n),t.deleteTexture(i),(o=t.getExtension("WEBGL_lose_context"))==null||o.loseContext(),r[0]<=r[3]?"premultiplied-alpha":"premultiply-alpha-on-upload"})()),Qi}const Ti=class ya extends Ft{constructor(t){super(t),this.isReady=!1,this.uploadMethodId="video",t={...ya.defaultOptions,...t},this._autoUpdate=!0,this._isConnectedToTicker=!1,this._updateFPS=t.updateFPS||0,this._msToNextUpdate=0,this.autoPlay=t.autoPlay!==!1,this.alphaMode=t.alphaMode??"premultiply-alpha-on-upload",this._videoFrameRequestCallback=this._videoFrameRequestCallback.bind(this),this._videoFrameRequestCallbackHandle=null,this._load=null,this._resolve=null,this._reject=null,this._onCanPlay=this._onCanPlay.bind(this),this._onCanPlayThrough=this._onCanPlayThrough.bind(this),this._onError=this._onError.bind(this),this._onPlayStart=this._onPlayStart.bind(this),this._onPlayStop=this._onPlayStop.bind(this),this._onSeeked=this._onSeeked.bind(this),t.autoLoad!==!1&&this.load()}updateFrame(){if(!this.destroyed){if(this._updateFPS){const t=ri.shared.elapsedMS*this.resource.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-t)}(!this._updateFPS||this._msToNextUpdate<=0)&&(this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0),this.isValid&&this.update()}}_videoFrameRequestCallback(){this.updateFrame(),this.destroyed?this._videoFrameRequestCallbackHandle=null:this._videoFrameRequestCallbackHandle=this.resource.requestVideoFrameCallback(this._videoFrameRequestCallback)}get isValid(){return!!this.resource.videoWidth&&!!this.resource.videoHeight}async load(){if(this._load)return this._load;const t=this.resource,e=this.options;return(t.readyState===t.HAVE_ENOUGH_DATA||t.readyState===t.HAVE_FUTURE_DATA)&&t.width&&t.height&&(t.complete=!0),t.addEventListener("play",this._onPlayStart),t.addEventListener("pause",this._onPlayStop),t.addEventListener("seeked",this._onSeeked),this._isSourceReady()?this._mediaReady():(e.preload||t.addEventListener("canplay",this._onCanPlay),t.addEventListener("canplaythrough",this._onCanPlayThrough),t.addEventListener("error",this._onError,!0)),this.alphaMode=await ga(),this._load=new Promise((i,n)=>{this.isValid?i(this):(this._resolve=i,this._reject=n,e.preloadTimeoutMs!==void 0&&(this._preloadTimeout=setTimeout(()=>{this._onError(new ErrorEvent(`Preload exceeded timeout of ${e.preloadTimeoutMs}ms`))})),t.load())}),this._load}_onError(t){this.resource.removeEventListener("error",this._onError,!0),this.emit("error",t),this._reject&&(this._reject(t),this._reject=null,this._resolve=null)}_isSourcePlaying(){const t=this.resource;return!t.paused&&!t.ended}_isSourceReady(){return this.resource.readyState>2}_onPlayStart(){this.isValid||this._mediaReady(),this._configureAutoUpdate()}_onPlayStop(){this._configureAutoUpdate()}_onSeeked(){this._autoUpdate&&!this._isSourcePlaying()&&(this._msToNextUpdate=0,this.updateFrame(),this._msToNextUpdate=0)}_onCanPlay(){this.resource.removeEventListener("canplay",this._onCanPlay),this._mediaReady()}_onCanPlayThrough(){this.resource.removeEventListener("canplaythrough",this._onCanPlay),this._preloadTimeout&&(clearTimeout(this._preloadTimeout),this._preloadTimeout=void 0),this._mediaReady()}_mediaReady(){const t=this.resource;this.isValid&&(this.isReady=!0,this.resize(t.videoWidth,t.videoHeight)),this._msToNextUpdate=0,this.updateFrame(),this._msToNextUpdate=0,this._resolve&&(this._resolve(this),this._resolve=null,this._reject=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&this.resource.play()}destroy(){this._configureAutoUpdate();const t=this.resource;t&&(t.removeEventListener("play",this._onPlayStart),t.removeEventListener("pause",this._onPlayStop),t.removeEventListener("seeked",this._onSeeked),t.removeEventListener("canplay",this._onCanPlay),t.removeEventListener("canplaythrough",this._onCanPlayThrough),t.removeEventListener("error",this._onError,!0),t.pause(),t.src="",t.load()),super.destroy()}get autoUpdate(){return this._autoUpdate}set autoUpdate(t){t!==this._autoUpdate&&(this._autoUpdate=t,this._configureAutoUpdate())}get updateFPS(){return this._updateFPS}set updateFPS(t){t!==this._updateFPS&&(this._updateFPS=t,this._configureAutoUpdate())}_configureAutoUpdate(){this._autoUpdate&&this._isSourcePlaying()?!this._updateFPS&&this.resource.requestVideoFrameCallback?(this._isConnectedToTicker&&(ri.shared.remove(this.updateFrame,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0),this._videoFrameRequestCallbackHandle===null&&(this._videoFrameRequestCallbackHandle=this.resource.requestVideoFrameCallback(this._videoFrameRequestCallback))):(this._videoFrameRequestCallbackHandle!==null&&(this.resource.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker||(ri.shared.add(this.updateFrame,this),this._isConnectedToTicker=!0,this._msToNextUpdate=0)):(this._videoFrameRequestCallbackHandle!==null&&(this.resource.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker&&(ri.shared.remove(this.updateFrame,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0))}static test(t){return globalThis.HTMLVideoElement&&t instanceof HTMLVideoElement}};Ti.extension=E.TextureSource;Ti.defaultOptions={...Ft.defaultOptions,autoLoad:!0,autoPlay:!0,updateFPS:0,crossorigin:!0,loop:!1,muted:!0,playsinline:!0,preload:!1};Ti.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"};let Ss=Ti;const Pt=(s,t,e=!1)=>(Array.isArray(s)||(s=[s]),t?s.map(i=>typeof i=="string"||e?t(i):i):s);class Dc{constructor(){this._parsers=[],this._cache=new Map,this._cacheMap=new Map}reset(){this._cacheMap.clear(),this._cache.clear()}has(t){return this._cache.has(t)}get(t){const e=this._cache.get(t);return e||V(`[Assets] Asset id ${t} was not found in the Cache`),e}set(t,e){const i=Pt(t);let n;for(let l=0;l<this.parsers.length;l++){const c=this.parsers[l];if(c.test(e)){n=c.getCacheableAssets(i,e);break}}const r=new Map(Object.entries(n||{}));n||i.forEach(l=>{r.set(l,e)});const o=[...r.keys()],a={cacheKeys:o,keys:i};i.forEach(l=>{this._cacheMap.set(l,a)}),o.forEach(l=>{const c=n?n[l]:e;this._cache.has(l)&&this._cache.get(l)!==c&&V("[Cache] already has key:",l),this._cache.set(l,r.get(l))})}remove(t){if(!this._cacheMap.has(t)){V(`[Assets] Asset id ${t} was not found in the Cache`);return}const e=this._cacheMap.get(t);e.cacheKeys.forEach(n=>{this._cache.delete(n)}),e.keys.forEach(n=>{this._cacheMap.delete(n)})}get parsers(){return this._parsers}}const Y=new Dc,An=[];st.handleByList(E.TextureSource,An);function xa(s={}){const t=s&&s.resource,e=t?s.resource:s,i=t?s:{resource:s};for(let n=0;n<An.length;n++){const r=An[n];if(r.test(e))return new r(i)}throw new Error(`Could not find a source type for resource: ${i.resource}`)}function $c(s={},t=!1){const e=s&&s.resource,i=e?s.resource:s,n=e?s:{resource:s};if(!t&&Y.has(i))return Y.get(i);const r=new O({source:xa(n)});return r.on("destroy",()=>{Y.has(i)&&Y.remove(i)}),t||Y.set(i,r),r}function Wc(s,t=!1){return typeof s=="string"?Y.get(s):s instanceof Ft?new O({source:s}):$c(s,t)}O.from=Wc;Ft.from=xa;st.add(da,ua,fa,Ss,ve,pa,Dn);var ae=(s=>(s[s.Low=0]="Low",s[s.Normal=1]="Normal",s[s.High=2]="High",s))(ae||{});function Tt(s){if(typeof s!="string")throw new TypeError(`Path must be a string. Received ${JSON.stringify(s)}`)}function us(s){return s.split("?")[0].split("#")[0]}function Nc(s){return s.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function Uc(s,t,e){return s.replace(new RegExp(Nc(t),"g"),e)}function Hc(s,t){let e="",i=0,n=-1,r=0,o=-1;for(let a=0;a<=s.length;++a){if(a<s.length)o=s.charCodeAt(a);else{if(o===47)break;o=47}if(o===47){if(!(n===a-1||r===1))if(n!==a-1&&r===2){if(e.length<2||i!==2||e.charCodeAt(e.length-1)!==46||e.charCodeAt(e.length-2)!==46){if(e.length>2){const l=e.lastIndexOf("/");if(l!==e.length-1){l===-1?(e="",i=0):(e=e.slice(0,l),i=e.length-1-e.lastIndexOf("/")),n=a,r=0;continue}}else if(e.length===2||e.length===1){e="",i=0,n=a,r=0;continue}}}else e.length>0?e+=`/${s.slice(n+1,a)}`:e=s.slice(n+1,a),i=a-n-1;n=a,r=0}else o===46&&r!==-1?++r:r=-1}return e}const yt={toPosix(s){return Uc(s,"\\","/")},isUrl(s){return/^https?:/.test(this.toPosix(s))},isDataUrl(s){return/^data:([a-z]+\/[a-z0-9-+.]+(;[a-z0-9-.!#$%*+.{}|~`]+=[a-z0-9-.!#$%*+.{}()_|~`]+)*)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s<>]*?)$/i.test(s)},isBlobUrl(s){return s.startsWith("blob:")},hasProtocol(s){return/^[^/:]+:/.test(this.toPosix(s))},getProtocol(s){Tt(s),s=this.toPosix(s);const t=/^file:\/\/\//.exec(s);if(t)return t[0];const e=/^[^/:]+:\/{0,2}/.exec(s);return e?e[0]:""},toAbsolute(s,t,e){if(Tt(s),this.isDataUrl(s)||this.isBlobUrl(s))return s;const i=us(this.toPosix(t??H.get().getBaseUrl())),n=us(this.toPosix(e??this.rootname(i)));return s=this.toPosix(s),s.startsWith("/")?yt.join(n,s.slice(1)):this.isAbsolute(s)?s:this.join(i,s)},normalize(s){if(Tt(s),s.length===0)return".";if(this.isDataUrl(s)||this.isBlobUrl(s))return s;s=this.toPosix(s);let t="";const e=s.startsWith("/");this.hasProtocol(s)&&(t=this.rootname(s),s=s.slice(t.length));const i=s.endsWith("/");return s=Hc(s),s.length>0&&i&&(s+="/"),e?`/${s}`:t+s},isAbsolute(s){return Tt(s),s=this.toPosix(s),this.hasProtocol(s)?!0:s.startsWith("/")},join(...s){if(s.length===0)return".";let t;for(let e=0;e<s.length;++e){const i=s[e];if(Tt(i),i.length>0)if(t===void 0)t=i;else{const n=s[e-1]??"";this.joinExtensions.includes(this.extname(n).toLowerCase())?t+=`/../${i}`:t+=`/${i}`}}return t===void 0?".":this.normalize(t)},dirname(s){if(Tt(s),s.length===0)return".";s=this.toPosix(s);let t=s.charCodeAt(0);const e=t===47;let i=-1,n=!0;const r=this.getProtocol(s),o=s;s=s.slice(r.length);for(let a=s.length-1;a>=1;--a)if(t=s.charCodeAt(a),t===47){if(!n){i=a;break}}else n=!1;return i===-1?e?"/":this.isUrl(o)?r+s:r:e&&i===1?"//":r+s.slice(0,i)},rootname(s){Tt(s),s=this.toPosix(s);let t="";if(s.startsWith("/")?t="/":t=this.getProtocol(s),this.isUrl(s)){const e=s.indexOf("/",t.length);e!==-1?t=s.slice(0,e):t=s,t.endsWith("/")||(t+="/")}return t},basename(s,t){Tt(s),t&&Tt(t),s=us(this.toPosix(s));let e=0,i=-1,n=!0,r;if(t!==void 0&&t.length>0&&t.length<=s.length){if(t.length===s.length&&t===s)return"";let o=t.length-1,a=-1;for(r=s.length-1;r>=0;--r){const l=s.charCodeAt(r);if(l===47){if(!n){e=r+1;break}}else a===-1&&(n=!1,a=r+1),o>=0&&(l===t.charCodeAt(o)?--o===-1&&(i=r):(o=-1,i=a))}return e===i?i=a:i===-1&&(i=s.length),s.slice(e,i)}for(r=s.length-1;r>=0;--r)if(s.charCodeAt(r)===47){if(!n){e=r+1;break}}else i===-1&&(n=!1,i=r+1);return i===-1?"":s.slice(e,i)},extname(s){Tt(s),s=us(this.toPosix(s));let t=-1,e=0,i=-1,n=!0,r=0;for(let o=s.length-1;o>=0;--o){const a=s.charCodeAt(o);if(a===47){if(!n){e=o+1;break}continue}i===-1&&(n=!1,i=o+1),a===46?t===-1?t=o:r!==1&&(r=1):t!==-1&&(r=-1)}return t===-1||i===-1||r===0||r===1&&t===i-1&&t===e+1?"":s.slice(t,i)},parse(s){Tt(s);const t={root:"",dir:"",base:"",ext:"",name:""};if(s.length===0)return t;s=us(this.toPosix(s));let e=s.charCodeAt(0);const i=this.isAbsolute(s);let n;t.root=this.rootname(s),i||this.hasProtocol(s)?n=1:n=0;let r=-1,o=0,a=-1,l=!0,c=s.length-1,h=0;for(;c>=n;--c){if(e=s.charCodeAt(c),e===47){if(!l){o=c+1;break}continue}a===-1&&(l=!1,a=c+1),e===46?r===-1?r=c:h!==1&&(h=1):r!==-1&&(h=-1)}return r===-1||a===-1||h===0||h===1&&r===a-1&&r===o+1?a!==-1&&(o===0&&i?t.base=t.name=s.slice(1,a):t.base=t.name=s.slice(o,a)):(o===0&&i?(t.name=s.slice(1,r),t.base=s.slice(1,a)):(t.name=s.slice(o,r),t.base=s.slice(o,a)),t.ext=s.slice(r,a)),t.dir=this.dirname(s),t},sep:"/",delimiter:":",joinExtensions:[".html"]};function ba(s,t,e,i,n){const r=t[e];for(let o=0;o<r.length;o++){const a=r[o];e<t.length-1?ba(s.replace(i[e],a),t,e+1,i,n):n.push(s.replace(i[e],a))}}function Yc(s){const t=/\{(.*?)\}/g,e=s.match(t),i=[];if(e){const n=[];e.forEach(r=>{const o=r.substring(1,r.length-1).split(",");n.push(o)}),ba(s,n,0,e,i)}else i.push(s);return i}const _i=s=>!Array.isArray(s);class Ke{constructor(){this._defaultBundleIdentifierOptions={connector:"-",createBundleAssetId:(t,e)=>`${t}${this._bundleIdConnector}${e}`,extractAssetIdFromBundle:(t,e)=>e.replace(`${t}${this._bundleIdConnector}`,"")},this._bundleIdConnector=this._defaultBundleIdentifierOptions.connector,this._createBundleAssetId=this._defaultBundleIdentifierOptions.createBundleAssetId,this._extractAssetIdFromBundle=this._defaultBundleIdentifierOptions.extractAssetIdFromBundle,this._assetMap={},this._preferredOrder=[],this._parsers=[],this._resolverHash={},this._bundles={}}setBundleIdentifier(t){if(this._bundleIdConnector=t.connector??this._bundleIdConnector,this._createBundleAssetId=t.createBundleAssetId??this._createBundleAssetId,this._extractAssetIdFromBundle=t.extractAssetIdFromBundle??this._extractAssetIdFromBundle,this._extractAssetIdFromBundle("foo",this._createBundleAssetId("foo","bar"))!=="bar")throw new Error("[Resolver] GenerateBundleAssetId are not working correctly")}prefer(...t){t.forEach(e=>{this._preferredOrder.push(e),e.priority||(e.priority=Object.keys(e.params))}),this._resolverHash={}}set basePath(t){this._basePath=t}get basePath(){return this._basePath}set rootPath(t){this._rootPath=t}get rootPath(){return this._rootPath}get parsers(){return this._parsers}reset(){this.setBundleIdentifier(this._defaultBundleIdentifierOptions),this._assetMap={},this._preferredOrder=[],this._resolverHash={},this._rootPath=null,this._basePath=null,this._manifest=null,this._bundles={},this._defaultSearchParams=null}setDefaultSearchParams(t){if(typeof t=="string")this._defaultSearchParams=t;else{const e=t;this._defaultSearchParams=Object.keys(e).map(i=>`${encodeURIComponent(i)}=${encodeURIComponent(e[i])}`).join("&")}}getAlias(t){const{alias:e,src:i}=t;return Pt(e||i,r=>typeof r=="string"?r:Array.isArray(r)?r.map(o=>(o==null?void 0:o.src)??o):r!=null&&r.src?r.src:r,!0)}addManifest(t){this._manifest&&V("[Resolver] Manifest already exists, this will be overwritten"),this._manifest=t,t.bundles.forEach(e=>{this.addBundle(e.name,e.assets)})}addBundle(t,e){const i=[];let n=e;Array.isArray(e)||(n=Object.entries(e).map(([r,o])=>typeof o=="string"||Array.isArray(o)?{alias:r,src:o}:{alias:r,...o})),n.forEach(r=>{const o=r.src,a=r.alias;let l;if(typeof a=="string"){const c=this._createBundleAssetId(t,a);i.push(c),l=[a,c]}else{const c=a.map(h=>this._createBundleAssetId(t,h));i.push(...c),l=[...a,...c]}this.add({...r,alias:l,src:o})}),this._bundles[t]=i}add(t){const e=[];Array.isArray(t)?e.push(...t):e.push(t);let i;i=r=>{this.hasKey(r)&&V(`[Resolver] already has key: ${r} overwriting`)},Pt(e).forEach(r=>{const{src:o}=r;let{data:a,format:l,loadParser:c,parser:h}=r;const d=Pt(o).map(m=>typeof m=="string"?Yc(m):Array.isArray(m)?m:[m]),f=this.getAlias(r);Array.isArray(f)?f.forEach(i):i(f);const u=[];d.forEach(m=>{m.forEach(y=>{let p={};if(typeof y!="object"){p.src=y;for(let g=0;g<this._parsers.length;g++){const x=this._parsers[g];if(x.test(y)){p=x.parse(y);break}}}else a=y.data??a,l=y.format??l,(y.loadParser||y.parser)&&(c=y.loadParser??c,h=y.parser??h),p={...p,...y};if(!f)throw new Error(`[Resolver] alias is undefined for this asset: ${p.src}`);p=this._buildResolvedAsset(p,{aliases:f,data:a,format:l,loadParser:c,parser:h}),u.push(p)})}),f.forEach(m=>{this._assetMap[m]=u})})}resolveBundle(t){const e=_i(t);t=Pt(t);const i={};return t.forEach(n=>{const r=this._bundles[n];if(r){const o=this.resolve(r),a={};for(const l in o){const c=o[l];a[this._extractAssetIdFromBundle(n,l)]=c}i[n]=a}}),e?i[t[0]]:i}resolveUrl(t){const e=this.resolve(t);if(typeof t!="string"){const i={};for(const n in e)i[n]=e[n].src;return i}return e.src}resolve(t){const e=_i(t);t=Pt(t);const i={};return t.forEach(n=>{if(!this._resolverHash[n])if(this._assetMap[n]){let r=this._assetMap[n];const o=this._getPreferredOrder(r);o==null||o.priority.forEach(a=>{o.params[a].forEach(l=>{const c=r.filter(h=>h[a]?h[a]===l:!1);c.length&&(r=c)})}),this._resolverHash[n]=r[0]}else this._resolverHash[n]=this._buildResolvedAsset({alias:[n],src:n},{});i[n]=this._resolverHash[n]}),e?i[t[0]]:i}hasKey(t){return!!this._assetMap[t]}hasBundle(t){return!!this._bundles[t]}_getPreferredOrder(t){for(let e=0;e<t.length;e++){const i=t[e],n=this._preferredOrder.find(r=>r.params.format.includes(i.format));if(n)return n}return this._preferredOrder[0]}_appendDefaultSearchParams(t){if(!this._defaultSearchParams)return t;const e=/\?/.test(t)?"&":"?";return`${t}${e}${this._defaultSearchParams}`}_buildResolvedAsset(t,e){const{aliases:i,data:n,loadParser:r,parser:o,format:a}=e;return(this._basePath||this._rootPath)&&(t.src=yt.toAbsolute(t.src,this._basePath,this._rootPath)),t.alias=i??t.alias??[t.src],t.src=this._appendDefaultSearchParams(t.src),t.data={...n||{},...t.data},t.loadParser=r??t.loadParser,t.parser=o??t.parser,t.format=a??t.format??Vc(t.src),t}}Ke.RETINA_PREFIX=/@([0-9\.]+)x/;function Vc(s){return s.split(".").pop().split("?").shift().split("#").shift()}const kn=(s,t)=>{const e=t.split("?")[1];return e&&(s+=`?${e}`),s},_a=class bs{constructor(t,e){this.linkedSheets=[];let i=t;(t==null?void 0:t.source)instanceof Ft&&(i={texture:t,data:e});const{texture:n,data:r,cachePrefix:o=""}=i;this.cachePrefix=o,this._texture=n instanceof O?n:null,this.textureSource=n.source,this.textures={},this.animations={},this.data=r;const a=parseFloat(r.meta.scale);a?(this.resolution=a,n.source.resolution=this.resolution):this.resolution=n.source._resolution,this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}parse(){return new Promise(t=>{this._callback=t,this._batchIndex=0,this._frameKeys.length<=bs.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()})}_processFrames(t){let e=t;const i=bs.BATCH_SIZE;for(;e-t<i&&e<this._frameKeys.length;){const n=this._frameKeys[e],r=this._frames[n],o=r.frame;if(o){let a=null,l=null;const c=r.trimmed!==!1&&r.sourceSize?r.sourceSize:r.frame,h=new j(0,0,Math.floor(c.w)/this.resolution,Math.floor(c.h)/this.resolution);r.rotated?a=new j(Math.floor(o.x)/this.resolution,Math.floor(o.y)/this.resolution,Math.floor(o.h)/this.resolution,Math.floor(o.w)/this.resolution):a=new j(Math.floor(o.x)/this.resolution,Math.floor(o.y)/this.resolution,Math.floor(o.w)/this.resolution,Math.floor(o.h)/this.resolution),r.trimmed!==!1&&r.spriteSourceSize&&(l=new j(Math.floor(r.spriteSourceSize.x)/this.resolution,Math.floor(r.spriteSourceSize.y)/this.resolution,Math.floor(o.w)/this.resolution,Math.floor(o.h)/this.resolution)),this.textures[n]=new O({source:this.textureSource,frame:a,orig:h,trim:l,rotate:r.rotated?2:0,defaultAnchor:r.anchor,defaultBorders:r.borders,label:n.toString()})}e++}}_processAnimations(){const t=this.data.animations||{};for(const e in t){this.animations[e]=[];for(let i=0;i<t[e].length;i++){const n=t[e][i];this.animations[e].push(this.textures[n])}}}_parseComplete(){const t=this._callback;this._callback=null,this._batchIndex=0,t.call(this,this.textures)}_nextBatch(){this._processFrames(this._batchIndex*bs.BATCH_SIZE),this._batchIndex++,setTimeout(()=>{this._batchIndex*bs.BATCH_SIZE<this._frameKeys.length?this._nextBatch():(this._processAnimations(),this._parseComplete())},0)}destroy(t=!1){var e;for(const i in this.textures)this.textures[i].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,t&&((e=this._texture)==null||e.destroy(),this.textureSource.destroy()),this._texture=null,this.textureSource=null,this.linkedSheets=[]}};_a.BATCH_SIZE=1e3;let Fr=_a;const jc=["jpg","png","jpeg","avif","webp","basis","etc2","bc7","bc6h","bc5","bc4","bc3","bc2","bc1","eac","astc"];function wa(s,t,e){const i={};if(s.forEach(n=>{i[n]=t}),Object.keys(t.textures).forEach(n=>{i[`${t.cachePrefix}${n}`]=t.textures[n]}),!e){const n=yt.dirname(s[0]);t.linkedSheets.forEach((r,o)=>{const a=wa([`${n}/${t.data.meta.related_multi_packs[o]}`],r,!0);Object.assign(i,a)})}return i}const Xc={extension:E.Asset,cache:{test:s=>s instanceof Fr,getCacheableAssets:(s,t)=>wa(s,t,!1)},resolver:{extension:{type:E.ResolveParser,name:"resolveSpritesheet"},test:s=>{const e=s.split("?")[0].split("."),i=e.pop(),n=e.pop();return i==="json"&&jc.includes(n)},parse:s=>{var e;const t=s.split(".");return{resolution:parseFloat(((e=Ke.RETINA_PREFIX.exec(s))==null?void 0:e[1])??"1"),format:t[t.length-2],src:s}}},loader:{name:"spritesheetLoader",id:"spritesheet",extension:{type:E.LoadParser,priority:ae.Normal,name:"spritesheetLoader"},async testParse(s,t){return yt.extname(t.src).toLowerCase()===".json"&&!!s.frames},async parse(s,t,e){var d,f;const{texture:i,imageFilename:n,textureOptions:r,cachePrefix:o}=(t==null?void 0:t.data)??{};let a=yt.dirname(t.src);a&&a.lastIndexOf("/")!==a.length-1&&(a+="/");let l;if(i instanceof O)l=i;else{const u=kn(a+(n??s.meta.image),t.src);l=(await e.load([{src:u,data:r}]))[u]}const c=new Fr({texture:l.source,data:s,cachePrefix:o});await c.parse();const h=(d=s==null?void 0:s.meta)==null?void 0:d.related_multi_packs;if(Array.isArray(h)){const u=[];for(const y of h){if(typeof y!="string")continue;let p=a+y;(f=t.data)!=null&&f.ignoreMultiPack||(p=kn(p,t.src),u.push(e.load({src:p,data:{textureOptions:r,ignoreMultiPack:!0}})))}const m=await Promise.all(u);c.linkedSheets=m,m.forEach(y=>{y.linkedSheets=[c].concat(c.linkedSheets.filter(p=>p!==y))})}return c},async unload(s,t,e){await e.unload(s.textureSource._sourceOrigin),s.destroy(!1)}}};st.add(Xc);const Ji=Object.create(null),zr=Object.create(null);function Nn(s,t){let e=zr[s];return e===void 0&&(Ji[t]===void 0&&(Ji[t]=1),zr[s]=e=Ji[t]++),e}let Ie;function va(){return(!Ie||Ie!=null&&Ie.isContextLost())&&(Ie=H.get().createCanvas().getContext("webgl",{})),Ie}let oi;function qc(){if(!oi){oi="mediump";const s=va();s&&s.getShaderPrecisionFormat&&(oi=s.getShaderPrecisionFormat(s.FRAGMENT_SHADER,s.HIGH_FLOAT).precision?"highp":"mediump")}return oi}function Kc(s,t,e){return t?s:e?(s=s.replace("out vec4 finalColor;",""),`

        #ifdef GL_ES // This checks if it is WebGL1
        #define in varying
        #define finalColor gl_FragColor
        #define texture texture2D
        #endif
        ${s}
        `):`

        #ifdef GL_ES // This checks if it is WebGL1
        #define in attribute
        #define out varying
        #endif
        ${s}
        `}function Zc(s,t,e){const i=e?t.maxSupportedFragmentPrecision:t.maxSupportedVertexPrecision;if(s.substring(0,9)!=="precision"){let n=e?t.requestedFragmentPrecision:t.requestedVertexPrecision;return n==="highp"&&i!=="highp"&&(n="mediump"),`precision ${n} float;
${s}`}else if(i!=="highp"&&s.substring(0,15)==="precision highp")return s.replace("precision highp","precision mediump");return s}function Qc(s,t){return t?`#version 300 es
${s}`:s}const Jc={},th={};function eh(s,{name:t="pixi-program"},e=!0){t=t.replace(/\s+/g,"-"),t+=e?"-fragment":"-vertex";const i=e?Jc:th;return i[t]?(i[t]++,t+=`-${i[t]}`):i[t]=1,s.indexOf("#define SHADER_NAME")!==-1?s:`${`#define SHADER_NAME ${t}`}
${s}`}function sh(s,t){return t?s.replace("#version 300 es",""):s}const tn={stripVersion:sh,ensurePrecision:Zc,addProgramDefines:Kc,setProgramName:eh,insertVersion:Qc},fs=Object.create(null),Sa=class Cn{constructor(t){t={...Cn.defaultOptions,...t};const e=t.fragment.indexOf("#version 300 es")!==-1,i={stripVersion:e,ensurePrecision:{requestedFragmentPrecision:t.preferredFragmentPrecision,requestedVertexPrecision:t.preferredVertexPrecision,maxSupportedVertexPrecision:"highp",maxSupportedFragmentPrecision:qc()},setProgramName:{name:t.name},addProgramDefines:e,insertVersion:e};let n=t.fragment,r=t.vertex;Object.keys(tn).forEach(o=>{const a=i[o];n=tn[o](n,a,!0),r=tn[o](r,a,!1)}),this.fragment=n,this.vertex=r,this.transformFeedbackVaryings=t.transformFeedbackVaryings,this._key=Nn(`${this.vertex}:${this.fragment}`,"gl-program")}destroy(){this.fragment=null,this.vertex=null,this._attributeData=null,this._uniformData=null,this._uniformBlockData=null,this.transformFeedbackVaryings=null,fs[this._cacheKey]=null}static from(t){const e=`${t.vertex}:${t.fragment}`;return fs[e]||(fs[e]=new Cn(t),fs[e]._cacheKey=e),fs[e]}};Sa.defaultOptions={preferredVertexPrecision:"highp",preferredFragmentPrecision:"mediump"};let Aa=Sa;const Gr={uint8x2:{size:2,stride:2,normalised:!1},uint8x4:{size:4,stride:4,normalised:!1},sint8x2:{size:2,stride:2,normalised:!1},sint8x4:{size:4,stride:4,normalised:!1},unorm8x2:{size:2,stride:2,normalised:!0},unorm8x4:{size:4,stride:4,normalised:!0},snorm8x2:{size:2,stride:2,normalised:!0},snorm8x4:{size:4,stride:4,normalised:!0},uint16x2:{size:2,stride:4,normalised:!1},uint16x4:{size:4,stride:8,normalised:!1},sint16x2:{size:2,stride:4,normalised:!1},sint16x4:{size:4,stride:8,normalised:!1},unorm16x2:{size:2,stride:4,normalised:!0},unorm16x4:{size:4,stride:8,normalised:!0},snorm16x2:{size:2,stride:4,normalised:!0},snorm16x4:{size:4,stride:8,normalised:!0},float16x2:{size:2,stride:4,normalised:!1},float16x4:{size:4,stride:8,normalised:!1},float32:{size:1,stride:4,normalised:!1},float32x2:{size:2,stride:8,normalised:!1},float32x3:{size:3,stride:12,normalised:!1},float32x4:{size:4,stride:16,normalised:!1},uint32:{size:1,stride:4,normalised:!1},uint32x2:{size:2,stride:8,normalised:!1},uint32x3:{size:3,stride:12,normalised:!1},uint32x4:{size:4,stride:16,normalised:!1},sint32:{size:1,stride:4,normalised:!1},sint32x2:{size:2,stride:8,normalised:!1},sint32x3:{size:3,stride:12,normalised:!1},sint32x4:{size:4,stride:16,normalised:!1}};function ih(s){return Gr[s]??Gr.float32}const nh={f32:"float32","vec2<f32>":"float32x2","vec3<f32>":"float32x3","vec4<f32>":"float32x4",vec2f:"float32x2",vec3f:"float32x3",vec4f:"float32x4",i32:"sint32","vec2<i32>":"sint32x2","vec3<i32>":"sint32x3","vec4<i32>":"sint32x4",u32:"uint32","vec2<u32>":"uint32x2","vec3<u32>":"uint32x3","vec4<u32>":"uint32x4",bool:"uint32","vec2<bool>":"uint32x2","vec3<bool>":"uint32x3","vec4<bool>":"uint32x4"};function rh({source:s,entryPoint:t}){const e={},i=s.indexOf(`fn ${t}`);if(i!==-1){const n=s.indexOf("->",i);if(n!==-1){const r=s.substring(i,n),o=/@location\((\d+)\)\s+([a-zA-Z0-9_]+)\s*:\s*([a-zA-Z0-9_<>]+)(?:,|\s|$)/g;let a;for(;(a=o.exec(r))!==null;){const l=nh[a[3]]??"float32";e[a[2]]={location:parseInt(a[1],10),format:l,stride:ih(l).stride,offset:0,instance:!1,start:0}}}}return e}function en(s){var d,f;const t=/(^|[^/])@(group|binding)\(\d+\)[^;]+;/g,e=/@group\((\d+)\)/,i=/@binding\((\d+)\)/,n=/var(<[^>]+>)? (\w+)/,r=/:\s*(\w+)/,o=/struct\s+(\w+)\s*{([^}]+)}/g,a=/(\w+)\s*:\s*([\w\<\>]+)/g,l=/struct\s+(\w+)/,c=(d=s.match(t))==null?void 0:d.map(u=>({group:parseInt(u.match(e)[1],10),binding:parseInt(u.match(i)[1],10),name:u.match(n)[2],isUniform:u.match(n)[1]==="<uniform>",type:u.match(r)[1]}));if(!c)return{groups:[],structs:[]};const h=((f=s.match(o))==null?void 0:f.map(u=>{const m=u.match(l)[1],y=u.match(a).reduce((p,g)=>{const[x,b]=g.split(":");return p[x.trim()]=b.trim(),p},{});return y?{name:m,members:y}:null}).filter(({name:u})=>c.some(m=>m.type===u)))??[];return{groups:c,structs:h}}var _s=(s=>(s[s.VERTEX=1]="VERTEX",s[s.FRAGMENT=2]="FRAGMENT",s[s.COMPUTE=4]="COMPUTE",s))(_s||{});function oh({groups:s}){const t=[];for(let e=0;e<s.length;e++){const i=s[e];t[i.group]||(t[i.group]=[]),i.isUniform?t[i.group].push({binding:i.binding,visibility:_s.VERTEX|_s.FRAGMENT,buffer:{type:"uniform"}}):i.type==="sampler"?t[i.group].push({binding:i.binding,visibility:_s.FRAGMENT,sampler:{type:"filtering"}}):i.type==="texture_2d"&&t[i.group].push({binding:i.binding,visibility:_s.FRAGMENT,texture:{sampleType:"float",viewDimension:"2d",multisampled:!1}})}return t}function ah({groups:s}){const t=[];for(let e=0;e<s.length;e++){const i=s[e];t[i.group]||(t[i.group]={}),t[i.group][i.name]=i.binding}return t}function lh(s,t){const e=new Set,i=new Set,n=[...s.structs,...t.structs].filter(o=>e.has(o.name)?!1:(e.add(o.name),!0)),r=[...s.groups,...t.groups].filter(o=>{const a=`${o.name}-${o.binding}`;return i.has(a)?!1:(i.add(a),!0)});return{structs:n,groups:r}}const ps=Object.create(null);class Pi{constructor(t){var a,l;this._layoutKey=0,this._attributeLocationsKey=0;const{fragment:e,vertex:i,layout:n,gpuLayout:r,name:o}=t;if(this.name=o,this.fragment=e,this.vertex=i,e.source===i.source){const c=en(e.source);this.structsAndGroups=c}else{const c=en(i.source),h=en(e.source);this.structsAndGroups=lh(c,h)}this.layout=n??ah(this.structsAndGroups),this.gpuLayout=r??oh(this.structsAndGroups),this.autoAssignGlobalUniforms=((a=this.layout[0])==null?void 0:a.globalUniforms)!==void 0,this.autoAssignLocalUniforms=((l=this.layout[1])==null?void 0:l.localUniforms)!==void 0,this._generateProgramKey()}_generateProgramKey(){const{vertex:t,fragment:e}=this,i=t.source+e.source+t.entryPoint+e.entryPoint;this._layoutKey=Nn(i,"program")}get attributeData(){return this._attributeData??(this._attributeData=rh(this.vertex)),this._attributeData}destroy(){this.gpuLayout=null,this.layout=null,this.structsAndGroups=null,this.fragment=null,this.vertex=null,ps[this._cacheKey]=null}static from(t){const e=`${t.vertex.source}:${t.fragment.source}:${t.fragment.entryPoint}:${t.vertex.entryPoint}`;return ps[e]||(ps[e]=new Pi(t),ps[e]._cacheKey=e),ps[e]}}const ka=["f32","i32","vec2<f32>","vec3<f32>","vec4<f32>","mat2x2<f32>","mat3x3<f32>","mat4x4<f32>","mat3x2<f32>","mat4x2<f32>","mat2x3<f32>","mat4x3<f32>","mat2x4<f32>","mat3x4<f32>","vec2<i32>","vec3<i32>","vec4<i32>"],ch=ka.reduce((s,t)=>(s[t]=!0,s),{});function hh(s,t){switch(s){case"f32":return 0;case"vec2<f32>":return new Float32Array(2*t);case"vec3<f32>":return new Float32Array(3*t);case"vec4<f32>":return new Float32Array(4*t);case"mat2x2<f32>":return new Float32Array([1,0,0,1]);case"mat3x3<f32>":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4x4<f32>":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}const Ca=class Ma{constructor(t,e){this._touched=0,this.uid=K("uniform"),this._resourceType="uniformGroup",this._resourceId=K("resource"),this.isUniformGroup=!0,this._dirtyId=0,this.destroyed=!1,e={...Ma.defaultOptions,...e},this.uniformStructures=t;const i={};for(const n in t){const r=t[n];if(r.name=n,r.size=r.size??1,!ch[r.type]){const o=r.type.match(/^array<(\w+(?:<\w+>)?),\s*(\d+)>$/);if(o){const[,a,l]=o;throw new Error(`Uniform type ${r.type} is not supported. Use type: '${a}', size: ${l} instead.`)}throw new Error(`Uniform type ${r.type} is not supported. Supported uniform types are: ${ka.join(", ")}`)}r.value??(r.value=hh(r.type,r.size)),i[n]=r.value}this.uniforms=i,this._dirtyId=1,this.ubo=e.ubo,this.isStatic=e.isStatic,this._signature=Nn(Object.keys(i).map(n=>`${n}-${t[n].type}`).join("-"),"uniform-group")}update(){this._dirtyId++}};Ca.defaultOptions={ubo:!1,isStatic:!1};let Ta=Ca;class yi{constructor(t){this.resources=Object.create(null),this._dirty=!0;let e=0;for(const i in t){const n=t[i];this.setResource(n,e++)}this._updateKey()}_updateKey(){if(!this._dirty)return;this._dirty=!1;const t=[];let e=0;for(const i in this.resources)t[e++]=this.resources[i]._resourceId;this._key=t.join("|")}setResource(t,e){var n,r;const i=this.resources[e];t!==i&&(i&&((n=t.off)==null||n.call(t,"change",this.onResourceChange,this)),(r=t.on)==null||r.call(t,"change",this.onResourceChange,this),this.resources[e]=t,this._dirty=!0)}getResource(t){return this.resources[t]}_touch(t){const e=this.resources;for(const i in e)e[i]._touched=t}destroy(){var e;const t=this.resources;for(const i in t){const n=t[i];(e=n==null?void 0:n.off)==null||e.call(n,"change",this.onResourceChange,this)}this.resources=null}onResourceChange(t){if(this._dirty=!0,t.destroyed){const e=this.resources;for(const i in e)e[i]===t&&(e[i]=null)}else this._updateKey()}}var Mn=(s=>(s[s.WEBGL=1]="WEBGL",s[s.WEBGPU=2]="WEBGPU",s[s.BOTH=3]="BOTH",s))(Mn||{});class Un extends Rt{constructor(t){super(),this.uid=K("shader"),this._uniformBindMap=Object.create(null),this._ownedBindGroups=[];let{gpuProgram:e,glProgram:i,groups:n,resources:r,compatibleRenderers:o,groupMap:a}=t;this.gpuProgram=e,this.glProgram=i,o===void 0&&(o=0,e&&(o|=Mn.WEBGPU),i&&(o|=Mn.WEBGL)),this.compatibleRenderers=o;const l={};if(!r&&!n&&(r={}),r&&n)throw new Error("[Shader] Cannot have both resources and groups");if(!e&&n&&!a)throw new Error("[Shader] No group map or WebGPU shader provided - consider using resources instead.");if(!e&&n&&a)for(const c in a)for(const h in a[c]){const d=a[c][h];l[d]={group:c,binding:h,name:d}}else if(e&&n&&!a){const c=e.structsAndGroups.groups;a={},c.forEach(h=>{a[h.group]=a[h.group]||{},a[h.group][h.binding]=h.name,l[h.name]=h})}else if(r){n={},a={},e&&e.structsAndGroups.groups.forEach(d=>{a[d.group]=a[d.group]||{},a[d.group][d.binding]=d.name,l[d.name]=d});let c=0;for(const h in r)l[h]||(n[99]||(n[99]=new yi,this._ownedBindGroups.push(n[99])),l[h]={group:99,binding:c,name:h},a[99]=a[99]||{},a[99][c]=h,c++);for(const h in r){const d=h;let f=r[h];!f.source&&!f._resourceType&&(f=new Ta(f));const u=l[d];u&&(n[u.group]||(n[u.group]=new yi,this._ownedBindGroups.push(n[u.group])),n[u.group].setResource(f,u.binding))}}this.groups=n,this._uniformBindMap=a,this.resources=this._buildResourceAccessor(n,l)}addResource(t,e,i){var n,r;(n=this._uniformBindMap)[e]||(n[e]={}),(r=this._uniformBindMap[e])[i]||(r[i]=t),this.groups[e]||(this.groups[e]=new yi,this._ownedBindGroups.push(this.groups[e]))}_buildResourceAccessor(t,e){const i={};for(const n in e){const r=e[n];Object.defineProperty(i,r.name,{get(){return t[r.group].getResource(r.binding)},set(o){t[r.group].setResource(o,r.binding)}})}return i}destroy(t=!1){var e,i;this.emit("destroy",this),t&&((e=this.gpuProgram)==null||e.destroy(),(i=this.glProgram)==null||i.destroy()),this.gpuProgram=null,this.glProgram=null,this.removeAllListeners(),this._uniformBindMap=null,this._ownedBindGroups.forEach(n=>{n.destroy()}),this._ownedBindGroups=null,this.resources=null,this.groups=null}static from(t){const{gpu:e,gl:i,...n}=t;let r,o;return e&&(r=Pi.from(e)),i&&(o=Aa.from(i)),new Un({gpuProgram:r,glProgram:o,...n})}}const Tn=[];st.handleByNamedList(E.Environment,Tn);async function dh(s){if(!s)for(let t=0;t<Tn.length;t++){const e=Tn[t];if(e.value.test()){await e.value.load();return}}}let ms;function uh(){if(typeof ms=="boolean")return ms;try{ms=new Function("param1","param2","param3","return param1[param2] === param3;")({a:"b"},"a","b")===!0}catch{ms=!1}return ms}function Or(s,t,e=2){const i=t&&t.length,n=i?t[0]*e:s.length;let r=Pa(s,0,n,e,!0);const o=[];if(!r||r.next===r.prev)return o;let a,l,c;if(i&&(r=yh(s,t,r,e)),s.length>80*e){a=s[0],l=s[1];let h=a,d=l;for(let f=e;f<n;f+=e){const u=s[f],m=s[f+1];u<a&&(a=u),m<l&&(l=m),u>h&&(h=u),m>d&&(d=m)}c=Math.max(h-a,d-l),c=c!==0?32767/c:0}return Is(r,o,e,a,l,c,0),o}function Pa(s,t,e,i,n){let r;if(n===Th(s,t,e,i)>0)for(let o=t;o<e;o+=i)r=Dr(o/i|0,s[o],s[o+1],r);else for(let o=e-i;o>=t;o-=i)r=Dr(o/i|0,s[o],s[o+1],r);return r&&He(r,r.next)&&(Bs(r),r=r.next),r}function Se(s,t){if(!s)return s;t||(t=s);let e=s,i;do if(i=!1,!e.steiner&&(He(e,e.next)||X(e.prev,e,e.next)===0)){if(Bs(e),e=t=e.prev,e===e.next)break;i=!0}else e=e.next;while(i||e!==t);return t}function Is(s,t,e,i,n,r,o){if(!s)return;!o&&r&&vh(s,i,n,r);let a=s;for(;s.prev!==s.next;){const l=s.prev,c=s.next;if(r?ph(s,i,n,r):fh(s)){t.push(l.i,s.i,c.i),Bs(s),s=c.next,a=c.next;continue}if(s=c,s===a){o?o===1?(s=mh(Se(s),t),Is(s,t,e,i,n,r,2)):o===2&&gh(s,t,e,i,n,r):Is(Se(s),t,e,i,n,r,1);break}}}function fh(s){const t=s.prev,e=s,i=s.next;if(X(t,e,i)>=0)return!1;const n=t.x,r=e.x,o=i.x,a=t.y,l=e.y,c=i.y,h=Math.min(n,r,o),d=Math.min(a,l,c),f=Math.max(n,r,o),u=Math.max(a,l,c);let m=i.next;for(;m!==t;){if(m.x>=h&&m.x<=f&&m.y>=d&&m.y<=u&&ws(n,a,r,l,o,c,m.x,m.y)&&X(m.prev,m,m.next)>=0)return!1;m=m.next}return!0}function ph(s,t,e,i){const n=s.prev,r=s,o=s.next;if(X(n,r,o)>=0)return!1;const a=n.x,l=r.x,c=o.x,h=n.y,d=r.y,f=o.y,u=Math.min(a,l,c),m=Math.min(h,d,f),y=Math.max(a,l,c),p=Math.max(h,d,f),g=Pn(u,m,t,e,i),x=Pn(y,p,t,e,i);let b=s.prevZ,_=s.nextZ;for(;b&&b.z>=g&&_&&_.z<=x;){if(b.x>=u&&b.x<=y&&b.y>=m&&b.y<=p&&b!==n&&b!==o&&ws(a,h,l,d,c,f,b.x,b.y)&&X(b.prev,b,b.next)>=0||(b=b.prevZ,_.x>=u&&_.x<=y&&_.y>=m&&_.y<=p&&_!==n&&_!==o&&ws(a,h,l,d,c,f,_.x,_.y)&&X(_.prev,_,_.next)>=0))return!1;_=_.nextZ}for(;b&&b.z>=g;){if(b.x>=u&&b.x<=y&&b.y>=m&&b.y<=p&&b!==n&&b!==o&&ws(a,h,l,d,c,f,b.x,b.y)&&X(b.prev,b,b.next)>=0)return!1;b=b.prevZ}for(;_&&_.z<=x;){if(_.x>=u&&_.x<=y&&_.y>=m&&_.y<=p&&_!==n&&_!==o&&ws(a,h,l,d,c,f,_.x,_.y)&&X(_.prev,_,_.next)>=0)return!1;_=_.nextZ}return!0}function mh(s,t){let e=s;do{const i=e.prev,n=e.next.next;!He(i,n)&&Ia(i,e,e.next,n)&&Ls(i,n)&&Ls(n,i)&&(t.push(i.i,e.i,n.i),Bs(e),Bs(e.next),e=s=n),e=e.next}while(e!==s);return Se(e)}function gh(s,t,e,i,n,r){let o=s;do{let a=o.next.next;for(;a!==o.prev;){if(o.i!==a.i&&kh(o,a)){let l=La(o,a);o=Se(o,o.next),l=Se(l,l.next),Is(o,t,e,i,n,r,0),Is(l,t,e,i,n,r,0);return}a=a.next}o=o.next}while(o!==s)}function yh(s,t,e,i){const n=[];for(let r=0,o=t.length;r<o;r++){const a=t[r]*i,l=r<o-1?t[r+1]*i:s.length,c=Pa(s,a,l,i,!1);c===c.next&&(c.steiner=!0),n.push(Ah(c))}n.sort(xh);for(let r=0;r<n.length;r++)e=bh(n[r],e);return e}function xh(s,t){let e=s.x-t.x;if(e===0&&(e=s.y-t.y,e===0)){const i=(s.next.y-s.y)/(s.next.x-s.x),n=(t.next.y-t.y)/(t.next.x-t.x);e=i-n}return e}function bh(s,t){const e=_h(s,t);if(!e)return t;const i=La(e,s);return Se(i,i.next),Se(e,e.next)}function _h(s,t){let e=t;const i=s.x,n=s.y;let r=-1/0,o;if(He(s,e))return e;do{if(He(s,e.next))return e.next;if(n<=e.y&&n>=e.next.y&&e.next.y!==e.y){const d=e.x+(n-e.y)*(e.next.x-e.x)/(e.next.y-e.y);if(d<=i&&d>r&&(r=d,o=e.x<e.next.x?e:e.next,d===i))return o}e=e.next}while(e!==t);if(!o)return null;const a=o,l=o.x,c=o.y;let h=1/0;e=o;do{if(i>=e.x&&e.x>=l&&i!==e.x&&Ea(n<c?i:r,n,l,c,n<c?r:i,n,e.x,e.y)){const d=Math.abs(n-e.y)/(i-e.x);Ls(e,s)&&(d<h||d===h&&(e.x>o.x||e.x===o.x&&wh(o,e)))&&(o=e,h=d)}e=e.next}while(e!==a);return o}function wh(s,t){return X(s.prev,s,t.prev)<0&&X(t.next,s,s.next)<0}function vh(s,t,e,i){let n=s;do n.z===0&&(n.z=Pn(n.x,n.y,t,e,i)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next;while(n!==s);n.prevZ.nextZ=null,n.prevZ=null,Sh(n)}function Sh(s){let t,e=1;do{let i=s,n;s=null;let r=null;for(t=0;i;){t++;let o=i,a=0;for(let c=0;c<e&&(a++,o=o.nextZ,!!o);c++);let l=e;for(;a>0||l>0&&o;)a!==0&&(l===0||!o||i.z<=o.z)?(n=i,i=i.nextZ,a--):(n=o,o=o.nextZ,l--),r?r.nextZ=n:s=n,n.prevZ=r,r=n;i=o}r.nextZ=null,e*=2}while(t>1);return s}function Pn(s,t,e,i,n){return s=(s-e)*n|0,t=(t-i)*n|0,s=(s|s<<8)&16711935,s=(s|s<<4)&252645135,s=(s|s<<2)&858993459,s=(s|s<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,s|t<<1}function Ah(s){let t=s,e=s;do(t.x<e.x||t.x===e.x&&t.y<e.y)&&(e=t),t=t.next;while(t!==s);return e}function Ea(s,t,e,i,n,r,o,a){return(n-o)*(t-a)>=(s-o)*(r-a)&&(s-o)*(i-a)>=(e-o)*(t-a)&&(e-o)*(r-a)>=(n-o)*(i-a)}function ws(s,t,e,i,n,r,o,a){return!(s===o&&t===a)&&Ea(s,t,e,i,n,r,o,a)}function kh(s,t){return s.next.i!==t.i&&s.prev.i!==t.i&&!Ch(s,t)&&(Ls(s,t)&&Ls(t,s)&&Mh(s,t)&&(X(s.prev,s,t.prev)||X(s,t.prev,t))||He(s,t)&&X(s.prev,s,s.next)>0&&X(t.prev,t,t.next)>0)}function X(s,t,e){return(t.y-s.y)*(e.x-t.x)-(t.x-s.x)*(e.y-t.y)}function He(s,t){return s.x===t.x&&s.y===t.y}function Ia(s,t,e,i){const n=li(X(s,t,e)),r=li(X(s,t,i)),o=li(X(e,i,s)),a=li(X(e,i,t));return!!(n!==r&&o!==a||n===0&&ai(s,e,t)||r===0&&ai(s,i,t)||o===0&&ai(e,s,i)||a===0&&ai(e,t,i))}function ai(s,t,e){return t.x<=Math.max(s.x,e.x)&&t.x>=Math.min(s.x,e.x)&&t.y<=Math.max(s.y,e.y)&&t.y>=Math.min(s.y,e.y)}function li(s){return s>0?1:s<0?-1:0}function Ch(s,t){let e=s;do{if(e.i!==s.i&&e.next.i!==s.i&&e.i!==t.i&&e.next.i!==t.i&&Ia(e,e.next,s,t))return!0;e=e.next}while(e!==s);return!1}function Ls(s,t){return X(s.prev,s,s.next)<0?X(s,t,s.next)>=0&&X(s,s.prev,t)>=0:X(s,t,s.prev)<0||X(s,s.next,t)<0}function Mh(s,t){let e=s,i=!1;const n=(s.x+t.x)/2,r=(s.y+t.y)/2;do e.y>r!=e.next.y>r&&e.next.y!==e.y&&n<(e.next.x-e.x)*(r-e.y)/(e.next.y-e.y)+e.x&&(i=!i),e=e.next;while(e!==s);return i}function La(s,t){const e=En(s.i,s.x,s.y),i=En(t.i,t.x,t.y),n=s.next,r=t.prev;return s.next=t,t.prev=s,e.next=n,n.prev=e,i.next=e,e.prev=i,r.next=i,i.prev=r,i}function Dr(s,t,e,i){const n=En(s,t,e);return i?(n.next=i.next,n.prev=i,i.next.prev=n,i.next=n):(n.prev=n,n.next=n),n}function Bs(s){s.next.prev=s.prev,s.prev.next=s.next,s.prevZ&&(s.prevZ.nextZ=s.nextZ),s.nextZ&&(s.nextZ.prevZ=s.prevZ)}function En(s,t,e){return{i:s,x:t,y:e,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Th(s,t,e,i){let n=0;for(let r=t,o=e-i;r<e;r+=i)n+=(s[o]-s[r])*(s[r+1]+s[o+1]),o=r;return n}const Ph=Or.default||Or;var Ba=(s=>(s[s.NONE=0]="NONE",s[s.COLOR=16384]="COLOR",s[s.STENCIL=1024]="STENCIL",s[s.DEPTH=256]="DEPTH",s[s.COLOR_DEPTH=16640]="COLOR_DEPTH",s[s.COLOR_STENCIL=17408]="COLOR_STENCIL",s[s.DEPTH_STENCIL=1280]="DEPTH_STENCIL",s[s.ALL=17664]="ALL",s))(Ba||{});class Eh{constructor(t){this.items=[],this._name=t}emit(t,e,i,n,r,o,a,l){const{name:c,items:h}=this;for(let d=0,f=h.length;d<f;d++)h[d][c](t,e,i,n,r,o,a,l);return this}add(t){return t[this._name]&&(this.remove(t),this.items.push(t)),this}remove(t){const e=this.items.indexOf(t);return e!==-1&&this.items.splice(e,1),this}contains(t){return this.items.indexOf(t)!==-1}removeAll(){return this.items.length=0,this}destroy(){this.removeAll(),this.items=null,this._name=null}get empty(){return this.items.length===0}get name(){return this._name}}const Ih=["init","destroy","contextChange","resolutionChange","resetState","renderEnd","renderStart","render","update","postrender","prerender"],Ra=class Fa extends Rt{constructor(t){super(),this.uid=K("renderer"),this.runners=Object.create(null),this.renderPipes=Object.create(null),this._initOptions={},this._systemsHash=Object.create(null),this.type=t.type,this.name=t.name,this.config=t;const e=[...Ih,...this.config.runners??[]];this._addRunners(...e),this._unsafeEvalCheck()}async init(t={}){const e=t.skipExtensionImports===!0?!0:t.manageImports===!1;await dh(e),this._addSystems(this.config.systems),this._addPipes(this.config.renderPipes,this.config.renderPipeAdaptors);for(const i in this._systemsHash)t={...this._systemsHash[i].constructor.defaultOptions,...t};t={...Fa.defaultOptions,...t},this._roundPixels=t.roundPixels?1:0;for(let i=0;i<this.runners.init.items.length;i++)await this.runners.init.items[i].init(t);this._initOptions=t}render(t,e){let i=t;if(i instanceof lt&&(i={container:i},e&&(z(N,"passing a second argument is deprecated, please use render options instead"),i.target=e.renderTexture)),i.target||(i.target=this.view.renderTarget),i.target===this.view.renderTarget&&(this._lastObjectRendered=i.container,i.clearColor??(i.clearColor=this.background.colorRgba),i.clear??(i.clear=this.background.clearBeforeRender)),i.clearColor){const n=Array.isArray(i.clearColor)&&i.clearColor.length===4;i.clearColor=n?i.clearColor:Q.shared.setValue(i.clearColor).toArray()}i.transform||(i.container.updateLocalTransform(),i.transform=i.container.localTransform),i.container.visible&&(i.container.enableRenderGroup(),this.runners.prerender.emit(i),this.runners.renderStart.emit(i),this.runners.render.emit(i),this.runners.renderEnd.emit(i),this.runners.postrender.emit(i))}resize(t,e,i){const n=this.view.resolution;this.view.resize(t,e,i),this.emit("resize",this.view.screen.width,this.view.screen.height,this.view.resolution),i!==void 0&&i!==n&&this.runners.resolutionChange.emit(i)}clear(t={}){const e=this;t.target||(t.target=e.renderTarget.renderTarget),t.clearColor||(t.clearColor=this.background.colorRgba),t.clear??(t.clear=Ba.ALL);const{clear:i,clearColor:n,target:r}=t;Q.shared.setValue(n??this.background.colorRgba),e.renderTarget.clear(r,i,Q.shared.toArray())}get resolution(){return this.view.resolution}set resolution(t){this.view.resolution=t,this.runners.resolutionChange.emit(t)}get width(){return this.view.texture.frame.width}get height(){return this.view.texture.frame.height}get canvas(){return this.view.canvas}get lastObjectRendered(){return this._lastObjectRendered}get renderingToScreen(){return this.renderTarget.renderingToScreen}get screen(){return this.view.screen}_addRunners(...t){t.forEach(e=>{this.runners[e]=new Eh(e)})}_addSystems(t){let e;for(e in t){const i=t[e];this._addSystem(i.value,i.name)}}_addSystem(t,e){const i=new t(this);if(this[e])throw new Error(`Whoops! The name "${e}" is already in use`);this[e]=i,this._systemsHash[e]=i;for(const n in this.runners)this.runners[n].add(i);return this}_addPipes(t,e){const i=e.reduce((n,r)=>(n[r.name]=r.value,n),{});t.forEach(n=>{const r=n.value,o=n.name,a=i[o];this.renderPipes[o]=new r(this,a?new a:null),this.runners.destroy.add(this.renderPipes[o])})}destroy(t=!1){this.runners.destroy.items.reverse(),this.runners.destroy.emit(t),Object.values(this.runners).forEach(e=>{e.destroy()}),(t===!0||typeof t=="object"&&t.releaseGlobalResources)&&$s.release(),this._systemsHash=null,this.renderPipes=null}generateTexture(t){return this.textureGenerator.generateTexture(t)}get roundPixels(){return!!this._roundPixels}_unsafeEvalCheck(){if(!uh())throw new Error("Current environment does not allow unsafe-eval, please use pixi.js/unsafe-eval module to enable support.")}resetState(){this.runners.resetState.emit()}};Ra.defaultOptions={resolution:1,failIfMajorPerformanceCaveat:!1,roundPixels:!1};let za=Ra,ci;function Lh(s){return ci!==void 0||(ci=(()=>{var e;const t={stencil:!0,failIfMajorPerformanceCaveat:s??za.defaultOptions.failIfMajorPerformanceCaveat};try{if(!H.get().getWebGLRenderingContext())return!1;let n=H.get().createCanvas().getContext("webgl",t);const r=!!((e=n==null?void 0:n.getContextAttributes())!=null&&e.stencil);if(n){const o=n.getExtension("WEBGL_lose_context");o&&o.loseContext()}return n=null,r}catch{return!1}})()),ci}let hi;async function Bh(s={}){return hi!==void 0||(hi=await(async()=>{const t=H.get().getNavigator().gpu;if(!t)return!1;try{return await(await t.requestAdapter(s)).requestDevice(),!0}catch{return!1}})()),hi}const $r=["webgl","webgpu","canvas"];async function Rh(s){let t=[];s.preference?(t.push(s.preference),$r.forEach(r=>{r!==s.preference&&t.push(r)})):t=$r.slice();let e,i={};for(let r=0;r<t.length;r++){const o=t[r];if(o==="webgpu"&&await Bh()){const{WebGPURenderer:a}=await bi(async()=>{const{WebGPURenderer:l}=await import("./WebGPURenderer-BLR9bTDW.js");return{WebGPURenderer:l}},__vite__mapDeps([3,2,4]));e=a,i={...s,...s.webgpu};break}else if(o==="webgl"&&Lh(s.failIfMajorPerformanceCaveat??za.defaultOptions.failIfMajorPerformanceCaveat)){const{WebGLRenderer:a}=await bi(async()=>{const{WebGLRenderer:l}=await import("./WebGLRenderer-BrXLOcNk.js");return{WebGLRenderer:l}},__vite__mapDeps([5,2,4]));e=a,i={...s,...s.webgl};break}else if(o==="canvas")throw i={...s},new Error("CanvasRenderer is not yet implemented")}if(delete i.webgpu,delete i.webgl,!e)throw new Error("No available renderer for the current environment");const n=new e;return await n.init(i),n}const Ga="8.13.2";class Oa{static init(){var t;(t=globalThis.__PIXI_APP_INIT__)==null||t.call(globalThis,this,Ga)}static destroy(){}}Oa.extension=E.Application;class Fh{constructor(t){this._renderer=t}init(){var t;(t=globalThis.__PIXI_RENDERER_INIT__)==null||t.call(globalThis,this._renderer,Ga)}destroy(){this._renderer=null}}Fh.extension={type:[E.WebGLSystem,E.WebGPUSystem],name:"initHook",priority:-10};const Da=class In{constructor(...t){this.stage=new lt,t[0]!==void 0&&z(N,"Application constructor options are deprecated, please use Application.init() instead.")}async init(t){t={...t},this.renderer=await Rh(t),In._plugins.forEach(e=>{e.init.call(this,t)})}render(){this.renderer.render({container:this.stage})}get canvas(){return this.renderer.canvas}get view(){return z(N,"Application.view is deprecated, please use Application.canvas instead."),this.renderer.canvas}get screen(){return this.renderer.screen}destroy(t=!1,e=!1){const i=In._plugins.slice(0);i.reverse(),i.forEach(n=>{n.destroy.call(this)}),this.stage.destroy(e),this.stage=null,this.renderer.destroy(t),this.renderer=null}};Da._plugins=[];let $a=Da;st.handleByList(E.Application,$a._plugins);st.add(Oa);class Wa extends Rt{constructor(){super(...arguments),this.chars=Object.create(null),this.lineHeight=0,this.fontFamily="",this.fontMetrics={fontSize:0,ascent:0,descent:0},this.baseLineOffset=0,this.distanceField={type:"none",range:0},this.pages=[],this.applyFillAsTint=!0,this.baseMeasurementFontSize=100,this.baseRenderedFontSize=100}get font(){return z(N,"BitmapFont.font is deprecated, please use BitmapFont.fontFamily instead."),this.fontFamily}get pageTextures(){return z(N,"BitmapFont.pageTextures is deprecated, please use BitmapFont.pages instead."),this.pages}get size(){return z(N,"BitmapFont.size is deprecated, please use BitmapFont.fontMetrics.fontSize instead."),this.fontMetrics.fontSize}get distanceFieldRange(){return z(N,"BitmapFont.distanceFieldRange is deprecated, please use BitmapFont.distanceField.range instead."),this.distanceField.range}get distanceFieldType(){return z(N,"BitmapFont.distanceFieldType is deprecated, please use BitmapFont.distanceField.type instead."),this.distanceField.type}destroy(t=!1){var e;this.emit("destroy",this),this.removeAllListeners();for(const i in this.chars)(e=this.chars[i].texture)==null||e.destroy();this.chars=null,t&&(this.pages.forEach(i=>i.texture.destroy(!0)),this.pages=null)}}/**
 * tiny-lru
 *
 * @copyright 2025 Jason Mulligan <jason.mulligan@avoidwork.com>
 * @license BSD-3-Clause
 * @version 11.4.5
 */class zh{constructor(t=0,e=0,i=!1){this.first=null,this.items=Object.create(null),this.last=null,this.max=t,this.resetTtl=i,this.size=0,this.ttl=e}clear(){return this.first=null,this.items=Object.create(null),this.last=null,this.size=0,this}delete(t){if(this.has(t)){const e=this.items[t];delete this.items[t],this.size--,e.prev!==null&&(e.prev.next=e.next),e.next!==null&&(e.next.prev=e.prev),this.first===e&&(this.first=e.next),this.last===e&&(this.last=e.prev)}return this}entries(t=this.keys()){return t.map(e=>[e,this.get(e)])}evict(t=!1){if(t||this.size>0){const e=this.first;delete this.items[e.key],--this.size===0?(this.first=null,this.last=null):(this.first=e.next,this.first.prev=null)}return this}expiresAt(t){let e;return this.has(t)&&(e=this.items[t].expiry),e}get(t){const e=this.items[t];if(e!==void 0){if(this.ttl>0&&e.expiry<=Date.now()){this.delete(t);return}return this.moveToEnd(e),e.value}}has(t){return t in this.items}moveToEnd(t){this.last!==t&&(t.prev!==null&&(t.prev.next=t.next),t.next!==null&&(t.next.prev=t.prev),this.first===t&&(this.first=t.next),t.prev=this.last,t.next=null,this.last!==null&&(this.last.next=t),this.last=t,this.first===null&&(this.first=t))}keys(){const t=[];let e=this.first;for(;e!==null;)t.push(e.key),e=e.next;return t}setWithEvicted(t,e,i=this.resetTtl){let n=null;if(this.has(t))this.set(t,e,!0,i);else{this.max>0&&this.size===this.max&&(n={...this.first},this.evict(!0));let r=this.items[t]={expiry:this.ttl>0?Date.now()+this.ttl:this.ttl,key:t,prev:this.last,next:null,value:e};++this.size===1?this.first=r:this.last.next=r,this.last=r}return n}set(t,e,i=!1,n=this.resetTtl){let r=this.items[t];return i||r!==void 0?(r.value=e,i===!1&&n&&(r.expiry=this.ttl>0?Date.now()+this.ttl:this.ttl),this.moveToEnd(r)):(this.max>0&&this.size===this.max&&this.evict(!0),r=this.items[t]={expiry:this.ttl>0?Date.now()+this.ttl:this.ttl,key:t,prev:this.last,next:null,value:e},++this.size===1?this.first=r:this.last.next=r,this.last=r),this}values(t=this.keys()){return t.map(e=>this.get(e))}}function Na(s=1e3,t=0,e=!1){if(isNaN(s)||s<0)throw new TypeError("Invalid max value");if(isNaN(t)||t<0)throw new TypeError("Invalid ttl value");if(typeof e!="boolean")throw new TypeError("Invalid resetTtl value");return new zh(s,t,e)}const Gh=["serif","sans-serif","monospace","cursive","fantasy","system-ui"];function wi(s){const t=typeof s.fontSize=="number"?`${s.fontSize}px`:s.fontSize;let e=s.fontFamily;Array.isArray(s.fontFamily)||(e=s.fontFamily.split(","));for(let i=e.length-1;i>=0;i--){let n=e[i].trim();!/([\"\'])[^\'\"]+\1/.test(n)&&!Gh.includes(n)&&(n=`"${n}"`),e[i]=n}return`${s.fontStyle} ${s.fontVariant} ${s.fontWeight} ${t} ${e.join(",")}`}const sn={willReadFrequently:!0},zt=class P{static get experimentalLetterSpacingSupported(){let t=P._experimentalLetterSpacingSupported;if(t===void 0){const e=H.get().getCanvasRenderingContext2D().prototype;t=P._experimentalLetterSpacingSupported="letterSpacing"in e||"textLetterSpacing"in e}return t}constructor(t,e,i,n,r,o,a,l,c){this.text=t,this.style=e,this.width=i,this.height=n,this.lines=r,this.lineWidths=o,this.lineHeight=a,this.maxLineWidth=l,this.fontProperties=c}static measureText(t=" ",e,i=P._canvas,n=e.wordWrap){var x;const r=`${t}-${e.styleKey}-wordWrap-${n}`;if(P._measurementCache.has(r))return P._measurementCache.get(r);const o=wi(e),a=P.measureFont(o);a.fontSize===0&&(a.fontSize=e.fontSize,a.ascent=e.fontSize);const l=P.__context;l.font=o;const h=(n?P._wordWrap(t,e,i):t).split(/(?:\r\n|\r|\n)/),d=new Array(h.length);let f=0;for(let b=0;b<h.length;b++){const _=P._measureText(h[b],e.letterSpacing,l);d[b]=_,f=Math.max(f,_)}const u=((x=e._stroke)==null?void 0:x.width)||0;let m=f+u;e.dropShadow&&(m+=e.dropShadow.distance);const y=e.lineHeight||a.fontSize;let p=Math.max(y,a.fontSize+u)+(h.length-1)*(y+e.leading);e.dropShadow&&(p+=e.dropShadow.distance);const g=new P(t,e,m,p,h,d,y+e.leading,f,a);return P._measurementCache.set(r,g),g}static _measureText(t,e,i){let n=!1;P.experimentalLetterSpacingSupported&&(P.experimentalLetterSpacing?(i.letterSpacing=`${e}px`,i.textLetterSpacing=`${e}px`,n=!0):(i.letterSpacing="0px",i.textLetterSpacing="0px"));const r=i.measureText(t);let o=r.width;const a=-r.actualBoundingBoxLeft;let c=r.actualBoundingBoxRight-a;if(o>0)if(n)o-=e,c-=e;else{const h=(P.graphemeSegmenter(t).length-1)*e;o+=h,c+=h}return Math.max(o,c)}static _wordWrap(t,e,i=P._canvas){const n=i.getContext("2d",sn);let r=0,o="",a="";const l=Object.create(null),{letterSpacing:c,whiteSpace:h}=e,d=P._collapseSpaces(h),f=P._collapseNewlines(h);let u=!d;const m=e.wordWrapWidth+c,y=P._tokenize(t);for(let p=0;p<y.length;p++){let g=y[p];if(P._isNewline(g)){if(!f){a+=P._addLine(o),u=!d,o="",r=0;continue}g=" "}if(d){const b=P.isBreakingSpace(g),_=P.isBreakingSpace(o[o.length-1]);if(b&&_)continue}const x=P._getFromCache(g,c,l,n);if(x>m)if(o!==""&&(a+=P._addLine(o),o="",r=0),P.canBreakWords(g,e.breakWords)){const b=P.wordWrapSplit(g);for(let _=0;_<b.length;_++){let S=b[_],v=S,w=1;for(;b[_+w];){const M=b[_+w];if(!P.canBreakChars(v,M,g,_,e.breakWords))S+=M;else break;v=M,w++}_+=w-1;const C=P._getFromCache(S,c,l,n);C+r>m&&(a+=P._addLine(o),u=!1,o="",r=0),o+=S,r+=C}}else{o.length>0&&(a+=P._addLine(o),o="",r=0);const b=p===y.length-1;a+=P._addLine(g,!b),u=!1,o="",r=0}else x+r>m&&(u=!1,a+=P._addLine(o),o="",r=0),(o.length>0||!P.isBreakingSpace(g)||u)&&(o+=g,r+=x)}return a+=P._addLine(o,!1),a}static _addLine(t,e=!0){return t=P._trimRight(t),t=e?`${t}
`:t,t}static _getFromCache(t,e,i,n){let r=i[t];return typeof r!="number"&&(r=P._measureText(t,e,n)+e,i[t]=r),r}static _collapseSpaces(t){return t==="normal"||t==="pre-line"}static _collapseNewlines(t){return t==="normal"}static _trimRight(t){if(typeof t!="string")return"";for(let e=t.length-1;e>=0;e--){const i=t[e];if(!P.isBreakingSpace(i))break;t=t.slice(0,-1)}return t}static _isNewline(t){return typeof t!="string"?!1:P._newlines.includes(t.charCodeAt(0))}static isBreakingSpace(t,e){return typeof t!="string"?!1:P._breakingSpaces.includes(t.charCodeAt(0))}static _tokenize(t){const e=[];let i="";if(typeof t!="string")return e;for(let n=0;n<t.length;n++){const r=t[n],o=t[n+1];if(P.isBreakingSpace(r,o)||P._isNewline(r)){i!==""&&(e.push(i),i=""),r==="\r"&&o===`
`?(e.push(`\r
`),n++):e.push(r);continue}i+=r}return i!==""&&e.push(i),e}static canBreakWords(t,e){return e}static canBreakChars(t,e,i,n,r){return!0}static wordWrapSplit(t){return P.graphemeSegmenter(t)}static measureFont(t){if(P._fonts[t])return P._fonts[t];const e=P._context;e.font=t;const i=e.measureText(P.METRICS_STRING+P.BASELINE_SYMBOL),n={ascent:i.actualBoundingBoxAscent,descent:i.actualBoundingBoxDescent,fontSize:i.actualBoundingBoxAscent+i.actualBoundingBoxDescent};return P._fonts[t]=n,n}static clearMetrics(t=""){t?delete P._fonts[t]:P._fonts={}}static get _canvas(){if(!P.__canvas){let t;try{const e=new OffscreenCanvas(0,0),i=e.getContext("2d",sn);if(i!=null&&i.measureText)return P.__canvas=e,e;t=H.get().createCanvas()}catch{t=H.get().createCanvas()}t.width=t.height=10,P.__canvas=t}return P.__canvas}static get _context(){return P.__context||(P.__context=P._canvas.getContext("2d",sn)),P.__context}};zt.METRICS_STRING="|ÉqÅ";zt.BASELINE_SYMBOL="M";zt.BASELINE_MULTIPLIER=1.4;zt.HEIGHT_MULTIPLIER=2;zt.graphemeSegmenter=(()=>{if(typeof(Intl==null?void 0:Intl.Segmenter)=="function"){const s=new Intl.Segmenter;return t=>{const e=s.segment(t),i=[];let n=0;for(const r of e)i[n++]=r.segment;return i}}return s=>[...s]})();zt.experimentalLetterSpacing=!1;zt._fonts={};zt._newlines=[10,13];zt._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];zt._measurementCache=Na(1e3);let $t=zt;const Wr=[{offset:0,color:"white"},{offset:1,color:"black"}],Hn=class Ln{constructor(...t){this.uid=K("fillGradient"),this._tick=0,this.type="linear",this.colorStops=[];let e=Oh(t);e={...e.type==="radial"?Ln.defaultRadialOptions:Ln.defaultLinearOptions,...Vo(e)},this._textureSize=e.textureSize,this._wrapMode=e.wrapMode,e.type==="radial"?(this.center=e.center,this.outerCenter=e.outerCenter??this.center,this.innerRadius=e.innerRadius,this.outerRadius=e.outerRadius,this.scale=e.scale,this.rotation=e.rotation):(this.start=e.start,this.end=e.end),this.textureSpace=e.textureSpace,this.type=e.type,e.colorStops.forEach(n=>{this.addColorStop(n.offset,n.color)})}addColorStop(t,e){return this.colorStops.push({offset:t,color:Q.shared.setValue(e).toHexa()}),this}buildLinearGradient(){if(this.texture)return;let{x:t,y:e}=this.start,{x:i,y:n}=this.end,r=i-t,o=n-e;const a=r<0||o<0;if(this._wrapMode==="clamp-to-edge"){if(r<0){const p=t;t=i,i=p,r*=-1}if(o<0){const p=e;e=n,n=p,o*=-1}}const l=this.colorStops.length?this.colorStops:Wr,c=this._textureSize,{canvas:h,context:d}=Ur(c,1),f=a?d.createLinearGradient(this._textureSize,0,0,0):d.createLinearGradient(0,0,this._textureSize,0);Nr(f,l),d.fillStyle=f,d.fillRect(0,0,c,1),this.texture=new O({source:new ve({resource:h,addressMode:this._wrapMode})});const u=Math.sqrt(r*r+o*o),m=Math.atan2(o,r),y=new G;y.scale(u/c,1),y.rotate(m),y.translate(t,e),this.textureSpace==="local"&&y.scale(c,c),this.transform=y}buildGradient(){this.texture||this._tick++,this.type==="linear"?this.buildLinearGradient():this.buildRadialGradient()}buildRadialGradient(){if(this.texture)return;const t=this.colorStops.length?this.colorStops:Wr,e=this._textureSize,{canvas:i,context:n}=Ur(e,e),{x:r,y:o}=this.center,{x:a,y:l}=this.outerCenter,c=this.innerRadius,h=this.outerRadius,d=a-h,f=l-h,u=e/(h*2),m=(r-d)*u,y=(o-f)*u,p=n.createRadialGradient(m,y,c*u,(a-d)*u,(l-f)*u,h*u);Nr(p,t),n.fillStyle=t[t.length-1].color,n.fillRect(0,0,e,e),n.fillStyle=p,n.translate(m,y),n.rotate(this.rotation),n.scale(1,this.scale),n.translate(-m,-y),n.fillRect(0,0,e,e),this.texture=new O({source:new ve({resource:i,addressMode:this._wrapMode})});const g=new G;g.scale(1/u,1/u),g.translate(d,f),this.textureSpace==="local"&&g.scale(e,e),this.transform=g}destroy(){var t;(t=this.texture)==null||t.destroy(!0),this.texture=null,this.transform=null,this.colorStops=[],this.start=null,this.end=null,this.center=null,this.outerCenter=null}get styleKey(){return`fill-gradient-${this.uid}-${this._tick}`}};Hn.defaultLinearOptions={start:{x:0,y:0},end:{x:0,y:1},colorStops:[],textureSpace:"local",type:"linear",textureSize:256,wrapMode:"clamp-to-edge"};Hn.defaultRadialOptions={center:{x:.5,y:.5},innerRadius:0,outerRadius:.5,colorStops:[],scale:1,textureSpace:"local",type:"radial",textureSize:256,wrapMode:"clamp-to-edge"};let qt=Hn;function Nr(s,t){for(let e=0;e<t.length;e++){const i=t[e];s.addColorStop(i.offset,i.color)}}function Ur(s,t){const e=H.get().createCanvas(s,t),i=e.getContext("2d");return{canvas:e,context:i}}function Oh(s){let t=s[0]??{};return(typeof t=="number"||s[1])&&(z("8.5.2","use options object instead"),t={type:"linear",start:{x:s[0],y:s[1]},end:{x:s[2],y:s[3]},textureSpace:s[4],textureSize:s[5]??qt.defaultLinearOptions.textureSize}),t}const Hr={repeat:{addressModeU:"repeat",addressModeV:"repeat"},"repeat-x":{addressModeU:"repeat",addressModeV:"clamp-to-edge"},"repeat-y":{addressModeU:"clamp-to-edge",addressModeV:"repeat"},"no-repeat":{addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}};class Ei{constructor(t,e){this.uid=K("fillPattern"),this._tick=0,this.transform=new G,this.texture=t,this.transform.scale(1/t.frame.width,1/t.frame.height),e&&(t.source.style.addressModeU=Hr[e].addressModeU,t.source.style.addressModeV=Hr[e].addressModeV)}setTransform(t){const e=this.texture;this.transform.copyFrom(t),this.transform.invert(),this.transform.scale(1/e.frame.width,1/e.frame.height),this._tick++}get texture(){return this._texture}set texture(t){this._texture!==t&&(this._texture=t,this._tick++)}get styleKey(){return`fill-pattern-${this.uid}-${this._tick}`}destroy(){this.texture.destroy(!0),this.texture=null}}var Dh=Wh,nn={a:7,c:6,h:1,l:2,m:2,q:4,s:4,t:2,v:1,z:0},$h=/([astvzqmhlc])([^astvzqmhlc]*)/ig;function Wh(s){var t=[];return s.replace($h,function(e,i,n){var r=i.toLowerCase();for(n=Uh(n),r=="m"&&n.length>2&&(t.push([i].concat(n.splice(0,2))),r="l",i=i=="m"?"l":"L");;){if(n.length==nn[r])return n.unshift(i),t.push(n);if(n.length<nn[r])throw new Error("malformed path data");t.push([i].concat(n.splice(0,nn[r])))}}),t}var Nh=/-?[0-9]*\.?[0-9]+(?:e[-+]?\d+)?/ig;function Uh(s){var t=s.match(Nh);return t?t.map(Number):[]}const Hh=No(Dh);function Yh(s,t){const e=Hh(s),i=[];let n=null,r=0,o=0;for(let a=0;a<e.length;a++){const l=e[a],c=l[0],h=l;switch(c){case"M":r=h[1],o=h[2],t.moveTo(r,o);break;case"m":r+=h[1],o+=h[2],t.moveTo(r,o);break;case"H":r=h[1],t.lineTo(r,o);break;case"h":r+=h[1],t.lineTo(r,o);break;case"V":o=h[1],t.lineTo(r,o);break;case"v":o+=h[1],t.lineTo(r,o);break;case"L":r=h[1],o=h[2],t.lineTo(r,o);break;case"l":r+=h[1],o+=h[2],t.lineTo(r,o);break;case"C":r=h[5],o=h[6],t.bezierCurveTo(h[1],h[2],h[3],h[4],r,o);break;case"c":t.bezierCurveTo(r+h[1],o+h[2],r+h[3],o+h[4],r+h[5],o+h[6]),r+=h[5],o+=h[6];break;case"S":r=h[3],o=h[4],t.bezierCurveToShort(h[1],h[2],r,o);break;case"s":t.bezierCurveToShort(r+h[1],o+h[2],r+h[3],o+h[4]),r+=h[3],o+=h[4];break;case"Q":r=h[3],o=h[4],t.quadraticCurveTo(h[1],h[2],r,o);break;case"q":t.quadraticCurveTo(r+h[1],o+h[2],r+h[3],o+h[4]),r+=h[3],o+=h[4];break;case"T":r=h[1],o=h[2],t.quadraticCurveToShort(r,o);break;case"t":r+=h[1],o+=h[2],t.quadraticCurveToShort(r,o);break;case"A":r=h[6],o=h[7],t.arcToSvg(h[1],h[2],h[3],h[4],h[5],r,o);break;case"a":r+=h[6],o+=h[7],t.arcToSvg(h[1],h[2],h[3],h[4],h[5],r,o);break;case"Z":case"z":t.closePath(),i.length>0&&(n=i.pop(),n?(r=n.startX,o=n.startY):(r=0,o=0)),n=null;break;default:V(`Unknown SVG path command: ${c}`)}c!=="Z"&&c!=="z"&&n===null&&(n={startX:r,startY:o},i.push(n))}return t}class Ii{constructor(t=0,e=0,i=0){this.type="circle",this.x=t,this.y=e,this.radius=i}clone(){return new Ii(this.x,this.y,this.radius)}contains(t,e){if(this.radius<=0)return!1;const i=this.radius*this.radius;let n=this.x-t,r=this.y-e;return n*=n,r*=r,n+r<=i}strokeContains(t,e,i,n=.5){if(this.radius===0)return!1;const r=this.x-t,o=this.y-e,a=this.radius,l=(1-n)*i,c=Math.sqrt(r*r+o*o);return c<=a+l&&c>a-(i-l)}getBounds(t){return t||(t=new j),t.x=this.x-this.radius,t.y=this.y-this.radius,t.width=this.radius*2,t.height=this.radius*2,t}copyFrom(t){return this.x=t.x,this.y=t.y,this.radius=t.radius,this}copyTo(t){return t.copyFrom(this),t}toString(){return`[pixi.js/math:Circle x=${this.x} y=${this.y} radius=${this.radius}]`}}class Yn{constructor(t=0,e=0,i=0,n=0){this.type="ellipse",this.x=t,this.y=e,this.halfWidth=i,this.halfHeight=n}clone(){return new Yn(this.x,this.y,this.halfWidth,this.halfHeight)}contains(t,e){if(this.halfWidth<=0||this.halfHeight<=0)return!1;let i=(t-this.x)/this.halfWidth,n=(e-this.y)/this.halfHeight;return i*=i,n*=n,i+n<=1}strokeContains(t,e,i,n=.5){const{halfWidth:r,halfHeight:o}=this;if(r<=0||o<=0)return!1;const a=i*(1-n),l=i-a,c=r-l,h=o-l,d=r+a,f=o+a,u=t-this.x,m=e-this.y,y=u*u/(c*c)+m*m/(h*h),p=u*u/(d*d)+m*m/(f*f);return y>1&&p<=1}getBounds(t){return t||(t=new j),t.x=this.x-this.halfWidth,t.y=this.y-this.halfHeight,t.width=this.halfWidth*2,t.height=this.halfHeight*2,t}copyFrom(t){return this.x=t.x,this.y=t.y,this.halfWidth=t.halfWidth,this.halfHeight=t.halfHeight,this}copyTo(t){return t.copyFrom(this),t}toString(){return`[pixi.js/math:Ellipse x=${this.x} y=${this.y} halfWidth=${this.halfWidth} halfHeight=${this.halfHeight}]`}}function Vh(s,t,e,i,n,r){const o=s-e,a=t-i,l=n-e,c=r-i,h=o*l+a*c,d=l*l+c*c;let f=-1;d!==0&&(f=h/d);let u,m;f<0?(u=e,m=i):f>1?(u=n,m=r):(u=e+f*l,m=i+f*c);const y=s-u,p=t-m;return y*y+p*p}let jh,Xh;class As{constructor(...t){this.type="polygon";let e=Array.isArray(t[0])?t[0]:t;if(typeof e[0]!="number"){const i=[];for(let n=0,r=e.length;n<r;n++)i.push(e[n].x,e[n].y);e=i}this.points=e,this.closePath=!0}isClockwise(){let t=0;const e=this.points,i=e.length;for(let n=0;n<i;n+=2){const r=e[n],o=e[n+1],a=e[(n+2)%i],l=e[(n+3)%i];t+=(a-r)*(l+o)}return t<0}containsPolygon(t){const e=this.getBounds(jh),i=t.getBounds(Xh);if(!e.containsRect(i))return!1;const n=t.points;for(let r=0;r<n.length;r+=2){const o=n[r],a=n[r+1];if(!this.contains(o,a))return!1}return!0}clone(){const t=this.points.slice(),e=new As(t);return e.closePath=this.closePath,e}contains(t,e){let i=!1;const n=this.points.length/2;for(let r=0,o=n-1;r<n;o=r++){const a=this.points[r*2],l=this.points[r*2+1],c=this.points[o*2],h=this.points[o*2+1];l>e!=h>e&&t<(c-a)*((e-l)/(h-l))+a&&(i=!i)}return i}strokeContains(t,e,i,n=.5){const r=i*i,o=r*(1-n),a=r-o,{points:l}=this,c=l.length-(this.closePath?0:2);for(let h=0;h<c;h+=2){const d=l[h],f=l[h+1],u=l[(h+2)%l.length],m=l[(h+3)%l.length],y=Vh(t,e,d,f,u,m),p=Math.sign((u-d)*(e-f)-(m-f)*(t-d));if(y<=(p<0?a:o))return!0}return!1}getBounds(t){t||(t=new j);const e=this.points;let i=1/0,n=-1/0,r=1/0,o=-1/0;for(let a=0,l=e.length;a<l;a+=2){const c=e[a],h=e[a+1];i=c<i?c:i,n=c>n?c:n,r=h<r?h:r,o=h>o?h:o}return t.x=i,t.width=n-i,t.y=r,t.height=o-r,t}copyFrom(t){return this.points=t.points.slice(),this.closePath=t.closePath,this}copyTo(t){return t.copyFrom(this),t}toString(){return`[pixi.js/math:PolygoncloseStroke=${this.closePath}points=${this.points.reduce((t,e)=>`${t}, ${e}`,"")}]`}get lastX(){return this.points[this.points.length-2]}get lastY(){return this.points[this.points.length-1]}get x(){return z("8.11.0","Polygon.lastX is deprecated, please use Polygon.lastX instead."),this.points[this.points.length-2]}get y(){return z("8.11.0","Polygon.y is deprecated, please use Polygon.lastY instead."),this.points[this.points.length-1]}get startX(){return this.points[0]}get startY(){return this.points[1]}}const di=(s,t,e,i,n,r,o)=>{const a=s-e,l=t-i,c=Math.sqrt(a*a+l*l);return c>=n-r&&c<=n+o};class Vn{constructor(t=0,e=0,i=0,n=0,r=20){this.type="roundedRectangle",this.x=t,this.y=e,this.width=i,this.height=n,this.radius=r}getBounds(t){return t||(t=new j),t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t}clone(){return new Vn(this.x,this.y,this.width,this.height,this.radius)}copyFrom(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this}copyTo(t){return t.copyFrom(this),t}contains(t,e){if(this.width<=0||this.height<=0)return!1;if(t>=this.x&&t<=this.x+this.width&&e>=this.y&&e<=this.y+this.height){const i=Math.max(0,Math.min(this.radius,Math.min(this.width,this.height)/2));if(e>=this.y+i&&e<=this.y+this.height-i||t>=this.x+i&&t<=this.x+this.width-i)return!0;let n=t-(this.x+i),r=e-(this.y+i);const o=i*i;if(n*n+r*r<=o||(n=t-(this.x+this.width-i),n*n+r*r<=o)||(r=e-(this.y+this.height-i),n*n+r*r<=o)||(n=t-(this.x+i),n*n+r*r<=o))return!0}return!1}strokeContains(t,e,i,n=.5){const{x:r,y:o,width:a,height:l,radius:c}=this,h=i*(1-n),d=i-h,f=r+c,u=o+c,m=a-c*2,y=l-c*2,p=r+a,g=o+l;return(t>=r-h&&t<=r+d||t>=p-d&&t<=p+h)&&e>=u&&e<=u+y||(e>=o-h&&e<=o+d||e>=g-d&&e<=g+h)&&t>=f&&t<=f+m?!0:t<f&&e<u&&di(t,e,f,u,c,d,h)||t>p-c&&e<u&&di(t,e,p-c,u,c,d,h)||t>p-c&&e>g-c&&di(t,e,p-c,g-c,c,d,h)||t<f&&e>g-c&&di(t,e,f,g-c,c,d,h)}toString(){return`[pixi.js/math:RoundedRectangle x=${this.x} y=${this.y}width=${this.width} height=${this.height} radius=${this.radius}]`}}const Ua={};function qh(s,t,e){let i=2166136261;for(let n=0;n<t;n++)i^=s[n].uid,i=Math.imul(i,16777619),i>>>=0;return Ua[i]||Kh(s,t,i,e)}function Kh(s,t,e,i){const n={};let r=0;for(let a=0;a<i;a++){const l=a<t?s[a]:O.EMPTY.source;n[r++]=l.source,n[r++]=l.style}const o=new yi(n);return Ua[e]=o,o}class Yr{constructor(t){typeof t=="number"?this.rawBinaryData=new ArrayBuffer(t):t instanceof Uint8Array?this.rawBinaryData=t.buffer:this.rawBinaryData=t,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData),this.size=this.rawBinaryData.byteLength}get int8View(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View}get uint8View(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View}get int16View(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View}get int32View(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View}get float64View(){return this._float64Array||(this._float64Array=new Float64Array(this.rawBinaryData)),this._float64Array}get bigUint64View(){return this._bigUint64Array||(this._bigUint64Array=new BigUint64Array(this.rawBinaryData)),this._bigUint64Array}view(t){return this[`${t}View`]}destroy(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this.uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null}static sizeOf(t){switch(t){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(`${t} isn't a valid view type`)}}}function Vr(s,t){const e=s.byteLength/8|0,i=new Float64Array(s,0,e);new Float64Array(t,0,e).set(i);const r=s.byteLength-e*8;if(r>0){const o=new Uint8Array(s,e*8,r);new Uint8Array(t,e*8,r).set(o)}}const Zh={normal:"normal-npm",add:"add-npm",screen:"screen-npm"};var Qh=(s=>(s[s.DISABLED=0]="DISABLED",s[s.RENDERING_MASK_ADD=1]="RENDERING_MASK_ADD",s[s.MASK_ACTIVE=2]="MASK_ACTIVE",s[s.INVERSE_MASK_ACTIVE=3]="INVERSE_MASK_ACTIVE",s[s.RENDERING_MASK_REMOVE=4]="RENDERING_MASK_REMOVE",s[s.NONE=5]="NONE",s))(Qh||{});function jr(s,t){return t.alphaMode==="no-premultiply-alpha"&&Zh[s]||s}const Jh=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join(`
`);function td(s){let t="";for(let e=0;e<s;++e)e>0&&(t+=`
else `),e<s-1&&(t+=`if(test == ${e}.0){}`);return t}function ed(s,t){if(s===0)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");const e=t.createShader(t.FRAGMENT_SHADER);try{for(;;){const i=Jh.replace(/%forloop%/gi,td(s));if(t.shaderSource(e,i),t.compileShader(e),!t.getShaderParameter(e,t.COMPILE_STATUS))s=s/2|0;else break}}finally{t.deleteShader(e)}return s}let Le=null;function sd(){var t;if(Le)return Le;const s=va();return Le=s.getParameter(s.MAX_TEXTURE_IMAGE_UNITS),Le=ed(Le,s),(t=s.getExtension("WEBGL_lose_context"))==null||t.loseContext(),Le}class id{constructor(){this.ids=Object.create(null),this.textures=[],this.count=0}clear(){for(let t=0;t<this.count;t++){const e=this.textures[t];this.textures[t]=null,this.ids[e.uid]=null}this.count=0}}class nd{constructor(){this.renderPipeId="batch",this.action="startBatch",this.start=0,this.size=0,this.textures=new id,this.blendMode="normal",this.topology="triangle-strip",this.canBundle=!0}destroy(){this.textures=null,this.gpuBindGroup=null,this.bindGroup=null,this.batcher=null}}const ks=[];let vi=0;$s.register({clear:()=>{if(ks.length>0)for(const s of ks)s&&s.destroy();ks.length=0,vi=0}});function Xr(){return vi>0?ks[--vi]:new nd}function qr(s){ks[vi++]=s}let gs=0;const Ha=class Ya{constructor(t){this.uid=K("batcher"),this.dirty=!0,this.batchIndex=0,this.batches=[],this._elements=[],t={...Ya.defaultOptions,...t},t.maxTextures||(z("v8.8.0","maxTextures is a required option for Batcher now, please pass it in the options"),t.maxTextures=sd());const{maxTextures:e,attributesInitialSize:i,indicesInitialSize:n}=t;this.attributeBuffer=new Yr(i*4),this.indexBuffer=new Uint16Array(n),this.maxTextures=e}begin(){this.elementSize=0,this.elementStart=0,this.indexSize=0,this.attributeSize=0;for(let t=0;t<this.batchIndex;t++)qr(this.batches[t]);this.batchIndex=0,this._batchIndexStart=0,this._batchIndexSize=0,this.dirty=!0}add(t){this._elements[this.elementSize++]=t,t._indexStart=this.indexSize,t._attributeStart=this.attributeSize,t._batcher=this,this.indexSize+=t.indexSize,this.attributeSize+=t.attributeSize*this.vertexSize}checkAndUpdateTexture(t,e){const i=t._batch.textures.ids[e._source.uid];return!i&&i!==0?!1:(t._textureId=i,t.texture=e,!0)}updateElement(t){this.dirty=!0;const e=this.attributeBuffer;t.packAsQuad?this.packQuadAttributes(t,e.float32View,e.uint32View,t._attributeStart,t._textureId):this.packAttributes(t,e.float32View,e.uint32View,t._attributeStart,t._textureId)}break(t){const e=this._elements;if(!e[this.elementStart])return;let i=Xr(),n=i.textures;n.clear();const r=e[this.elementStart];let o=jr(r.blendMode,r.texture._source),a=r.topology;this.attributeSize*4>this.attributeBuffer.size&&this._resizeAttributeBuffer(this.attributeSize*4),this.indexSize>this.indexBuffer.length&&this._resizeIndexBuffer(this.indexSize);const l=this.attributeBuffer.float32View,c=this.attributeBuffer.uint32View,h=this.indexBuffer;let d=this._batchIndexSize,f=this._batchIndexStart,u="startBatch";const m=this.maxTextures;for(let y=this.elementStart;y<this.elementSize;++y){const p=e[y];e[y]=null;const x=p.texture._source,b=jr(p.blendMode,x),_=o!==b||a!==p.topology;if(x._batchTick===gs&&!_){p._textureId=x._textureBindLocation,d+=p.indexSize,p.packAsQuad?(this.packQuadAttributes(p,l,c,p._attributeStart,p._textureId),this.packQuadIndex(h,p._indexStart,p._attributeStart/this.vertexSize)):(this.packAttributes(p,l,c,p._attributeStart,p._textureId),this.packIndex(p,h,p._indexStart,p._attributeStart/this.vertexSize)),p._batch=i;continue}x._batchTick=gs,(n.count>=m||_)&&(this._finishBatch(i,f,d-f,n,o,a,t,u),u="renderBatch",f=d,o=b,a=p.topology,i=Xr(),n=i.textures,n.clear(),++gs),p._textureId=x._textureBindLocation=n.count,n.ids[x.uid]=n.count,n.textures[n.count++]=x,p._batch=i,d+=p.indexSize,p.packAsQuad?(this.packQuadAttributes(p,l,c,p._attributeStart,p._textureId),this.packQuadIndex(h,p._indexStart,p._attributeStart/this.vertexSize)):(this.packAttributes(p,l,c,p._attributeStart,p._textureId),this.packIndex(p,h,p._indexStart,p._attributeStart/this.vertexSize))}n.count>0&&(this._finishBatch(i,f,d-f,n,o,a,t,u),f=d,++gs),this.elementStart=this.elementSize,this._batchIndexStart=f,this._batchIndexSize=d}_finishBatch(t,e,i,n,r,o,a,l){t.gpuBindGroup=null,t.bindGroup=null,t.action=l,t.batcher=this,t.textures=n,t.blendMode=r,t.topology=o,t.start=e,t.size=i,++gs,this.batches[this.batchIndex++]=t,a.add(t)}finish(t){this.break(t)}ensureAttributeBuffer(t){t*4<=this.attributeBuffer.size||this._resizeAttributeBuffer(t*4)}ensureIndexBuffer(t){t<=this.indexBuffer.length||this._resizeIndexBuffer(t)}_resizeAttributeBuffer(t){const e=Math.max(t,this.attributeBuffer.size*2),i=new Yr(e);Vr(this.attributeBuffer.rawBinaryData,i.rawBinaryData),this.attributeBuffer=i}_resizeIndexBuffer(t){const e=this.indexBuffer;let i=Math.max(t,e.length*1.5);i+=i%2;const n=i>65535?new Uint32Array(i):new Uint16Array(i);if(n.BYTES_PER_ELEMENT!==e.BYTES_PER_ELEMENT)for(let r=0;r<e.length;r++)n[r]=e[r];else Vr(e.buffer,n.buffer);this.indexBuffer=n}packQuadIndex(t,e,i){t[e]=i+0,t[e+1]=i+1,t[e+2]=i+2,t[e+3]=i+0,t[e+4]=i+2,t[e+5]=i+3}packIndex(t,e,i,n){const r=t.indices,o=t.indexSize,a=t.indexOffset,l=t.attributeOffset;for(let c=0;c<o;c++)e[i++]=n+r[c+a]-l}destroy(){if(this.batches!==null){for(let t=0;t<this.batches.length;t++)qr(this.batches[t]);this.batches=null;for(let t=0;t<this._elements.length;t++)this._elements[t]&&(this._elements[t]._batch=null);this._elements=null,this.indexBuffer=null,this.attributeBuffer.destroy(),this.attributeBuffer=null}}};Ha.defaultOptions={maxTextures:null,attributesInitialSize:4,indicesInitialSize:6};let rd=Ha;var dt=(s=>(s[s.MAP_READ=1]="MAP_READ",s[s.MAP_WRITE=2]="MAP_WRITE",s[s.COPY_SRC=4]="COPY_SRC",s[s.COPY_DST=8]="COPY_DST",s[s.INDEX=16]="INDEX",s[s.VERTEX=32]="VERTEX",s[s.UNIFORM=64]="UNIFORM",s[s.STORAGE=128]="STORAGE",s[s.INDIRECT=256]="INDIRECT",s[s.QUERY_RESOLVE=512]="QUERY_RESOLVE",s[s.STATIC=1024]="STATIC",s))(dt||{});class Rs extends Rt{constructor(t){let{data:e,size:i}=t;const{usage:n,label:r,shrinkToFit:o}=t;super(),this.uid=K("buffer"),this._resourceType="buffer",this._resourceId=K("resource"),this._touched=0,this._updateID=1,this._dataInt32=null,this.shrinkToFit=!0,this.destroyed=!1,e instanceof Array&&(e=new Float32Array(e)),this._data=e,i??(i=e==null?void 0:e.byteLength);const a=!!e;this.descriptor={size:i,usage:n,mappedAtCreation:a,label:r},this.shrinkToFit=o??!0}get data(){return this._data}set data(t){this.setDataWithSize(t,t.length,!0)}get dataInt32(){return this._dataInt32||(this._dataInt32=new Int32Array(this.data.buffer)),this._dataInt32}get static(){return!!(this.descriptor.usage&dt.STATIC)}set static(t){t?this.descriptor.usage|=dt.STATIC:this.descriptor.usage&=~dt.STATIC}setDataWithSize(t,e,i){if(this._updateID++,this._updateSize=e*t.BYTES_PER_ELEMENT,this._data===t){i&&this.emit("update",this);return}const n=this._data;if(this._data=t,this._dataInt32=null,!n||n.length!==t.length){!this.shrinkToFit&&n&&t.byteLength<n.byteLength?i&&this.emit("update",this):(this.descriptor.size=t.byteLength,this._resourceId=K("resource"),this.emit("change",this));return}i&&this.emit("update",this)}update(t){this._updateSize=t??this._updateSize,this._updateID++,this.emit("update",this)}destroy(){this.destroyed=!0,this.emit("destroy",this),this.emit("change",this),this._data=null,this.descriptor=null,this.removeAllListeners()}}function Va(s,t){if(!(s instanceof Rs)){let e=t?dt.INDEX:dt.VERTEX;s instanceof Array&&(t?(s=new Uint32Array(s),e=dt.INDEX|dt.COPY_DST):(s=new Float32Array(s),e=dt.VERTEX|dt.COPY_DST)),s=new Rs({data:s,label:t?"index-mesh-buffer":"vertex-mesh-buffer",usage:e})}return s}function od(s,t,e){const i=s.getAttribute(t);if(!i)return e.minX=0,e.minY=0,e.maxX=0,e.maxY=0,e;const n=i.buffer.data;let r=1/0,o=1/0,a=-1/0,l=-1/0;const c=n.BYTES_PER_ELEMENT,h=(i.offset||0)/c,d=(i.stride||2*4)/c;for(let f=h;f<n.length;f+=d){const u=n[f],m=n[f+1];u>a&&(a=u),m>l&&(l=m),u<r&&(r=u),m<o&&(o=m)}return e.minX=r,e.minY=o,e.maxX=a,e.maxY=l,e}function ad(s){return(s instanceof Rs||Array.isArray(s)||s.BYTES_PER_ELEMENT)&&(s={buffer:s}),s.buffer=Va(s.buffer,!1),s}class ld extends Rt{constructor(t={}){super(),this.uid=K("geometry"),this._layoutKey=0,this.instanceCount=1,this._bounds=new Lt,this._boundsDirty=!0;const{attributes:e,indexBuffer:i,topology:n}=t;if(this.buffers=[],this.attributes={},e)for(const r in e)this.addAttribute(r,e[r]);this.instanceCount=t.instanceCount??1,i&&this.addIndex(i),this.topology=n||"triangle-list"}onBufferUpdate(){this._boundsDirty=!0,this.emit("update",this)}getAttribute(t){return this.attributes[t]}getIndex(){return this.indexBuffer}getBuffer(t){return this.getAttribute(t).buffer}getSize(){for(const t in this.attributes){const e=this.attributes[t];return e.buffer.data.length/(e.stride/4||e.size)}return 0}addAttribute(t,e){const i=ad(e);this.buffers.indexOf(i.buffer)===-1&&(this.buffers.push(i.buffer),i.buffer.on("update",this.onBufferUpdate,this),i.buffer.on("change",this.onBufferUpdate,this)),this.attributes[t]=i}addIndex(t){this.indexBuffer=Va(t,!0),this.buffers.push(this.indexBuffer)}get bounds(){return this._boundsDirty?(this._boundsDirty=!1,od(this,"aPosition",this._bounds)):this._bounds}destroy(t=!1){this.emit("destroy",this),this.removeAllListeners(),t&&this.buffers.forEach(e=>e.destroy()),this.attributes=null,this.buffers=null,this.indexBuffer=null,this._bounds=null}}const cd=new Float32Array(1),hd=new Uint32Array(1);class dd extends ld{constructor(){const e=new Rs({data:cd,label:"attribute-batch-buffer",usage:dt.VERTEX|dt.COPY_DST,shrinkToFit:!1}),i=new Rs({data:hd,label:"index-batch-buffer",usage:dt.INDEX|dt.COPY_DST,shrinkToFit:!1}),n=6*4;super({attributes:{aPosition:{buffer:e,format:"float32x2",stride:n,offset:0},aUV:{buffer:e,format:"float32x2",stride:n,offset:2*4},aColor:{buffer:e,format:"unorm8x4",stride:n,offset:4*4},aTextureIdAndRound:{buffer:e,format:"uint16x2",stride:n,offset:5*4}},indexBuffer:i})}}function Kr(s,t,e){if(s)for(const i in s){const n=i.toLocaleLowerCase(),r=t[n];if(r){let o=s[i];i==="header"&&(o=o.replace(/@in\s+[^;]+;\s*/g,"").replace(/@out\s+[^;]+;\s*/g,"")),e&&r.push(`//----${e}----//`),r.push(o)}else V(`${i} placement hook does not exist in shader`)}}const ud=/\{\{(.*?)\}\}/g;function Zr(s){var i;const t={};return(((i=s.match(ud))==null?void 0:i.map(n=>n.replace(/[{()}]/g,"")))??[]).forEach(n=>{t[n]=[]}),t}function Qr(s,t){let e;const i=/@in\s+([^;]+);/g;for(;(e=i.exec(s))!==null;)t.push(e[1])}function Jr(s,t,e=!1){const i=[];Qr(t,i),s.forEach(a=>{a.header&&Qr(a.header,i)});const n=i;e&&n.sort();const r=n.map((a,l)=>`       @location(${l}) ${a},`).join(`
`);let o=t.replace(/@in\s+[^;]+;\s*/g,"");return o=o.replace("{{in}}",`
${r}
`),o}function to(s,t){let e;const i=/@out\s+([^;]+);/g;for(;(e=i.exec(s))!==null;)t.push(e[1])}function fd(s){const e=/\b(\w+)\s*:/g.exec(s);return e?e[1]:""}function pd(s){const t=/@.*?\s+/g;return s.replace(t,"")}function md(s,t){const e=[];to(t,e),s.forEach(l=>{l.header&&to(l.header,e)});let i=0;const n=e.sort().map(l=>l.indexOf("builtin")>-1?l:`@location(${i++}) ${l}`).join(`,
`),r=e.sort().map(l=>`       var ${pd(l)};`).join(`
`),o=`return VSOutput(
            ${e.sort().map(l=>` ${fd(l)}`).join(`,
`)});`;let a=t.replace(/@out\s+[^;]+;\s*/g,"");return a=a.replace("{{struct}}",`
${n}
`),a=a.replace("{{start}}",`
${r}
`),a=a.replace("{{return}}",`
${o}
`),a}function eo(s,t){let e=s;for(const i in t){const n=t[i];n.join(`
`).length?e=e.replace(`{{${i}}}`,`//-----${i} START-----//
${n.join(`
`)}
//----${i} FINISH----//`):e=e.replace(`{{${i}}}`,"")}return e}const te=Object.create(null),rn=new Map;let gd=0;function yd({template:s,bits:t}){const e=ja(s,t);if(te[e])return te[e];const{vertex:i,fragment:n}=bd(s,t);return te[e]=Xa(i,n,t),te[e]}function xd({template:s,bits:t}){const e=ja(s,t);return te[e]||(te[e]=Xa(s.vertex,s.fragment,t)),te[e]}function bd(s,t){const e=t.map(o=>o.vertex).filter(o=>!!o),i=t.map(o=>o.fragment).filter(o=>!!o);let n=Jr(e,s.vertex,!0);n=md(e,n);const r=Jr(i,s.fragment,!0);return{vertex:n,fragment:r}}function ja(s,t){return t.map(e=>(rn.has(e)||rn.set(e,gd++),rn.get(e))).sort((e,i)=>e-i).join("-")+s.vertex+s.fragment}function Xa(s,t,e){const i=Zr(s),n=Zr(t);return e.forEach(r=>{Kr(r.vertex,i,r.name),Kr(r.fragment,n,r.name)}),{vertex:eo(s,i),fragment:eo(t,n)}}const _d=`
    @in aPosition: vec2<f32>;
    @in aUV: vec2<f32>;

    @out @builtin(position) vPosition: vec4<f32>;
    @out vUV : vec2<f32>;
    @out vColor : vec4<f32>;

    {{header}}

    struct VSOutput {
        {{struct}}
    };

    @vertex
    fn main( {{in}} ) -> VSOutput {

        var worldTransformMatrix = globalUniforms.uWorldTransformMatrix;
        var modelMatrix = mat3x3<f32>(
            1.0, 0.0, 0.0,
            0.0, 1.0, 0.0,
            0.0, 0.0, 1.0
          );
        var position = aPosition;
        var uv = aUV;

        {{start}}

        vColor = vec4<f32>(1., 1., 1., 1.);

        {{main}}

        vUV = uv;

        var modelViewProjectionMatrix = globalUniforms.uProjectionMatrix * worldTransformMatrix * modelMatrix;

        vPosition =  vec4<f32>((modelViewProjectionMatrix *  vec3<f32>(position, 1.0)).xy, 0.0, 1.0);

        vColor *= globalUniforms.uWorldColorAlpha;

        {{end}}

        {{return}}
    };
`,wd=`
    @in vUV : vec2<f32>;
    @in vColor : vec4<f32>;

    {{header}}

    @fragment
    fn main(
        {{in}}
      ) -> @location(0) vec4<f32> {

        {{start}}

        var outColor:vec4<f32>;

        {{main}}

        var finalColor:vec4<f32> = outColor * vColor;

        {{end}}

        return finalColor;
      };
`,vd=`
    in vec2 aPosition;
    in vec2 aUV;

    out vec4 vColor;
    out vec2 vUV;

    {{header}}

    void main(void){

        mat3 worldTransformMatrix = uWorldTransformMatrix;
        mat3 modelMatrix = mat3(
            1.0, 0.0, 0.0,
            0.0, 1.0, 0.0,
            0.0, 0.0, 1.0
          );
        vec2 position = aPosition;
        vec2 uv = aUV;

        {{start}}

        vColor = vec4(1.);

        {{main}}

        vUV = uv;

        mat3 modelViewProjectionMatrix = uProjectionMatrix * worldTransformMatrix * modelMatrix;

        gl_Position = vec4((modelViewProjectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);

        vColor *= uWorldColorAlpha;

        {{end}}
    }
`,Sd=`

    in vec4 vColor;
    in vec2 vUV;

    out vec4 finalColor;

    {{header}}

    void main(void) {

        {{start}}

        vec4 outColor;

        {{main}}

        finalColor = outColor * vColor;

        {{end}}
    }
`,Ad={name:"global-uniforms-bit",vertex:{header:`
        struct GlobalUniforms {
            uProjectionMatrix:mat3x3<f32>,
            uWorldTransformMatrix:mat3x3<f32>,
            uWorldColorAlpha: vec4<f32>,
            uResolution: vec2<f32>,
        }

        @group(0) @binding(0) var<uniform> globalUniforms : GlobalUniforms;
        `}},kd={name:"global-uniforms-bit",vertex:{header:`
          uniform mat3 uProjectionMatrix;
          uniform mat3 uWorldTransformMatrix;
          uniform vec4 uWorldColorAlpha;
          uniform vec2 uResolution;
        `}};function Cd({bits:s,name:t}){const e=yd({template:{fragment:wd,vertex:_d},bits:[Ad,...s]});return Pi.from({name:t,vertex:{source:e.vertex,entryPoint:"main"},fragment:{source:e.fragment,entryPoint:"main"}})}function Md({bits:s,name:t}){return new Aa({name:t,...xd({template:{vertex:vd,fragment:Sd},bits:[kd,...s]})})}const Td={name:"color-bit",vertex:{header:`
            @in aColor: vec4<f32>;
        `,main:`
            vColor *= vec4<f32>(aColor.rgb * aColor.a, aColor.a);
        `}},Pd={name:"color-bit",vertex:{header:`
            in vec4 aColor;
        `,main:`
            vColor *= vec4(aColor.rgb * aColor.a, aColor.a);
        `}},on={};function Ed(s){const t=[];if(s===1)t.push("@group(1) @binding(0) var textureSource1: texture_2d<f32>;"),t.push("@group(1) @binding(1) var textureSampler1: sampler;");else{let e=0;for(let i=0;i<s;i++)t.push(`@group(1) @binding(${e++}) var textureSource${i+1}: texture_2d<f32>;`),t.push(`@group(1) @binding(${e++}) var textureSampler${i+1}: sampler;`)}return t.join(`
`)}function Id(s){const t=[];if(s===1)t.push("outColor = textureSampleGrad(textureSource1, textureSampler1, vUV, uvDx, uvDy);");else{t.push("switch vTextureId {");for(let e=0;e<s;e++)e===s-1?t.push("  default:{"):t.push(`  case ${e}:{`),t.push(`      outColor = textureSampleGrad(textureSource${e+1}, textureSampler${e+1}, vUV, uvDx, uvDy);`),t.push("      break;}");t.push("}")}return t.join(`
`)}function Ld(s){return on[s]||(on[s]={name:"texture-batch-bit",vertex:{header:`
                @in aTextureIdAndRound: vec2<u32>;
                @out @interpolate(flat) vTextureId : u32;
            `,main:`
                vTextureId = aTextureIdAndRound.y;
            `,end:`
                if(aTextureIdAndRound.x == 1)
                {
                    vPosition = vec4<f32>(roundPixels(vPosition.xy, globalUniforms.uResolution), vPosition.zw);
                }
            `},fragment:{header:`
                @in @interpolate(flat) vTextureId: u32;

                ${Ed(s)}
            `,main:`
                var uvDx = dpdx(vUV);
                var uvDy = dpdy(vUV);

                ${Id(s)}
            `}}),on[s]}const an={};function Bd(s){const t=[];for(let e=0;e<s;e++)e>0&&t.push("else"),e<s-1&&t.push(`if(vTextureId < ${e}.5)`),t.push("{"),t.push(`	outColor = texture(uTextures[${e}], vUV);`),t.push("}");return t.join(`
`)}function Rd(s){return an[s]||(an[s]={name:"texture-batch-bit",vertex:{header:`
                in vec2 aTextureIdAndRound;
                out float vTextureId;

            `,main:`
                vTextureId = aTextureIdAndRound.y;
            `,end:`
                if(aTextureIdAndRound.x == 1.)
                {
                    gl_Position.xy = roundPixels(gl_Position.xy, uResolution);
                }
            `},fragment:{header:`
                in float vTextureId;

                uniform sampler2D uTextures[${s}];

            `,main:`

                ${Bd(s)}
            `}}),an[s]}const Fd={name:"round-pixels-bit",vertex:{header:`
            fn roundPixels(position: vec2<f32>, targetSize: vec2<f32>) -> vec2<f32>
            {
                return (floor(((position * 0.5 + 0.5) * targetSize) + 0.5) / targetSize) * 2.0 - 1.0;
            }
        `}},zd={name:"round-pixels-bit",vertex:{header:`
            vec2 roundPixels(vec2 position, vec2 targetSize)
            {
                return (floor(((position * 0.5 + 0.5) * targetSize) + 0.5) / targetSize) * 2.0 - 1.0;
            }
        `}},so={};function Gd(s){let t=so[s];if(t)return t;const e=new Int32Array(s);for(let i=0;i<s;i++)e[i]=i;return t=so[s]=new Ta({uTextures:{value:e,type:"i32",size:s}},{isStatic:!0}),t}class Od extends Un{constructor(t){const e=Md({name:"batch",bits:[Pd,Rd(t),zd]}),i=Cd({name:"batch",bits:[Td,Ld(t),Fd]});super({glProgram:e,gpuProgram:i,resources:{batchSamplers:Gd(t)}})}}let ln=null;const qa=class Ka extends rd{constructor(t){super(t),this.geometry=new dd,this.name=Ka.extension.name,this.vertexSize=6,ln??(ln=new Od(t.maxTextures)),this.shader=ln}packAttributes(t,e,i,n,r){const o=r<<16|t.roundPixels&65535,a=t.transform,l=a.a,c=a.b,h=a.c,d=a.d,f=a.tx,u=a.ty,{positions:m,uvs:y}=t,p=t.color,g=t.attributeOffset,x=g+t.attributeSize;for(let b=g;b<x;b++){const _=b*2,S=m[_],v=m[_+1];e[n++]=l*S+h*v+f,e[n++]=d*v+c*S+u,e[n++]=y[_],e[n++]=y[_+1],i[n++]=p,i[n++]=o}}packQuadAttributes(t,e,i,n,r){const o=t.texture,a=t.transform,l=a.a,c=a.b,h=a.c,d=a.d,f=a.tx,u=a.ty,m=t.bounds,y=m.maxX,p=m.minX,g=m.maxY,x=m.minY,b=o.uvs,_=t.color,S=r<<16|t.roundPixels&65535;e[n+0]=l*p+h*x+f,e[n+1]=d*x+c*p+u,e[n+2]=b.x0,e[n+3]=b.y0,i[n+4]=_,i[n+5]=S,e[n+6]=l*y+h*x+f,e[n+7]=d*x+c*y+u,e[n+8]=b.x1,e[n+9]=b.y1,i[n+10]=_,i[n+11]=S,e[n+12]=l*y+h*g+f,e[n+13]=d*g+c*y+u,e[n+14]=b.x2,e[n+15]=b.y2,i[n+16]=_,i[n+17]=S,e[n+18]=l*p+h*g+f,e[n+19]=d*g+c*p+u,e[n+20]=b.x3,e[n+21]=b.y3,i[n+22]=_,i[n+23]=S}};qa.extension={type:[E.Batcher],name:"default"};let Dd=qa;function $d(s,t,e,i,n,r,o,a=null){let l=0;e*=t,n*=r;const c=a.a,h=a.b,d=a.c,f=a.d,u=a.tx,m=a.ty;for(;l<o;){const y=s[e],p=s[e+1];i[n]=c*y+d*p+u,i[n+1]=h*y+f*p+m,n+=r,e+=t,l++}}function Wd(s,t,e,i){let n=0;for(t*=e;n<i;)s[t]=0,s[t+1]=0,t+=e,n++}function Za(s,t,e,i,n){const r=t.a,o=t.b,a=t.c,l=t.d,c=t.tx,h=t.ty;e||(e=0),i||(i=2),n||(n=s.length/i-e);let d=e*i;for(let f=0;f<n;f++){const u=s[d],m=s[d+1];s[d]=r*u+a*m+c,s[d+1]=o*u+l*m+h,d+=i}}const Nd=new G;class Qa{constructor(){this.packAsQuad=!1,this.batcherName="default",this.topology="triangle-list",this.applyTransform=!0,this.roundPixels=0,this._batcher=null,this._batch=null}get uvs(){return this.geometryData.uvs}get positions(){return this.geometryData.vertices}get indices(){return this.geometryData.indices}get blendMode(){return this.renderable&&this.applyTransform?this.renderable.groupBlendMode:"normal"}get color(){const t=this.baseColor,e=t>>16|t&65280|(t&255)<<16,i=this.renderable;return i?sa(e,i.groupColor)+(this.alpha*i.groupAlpha*255<<24):e+(this.alpha*255<<24)}get transform(){var t;return((t=this.renderable)==null?void 0:t.groupTransform)||Nd}copyTo(t){t.indexOffset=this.indexOffset,t.indexSize=this.indexSize,t.attributeOffset=this.attributeOffset,t.attributeSize=this.attributeSize,t.baseColor=this.baseColor,t.alpha=this.alpha,t.texture=this.texture,t.geometryData=this.geometryData,t.topology=this.topology}reset(){this.applyTransform=!0,this.renderable=null,this.topology="triangle-list"}destroy(){this.renderable=null,this.texture=null,this.geometryData=null,this._batcher=null,this._batch=null}}const Fs={extension:{type:E.ShapeBuilder,name:"circle"},build(s,t){let e,i,n,r,o,a;if(s.type==="circle"){const _=s;if(o=a=_.radius,o<=0)return!1;e=_.x,i=_.y,n=r=0}else if(s.type==="ellipse"){const _=s;if(o=_.halfWidth,a=_.halfHeight,o<=0||a<=0)return!1;e=_.x,i=_.y,n=r=0}else{const _=s,S=_.width/2,v=_.height/2;e=_.x+S,i=_.y+v,o=a=Math.max(0,Math.min(_.radius,Math.min(S,v))),n=S-o,r=v-a}if(n<0||r<0)return!1;const l=Math.ceil(2.3*Math.sqrt(o+a)),c=l*8+(n?4:0)+(r?4:0);if(c===0)return!1;if(l===0)return t[0]=t[6]=e+n,t[1]=t[3]=i+r,t[2]=t[4]=e-n,t[5]=t[7]=i-r,!0;let h=0,d=l*4+(n?2:0)+2,f=d,u=c,m=n+o,y=r,p=e+m,g=e-m,x=i+y;if(t[h++]=p,t[h++]=x,t[--d]=x,t[--d]=g,r){const _=i-y;t[f++]=g,t[f++]=_,t[--u]=_,t[--u]=p}for(let _=1;_<l;_++){const S=Math.PI/2*(_/l),v=n+Math.cos(S)*o,w=r+Math.sin(S)*a,C=e+v,M=e-v,k=i+w,A=i-w;t[h++]=C,t[h++]=k,t[--d]=k,t[--d]=M,t[f++]=M,t[f++]=A,t[--u]=A,t[--u]=C}m=n,y=r+a,p=e+m,g=e-m,x=i+y;const b=i-y;return t[h++]=p,t[h++]=x,t[--u]=b,t[--u]=p,n&&(t[h++]=g,t[h++]=x,t[--u]=b,t[--u]=g),!0},triangulate(s,t,e,i,n,r){if(s.length===0)return;let o=0,a=0;for(let h=0;h<s.length;h+=2)o+=s[h],a+=s[h+1];o/=s.length/2,a/=s.length/2;let l=i;t[l*e]=o,t[l*e+1]=a;const c=l++;for(let h=0;h<s.length;h+=2)t[l*e]=s[h],t[l*e+1]=s[h+1],h>0&&(n[r++]=l,n[r++]=c,n[r++]=l-1),l++;n[r++]=c+1,n[r++]=c,n[r++]=l-1}},Ud={...Fs,extension:{...Fs.extension,name:"ellipse"}},Hd={...Fs,extension:{...Fs.extension,name:"roundedRectangle"}},Ja=1e-4,io=1e-4;function Yd(s){const t=s.length;if(t<6)return 1;let e=0;for(let i=0,n=s[t-2],r=s[t-1];i<t;i+=2){const o=s[i],a=s[i+1];e+=(o-n)*(a+r),n=o,r=a}return e<0?-1:1}function no(s,t,e,i,n,r,o,a){const l=s-e*n,c=t-i*n,h=s+e*r,d=t+i*r;let f,u;o?(f=i,u=-e):(f=-i,u=e);const m=l+f,y=c+u,p=h+f,g=d+u;return a.push(m,y),a.push(p,g),2}function pe(s,t,e,i,n,r,o,a){const l=e-s,c=i-t;let h=Math.atan2(l,c),d=Math.atan2(n-s,r-t);a&&h<d?h+=Math.PI*2:!a&&h>d&&(d+=Math.PI*2);let f=h;const u=d-h,m=Math.abs(u),y=Math.sqrt(l*l+c*c),p=(15*m*Math.sqrt(y)/Math.PI>>0)+1,g=u/p;if(f+=g,a){o.push(s,t),o.push(e,i);for(let x=1,b=f;x<p;x++,b+=g)o.push(s,t),o.push(s+Math.sin(b)*y,t+Math.cos(b)*y);o.push(s,t),o.push(n,r)}else{o.push(e,i),o.push(s,t);for(let x=1,b=f;x<p;x++,b+=g)o.push(s+Math.sin(b)*y,t+Math.cos(b)*y),o.push(s,t);o.push(n,r),o.push(s,t)}return p*2}function Vd(s,t,e,i,n,r){const o=Ja;if(s.length===0)return;const a=t;let l=a.alignment;if(t.alignment!==.5){let $=Yd(s);l=(l-.5)*$+.5}const c=new rt(s[0],s[1]),h=new rt(s[s.length-2],s[s.length-1]),d=i,f=Math.abs(c.x-h.x)<o&&Math.abs(c.y-h.y)<o;if(d){s=s.slice(),f&&(s.pop(),s.pop(),h.set(s[s.length-2],s[s.length-1]));const $=(c.x+h.x)*.5,Jt=(h.y+c.y)*.5;s.unshift($,Jt),s.push($,Jt)}const u=n,m=s.length/2;let y=s.length;const p=u.length/2,g=a.width/2,x=g*g,b=a.miterLimit*a.miterLimit;let _=s[0],S=s[1],v=s[2],w=s[3],C=0,M=0,k=-(S-w),A=_-v,F=0,L=0,D=Math.sqrt(k*k+A*A);k/=D,A/=D,k*=g,A*=g;const Mt=l,T=(1-Mt)*2,I=Mt*2;d||(a.cap==="round"?y+=pe(_-k*(T-I)*.5,S-A*(T-I)*.5,_-k*T,S-A*T,_+k*I,S+A*I,u,!0)+2:a.cap==="square"&&(y+=no(_,S,k,A,T,I,!0,u))),u.push(_-k*T,S-A*T),u.push(_+k*I,S+A*I);for(let $=1;$<m-1;++$){_=s[($-1)*2],S=s[($-1)*2+1],v=s[$*2],w=s[$*2+1],C=s[($+1)*2],M=s[($+1)*2+1],k=-(S-w),A=_-v,D=Math.sqrt(k*k+A*A),k/=D,A/=D,k*=g,A*=g,F=-(w-M),L=v-C,D=Math.sqrt(F*F+L*L),F/=D,L/=D,F*=g,L*=g;const Jt=v-_,ls=S-w,cs=v-C,hs=M-w,ur=Jt*cs+ls*hs,Ks=ls*cs-hs*Jt,ds=Ks<0;if(Math.abs(Ks)<.001*Math.abs(ur)){u.push(v-k*T,w-A*T),u.push(v+k*I,w+A*I),ur>=0&&(a.join==="round"?y+=pe(v,w,v-k*T,w-A*T,v-F*T,w-L*T,u,!1)+4:y+=2,u.push(v-F*I,w-L*I),u.push(v+F*T,w+L*T));continue}const fr=(-k+_)*(-A+w)-(-k+v)*(-A+S),pr=(-F+C)*(-L+w)-(-F+v)*(-L+M),Zs=(Jt*pr-cs*fr)/Ks,Qs=(hs*fr-ls*pr)/Ks,Wi=(Zs-v)*(Zs-v)+(Qs-w)*(Qs-w),he=v+(Zs-v)*T,de=w+(Qs-w)*T,ue=v-(Zs-v)*I,fe=w-(Qs-w)*I,Wl=Math.min(Jt*Jt+ls*ls,cs*cs+hs*hs),mr=ds?T:I,Nl=Wl+mr*mr*x;Wi<=Nl?a.join==="bevel"||Wi/x>b?(ds?(u.push(he,de),u.push(v+k*I,w+A*I),u.push(he,de),u.push(v+F*I,w+L*I)):(u.push(v-k*T,w-A*T),u.push(ue,fe),u.push(v-F*T,w-L*T),u.push(ue,fe)),y+=2):a.join==="round"?ds?(u.push(he,de),u.push(v+k*I,w+A*I),y+=pe(v,w,v+k*I,w+A*I,v+F*I,w+L*I,u,!0)+4,u.push(he,de),u.push(v+F*I,w+L*I)):(u.push(v-k*T,w-A*T),u.push(ue,fe),y+=pe(v,w,v-k*T,w-A*T,v-F*T,w-L*T,u,!1)+4,u.push(v-F*T,w-L*T),u.push(ue,fe)):(u.push(he,de),u.push(ue,fe)):(u.push(v-k*T,w-A*T),u.push(v+k*I,w+A*I),a.join==="round"?ds?y+=pe(v,w,v+k*I,w+A*I,v+F*I,w+L*I,u,!0)+2:y+=pe(v,w,v-k*T,w-A*T,v-F*T,w-L*T,u,!1)+2:a.join==="miter"&&Wi/x<=b&&(ds?(u.push(ue,fe),u.push(ue,fe)):(u.push(he,de),u.push(he,de)),y+=2),u.push(v-F*T,w-L*T),u.push(v+F*I,w+L*I),y+=2)}_=s[(m-2)*2],S=s[(m-2)*2+1],v=s[(m-1)*2],w=s[(m-1)*2+1],k=-(S-w),A=_-v,D=Math.sqrt(k*k+A*A),k/=D,A/=D,k*=g,A*=g,u.push(v-k*T,w-A*T),u.push(v+k*I,w+A*I),d||(a.cap==="round"?y+=pe(v-k*(T-I)*.5,w-A*(T-I)*.5,v-k*T,w-A*T,v+k*I,w+A*I,u,!1)+2:a.cap==="square"&&(y+=no(v,w,k,A,T,I,!1,u)));const as=io*io;for(let $=p;$<y+p-2;++$)_=u[$*2],S=u[$*2+1],v=u[($+1)*2],w=u[($+1)*2+1],C=u[($+2)*2],M=u[($+2)*2+1],!(Math.abs(_*(w-M)+v*(M-S)+C*(S-w))<as)&&r.push($,$+1,$+2)}function jd(s,t,e,i){const n=Ja;if(s.length===0)return;const r=s[0],o=s[1],a=s[s.length-2],l=s[s.length-1],c=t||Math.abs(r-a)<n&&Math.abs(o-l)<n,h=e,d=s.length/2,f=h.length/2;for(let u=0;u<d;u++)h.push(s[u*2]),h.push(s[u*2+1]);for(let u=0;u<d-1;u++)i.push(f+u,f+u+1);c&&i.push(f+d-1,f)}function tl(s,t,e,i,n,r,o){const a=Ph(s,t,2);if(!a)return;for(let c=0;c<a.length;c+=3)r[o++]=a[c]+n,r[o++]=a[c+1]+n,r[o++]=a[c+2]+n;let l=n*i;for(let c=0;c<s.length;c+=2)e[l]=s[c],e[l+1]=s[c+1],l+=i}const Xd=[],qd={extension:{type:E.ShapeBuilder,name:"polygon"},build(s,t){for(let e=0;e<s.points.length;e++)t[e]=s.points[e];return!0},triangulate(s,t,e,i,n,r){tl(s,Xd,t,e,i,n,r)}},Kd={extension:{type:E.ShapeBuilder,name:"rectangle"},build(s,t){const e=s,i=e.x,n=e.y,r=e.width,o=e.height;return r>0&&o>0?(t[0]=i,t[1]=n,t[2]=i+r,t[3]=n,t[4]=i+r,t[5]=n+o,t[6]=i,t[7]=n+o,!0):!1},triangulate(s,t,e,i,n,r){let o=0;i*=e,t[i+o]=s[0],t[i+o+1]=s[1],o+=e,t[i+o]=s[2],t[i+o+1]=s[3],o+=e,t[i+o]=s[6],t[i+o+1]=s[7],o+=e,t[i+o]=s[4],t[i+o+1]=s[5],o+=e;const a=i/e;n[r++]=a,n[r++]=a+1,n[r++]=a+2,n[r++]=a+1,n[r++]=a+3,n[r++]=a+2}},Zd={extension:{type:E.ShapeBuilder,name:"triangle"},build(s,t){return t[0]=s.x,t[1]=s.y,t[2]=s.x2,t[3]=s.y2,t[4]=s.x3,t[5]=s.y3,!0},triangulate(s,t,e,i,n,r){let o=0;i*=e,t[i+o]=s[0],t[i+o+1]=s[1],o+=e,t[i+o]=s[2],t[i+o+1]=s[3],o+=e,t[i+o]=s[4],t[i+o+1]=s[5];const a=i/e;n[r++]=a,n[r++]=a+1,n[r++]=a+2}},Qd=new G,Jd=new j;function tu(s,t,e,i){const n=t.matrix?s.copyFrom(t.matrix).invert():s.identity();if(t.textureSpace==="local"){const o=e.getBounds(Jd);t.width&&o.pad(t.width);const{x:a,y:l}=o,c=1/o.width,h=1/o.height,d=-a*c,f=-l*h,u=n.a,m=n.b,y=n.c,p=n.d;n.a*=c,n.b*=c,n.c*=h,n.d*=h,n.tx=d*u+f*y+n.tx,n.ty=d*m+f*p+n.ty}else n.translate(t.texture.frame.x,t.texture.frame.y),n.scale(1/t.texture.source.width,1/t.texture.source.height);const r=t.texture.source.style;return!(t.fill instanceof qt)&&r.addressMode==="clamp-to-edge"&&(r.addressMode="repeat",r.update()),i&&n.append(Qd.copyFrom(i).invert()),n}const Li={};st.handleByMap(E.ShapeBuilder,Li);st.add(Kd,qd,Zd,Fs,Ud,Hd);const eu=new j,su=new G;function iu(s,t){const{geometryData:e,batches:i}=t;i.length=0,e.indices.length=0,e.vertices.length=0,e.uvs.length=0;for(let n=0;n<s.instructions.length;n++){const r=s.instructions[n];if(r.action==="texture")nu(r.data,i,e);else if(r.action==="fill"||r.action==="stroke"){const o=r.action==="stroke",a=r.data.path.shapePath,l=r.data.style,c=r.data.hole;o&&c&&ro(c.shapePath,l,!0,i,e),c&&(a.shapePrimitives[a.shapePrimitives.length-1].holes=c.shapePath.shapePrimitives),ro(a,l,o,i,e)}}}function nu(s,t,e){const i=[],n=Li.rectangle,r=eu;r.x=s.dx,r.y=s.dy,r.width=s.dw,r.height=s.dh;const o=s.transform;if(!n.build(r,i))return;const{vertices:a,uvs:l,indices:c}=e,h=c.length,d=a.length/2;o&&Za(i,o),n.triangulate(i,a,2,d,c,h);const f=s.image,u=f.uvs;l.push(u.x0,u.y0,u.x1,u.y1,u.x3,u.y3,u.x2,u.y2);const m=St.get(Qa);m.indexOffset=h,m.indexSize=c.length-h,m.attributeOffset=d,m.attributeSize=a.length/2-d,m.baseColor=s.style,m.alpha=s.alpha,m.texture=f,m.geometryData=e,t.push(m)}function ro(s,t,e,i,n){const{vertices:r,uvs:o,indices:a}=n;s.shapePrimitives.forEach(({shape:l,transform:c,holes:h})=>{const d=[],f=Li[l.type];if(!f.build(l,d))return;const u=a.length,m=r.length/2;let y="triangle-list";if(c&&Za(d,c),e){const b=l.closePath??!0,_=t;_.pixelLine?(jd(d,b,r,a),y="line-list"):Vd(d,_,!1,b,r,a)}else if(h){const b=[],_=d.slice();ru(h).forEach(v=>{b.push(_.length/2),_.push(...v)}),tl(_,b,r,2,m,a,u)}else f.triangulate(d,r,2,m,a,u);const p=o.length/2,g=t.texture;if(g!==O.WHITE){const b=tu(su,t,l,c);$d(r,2,m,o,p,2,r.length/2-m,b)}else Wd(o,p,2,r.length/2-m);const x=St.get(Qa);x.indexOffset=u,x.indexSize=a.length-u,x.attributeOffset=m,x.attributeSize=r.length/2-m,x.baseColor=t.color,x.alpha=t.alpha,x.texture=g,x.geometryData=n,x.topology=y,i.push(x)})}function ru(s){const t=[];for(let e=0;e<s.length;e++){const i=s[e].shape,n=[];Li[i.type].build(i,n)&&t.push(n)}return t}class ou{constructor(){this.batches=[],this.geometryData={vertices:[],uvs:[],indices:[]}}}class au{constructor(){this.instructions=new oa}init(t){this.batcher=new Dd({maxTextures:t}),this.instructions.reset()}get geometry(){return z(tc,"GraphicsContextRenderData#geometry is deprecated, please use batcher.geometry instead."),this.batcher.geometry}destroy(){this.batcher.destroy(),this.instructions.destroy(),this.batcher=null,this.instructions=null}}const jn=class Bn{constructor(t){this._gpuContextHash={},this._graphicsDataContextHash=Object.create(null),this._renderer=t,t.renderableGC.addManagedHash(this,"_gpuContextHash"),t.renderableGC.addManagedHash(this,"_graphicsDataContextHash")}init(t){Bn.defaultOptions.bezierSmoothness=(t==null?void 0:t.bezierSmoothness)??Bn.defaultOptions.bezierSmoothness}getContextRenderData(t){return this._graphicsDataContextHash[t.uid]||this._initContextRenderData(t)}updateGpuContext(t){let e=this._gpuContextHash[t.uid]||this._initContext(t);if(t.dirty){e?this._cleanGraphicsContextData(t):e=this._initContext(t),iu(t,e);const i=t.batchMode;t.customShader||i==="no-batch"?e.isBatchable=!1:i==="auto"?e.isBatchable=e.geometryData.vertices.length<400:e.isBatchable=!0,t.dirty=!1}return e}getGpuContext(t){return this._gpuContextHash[t.uid]||this._initContext(t)}_initContextRenderData(t){const e=St.get(au,{maxTextures:this._renderer.limits.maxBatchableTextures}),{batches:i,geometryData:n}=this._gpuContextHash[t.uid],r=n.vertices.length,o=n.indices.length;for(let h=0;h<i.length;h++)i[h].applyTransform=!1;const a=e.batcher;a.ensureAttributeBuffer(r),a.ensureIndexBuffer(o),a.begin();for(let h=0;h<i.length;h++){const d=i[h];a.add(d)}a.finish(e.instructions);const l=a.geometry;l.indexBuffer.setDataWithSize(a.indexBuffer,a.indexSize,!0),l.buffers[0].setDataWithSize(a.attributeBuffer.float32View,a.attributeSize,!0);const c=a.batches;for(let h=0;h<c.length;h++){const d=c[h];d.bindGroup=qh(d.textures.textures,d.textures.count,this._renderer.limits.maxBatchableTextures)}return this._graphicsDataContextHash[t.uid]=e,e}_initContext(t){const e=new ou;return e.context=t,this._gpuContextHash[t.uid]=e,t.on("destroy",this.onGraphicsContextDestroy,this),this._gpuContextHash[t.uid]}onGraphicsContextDestroy(t){this._cleanGraphicsContextData(t),t.off("destroy",this.onGraphicsContextDestroy,this),this._gpuContextHash[t.uid]=null}_cleanGraphicsContextData(t){const e=this._gpuContextHash[t.uid];e.isBatchable||this._graphicsDataContextHash[t.uid]&&(St.return(this.getContextRenderData(t)),this._graphicsDataContextHash[t.uid]=null),e.batches&&e.batches.forEach(i=>{St.return(i)})}destroy(){for(const t in this._gpuContextHash)this._gpuContextHash[t]&&this.onGraphicsContextDestroy(this._gpuContextHash[t].context)}};jn.extension={type:[E.WebGLSystem,E.WebGPUSystem,E.CanvasSystem],name:"graphicsContext"};jn.defaultOptions={bezierSmoothness:.5};let el=jn;const lu=8,ui=11920929e-14,cu=1;function sl(s,t,e,i,n,r,o,a,l,c){const d=Math.min(.99,Math.max(0,c??el.defaultOptions.bezierSmoothness));let f=(cu-d)/1;return f*=f,hu(t,e,i,n,r,o,a,l,s,f),s}function hu(s,t,e,i,n,r,o,a,l,c){Rn(s,t,e,i,n,r,o,a,l,c,0),l.push(o,a)}function Rn(s,t,e,i,n,r,o,a,l,c,h){if(h>lu)return;const d=(s+e)/2,f=(t+i)/2,u=(e+n)/2,m=(i+r)/2,y=(n+o)/2,p=(r+a)/2,g=(d+u)/2,x=(f+m)/2,b=(u+y)/2,_=(m+p)/2,S=(g+b)/2,v=(x+_)/2;if(h>0){let w=o-s,C=a-t;const M=Math.abs((e-o)*C-(i-a)*w),k=Math.abs((n-o)*C-(r-a)*w);if(M>ui&&k>ui){if((M+k)*(M+k)<=c*(w*w+C*C)){l.push(S,v);return}}else if(M>ui){if(M*M<=c*(w*w+C*C)){l.push(S,v);return}}else if(k>ui){if(k*k<=c*(w*w+C*C)){l.push(S,v);return}}else if(w=S-(s+o)/2,C=v-(t+a)/2,w*w+C*C<=c){l.push(S,v);return}}Rn(s,t,d,f,g,x,S,v,l,c,h+1),Rn(S,v,b,_,y,p,o,a,l,c,h+1)}const du=8,uu=11920929e-14,fu=1;function pu(s,t,e,i,n,r,o,a){const c=Math.min(.99,Math.max(0,a??el.defaultOptions.bezierSmoothness));let h=(fu-c)/1;return h*=h,mu(t,e,i,n,r,o,s,h),s}function mu(s,t,e,i,n,r,o,a){Fn(o,s,t,e,i,n,r,a,0),o.push(n,r)}function Fn(s,t,e,i,n,r,o,a,l){if(l>du)return;const c=(t+i)/2,h=(e+n)/2,d=(i+r)/2,f=(n+o)/2,u=(c+d)/2,m=(h+f)/2;let y=r-t,p=o-e;const g=Math.abs((i-r)*p-(n-o)*y);if(g>uu){if(g*g<=a*(y*y+p*p)){s.push(u,m);return}}else if(y=u-(t+r)/2,p=m-(e+o)/2,y*y+p*p<=a){s.push(u,m);return}Fn(s,t,e,c,h,u,m,a,l+1),Fn(s,u,m,d,f,r,o,a,l+1)}function il(s,t,e,i,n,r,o,a){let l=Math.abs(n-r);(!o&&n>r||o&&r>n)&&(l=2*Math.PI-l),a||(a=Math.max(6,Math.floor(6*Math.pow(i,1/3)*(l/Math.PI)))),a=Math.max(a,3);let c=l/a,h=n;c*=o?-1:1;for(let d=0;d<a+1;d++){const f=Math.cos(h),u=Math.sin(h),m=t+f*i,y=e+u*i;s.push(m,y),h+=c}}function gu(s,t,e,i,n,r){const o=s[s.length-2],l=s[s.length-1]-e,c=o-t,h=n-e,d=i-t,f=Math.abs(l*d-c*h);if(f<1e-8||r===0){(s[s.length-2]!==t||s[s.length-1]!==e)&&s.push(t,e);return}const u=l*l+c*c,m=h*h+d*d,y=l*h+c*d,p=r*Math.sqrt(u)/f,g=r*Math.sqrt(m)/f,x=p*y/u,b=g*y/m,_=p*d+g*c,S=p*h+g*l,v=c*(g+x),w=l*(g+x),C=d*(p+b),M=h*(p+b),k=Math.atan2(w-S,v-_),A=Math.atan2(M-S,C-_);il(s,_+t,S+e,r,k,A,c*h>d*l)}const Cs=Math.PI*2,cn={centerX:0,centerY:0,ang1:0,ang2:0},hn=({x:s,y:t},e,i,n,r,o,a,l)=>{s*=e,t*=i;const c=n*s-r*t,h=r*s+n*t;return l.x=c+o,l.y=h+a,l};function yu(s,t){const e=t===-1.5707963267948966?-.551915024494:1.3333333333333333*Math.tan(t/4),i=t===1.5707963267948966?.551915024494:e,n=Math.cos(s),r=Math.sin(s),o=Math.cos(s+t),a=Math.sin(s+t);return[{x:n-r*i,y:r+n*i},{x:o+a*i,y:a-o*i},{x:o,y:a}]}const oo=(s,t,e,i)=>{const n=s*i-t*e<0?-1:1;let r=s*e+t*i;return r>1&&(r=1),r<-1&&(r=-1),n*Math.acos(r)},xu=(s,t,e,i,n,r,o,a,l,c,h,d,f)=>{const u=Math.pow(n,2),m=Math.pow(r,2),y=Math.pow(h,2),p=Math.pow(d,2);let g=u*m-u*p-m*y;g<0&&(g=0),g/=u*p+m*y,g=Math.sqrt(g)*(o===a?-1:1);const x=g*n/r*d,b=g*-r/n*h,_=c*x-l*b+(s+e)/2,S=l*x+c*b+(t+i)/2,v=(h-x)/n,w=(d-b)/r,C=(-h-x)/n,M=(-d-b)/r,k=oo(1,0,v,w);let A=oo(v,w,C,M);a===0&&A>0&&(A-=Cs),a===1&&A<0&&(A+=Cs),f.centerX=_,f.centerY=S,f.ang1=k,f.ang2=A};function bu(s,t,e,i,n,r,o,a=0,l=0,c=0){if(r===0||o===0)return;const h=Math.sin(a*Cs/360),d=Math.cos(a*Cs/360),f=d*(t-i)/2+h*(e-n)/2,u=-h*(t-i)/2+d*(e-n)/2;if(f===0&&u===0)return;r=Math.abs(r),o=Math.abs(o);const m=Math.pow(f,2)/Math.pow(r,2)+Math.pow(u,2)/Math.pow(o,2);m>1&&(r*=Math.sqrt(m),o*=Math.sqrt(m)),xu(t,e,i,n,r,o,l,c,h,d,f,u,cn);let{ang1:y,ang2:p}=cn;const{centerX:g,centerY:x}=cn;let b=Math.abs(p)/(Cs/4);Math.abs(1-b)<1e-7&&(b=1);const _=Math.max(Math.ceil(b),1);p/=_;let S=s[s.length-2],v=s[s.length-1];const w={x:0,y:0};for(let C=0;C<_;C++){const M=yu(y,p),{x:k,y:A}=hn(M[0],r,o,d,h,g,x,w),{x:F,y:L}=hn(M[1],r,o,d,h,g,x,w),{x:D,y:Mt}=hn(M[2],r,o,d,h,g,x,w);sl(s,S,v,k,A,F,L,D,Mt),S=D,v=Mt,y+=p}}function _u(s,t,e){const i=(o,a)=>{const l=a.x-o.x,c=a.y-o.y,h=Math.sqrt(l*l+c*c),d=l/h,f=c/h;return{len:h,nx:d,ny:f}},n=(o,a)=>{o===0?s.moveTo(a.x,a.y):s.lineTo(a.x,a.y)};let r=t[t.length-1];for(let o=0;o<t.length;o++){const a=t[o%t.length],l=a.radius??e;if(l<=0){n(o,a),r=a;continue}const c=t[(o+1)%t.length],h=i(a,r),d=i(a,c);if(h.len<1e-4||d.len<1e-4){n(o,a),r=a;continue}let f=Math.asin(h.nx*d.ny-h.ny*d.nx),u=1,m=!1;h.nx*d.nx-h.ny*-d.ny<0?f<0?f=Math.PI+f:(f=Math.PI-f,u=-1,m=!0):f>0&&(u=-1,m=!0);const y=f/2;let p,g=Math.abs(Math.cos(y)*l/Math.sin(y));g>Math.min(h.len/2,d.len/2)?(g=Math.min(h.len/2,d.len/2),p=Math.abs(g*Math.sin(y)/Math.cos(y))):p=l;const x=a.x+d.nx*g+-d.ny*p*u,b=a.y+d.ny*g+d.nx*p*u,_=Math.atan2(h.ny,h.nx)+Math.PI/2*u,S=Math.atan2(d.ny,d.nx)-Math.PI/2*u;o===0&&s.moveTo(x+Math.cos(_)*p,b+Math.sin(_)*p),s.arc(x,b,p,_,S,m),r=a}}function wu(s,t,e,i){const n=(a,l)=>Math.sqrt((a.x-l.x)**2+(a.y-l.y)**2),r=(a,l,c)=>({x:a.x+(l.x-a.x)*c,y:a.y+(l.y-a.y)*c}),o=t.length;for(let a=0;a<o;a++){const l=t[(a+1)%o],c=l.radius??e;if(c<=0){a===0?s.moveTo(l.x,l.y):s.lineTo(l.x,l.y);continue}const h=t[a],d=t[(a+2)%o],f=n(h,l);let u;if(f<1e-4)u=l;else{const p=Math.min(f/2,c);u=r(l,h,p/f)}const m=n(d,l);let y;if(m<1e-4)y=l;else{const p=Math.min(m/2,c);y=r(l,d,p/m)}a===0?s.moveTo(u.x,u.y):s.lineTo(u.x,u.y),s.quadraticCurveTo(l.x,l.y,y.x,y.y,i)}}const vu=new j;class Su{constructor(t){this.shapePrimitives=[],this._currentPoly=null,this._bounds=new Lt,this._graphicsPath2D=t,this.signed=t.checkForHoles}moveTo(t,e){return this.startPoly(t,e),this}lineTo(t,e){this._ensurePoly();const i=this._currentPoly.points,n=i[i.length-2],r=i[i.length-1];return(n!==t||r!==e)&&i.push(t,e),this}arc(t,e,i,n,r,o){this._ensurePoly(!1);const a=this._currentPoly.points;return il(a,t,e,i,n,r,o),this}arcTo(t,e,i,n,r){this._ensurePoly();const o=this._currentPoly.points;return gu(o,t,e,i,n,r),this}arcToSvg(t,e,i,n,r,o,a){const l=this._currentPoly.points;return bu(l,this._currentPoly.lastX,this._currentPoly.lastY,o,a,t,e,i,n,r),this}bezierCurveTo(t,e,i,n,r,o,a){this._ensurePoly();const l=this._currentPoly;return sl(this._currentPoly.points,l.lastX,l.lastY,t,e,i,n,r,o,a),this}quadraticCurveTo(t,e,i,n,r){this._ensurePoly();const o=this._currentPoly;return pu(this._currentPoly.points,o.lastX,o.lastY,t,e,i,n,r),this}closePath(){return this.endPoly(!0),this}addPath(t,e){this.endPoly(),e&&!e.isIdentity()&&(t=t.clone(!0),t.transform(e));const i=this.shapePrimitives,n=i.length;for(let r=0;r<t.instructions.length;r++){const o=t.instructions[r];this[o.action](...o.data)}if(t.checkForHoles&&i.length-n>1){let r=null;for(let o=n;o<i.length;o++){const a=i[o];if(a.shape.type==="polygon"){const l=a.shape,c=r==null?void 0:r.shape;c&&c.containsPolygon(l)?(r.holes||(r.holes=[]),r.holes.push(a),i.copyWithin(o,o+1),i.length--,o--):r=a}}}return this}finish(t=!1){this.endPoly(t)}rect(t,e,i,n,r){return this.drawShape(new j(t,e,i,n),r),this}circle(t,e,i,n){return this.drawShape(new Ii(t,e,i),n),this}poly(t,e,i){const n=new As(t);return n.closePath=e,this.drawShape(n,i),this}regularPoly(t,e,i,n,r=0,o){n=Math.max(n|0,3);const a=-1*Math.PI/2+r,l=Math.PI*2/n,c=[];for(let h=0;h<n;h++){const d=a-h*l;c.push(t+i*Math.cos(d),e+i*Math.sin(d))}return this.poly(c,!0,o),this}roundPoly(t,e,i,n,r,o=0,a){if(n=Math.max(n|0,3),r<=0)return this.regularPoly(t,e,i,n,o);const l=i*Math.sin(Math.PI/n)-.001;r=Math.min(r,l);const c=-1*Math.PI/2+o,h=Math.PI*2/n,d=(n-2)*Math.PI/n/2;for(let f=0;f<n;f++){const u=f*h+c,m=t+i*Math.cos(u),y=e+i*Math.sin(u),p=u+Math.PI+d,g=u-Math.PI-d,x=m+r*Math.cos(p),b=y+r*Math.sin(p),_=m+r*Math.cos(g),S=y+r*Math.sin(g);f===0?this.moveTo(x,b):this.lineTo(x,b),this.quadraticCurveTo(m,y,_,S,a)}return this.closePath()}roundShape(t,e,i=!1,n){return t.length<3?this:(i?wu(this,t,e,n):_u(this,t,e),this.closePath())}filletRect(t,e,i,n,r){if(r===0)return this.rect(t,e,i,n);const o=Math.min(i,n)/2,a=Math.min(o,Math.max(-o,r)),l=t+i,c=e+n,h=a<0?-a:0,d=Math.abs(a);return this.moveTo(t,e+d).arcTo(t+h,e+h,t+d,e,d).lineTo(l-d,e).arcTo(l-h,e+h,l,e+d,d).lineTo(l,c-d).arcTo(l-h,c-h,t+i-d,c,d).lineTo(t+d,c).arcTo(t+h,c-h,t,c-d,d).closePath()}chamferRect(t,e,i,n,r,o){if(r<=0)return this.rect(t,e,i,n);const a=Math.min(r,Math.min(i,n)/2),l=t+i,c=e+n,h=[t+a,e,l-a,e,l,e+a,l,c-a,l-a,c,t+a,c,t,c-a,t,e+a];for(let d=h.length-1;d>=2;d-=2)h[d]===h[d-2]&&h[d-1]===h[d-3]&&h.splice(d-1,2);return this.poly(h,!0,o)}ellipse(t,e,i,n,r){return this.drawShape(new Yn(t,e,i,n),r),this}roundRect(t,e,i,n,r,o){return this.drawShape(new Vn(t,e,i,n,r),o),this}drawShape(t,e){return this.endPoly(),this.shapePrimitives.push({shape:t,transform:e}),this}startPoly(t,e){let i=this._currentPoly;return i&&this.endPoly(),i=new As,i.points.push(t,e),this._currentPoly=i,this}endPoly(t=!1){const e=this._currentPoly;return e&&e.points.length>2&&(e.closePath=t,this.shapePrimitives.push({shape:e})),this._currentPoly=null,this}_ensurePoly(t=!0){if(!this._currentPoly&&(this._currentPoly=new As,t)){const e=this.shapePrimitives[this.shapePrimitives.length-1];if(e){let i=e.shape.x,n=e.shape.y;if(e.transform&&!e.transform.isIdentity()){const r=e.transform,o=i;i=r.a*i+r.c*n+r.tx,n=r.b*o+r.d*n+r.ty}this._currentPoly.points.push(i,n)}else this._currentPoly.points.push(0,0)}}buildPath(){const t=this._graphicsPath2D;this.shapePrimitives.length=0,this._currentPoly=null;for(let e=0;e<t.instructions.length;e++){const i=t.instructions[e];this[i.action](...i.data)}this.finish()}get bounds(){const t=this._bounds;t.clear();const e=this.shapePrimitives;for(let i=0;i<e.length;i++){const n=e[i],r=n.shape.getBounds(vu);n.transform?t.addRect(r,n.transform):t.addRect(r)}return t}}class jt{constructor(t,e=!1){this.instructions=[],this.uid=K("graphicsPath"),this._dirty=!0,this.checkForHoles=e,typeof t=="string"?Yh(t,this):this.instructions=(t==null?void 0:t.slice())??[]}get shapePath(){return this._shapePath||(this._shapePath=new Su(this)),this._dirty&&(this._dirty=!1,this._shapePath.buildPath()),this._shapePath}addPath(t,e){return t=t.clone(),this.instructions.push({action:"addPath",data:[t,e]}),this._dirty=!0,this}arc(...t){return this.instructions.push({action:"arc",data:t}),this._dirty=!0,this}arcTo(...t){return this.instructions.push({action:"arcTo",data:t}),this._dirty=!0,this}arcToSvg(...t){return this.instructions.push({action:"arcToSvg",data:t}),this._dirty=!0,this}bezierCurveTo(...t){return this.instructions.push({action:"bezierCurveTo",data:t}),this._dirty=!0,this}bezierCurveToShort(t,e,i,n,r){const o=this.instructions[this.instructions.length-1],a=this.getLastPoint(rt.shared);let l=0,c=0;if(!o||o.action!=="bezierCurveTo")l=a.x,c=a.y;else{l=o.data[2],c=o.data[3];const h=a.x,d=a.y;l=h+(h-l),c=d+(d-c)}return this.instructions.push({action:"bezierCurveTo",data:[l,c,t,e,i,n,r]}),this._dirty=!0,this}closePath(){return this.instructions.push({action:"closePath",data:[]}),this._dirty=!0,this}ellipse(...t){return this.instructions.push({action:"ellipse",data:t}),this._dirty=!0,this}lineTo(...t){return this.instructions.push({action:"lineTo",data:t}),this._dirty=!0,this}moveTo(...t){return this.instructions.push({action:"moveTo",data:t}),this}quadraticCurveTo(...t){return this.instructions.push({action:"quadraticCurveTo",data:t}),this._dirty=!0,this}quadraticCurveToShort(t,e,i){const n=this.instructions[this.instructions.length-1],r=this.getLastPoint(rt.shared);let o=0,a=0;if(!n||n.action!=="quadraticCurveTo")o=r.x,a=r.y;else{o=n.data[0],a=n.data[1];const l=r.x,c=r.y;o=l+(l-o),a=c+(c-a)}return this.instructions.push({action:"quadraticCurveTo",data:[o,a,t,e,i]}),this._dirty=!0,this}rect(t,e,i,n,r){return this.instructions.push({action:"rect",data:[t,e,i,n,r]}),this._dirty=!0,this}circle(t,e,i,n){return this.instructions.push({action:"circle",data:[t,e,i,n]}),this._dirty=!0,this}roundRect(...t){return this.instructions.push({action:"roundRect",data:t}),this._dirty=!0,this}poly(...t){return this.instructions.push({action:"poly",data:t}),this._dirty=!0,this}regularPoly(...t){return this.instructions.push({action:"regularPoly",data:t}),this._dirty=!0,this}roundPoly(...t){return this.instructions.push({action:"roundPoly",data:t}),this._dirty=!0,this}roundShape(...t){return this.instructions.push({action:"roundShape",data:t}),this._dirty=!0,this}filletRect(...t){return this.instructions.push({action:"filletRect",data:t}),this._dirty=!0,this}chamferRect(...t){return this.instructions.push({action:"chamferRect",data:t}),this._dirty=!0,this}star(t,e,i,n,r,o,a){r||(r=n/2);const l=-1*Math.PI/2+o,c=i*2,h=Math.PI*2/c,d=[];for(let f=0;f<c;f++){const u=f%2?r:n,m=f*h+l;d.push(t+u*Math.cos(m),e+u*Math.sin(m))}return this.poly(d,!0,a),this}clone(t=!1){const e=new jt;if(e.checkForHoles=this.checkForHoles,!t)e.instructions=this.instructions.slice();else for(let i=0;i<this.instructions.length;i++){const n=this.instructions[i];e.instructions.push({action:n.action,data:n.data.slice()})}return e}clear(){return this.instructions.length=0,this._dirty=!0,this}transform(t){if(t.isIdentity())return this;const e=t.a,i=t.b,n=t.c,r=t.d,o=t.tx,a=t.ty;let l=0,c=0,h=0,d=0,f=0,u=0,m=0,y=0;for(let p=0;p<this.instructions.length;p++){const g=this.instructions[p],x=g.data;switch(g.action){case"moveTo":case"lineTo":l=x[0],c=x[1],x[0]=e*l+n*c+o,x[1]=i*l+r*c+a;break;case"bezierCurveTo":h=x[0],d=x[1],f=x[2],u=x[3],l=x[4],c=x[5],x[0]=e*h+n*d+o,x[1]=i*h+r*d+a,x[2]=e*f+n*u+o,x[3]=i*f+r*u+a,x[4]=e*l+n*c+o,x[5]=i*l+r*c+a;break;case"quadraticCurveTo":h=x[0],d=x[1],l=x[2],c=x[3],x[0]=e*h+n*d+o,x[1]=i*h+r*d+a,x[2]=e*l+n*c+o,x[3]=i*l+r*c+a;break;case"arcToSvg":l=x[5],c=x[6],m=x[0],y=x[1],x[0]=e*m+n*y,x[1]=i*m+r*y,x[5]=e*l+n*c+o,x[6]=i*l+r*c+a;break;case"circle":x[4]=ys(x[3],t);break;case"rect":x[4]=ys(x[4],t);break;case"ellipse":x[8]=ys(x[8],t);break;case"roundRect":x[5]=ys(x[5],t);break;case"addPath":x[0].transform(t);break;case"poly":x[2]=ys(x[2],t);break;default:V("unknown transform action",g.action);break}}return this._dirty=!0,this}get bounds(){return this.shapePath.bounds}getLastPoint(t){let e=this.instructions.length-1,i=this.instructions[e];if(!i)return t.x=0,t.y=0,t;for(;i.action==="closePath";){if(e--,e<0)return t.x=0,t.y=0,t;i=this.instructions[e]}switch(i.action){case"moveTo":case"lineTo":t.x=i.data[0],t.y=i.data[1];break;case"quadraticCurveTo":t.x=i.data[2],t.y=i.data[3];break;case"bezierCurveTo":t.x=i.data[4],t.y=i.data[5];break;case"arc":case"arcToSvg":t.x=i.data[5],t.y=i.data[6];break;case"addPath":i.data[0].getLastPoint(t);break}return t}}function ys(s,t){return s?s.prepend(t):t.clone()}function q(s,t,e){const i=s.getAttribute(t);return i?Number(i):e}function Au(s,t){const e=s.querySelectorAll("defs");for(let i=0;i<e.length;i++){const n=e[i];for(let r=0;r<n.children.length;r++){const o=n.children[r];switch(o.nodeName.toLowerCase()){case"lineargradient":t.defs[o.id]=ku(o);break;case"radialgradient":t.defs[o.id]=Cu();break}}}}function ku(s){const t=q(s,"x1",0),e=q(s,"y1",0),i=q(s,"x2",1),n=q(s,"y2",0),r=s.getAttribute("gradientUnits")||"objectBoundingBox",o=new qt(t,e,i,n,r==="objectBoundingBox"?"local":"global");for(let a=0;a<s.children.length;a++){const l=s.children[a],c=q(l,"offset",0),h=Q.shared.setValue(l.getAttribute("stop-color")).toNumber();o.addColorStop(c,h)}return o}function Cu(s){return V("[SVG Parser] Radial gradients are not yet supported"),new qt(0,0,1,0)}function ao(s){const t=s.match(/url\s*\(\s*['"]?\s*#([^'"\s)]+)\s*['"]?\s*\)/i);return t?t[1]:""}const lo={fill:{type:"paint",default:0},"fill-opacity":{type:"number",default:1},stroke:{type:"paint",default:0},"stroke-width":{type:"number",default:1},"stroke-opacity":{type:"number",default:1},"stroke-linecap":{type:"string",default:"butt"},"stroke-linejoin":{type:"string",default:"miter"},"stroke-miterlimit":{type:"number",default:10},"stroke-dasharray":{type:"string",default:"none"},"stroke-dashoffset":{type:"number",default:0},opacity:{type:"number",default:1}};function nl(s,t){const e=s.getAttribute("style"),i={},n={},r={strokeStyle:i,fillStyle:n,useFill:!1,useStroke:!1};for(const o in lo){const a=s.getAttribute(o);a&&co(t,r,o,a.trim())}if(e){const o=e.split(";");for(let a=0;a<o.length;a++){const l=o[a].trim(),[c,h]=l.split(":");lo[c]&&co(t,r,c,h.trim())}}return{strokeStyle:r.useStroke?i:null,fillStyle:r.useFill?n:null,useFill:r.useFill,useStroke:r.useStroke}}function co(s,t,e,i){switch(e){case"stroke":if(i!=="none"){if(i.startsWith("url(")){const n=ao(i);t.strokeStyle.fill=s.defs[n]}else t.strokeStyle.color=Q.shared.setValue(i).toNumber();t.useStroke=!0}break;case"stroke-width":t.strokeStyle.width=Number(i);break;case"fill":if(i!=="none"){if(i.startsWith("url(")){const n=ao(i);t.fillStyle.fill=s.defs[n]}else t.fillStyle.color=Q.shared.setValue(i).toNumber();t.useFill=!0}break;case"fill-opacity":t.fillStyle.alpha=Number(i);break;case"stroke-opacity":t.strokeStyle.alpha=Number(i);break;case"opacity":t.fillStyle.alpha=Number(i),t.strokeStyle.alpha=Number(i);break}}function Mu(s){if(s.length<=2)return!0;const t=s.map(a=>a.area).sort((a,l)=>l-a),[e,i]=t,n=t[t.length-1],r=e/i,o=i/n;return!(r>3&&o<2)}function Tu(s){return s.split(/(?=[Mm])/).filter(i=>i.trim().length>0)}function Pu(s){const t=s.match(/[-+]?[0-9]*\.?[0-9]+/g);if(!t||t.length<4)return 0;const e=t.map(Number),i=[],n=[];for(let h=0;h<e.length;h+=2)h+1<e.length&&(i.push(e[h]),n.push(e[h+1]));if(i.length===0||n.length===0)return 0;const r=Math.min(...i),o=Math.max(...i),a=Math.min(...n),l=Math.max(...n);return(o-r)*(l-a)}function ho(s,t){const e=new jt(s,!1);for(const i of e.instructions)t.instructions.push(i)}function Eu(s,t){if(typeof s=="string"){const o=document.createElement("div");o.innerHTML=s.trim(),s=o.querySelector("svg")}const e={context:t,defs:{},path:new jt};Au(s,e);const i=s.children,{fillStyle:n,strokeStyle:r}=nl(s,e);for(let o=0;o<i.length;o++){const a=i[o];a.nodeName.toLowerCase()!=="defs"&&rl(a,e,n,r)}return t}function rl(s,t,e,i){const n=s.children,{fillStyle:r,strokeStyle:o}=nl(s,t);r&&e?e={...e,...r}:r&&(e=r),o&&i?i={...i,...o}:o&&(i=o);const a=!e&&!i;a&&(e={color:0});let l,c,h,d,f,u,m,y,p,g,x,b,_,S,v,w,C;switch(s.nodeName.toLowerCase()){case"path":{S=s.getAttribute("d");const M=s.getAttribute("fill-rule"),k=Tu(S),A=M==="evenodd",F=k.length>1;if(A&&F){const D=k.map(T=>({path:T,area:Pu(T)}));if(D.sort((T,I)=>I.area-T.area),k.length>3||!Mu(D))for(let T=0;T<D.length;T++){const I=D[T],as=T===0;t.context.beginPath();const $=new jt(void 0,!0);ho(I.path,$),t.context.path($),as?(e&&t.context.fill(e),i&&t.context.stroke(i)):t.context.cut()}else for(let T=0;T<D.length;T++){const I=D[T],as=T%2===1;t.context.beginPath();const $=new jt(void 0,!0);ho(I.path,$),t.context.path($),as?t.context.cut():(e&&t.context.fill(e),i&&t.context.stroke(i))}}else{const D=M?M==="evenodd":!0;v=new jt(S,D),t.context.path(v),e&&t.context.fill(e),i&&t.context.stroke(i)}break}case"circle":m=q(s,"cx",0),y=q(s,"cy",0),p=q(s,"r",0),t.context.ellipse(m,y,p,p),e&&t.context.fill(e),i&&t.context.stroke(i);break;case"rect":l=q(s,"x",0),c=q(s,"y",0),w=q(s,"width",0),C=q(s,"height",0),g=q(s,"rx",0),x=q(s,"ry",0),g||x?t.context.roundRect(l,c,w,C,g||x):t.context.rect(l,c,w,C),e&&t.context.fill(e),i&&t.context.stroke(i);break;case"ellipse":m=q(s,"cx",0),y=q(s,"cy",0),g=q(s,"rx",0),x=q(s,"ry",0),t.context.beginPath(),t.context.ellipse(m,y,g,x),e&&t.context.fill(e),i&&t.context.stroke(i);break;case"line":h=q(s,"x1",0),d=q(s,"y1",0),f=q(s,"x2",0),u=q(s,"y2",0),t.context.beginPath(),t.context.moveTo(h,d),t.context.lineTo(f,u),i&&t.context.stroke(i);break;case"polygon":_=s.getAttribute("points"),b=_.match(/\d+/g).map(M=>parseInt(M,10)),t.context.poly(b,!0),e&&t.context.fill(e),i&&t.context.stroke(i);break;case"polyline":_=s.getAttribute("points"),b=_.match(/\d+/g).map(M=>parseInt(M,10)),t.context.poly(b,!1),i&&t.context.stroke(i);break;case"g":case"svg":break;default:{V(`[SVG parser] <${s.nodeName}> elements unsupported`);break}}a&&(e=null);for(let M=0;M<n.length;M++)rl(n[M],t,e,i)}function Iu(s){return Q.isColorLike(s)}function uo(s){return s instanceof Ei}function fo(s){return s instanceof qt}function Lu(s){return s instanceof O}function Bu(s,t,e){const i=Q.shared.setValue(t??0);return s.color=i.toNumber(),s.alpha=i.alpha===1?e.alpha:i.alpha,s.texture=O.WHITE,{...e,...s}}function Ru(s,t,e){return s.texture=t,{...e,...s}}function po(s,t,e){return s.fill=t,s.color=16777215,s.texture=t.texture,s.matrix=t.transform,{...e,...s}}function mo(s,t,e){return t.buildGradient(),s.fill=t,s.color=16777215,s.texture=t.texture,s.matrix=t.transform,s.textureSpace=t.textureSpace,{...e,...s}}function Fu(s,t){const e={...t,...s},i=Q.shared.setValue(e.color);return e.alpha*=i.alpha,e.color=i.toNumber(),e}function _e(s,t){if(s==null)return null;const e={},i=s;return Iu(s)?Bu(e,s,t):Lu(s)?Ru(e,s,t):uo(s)?po(e,s,t):fo(s)?mo(e,s,t):i.fill&&uo(i.fill)?po(i,i.fill,t):i.fill&&fo(i.fill)?mo(i,i.fill,t):Fu(i,t)}function Si(s,t){const{width:e,alignment:i,miterLimit:n,cap:r,join:o,pixelLine:a,...l}=t,c=_e(s,l);return c?{width:e,alignment:i,miterLimit:n,cap:r,join:o,pixelLine:a,...c}:null}const zu=new rt,go=new G,Xn=class Ot extends Rt{constructor(){super(...arguments),this.uid=K("graphicsContext"),this.dirty=!0,this.batchMode="auto",this.instructions=[],this._activePath=new jt,this._transform=new G,this._fillStyle={...Ot.defaultFillStyle},this._strokeStyle={...Ot.defaultStrokeStyle},this._stateStack=[],this._tick=0,this._bounds=new Lt,this._boundsDirty=!0}clone(){const t=new Ot;return t.batchMode=this.batchMode,t.instructions=this.instructions.slice(),t._activePath=this._activePath.clone(),t._transform=this._transform.clone(),t._fillStyle={...this._fillStyle},t._strokeStyle={...this._strokeStyle},t._stateStack=this._stateStack.slice(),t._bounds=this._bounds.clone(),t._boundsDirty=!0,t}get fillStyle(){return this._fillStyle}set fillStyle(t){this._fillStyle=_e(t,Ot.defaultFillStyle)}get strokeStyle(){return this._strokeStyle}set strokeStyle(t){this._strokeStyle=Si(t,Ot.defaultStrokeStyle)}setFillStyle(t){return this._fillStyle=_e(t,Ot.defaultFillStyle),this}setStrokeStyle(t){return this._strokeStyle=_e(t,Ot.defaultStrokeStyle),this}texture(t,e,i,n,r,o){return this.instructions.push({action:"texture",data:{image:t,dx:i||0,dy:n||0,dw:r||t.frame.width,dh:o||t.frame.height,transform:this._transform.clone(),alpha:this._fillStyle.alpha,style:e?Q.shared.setValue(e).toNumber():16777215}}),this.onUpdate(),this}beginPath(){return this._activePath=new jt,this}fill(t,e){let i;const n=this.instructions[this.instructions.length-1];return this._tick===0&&n&&n.action==="stroke"?i=n.data.path:i=this._activePath.clone(),i?(t!=null&&(e!==void 0&&typeof t=="number"&&(z(N,"GraphicsContext.fill(color, alpha) is deprecated, use GraphicsContext.fill({ color, alpha }) instead"),t={color:t,alpha:e}),this._fillStyle=_e(t,Ot.defaultFillStyle)),this.instructions.push({action:"fill",data:{style:this.fillStyle,path:i}}),this.onUpdate(),this._initNextPathLocation(),this._tick=0,this):this}_initNextPathLocation(){const{x:t,y:e}=this._activePath.getLastPoint(rt.shared);this._activePath.clear(),this._activePath.moveTo(t,e)}stroke(t){let e;const i=this.instructions[this.instructions.length-1];return this._tick===0&&i&&i.action==="fill"?e=i.data.path:e=this._activePath.clone(),e?(t!=null&&(this._strokeStyle=Si(t,Ot.defaultStrokeStyle)),this.instructions.push({action:"stroke",data:{style:this.strokeStyle,path:e}}),this.onUpdate(),this._initNextPathLocation(),this._tick=0,this):this}cut(){for(let t=0;t<2;t++){const e=this.instructions[this.instructions.length-1-t],i=this._activePath.clone();if(e&&(e.action==="stroke"||e.action==="fill"))if(e.data.hole)e.data.hole.addPath(i);else{e.data.hole=i;break}}return this._initNextPathLocation(),this}arc(t,e,i,n,r,o){this._tick++;const a=this._transform;return this._activePath.arc(a.a*t+a.c*e+a.tx,a.b*t+a.d*e+a.ty,i,n,r,o),this}arcTo(t,e,i,n,r){this._tick++;const o=this._transform;return this._activePath.arcTo(o.a*t+o.c*e+o.tx,o.b*t+o.d*e+o.ty,o.a*i+o.c*n+o.tx,o.b*i+o.d*n+o.ty,r),this}arcToSvg(t,e,i,n,r,o,a){this._tick++;const l=this._transform;return this._activePath.arcToSvg(t,e,i,n,r,l.a*o+l.c*a+l.tx,l.b*o+l.d*a+l.ty),this}bezierCurveTo(t,e,i,n,r,o,a){this._tick++;const l=this._transform;return this._activePath.bezierCurveTo(l.a*t+l.c*e+l.tx,l.b*t+l.d*e+l.ty,l.a*i+l.c*n+l.tx,l.b*i+l.d*n+l.ty,l.a*r+l.c*o+l.tx,l.b*r+l.d*o+l.ty,a),this}closePath(){var t;return this._tick++,(t=this._activePath)==null||t.closePath(),this}ellipse(t,e,i,n){return this._tick++,this._activePath.ellipse(t,e,i,n,this._transform.clone()),this}circle(t,e,i){return this._tick++,this._activePath.circle(t,e,i,this._transform.clone()),this}path(t){return this._tick++,this._activePath.addPath(t,this._transform.clone()),this}lineTo(t,e){this._tick++;const i=this._transform;return this._activePath.lineTo(i.a*t+i.c*e+i.tx,i.b*t+i.d*e+i.ty),this}moveTo(t,e){this._tick++;const i=this._transform,n=this._activePath.instructions,r=i.a*t+i.c*e+i.tx,o=i.b*t+i.d*e+i.ty;return n.length===1&&n[0].action==="moveTo"?(n[0].data[0]=r,n[0].data[1]=o,this):(this._activePath.moveTo(r,o),this)}quadraticCurveTo(t,e,i,n,r){this._tick++;const o=this._transform;return this._activePath.quadraticCurveTo(o.a*t+o.c*e+o.tx,o.b*t+o.d*e+o.ty,o.a*i+o.c*n+o.tx,o.b*i+o.d*n+o.ty,r),this}rect(t,e,i,n){return this._tick++,this._activePath.rect(t,e,i,n,this._transform.clone()),this}roundRect(t,e,i,n,r){return this._tick++,this._activePath.roundRect(t,e,i,n,r,this._transform.clone()),this}poly(t,e){return this._tick++,this._activePath.poly(t,e,this._transform.clone()),this}regularPoly(t,e,i,n,r=0,o){return this._tick++,this._activePath.regularPoly(t,e,i,n,r,o),this}roundPoly(t,e,i,n,r,o){return this._tick++,this._activePath.roundPoly(t,e,i,n,r,o),this}roundShape(t,e,i,n){return this._tick++,this._activePath.roundShape(t,e,i,n),this}filletRect(t,e,i,n,r){return this._tick++,this._activePath.filletRect(t,e,i,n,r),this}chamferRect(t,e,i,n,r,o){return this._tick++,this._activePath.chamferRect(t,e,i,n,r,o),this}star(t,e,i,n,r=0,o=0){return this._tick++,this._activePath.star(t,e,i,n,r,o,this._transform.clone()),this}svg(t){return this._tick++,Eu(t,this),this}restore(){const t=this._stateStack.pop();return t&&(this._transform=t.transform,this._fillStyle=t.fillStyle,this._strokeStyle=t.strokeStyle),this}save(){return this._stateStack.push({transform:this._transform.clone(),fillStyle:{...this._fillStyle},strokeStyle:{...this._strokeStyle}}),this}getTransform(){return this._transform}resetTransform(){return this._transform.identity(),this}rotate(t){return this._transform.rotate(t),this}scale(t,e=t){return this._transform.scale(t,e),this}setTransform(t,e,i,n,r,o){return t instanceof G?(this._transform.set(t.a,t.b,t.c,t.d,t.tx,t.ty),this):(this._transform.set(t,e,i,n,r,o),this)}transform(t,e,i,n,r,o){return t instanceof G?(this._transform.append(t),this):(go.set(t,e,i,n,r,o),this._transform.append(go),this)}translate(t,e=t){return this._transform.translate(t,e),this}clear(){return this._activePath.clear(),this.instructions.length=0,this.resetTransform(),this.onUpdate(),this}onUpdate(){this._boundsDirty=!0,!this.dirty&&(this.emit("update",this,16),this.dirty=!0)}get bounds(){if(!this._boundsDirty)return this._bounds;this._boundsDirty=!1;const t=this._bounds;t.clear();for(let e=0;e<this.instructions.length;e++){const i=this.instructions[e],n=i.action;if(n==="fill"){const r=i.data;t.addBounds(r.path.bounds)}else if(n==="texture"){const r=i.data;t.addFrame(r.dx,r.dy,r.dx+r.dw,r.dy+r.dh,r.transform)}if(n==="stroke"){const r=i.data,o=r.style.alignment,a=r.style.width*(1-o),l=r.path.bounds;t.addFrame(l.minX-a,l.minY-a,l.maxX+a,l.maxY+a)}}return t}containsPoint(t){var n;if(!this.bounds.containsPoint(t.x,t.y))return!1;const e=this.instructions;let i=!1;for(let r=0;r<e.length;r++){const o=e[r],a=o.data,l=a.path;if(!o.action||!l)continue;const c=a.style,h=l.shapePath.shapePrimitives;for(let d=0;d<h.length;d++){const f=h[d].shape;if(!c||!f)continue;const u=h[d].transform,m=u?u.applyInverse(t,zu):t;if(o.action==="fill")i=f.contains(m.x,m.y);else{const p=c;i=f.strokeContains(m.x,m.y,p.width,p.alignment)}const y=a.hole;if(y){const p=(n=y.shapePath)==null?void 0:n.shapePrimitives;if(p)for(let g=0;g<p.length;g++)p[g].shape.contains(m.x,m.y)&&(i=!1)}if(i)return!0}}return i}destroy(t=!1){if(this._stateStack.length=0,this._transform=null,this.emit("destroy",this),this.removeAllListeners(),typeof t=="boolean"?t:t==null?void 0:t.texture){const i=typeof t=="boolean"?t:t==null?void 0:t.textureSource;this._fillStyle.texture&&(this._fillStyle.fill&&"uid"in this._fillStyle.fill?this._fillStyle.fill.destroy():this._fillStyle.texture.destroy(i)),this._strokeStyle.texture&&(this._strokeStyle.fill&&"uid"in this._strokeStyle.fill?this._strokeStyle.fill.destroy():this._strokeStyle.texture.destroy(i))}this._fillStyle=null,this._strokeStyle=null,this.instructions=null,this._activePath=null,this._bounds=null,this._stateStack=null,this.customShader=null,this._transform=null}};Xn.defaultFillStyle={color:16777215,alpha:1,texture:O.WHITE,matrix:null,fill:null,textureSpace:"local"};Xn.defaultStrokeStyle={width:1,color:16777215,alpha:1,alignment:.5,miterLimit:10,cap:"butt",join:"miter",texture:O.WHITE,matrix:null,fill:null,textureSpace:"local",pixelLine:!1};let _t=Xn;const qn=class Be extends Rt{constructor(t={}){super(),this.uid=K("textStyle"),this._tick=0,Gu(t);const e={...Be.defaultTextStyle,...t};for(const i in e){const n=i;this[n]=e[i]}this.update(),this._tick=0}get align(){return this._align}set align(t){this._align=t,this.update()}get breakWords(){return this._breakWords}set breakWords(t){this._breakWords=t,this.update()}get dropShadow(){return this._dropShadow}set dropShadow(t){t!==null&&typeof t=="object"?this._dropShadow=this._createProxy({...Be.defaultDropShadow,...t}):this._dropShadow=t?this._createProxy({...Be.defaultDropShadow}):null,this.update()}get fontFamily(){return this._fontFamily}set fontFamily(t){this._fontFamily=t,this.update()}get fontSize(){return this._fontSize}set fontSize(t){typeof t=="string"?this._fontSize=parseInt(t,10):this._fontSize=t,this.update()}get fontStyle(){return this._fontStyle}set fontStyle(t){this._fontStyle=t.toLowerCase(),this.update()}get fontVariant(){return this._fontVariant}set fontVariant(t){this._fontVariant=t,this.update()}get fontWeight(){return this._fontWeight}set fontWeight(t){this._fontWeight=t,this.update()}get leading(){return this._leading}set leading(t){this._leading=t,this.update()}get letterSpacing(){return this._letterSpacing}set letterSpacing(t){this._letterSpacing=t,this.update()}get lineHeight(){return this._lineHeight}set lineHeight(t){this._lineHeight=t,this.update()}get padding(){return this._padding}set padding(t){this._padding=t,this.update()}get filters(){return this._filters}set filters(t){this._filters=Object.freeze(t),this.update()}get trim(){return this._trim}set trim(t){this._trim=t,this.update()}get textBaseline(){return this._textBaseline}set textBaseline(t){this._textBaseline=t,this.update()}get whiteSpace(){return this._whiteSpace}set whiteSpace(t){this._whiteSpace=t,this.update()}get wordWrap(){return this._wordWrap}set wordWrap(t){this._wordWrap=t,this.update()}get wordWrapWidth(){return this._wordWrapWidth}set wordWrapWidth(t){this._wordWrapWidth=t,this.update()}get fill(){return this._originalFill}set fill(t){t!==this._originalFill&&(this._originalFill=t,this._isFillStyle(t)&&(this._originalFill=this._createProxy({..._t.defaultFillStyle,...t},()=>{this._fill=_e({...this._originalFill},_t.defaultFillStyle)})),this._fill=_e(t===0?"black":t,_t.defaultFillStyle),this.update())}get stroke(){return this._originalStroke}set stroke(t){t!==this._originalStroke&&(this._originalStroke=t,this._isFillStyle(t)&&(this._originalStroke=this._createProxy({..._t.defaultStrokeStyle,...t},()=>{this._stroke=Si({...this._originalStroke},_t.defaultStrokeStyle)})),this._stroke=Si(t,_t.defaultStrokeStyle),this.update())}update(){this._tick++,this.emit("update",this)}reset(){const t=Be.defaultTextStyle;for(const e in t)this[e]=t[e]}get styleKey(){return`${this.uid}-${this._tick}`}clone(){return new Be({align:this.align,breakWords:this.breakWords,dropShadow:this._dropShadow?{...this._dropShadow}:null,fill:this._fill,fontFamily:this.fontFamily,fontSize:this.fontSize,fontStyle:this.fontStyle,fontVariant:this.fontVariant,fontWeight:this.fontWeight,leading:this.leading,letterSpacing:this.letterSpacing,lineHeight:this.lineHeight,padding:this.padding,stroke:this._stroke,textBaseline:this.textBaseline,whiteSpace:this.whiteSpace,wordWrap:this.wordWrap,wordWrapWidth:this.wordWrapWidth,filters:this._filters?[...this._filters]:void 0})}_getFinalPadding(){let t=0;if(this._filters)for(let e=0;e<this._filters.length;e++)t+=this._filters[e].padding;return Math.max(this._padding,t)}destroy(t=!1){var i,n,r,o;if(this.removeAllListeners(),typeof t=="boolean"?t:t==null?void 0:t.texture){const a=typeof t=="boolean"?t:t==null?void 0:t.textureSource;(i=this._fill)!=null&&i.texture&&this._fill.texture.destroy(a),(n=this._originalFill)!=null&&n.texture&&this._originalFill.texture.destroy(a),(r=this._stroke)!=null&&r.texture&&this._stroke.texture.destroy(a),(o=this._originalStroke)!=null&&o.texture&&this._originalStroke.texture.destroy(a)}this._fill=null,this._stroke=null,this.dropShadow=null,this._originalStroke=null,this._originalFill=null}_createProxy(t,e){return new Proxy(t,{set:(i,n,r)=>(i[n]=r,e==null||e(n,r),this.update(),!0)})}_isFillStyle(t){return(t??null)!==null&&!(Q.isColorLike(t)||t instanceof qt||t instanceof Ei)}};qn.defaultDropShadow={alpha:1,angle:Math.PI/6,blur:0,color:"black",distance:5};qn.defaultTextStyle={align:"left",breakWords:!1,dropShadow:null,fill:"black",fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",leading:0,letterSpacing:0,lineHeight:0,padding:0,stroke:null,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100};let Ae=qn;function Gu(s){const t=s;if(typeof t.dropShadow=="boolean"&&t.dropShadow){const e=Ae.defaultDropShadow;s.dropShadow={alpha:t.dropShadowAlpha??e.alpha,angle:t.dropShadowAngle??e.angle,blur:t.dropShadowBlur??e.blur,color:t.dropShadowColor??e.color,distance:t.dropShadowDistance??e.distance}}if(t.strokeThickness!==void 0){z(N,"strokeThickness is now a part of stroke");const e=t.stroke;let i={};if(Q.isColorLike(e))i.color=e;else if(e instanceof qt||e instanceof Ei)i.fill=e;else if(Object.hasOwnProperty.call(e,"color")||Object.hasOwnProperty.call(e,"fill"))i=e;else throw new Error("Invalid stroke value.");s.stroke={...i,width:t.strokeThickness}}if(Array.isArray(t.fillGradientStops)){if(z(N,"gradient fill is now a fill pattern: `new FillGradient(...)`"),!Array.isArray(t.fill)||t.fill.length===0)throw new Error("Invalid fill value. Expected an array of colors for gradient fill.");t.fill.length!==t.fillGradientStops.length&&V("The number of fill colors must match the number of fill gradient stops.");const e=new qt({start:{x:0,y:0},end:{x:0,y:1},textureSpace:"local"}),i=t.fillGradientStops.slice(),n=t.fill.map(r=>Q.shared.setValue(r).toNumber());i.forEach((r,o)=>{e.addColorStop(r,n[o])}),s.fill={fill:e}}}class Ou{constructor(t){this._canvasPool=Object.create(null),this.canvasOptions=t||{},this.enableFullScreen=!1}_createCanvasAndContext(t,e){const i=H.get().createCanvas();i.width=t,i.height=e;const n=i.getContext("2d");return{canvas:i,context:n}}getOptimalCanvasAndContext(t,e,i=1){t=Math.ceil(t*i-1e-6),e=Math.ceil(e*i-1e-6),t=$e(t),e=$e(e);const n=(t<<17)+(e<<1);this._canvasPool[n]||(this._canvasPool[n]=[]);let r=this._canvasPool[n].pop();return r||(r=this._createCanvasAndContext(t,e)),r}returnCanvasAndContext(t){const e=t.canvas,{width:i,height:n}=e,r=(i<<17)+(n<<1);t.context.resetTransform(),t.context.clearRect(0,0,i,n),this._canvasPool[r].push(t)}clear(){this._canvasPool={}}}const zs=new Ou;$s.register(zs);const yo=1e5;function Ai(s,t,e,i=0){if(s.texture===O.WHITE&&!s.fill)return Q.shared.setValue(s.color).setAlpha(s.alpha??1).toHexa();if(s.fill){if(s.fill instanceof Ei){const n=s.fill,r=t.createPattern(n.texture.source.resource,"repeat"),o=n.transform.copyTo(G.shared);return o.scale(n.texture.frame.width,n.texture.frame.height),r.setTransform(o),r}else if(s.fill instanceof qt){const n=s.fill,r=n.type==="linear",o=n.textureSpace==="local";let a=1,l=1;o&&e&&(a=e.width+i,l=e.height+i);let c,h=!1;if(r){const{start:d,end:f}=n;c=t.createLinearGradient(d.x*a,d.y*l,f.x*a,f.y*l),h=Math.abs(f.x-d.x)<Math.abs((f.y-d.y)*.1)}else{const{center:d,innerRadius:f,outerCenter:u,outerRadius:m}=n;c=t.createRadialGradient(d.x*a,d.y*l,f*a,u.x*a,u.y*l,m*a)}if(h&&o&&e){const d=e.lineHeight/l;for(let f=0;f<e.lines.length;f++){const u=(f*e.lineHeight+i/2)/l;n.colorStops.forEach(m=>{const y=u+m.offset*d;c.addColorStop(Math.floor(y*yo)/yo,Q.shared.setValue(m.color).toHex())})}}else n.colorStops.forEach(d=>{c.addColorStop(d.offset,Q.shared.setValue(d.color).toHex())});return c}}else{const n=t.createPattern(s.texture.source.resource,"repeat"),r=s.matrix.copyTo(G.shared);return r.scale(s.texture.frame.width,s.texture.frame.height),n.setTransform(r),n}return V("FillStyle not recognised",s),"red"}const ol=class al extends Wa{constructor(t){super(),this.resolution=1,this.pages=[],this._padding=0,this._measureCache=Object.create(null),this._currentChars=[],this._currentX=0,this._currentY=0,this._currentMaxCharHeight=0,this._currentPageIndex=-1,this._skipKerning=!1;const e={...al.defaultOptions,...t};this._textureSize=e.textureSize,this._mipmap=e.mipmap;const i=e.style.clone();e.overrideFill&&(i._fill.color=16777215,i._fill.alpha=1,i._fill.texture=O.WHITE,i._fill.fill=null),this.applyFillAsTint=e.overrideFill;const n=i.fontSize;i.fontSize=this.baseMeasurementFontSize;const r=wi(i);e.overrideSize?i._stroke&&(i._stroke.width*=this.baseRenderedFontSize/n):i.fontSize=this.baseRenderedFontSize=n,this._style=i,this._skipKerning=e.skipKerning??!1,this.resolution=e.resolution??1,this._padding=e.padding??4,e.textureStyle&&(this._textureStyle=e.textureStyle instanceof We?e.textureStyle:new We(e.textureStyle)),this.fontMetrics=$t.measureFont(r),this.lineHeight=i.lineHeight||this.fontMetrics.fontSize||i.fontSize}ensureCharacters(t){var p,g;const e=$t.graphemeSegmenter(t).filter(x=>!this._currentChars.includes(x)).filter((x,b,_)=>_.indexOf(x)===b);if(!e.length)return;this._currentChars=[...this._currentChars,...e];let i;this._currentPageIndex===-1?i=this._nextPage():i=this.pages[this._currentPageIndex];let{canvas:n,context:r}=i.canvasAndContext,o=i.texture.source;const a=this._style;let l=this._currentX,c=this._currentY,h=this._currentMaxCharHeight;const d=this.baseRenderedFontSize/this.baseMeasurementFontSize,f=this._padding*d;let u=!1;const m=n.width/this.resolution,y=n.height/this.resolution;for(let x=0;x<e.length;x++){const b=e[x],_=$t.measureText(b,a,n,!1);_.lineHeight=_.height;const S=_.width*d,v=Math.ceil((a.fontStyle==="italic"?2:1)*S),w=_.height*d,C=v+f*2,M=w+f*2;if(u=!1,b!==`
`&&b!=="\r"&&b!=="	"&&b!==" "&&(u=!0,h=Math.ceil(Math.max(M,h))),l+C>m&&(c+=h,h=M,l=0,c+h>y)){o.update();const A=this._nextPage();n=A.canvasAndContext.canvas,r=A.canvasAndContext.context,o=A.texture.source,l=0,c=0,h=0}const k=S/d-(((p=a.dropShadow)==null?void 0:p.distance)??0)-(((g=a._stroke)==null?void 0:g.width)??0);if(this.chars[b]={id:b.codePointAt(0),xOffset:-this._padding,yOffset:-this._padding,xAdvance:k,kerning:{}},u){this._drawGlyph(r,_,l+f,c+f,d,a);const A=o.width*d,F=o.height*d,L=new j(l/A*o.width,c/F*o.height,C/A*o.width,M/F*o.height);this.chars[b].texture=new O({source:o,frame:L}),l+=Math.ceil(C)}}o.update(),this._currentX=l,this._currentY=c,this._currentMaxCharHeight=h,this._skipKerning&&this._applyKerning(e,r)}get pageTextures(){return z(N,"BitmapFont.pageTextures is deprecated, please use BitmapFont.pages instead."),this.pages}_applyKerning(t,e){const i=this._measureCache;for(let n=0;n<t.length;n++){const r=t[n];for(let o=0;o<this._currentChars.length;o++){const a=this._currentChars[o];let l=i[r];l||(l=i[r]=e.measureText(r).width);let c=i[a];c||(c=i[a]=e.measureText(a).width);let h=e.measureText(r+a).width,d=h-(l+c);d&&(this.chars[r].kerning[a]=d),h=e.measureText(r+a).width,d=h-(l+c),d&&(this.chars[a].kerning[r]=d)}}}_nextPage(){this._currentPageIndex++;const t=this.resolution,e=zs.getOptimalCanvasAndContext(this._textureSize,this._textureSize,t);this._setupContext(e.context,this._style,t);const i=t*(this.baseRenderedFontSize/this.baseMeasurementFontSize),n=new O({source:new ve({resource:e.canvas,resolution:i,alphaMode:"premultiply-alpha-on-upload",autoGenerateMipmaps:this._mipmap})});this._textureStyle&&(n.source.style=this._textureStyle);const r={canvasAndContext:e,texture:n};return this.pages[this._currentPageIndex]=r,r}_setupContext(t,e,i){e.fontSize=this.baseRenderedFontSize,t.scale(i,i),t.font=wi(e),e.fontSize=this.baseMeasurementFontSize,t.textBaseline=e.textBaseline;const n=e._stroke,r=(n==null?void 0:n.width)??0;if(n&&(t.lineWidth=r,t.lineJoin=n.join,t.miterLimit=n.miterLimit,t.strokeStyle=Ai(n,t)),e._fill&&(t.fillStyle=Ai(e._fill,t)),e.dropShadow){const o=e.dropShadow,a=Q.shared.setValue(o.color).toArray(),l=o.blur*i,c=o.distance*i;t.shadowColor=`rgba(${a[0]*255},${a[1]*255},${a[2]*255},${o.alpha})`,t.shadowBlur=l,t.shadowOffsetX=Math.cos(o.angle)*c,t.shadowOffsetY=Math.sin(o.angle)*c}else t.shadowColor="black",t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0}_drawGlyph(t,e,i,n,r,o){const a=e.text,l=e.fontProperties,c=o._stroke,h=((c==null?void 0:c.width)??0)*r,d=i+h/2,f=n-h/2,u=l.descent*r,m=e.lineHeight*r;let y=!1;o.stroke&&h&&(y=!0,t.strokeText(a,d,f+m-u));const{shadowBlur:p,shadowOffsetX:g,shadowOffsetY:x}=t;o._fill&&(y&&(t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0),t.fillText(a,d,f+m-u)),y&&(t.shadowBlur=p,t.shadowOffsetX=g,t.shadowOffsetY=x)}destroy(){super.destroy();for(let t=0;t<this.pages.length;t++){const{canvasAndContext:e,texture:i}=this.pages[t];zs.returnCanvasAndContext(e),i.destroy(!0)}this.pages=null}};ol.defaultOptions={textureSize:512,style:new Ae,mipmap:!0};let xo=ol;function Du(s,t,e,i){const n={width:0,height:0,offsetY:0,scale:t.fontSize/e.baseMeasurementFontSize,lines:[{width:0,charPositions:[],spaceWidth:0,spacesIndex:[],chars:[]}]};n.offsetY=e.baseLineOffset;let r=n.lines[0],o=null,a=!0;const l={width:0,start:0,index:0,positions:[],chars:[]},c=e.baseMeasurementFontSize/t.fontSize,h=t.letterSpacing*c,d=t.wordWrapWidth*c,f=t.lineHeight?t.lineHeight*c:e.lineHeight,u=t.wordWrap&&t.breakWords,m=g=>{const x=r.width;for(let b=0;b<l.index;b++){const _=g.positions[b];r.chars.push(g.chars[b]),r.charPositions.push(_+x)}r.width+=g.width,a=!1,l.width=0,l.index=0,l.chars.length=0},y=()=>{let g=r.chars.length-1;if(i){let x=r.chars[g];for(;x===" ";)r.width-=e.chars[x].xAdvance,x=r.chars[--g]}n.width=Math.max(n.width,r.width),r={width:0,charPositions:[],chars:[],spaceWidth:0,spacesIndex:[]},a=!0,n.lines.push(r),n.height+=f},p=g=>g-h>d;for(let g=0;g<s.length+1;g++){let x;const b=g===s.length;b||(x=s[g]);const _=e.chars[x]||e.chars[" "];if(/(?:\s)/.test(x)||x==="\r"||x===`
`||b){if(!a&&t.wordWrap&&p(r.width+l.width)?(y(),m(l),b||r.charPositions.push(0)):(l.start=r.width,m(l),b||r.charPositions.push(0)),x==="\r"||x===`
`)y();else if(!b){const C=_.xAdvance+(_.kerning[o]||0)+h;r.width+=C,r.spaceWidth=C,r.spacesIndex.push(r.charPositions.length),r.chars.push(x)}}else{const w=_.kerning[o]||0,C=_.xAdvance+w+h;u&&p(r.width+l.width+C)&&(m(l),y()),l.positions[l.index++]=l.width+w,l.chars.push(x),l.width+=C}o=x}return y(),t.align==="center"?$u(n):t.align==="right"?Wu(n):t.align==="justify"&&Nu(n),n}function $u(s){for(let t=0;t<s.lines.length;t++){const e=s.lines[t],i=s.width/2-e.width/2;for(let n=0;n<e.charPositions.length;n++)e.charPositions[n]+=i}}function Wu(s){for(let t=0;t<s.lines.length;t++){const e=s.lines[t],i=s.width-e.width;for(let n=0;n<e.charPositions.length;n++)e.charPositions[n]+=i}}function Nu(s){const t=s.width;for(let e=0;e<s.lines.length;e++){const i=s.lines[e];let n=0,r=i.spacesIndex[n++],o=0;const a=i.spacesIndex.length,c=(t-i.width)/a;for(let h=0;h<i.charPositions.length;h++)h===r&&(r=i.spacesIndex[n++],o+=c),i.charPositions[h]+=o}}function Uu(s){if(s==="")return[];typeof s=="string"&&(s=[s]);const t=[];for(let e=0,i=s.length;e<i;e++){const n=s[e];if(Array.isArray(n)){if(n.length!==2)throw new Error(`[BitmapFont]: Invalid character range length, expecting 2 got ${n.length}.`);if(n[0].length===0||n[1].length===0)throw new Error("[BitmapFont]: Invalid character delimiter.");const r=n[0].charCodeAt(0),o=n[1].charCodeAt(0);if(o<r)throw new Error("[BitmapFont]: Invalid character range.");for(let a=r,l=o;a<=l;a++)t.push(String.fromCharCode(a))}else t.push(...Array.from(n))}if(t.length===0)throw new Error("[BitmapFont]: Empty set when resolving characters.");return t}let fi=0;class Hu{constructor(){this.ALPHA=[["a","z"],["A","Z"]," "],this.NUMERIC=[["0","9"]],this.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "],this.ASCII=[[" ","~"]],this.defaultOptions={chars:this.ALPHANUMERIC,resolution:1,padding:4,skipKerning:!1,textureStyle:null},this.measureCache=Na(1e3)}getFont(t,e){var o;let i=`${e.fontFamily}-bitmap`,n=!0;if(e._fill.fill&&!e._stroke?(i+=e._fill.fill.styleKey,n=!1):(e._stroke||e.dropShadow)&&(i=`${e.styleKey}-bitmap`,n=!1),!Y.has(i)){const a=Object.create(e);a.lineHeight=0;const l=new xo({style:a,overrideFill:n,overrideSize:!0,...this.defaultOptions});fi++,fi>50&&V("BitmapText",`You have dynamically created ${fi} bitmap fonts, this can be inefficient. Try pre installing your font styles using \`BitmapFont.install({name:"style1", style})\``),l.once("destroy",()=>{fi--,Y.remove(i)}),Y.set(i,l)}const r=Y.get(i);return(o=r.ensureCharacters)==null||o.call(r,t),r}getLayout(t,e,i=!0){const n=this.getFont(t,e),r=`${t}-${e.styleKey}-${i}`;if(this.measureCache.has(r))return this.measureCache.get(r);const o=$t.graphemeSegmenter(t),a=Du(o,e,n,i);return this.measureCache.set(r,a),a}measureText(t,e,i=!0){return this.getLayout(t,e,i)}install(...t){var c,h,d,f;let e=t[0];typeof e=="string"&&(e={name:e,style:t[1],chars:(c=t[2])==null?void 0:c.chars,resolution:(h=t[2])==null?void 0:h.resolution,padding:(d=t[2])==null?void 0:d.padding,skipKerning:(f=t[2])==null?void 0:f.skipKerning},z(N,"BitmapFontManager.install(name, style, options) is deprecated, use BitmapFontManager.install({name, style, ...options})"));const i=e==null?void 0:e.name;if(!i)throw new Error("[BitmapFontManager] Property `name` is required.");e={...this.defaultOptions,...e};const n=e.style,r=n instanceof Ae?n:new Ae(n),o=e.dynamicFill??this._canUseTintForStyle(r),a=new xo({style:r,overrideFill:o,skipKerning:e.skipKerning,padding:e.padding,resolution:e.resolution,overrideSize:!1,textureStyle:e.textureStyle}),l=Uu(e.chars);return a.ensureCharacters(l.join("")),Y.set(`${i}-bitmap`,a),a.once("destroy",()=>Y.remove(`${i}-bitmap`)),a}uninstall(t){const e=`${t}-bitmap`,i=Y.get(e);i&&i.destroy()}_canUseTintForStyle(t){return!t._stroke&&(!t.dropShadow||t.dropShadow.color===0)&&!t._fill.fill&&t._fill.color===16777215}}const bo=new Hu;class ll extends Wa{constructor(t,e){super();const{textures:i,data:n}=t;Object.keys(n.pages).forEach(r=>{const o=n.pages[parseInt(r,10)],a=i[o.id];this.pages.push({texture:a})}),Object.keys(n.chars).forEach(r=>{const o=n.chars[r],{frame:a,source:l,rotate:c}=i[o.page],h=U.transformRectCoords(o,a,c,new j),d=new O({frame:h,orig:new j(0,0,o.width,o.height),source:l,rotate:c});this.chars[r]={id:r.codePointAt(0),xOffset:o.xOffset,yOffset:o.yOffset,xAdvance:o.xAdvance,kerning:o.kerning??{},texture:d}}),this.baseRenderedFontSize=n.fontSize,this.baseMeasurementFontSize=n.fontSize,this.fontMetrics={ascent:0,descent:0,fontSize:n.fontSize},this.baseLineOffset=n.baseLineOffset,this.lineHeight=n.lineHeight,this.fontFamily=n.fontFamily,this.distanceField=n.distanceField??{type:"none",range:0},this.url=e}destroy(){super.destroy();for(let t=0;t<this.pages.length;t++){const{texture:e}=this.pages[t];e.destroy(!0)}this.pages=null}static install(t){bo.install(t)}static uninstall(t){bo.uninstall(t)}}const dn={test(s){return typeof s=="string"&&s.startsWith("info face=")},parse(s){const t=s.match(/^[a-z]+\s+.+$/gm),e={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[],distanceField:[]};for(const d in t){const f=t[d].match(/^[a-z]+/gm)[0],u=t[d].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),m={};for(const y in u){const p=u[y].split("="),g=p[0],x=p[1].replace(/"/gm,""),b=parseFloat(x),_=isNaN(b)?x:b;m[g]=_}e[f].push(m)}const i={chars:{},pages:[],lineHeight:0,fontSize:0,fontFamily:"",distanceField:null,baseLineOffset:0},[n]=e.info,[r]=e.common,[o]=e.distanceField??[];o&&(i.distanceField={range:parseInt(o.distanceRange,10),type:o.fieldType}),i.fontSize=parseInt(n.size,10),i.fontFamily=n.face,i.lineHeight=parseInt(r.lineHeight,10);const a=e.page;for(let d=0;d<a.length;d++)i.pages.push({id:parseInt(a[d].id,10)||0,file:a[d].file});const l={};i.baseLineOffset=i.lineHeight-parseInt(r.base,10);const c=e.char;for(let d=0;d<c.length;d++){const f=c[d],u=parseInt(f.id,10);let m=f.letter??f.char??String.fromCharCode(u);m==="space"&&(m=" "),l[u]=m,i.chars[m]={id:u,page:parseInt(f.page,10)||0,x:parseInt(f.x,10),y:parseInt(f.y,10),width:parseInt(f.width,10),height:parseInt(f.height,10),xOffset:parseInt(f.xoffset,10),yOffset:parseInt(f.yoffset,10),xAdvance:parseInt(f.xadvance,10),kerning:{}}}const h=e.kerning||[];for(let d=0;d<h.length;d++){const f=parseInt(h[d].first,10),u=parseInt(h[d].second,10),m=parseInt(h[d].amount,10);i.chars[l[u]].kerning[l[f]]=m}return i}},_o={test(s){const t=s;return typeof t!="string"&&"getElementsByTagName"in t&&t.getElementsByTagName("page").length&&t.getElementsByTagName("info")[0].getAttribute("face")!==null},parse(s){const t={chars:{},pages:[],lineHeight:0,fontSize:0,fontFamily:"",distanceField:null,baseLineOffset:0},e=s.getElementsByTagName("info")[0],i=s.getElementsByTagName("common")[0],n=s.getElementsByTagName("distanceField")[0];n&&(t.distanceField={type:n.getAttribute("fieldType"),range:parseInt(n.getAttribute("distanceRange"),10)});const r=s.getElementsByTagName("page"),o=s.getElementsByTagName("char"),a=s.getElementsByTagName("kerning");t.fontSize=parseInt(e.getAttribute("size"),10),t.fontFamily=e.getAttribute("face"),t.lineHeight=parseInt(i.getAttribute("lineHeight"),10);for(let c=0;c<r.length;c++)t.pages.push({id:parseInt(r[c].getAttribute("id"),10)||0,file:r[c].getAttribute("file")});const l={};t.baseLineOffset=t.lineHeight-parseInt(i.getAttribute("base"),10);for(let c=0;c<o.length;c++){const h=o[c],d=parseInt(h.getAttribute("id"),10);let f=h.getAttribute("letter")??h.getAttribute("char")??String.fromCharCode(d);f==="space"&&(f=" "),l[d]=f,t.chars[f]={id:d,page:parseInt(h.getAttribute("page"),10)||0,x:parseInt(h.getAttribute("x"),10),y:parseInt(h.getAttribute("y"),10),width:parseInt(h.getAttribute("width"),10),height:parseInt(h.getAttribute("height"),10),xOffset:parseInt(h.getAttribute("xoffset"),10),yOffset:parseInt(h.getAttribute("yoffset"),10),xAdvance:parseInt(h.getAttribute("xadvance"),10),kerning:{}}}for(let c=0;c<a.length;c++){const h=parseInt(a[c].getAttribute("first"),10),d=parseInt(a[c].getAttribute("second"),10),f=parseInt(a[c].getAttribute("amount"),10);t.chars[l[d]].kerning[l[h]]=f}return t}},wo={test(s){return typeof s=="string"&&s.includes("<font>")?_o.test(H.get().parseXML(s)):!1},parse(s){return _o.parse(H.get().parseXML(s))}},Yu=[".xml",".fnt"],Vu={extension:{type:E.CacheParser,name:"cacheBitmapFont"},test:s=>s instanceof ll,getCacheableAssets(s,t){const e={};return s.forEach(i=>{e[i]=t,e[`${i}-bitmap`]=t}),e[`${t.fontFamily}-bitmap`]=t,e}},ju={extension:{type:E.LoadParser,priority:ae.Normal},name:"loadBitmapFont",id:"bitmap-font",test(s){return Yu.includes(yt.extname(s).toLowerCase())},async testParse(s){return dn.test(s)||wo.test(s)},async parse(s,t,e){const i=dn.test(s)?dn.parse(s):wo.parse(s),{src:n}=t,{pages:r}=i,o=[],a=i.distanceField?{scaleMode:"linear",alphaMode:"premultiply-alpha-on-upload",autoGenerateMipmaps:!1,resolution:1}:{};for(let d=0;d<r.length;++d){const f=r[d].file;let u=yt.join(yt.dirname(n),f);u=kn(u,n),o.push({src:u,data:a})}const l=await e.load(o),c=o.map(d=>l[d.src]);return new ll({data:i,textures:c},n)},async load(s,t){return await(await H.get().fetch(s)).text()},async unload(s,t,e){await Promise.all(s.pages.map(i=>e.unload(i.texture.source._sourceOrigin))),s.destroy()}};class Xu{constructor(t,e=!1){this._loader=t,this._assetList=[],this._isLoading=!1,this._maxConcurrent=1,this.verbose=e}add(t){t.forEach(e=>{this._assetList.push(e)}),this.verbose&&console.log("[BackgroundLoader] assets: ",this._assetList),this._isActive&&!this._isLoading&&this._next()}async _next(){if(this._assetList.length&&this._isActive){this._isLoading=!0;const t=[],e=Math.min(this._assetList.length,this._maxConcurrent);for(let i=0;i<e;i++)t.push(this._assetList.pop());await this._loader.load(t),this._isLoading=!1,this._next()}}get active(){return this._isActive}set active(t){this._isActive!==t&&(this._isActive=t,t&&!this._isLoading&&this._next())}}const qu={extension:{type:E.CacheParser,name:"cacheTextureArray"},test:s=>Array.isArray(s)&&s.every(t=>t instanceof O),getCacheableAssets:(s,t)=>{const e={};return s.forEach(i=>{t.forEach((n,r)=>{e[i+(r===0?"":r+1)]=n})}),e}};async function cl(s){if("Image"in globalThis)return new Promise(t=>{const e=new Image;e.onload=()=>{t(!0)},e.onerror=()=>{t(!1)},e.src=s});if("createImageBitmap"in globalThis&&"fetch"in globalThis){try{const t=await(await fetch(s)).blob();await createImageBitmap(t)}catch{return!1}return!0}return!1}const Ku={extension:{type:E.DetectionParser,priority:1},test:async()=>cl("data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A="),add:async s=>[...s,"avif"],remove:async s=>s.filter(t=>t!=="avif")},vo=["png","jpg","jpeg"],Zu={extension:{type:E.DetectionParser,priority:-1},test:()=>Promise.resolve(!0),add:async s=>[...s,...vo],remove:async s=>s.filter(t=>!vo.includes(t))},Qu="WorkerGlobalScope"in globalThis&&globalThis instanceof globalThis.WorkerGlobalScope;function Bi(s){return Qu?!1:document.createElement("video").canPlayType(s)!==""}const Ju={extension:{type:E.DetectionParser,priority:0},test:async()=>Bi("video/mp4"),add:async s=>[...s,"mp4","m4v"],remove:async s=>s.filter(t=>t!=="mp4"&&t!=="m4v")},tf={extension:{type:E.DetectionParser,priority:0},test:async()=>Bi("video/ogg"),add:async s=>[...s,"ogv"],remove:async s=>s.filter(t=>t!=="ogv")},ef={extension:{type:E.DetectionParser,priority:0},test:async()=>Bi("video/webm"),add:async s=>[...s,"webm"],remove:async s=>s.filter(t=>t!=="webm")},sf={extension:{type:E.DetectionParser,priority:0},test:async()=>cl("data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA="),add:async s=>[...s,"webp"],remove:async s=>s.filter(t=>t!=="webp")};class nf{constructor(){this._parsers=[],this._parsersValidated=!1,this.parsers=new Proxy(this._parsers,{set:(t,e,i)=>(this._parsersValidated=!1,t[e]=i,!0)}),this.promiseCache={}}reset(){this._parsersValidated=!1,this.promiseCache={}}_getLoadPromiseAndParser(t,e){const i={promise:null,parser:null};return i.promise=(async()=>{var o,a;let n=null,r=null;if((e.parser||e.loadParser)&&(r=this._parserHash[e.parser||e.loadParser],e.loadParser&&V(`[Assets] "loadParser" is deprecated, use "parser" instead for ${t}`),r||V(`[Assets] specified load parser "${e.parser||e.loadParser}" not found while loading ${t}`)),!r){for(let l=0;l<this.parsers.length;l++){const c=this.parsers[l];if(c.load&&((o=c.test)!=null&&o.call(c,t,e,this))){r=c;break}}if(!r)return V(`[Assets] ${t} could not be loaded as we don't know how to parse it, ensure the correct parser has been added`),null}n=await r.load(t,e,this),i.parser=r;for(let l=0;l<this.parsers.length;l++){const c=this.parsers[l];c.parse&&c.parse&&await((a=c.testParse)==null?void 0:a.call(c,n,e,this))&&(n=await c.parse(n,e,this)||n,i.parser=c)}return n})(),i}async load(t,e){this._parsersValidated||this._validateParsers();let i=0;const n={},r=_i(t),o=Pt(t,c=>({alias:[c],src:c,data:{}})),a=o.length,l=o.map(async c=>{const h=yt.toAbsolute(c.src);if(!n[c.src])try{this.promiseCache[h]||(this.promiseCache[h]=this._getLoadPromiseAndParser(h,c)),n[c.src]=await this.promiseCache[h].promise,e&&e(++i/a)}catch(d){throw delete this.promiseCache[h],delete n[c.src],new Error(`[Loader.load] Failed to load ${h}.
${d}`)}});return await Promise.all(l),r?n[o[0].src]:n}async unload(t){const i=Pt(t,n=>({alias:[n],src:n})).map(async n=>{var a,l;const r=yt.toAbsolute(n.src),o=this.promiseCache[r];if(o){const c=await o.promise;delete this.promiseCache[r],await((l=(a=o.parser)==null?void 0:a.unload)==null?void 0:l.call(a,c,n,this))}});await Promise.all(i)}_validateParsers(){this._parsersValidated=!0,this._parserHash=this._parsers.filter(t=>t.name||t.id).reduce((t,e)=>(!e.name&&!e.id?V("[Assets] parser should have an id"):(t[e.name]||t[e.id])&&V(`[Assets] parser id conflict "${e.id}"`),t[e.name]=e,e.id&&(t[e.id]=e),t),{})}}function Ze(s,t){if(Array.isArray(t)){for(const e of t)if(s.startsWith(`data:${e}`))return!0;return!1}return s.startsWith(`data:${t}`)}function Qe(s,t){const e=s.split("?")[0],i=yt.extname(e).toLowerCase();return Array.isArray(t)?t.includes(i):i===t}const rf=".json",of="application/json",af={extension:{type:E.LoadParser,priority:ae.Low},name:"loadJson",id:"json",test(s){return Ze(s,of)||Qe(s,rf)},async load(s){return await(await H.get().fetch(s)).json()}},lf=".txt",cf="text/plain",hf={name:"loadTxt",id:"text",extension:{type:E.LoadParser,priority:ae.Low,name:"loadTxt"},test(s){return Ze(s,cf)||Qe(s,lf)},async load(s){return await(await H.get().fetch(s)).text()}},df=["normal","bold","100","200","300","400","500","600","700","800","900"],uf=[".ttf",".otf",".woff",".woff2"],ff=["font/ttf","font/otf","font/woff","font/woff2"],pf=/^(--|-?[A-Z_])[0-9A-Z_-]*$/i;function mf(s){const t=yt.extname(s),n=yt.basename(s,t).replace(/(-|_)/g," ").toLowerCase().split(" ").map(a=>a.charAt(0).toUpperCase()+a.slice(1));let r=n.length>0;for(const a of n)if(!a.match(pf)){r=!1;break}let o=n.join(" ");return r||(o=`"${o.replace(/[\\"]/g,"\\$&")}"`),o}const gf=/^[0-9A-Za-z%:/?#\[\]@!\$&'()\*\+,;=\-._~]*$/;function yf(s){return gf.test(s)?s:encodeURI(s)}const xf={extension:{type:E.LoadParser,priority:ae.Low},name:"loadWebFont",id:"web-font",test(s){return Ze(s,ff)||Qe(s,uf)},async load(s,t){var i,n,r;const e=H.get().getFontFaceSet();if(e){const o=[],a=((i=t.data)==null?void 0:i.family)??mf(s),l=((r=(n=t.data)==null?void 0:n.weights)==null?void 0:r.filter(h=>df.includes(h)))??["normal"],c=t.data??{};for(let h=0;h<l.length;h++){const d=l[h],f=new FontFace(a,`url(${yf(s)})`,{...c,weight:d});await f.load(),e.add(f),o.push(f)}return Y.has(`${a}-and-url`)?Y.get(`${a}-and-url`).entries.push({url:s,faces:o}):Y.set(`${a}-and-url`,{entries:[{url:s,faces:o}]}),o.length===1?o[0]:o}return V("[loadWebFont] FontFace API is not supported. Skipping loading font"),null},unload(s){const t=Array.isArray(s)?s:[s],e=t[0].family,i=Y.get(`${e}-and-url`),n=i.entries.find(r=>r.faces.some(o=>t.indexOf(o)!==-1));n.faces=n.faces.filter(r=>t.indexOf(r)===-1),n.faces.length===0&&(i.entries=i.entries.filter(r=>r!==n)),t.forEach(r=>{H.get().getFontFaceSet().delete(r)}),i.entries.length===0&&Y.remove(`${e}-and-url`)}};function Kn(s,t=1){var i;const e=(i=Ke.RETINA_PREFIX)==null?void 0:i.exec(s);return e?parseFloat(e[1]):t}function Zn(s,t,e){s.label=e,s._sourceOrigin=e;const i=new O({source:s,label:e}),n=()=>{delete t.promiseCache[e],Y.has(e)&&Y.remove(e)};return i.source.once("destroy",()=>{t.promiseCache[e]&&(V("[Assets] A TextureSource managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the TextureSource."),n())}),i.once("destroy",()=>{s.destroyed||(V("[Assets] A Texture managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the Texture."),n())}),i}const bf=".svg",_f="image/svg+xml",wf={extension:{type:E.LoadParser,priority:ae.Low,name:"loadSVG"},name:"loadSVG",id:"svg",config:{crossOrigin:"anonymous",parseAsGraphicsContext:!1},test(s){return Ze(s,_f)||Qe(s,bf)},async load(s,t,e){var i;return((i=t.data)==null?void 0:i.parseAsGraphicsContext)??this.config.parseAsGraphicsContext?Sf(s):vf(s,t,e,this.config.crossOrigin)},unload(s){s.destroy(!0)}};async function vf(s,t,e,i){var p,g,x;const n=await H.get().fetch(s),r=H.get().createImage();r.src=`data:image/svg+xml;charset=utf-8,${encodeURIComponent(await n.text())}`,r.crossOrigin=i,await r.decode();const o=((p=t.data)==null?void 0:p.width)??r.width,a=((g=t.data)==null?void 0:g.height)??r.height,l=((x=t.data)==null?void 0:x.resolution)||Kn(s),c=Math.ceil(o*l),h=Math.ceil(a*l),d=H.get().createCanvas(c,h),f=d.getContext("2d");f.imageSmoothingEnabled=!0,f.imageSmoothingQuality="high",f.drawImage(r,0,0,o*l,a*l);const{parseAsGraphicsContext:u,...m}=t.data??{},y=new ve({resource:d,alphaMode:"premultiply-alpha-on-upload",resolution:l,...m});return Zn(y,e,s)}async function Sf(s){const e=await(await H.get().fetch(s)).text(),i=new _t;return i.svg(e),i}const Af=`(function () {
    'use strict';

    const WHITE_PNG = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII=";
    async function checkImageBitmap() {
      try {
        if (typeof createImageBitmap !== "function")
          return false;
        const response = await fetch(WHITE_PNG);
        const imageBlob = await response.blob();
        const imageBitmap = await createImageBitmap(imageBlob);
        return imageBitmap.width === 1 && imageBitmap.height === 1;
      } catch (_e) {
        return false;
      }
    }
    void checkImageBitmap().then((result) => {
      self.postMessage(result);
    });

})();
`;let ze=null,zn=class{constructor(){ze||(ze=URL.createObjectURL(new Blob([Af],{type:"application/javascript"}))),this.worker=new Worker(ze)}};zn.revokeObjectURL=function(){ze&&(URL.revokeObjectURL(ze),ze=null)};const kf=`(function () {
    'use strict';

    async function loadImageBitmap(url, alphaMode) {
      const response = await fetch(url);
      if (!response.ok) {
        throw new Error(\`[WorkerManager.loadImageBitmap] Failed to fetch \${url}: \${response.status} \${response.statusText}\`);
      }
      const imageBlob = await response.blob();
      return alphaMode === "premultiplied-alpha" ? createImageBitmap(imageBlob, { premultiplyAlpha: "none" }) : createImageBitmap(imageBlob);
    }
    self.onmessage = async (event) => {
      try {
        const imageBitmap = await loadImageBitmap(event.data.data[0], event.data.data[1]);
        self.postMessage({
          data: imageBitmap,
          uuid: event.data.uuid,
          id: event.data.id
        }, [imageBitmap]);
      } catch (e) {
        self.postMessage({
          error: e,
          uuid: event.data.uuid,
          id: event.data.id
        });
      }
    };

})();
`;let Ge=null;class hl{constructor(){Ge||(Ge=URL.createObjectURL(new Blob([kf],{type:"application/javascript"}))),this.worker=new Worker(Ge)}}hl.revokeObjectURL=function(){Ge&&(URL.revokeObjectURL(Ge),Ge=null)};let So=0,un;class Cf{constructor(){this._initialized=!1,this._createdWorkers=0,this._workerPool=[],this._queue=[],this._resolveHash={}}isImageBitmapSupported(){return this._isImageBitmapSupported!==void 0?this._isImageBitmapSupported:(this._isImageBitmapSupported=new Promise(t=>{const{worker:e}=new zn;e.addEventListener("message",i=>{e.terminate(),zn.revokeObjectURL(),t(i.data)})}),this._isImageBitmapSupported)}loadImageBitmap(t,e){var i;return this._run("loadImageBitmap",[t,(i=e==null?void 0:e.data)==null?void 0:i.alphaMode])}async _initWorkers(){this._initialized||(this._initialized=!0)}_getWorker(){un===void 0&&(un=navigator.hardwareConcurrency||4);let t=this._workerPool.pop();return!t&&this._createdWorkers<un&&(this._createdWorkers++,t=new hl().worker,t.addEventListener("message",e=>{this._complete(e.data),this._returnWorker(e.target),this._next()})),t}_returnWorker(t){this._workerPool.push(t)}_complete(t){t.error!==void 0?this._resolveHash[t.uuid].reject(t.error):this._resolveHash[t.uuid].resolve(t.data),this._resolveHash[t.uuid]=null}async _run(t,e){await this._initWorkers();const i=new Promise((n,r)=>{this._queue.push({id:t,arguments:e,resolve:n,reject:r})});return this._next(),i}_next(){if(!this._queue.length)return;const t=this._getWorker();if(!t)return;const e=this._queue.pop(),i=e.id;this._resolveHash[So]={resolve:e.resolve,reject:e.reject},t.postMessage({data:e.arguments,uuid:So++,id:i})}reset(){this._workerPool.forEach(t=>t.terminate()),this._workerPool.length=0,Object.values(this._resolveHash).forEach(({reject:t})=>{t==null||t(new Error("WorkerManager destroyed"))}),this._resolveHash={},this._queue.length=0,this._initialized=!1,this._createdWorkers=0}}const Ao=new Cf,Mf=[".jpeg",".jpg",".png",".webp",".avif"],Tf=["image/jpeg","image/png","image/webp","image/avif"];async function Pf(s,t){var n;const e=await H.get().fetch(s);if(!e.ok)throw new Error(`[loadImageBitmap] Failed to fetch ${s}: ${e.status} ${e.statusText}`);const i=await e.blob();return((n=t==null?void 0:t.data)==null?void 0:n.alphaMode)==="premultiplied-alpha"?createImageBitmap(i,{premultiplyAlpha:"none"}):createImageBitmap(i)}const dl={name:"loadTextures",id:"texture",extension:{type:E.LoadParser,priority:ae.High,name:"loadTextures"},config:{preferWorkers:!0,preferCreateImageBitmap:!0,crossOrigin:"anonymous"},test(s){return Ze(s,Tf)||Qe(s,Mf)},async load(s,t,e){var r;let i=null;globalThis.createImageBitmap&&this.config.preferCreateImageBitmap?this.config.preferWorkers&&await Ao.isImageBitmapSupported()?i=await Ao.loadImageBitmap(s,t):i=await Pf(s,t):i=await new Promise((o,a)=>{i=H.get().createImage(),i.crossOrigin=this.config.crossOrigin,i.src=s,i.complete?o(i):(i.onload=()=>{o(i)},i.onerror=a)});const n=new ve({resource:i,alphaMode:"premultiply-alpha-on-upload",resolution:((r=t.data)==null?void 0:r.resolution)||Kn(s),...t.data});return Zn(n,e,s)},unload(s){s.destroy(!0)}},Ef=[".mp4",".m4v",".webm",".ogg",".ogv",".h264",".avi",".mov"];let fn,pn;function If(s,t,e){e===void 0&&!t.startsWith("data:")?s.crossOrigin=Bf(t):e!==!1&&(s.crossOrigin=typeof e=="string"?e:"anonymous")}function Lf(s){return new Promise((t,e)=>{s.addEventListener("canplaythrough",i),s.addEventListener("error",n),s.load();function i(){r(),t()}function n(o){r(),e(o)}function r(){s.removeEventListener("canplaythrough",i),s.removeEventListener("error",n)}})}function Bf(s,t=globalThis.location){if(s.startsWith("data:"))return"";t||(t=globalThis.location);const e=new URL(s,document.baseURI);return e.hostname!==t.hostname||e.port!==t.port||e.protocol!==t.protocol?"anonymous":""}function Rf(){const s=[],t=[];for(const e of Ef){const i=Ss.MIME_TYPES[e.substring(1)]||`video/${e.substring(1)}`;Bi(i)&&(s.push(e),t.includes(i)||t.push(i))}return{validVideoExtensions:s,validVideoMime:t}}const Ff={name:"loadVideo",id:"video",extension:{type:E.LoadParser,name:"loadVideo"},test(s){if(!fn||!pn){const{validVideoExtensions:i,validVideoMime:n}=Rf();fn=i,pn=n}const t=Ze(s,pn),e=Qe(s,fn);return t||e},async load(s,t,e){var l,c;const i={...Ss.defaultOptions,resolution:((l=t.data)==null?void 0:l.resolution)||Kn(s),alphaMode:((c=t.data)==null?void 0:c.alphaMode)||await ga(),...t.data},n=document.createElement("video"),r={preload:i.autoLoad!==!1?"auto":void 0,"webkit-playsinline":i.playsinline!==!1?"":void 0,playsinline:i.playsinline!==!1?"":void 0,muted:i.muted===!0?"":void 0,loop:i.loop===!0?"":void 0,autoplay:i.autoPlay!==!1?"":void 0};Object.keys(r).forEach(h=>{const d=r[h];d!==void 0&&n.setAttribute(h,d)}),i.muted===!0&&(n.muted=!0),If(n,s,i.crossorigin);const o=document.createElement("source");let a;if(i.mime)a=i.mime;else if(s.startsWith("data:"))a=s.slice(5,s.indexOf(";"));else if(!s.startsWith("blob:")){const h=s.split("?")[0].slice(s.lastIndexOf(".")+1).toLowerCase();a=Ss.MIME_TYPES[h]||`video/${h}`}return o.src=s,a&&(o.type=a),new Promise(h=>{const d=async()=>{const f=new Ss({...i,resource:n});n.removeEventListener("canplay",d),t.data.preload&&await Lf(n),h(Zn(f,e,s))};i.preload&&!i.autoPlay&&n.load(),n.addEventListener("canplay",d),n.appendChild(o)})},unload(s){s.destroy(!0)}},ul={extension:{type:E.ResolveParser,name:"resolveTexture"},test:dl.test,parse:s=>{var t;return{resolution:parseFloat(((t=Ke.RETINA_PREFIX.exec(s))==null?void 0:t[1])??"1"),format:s.split(".").pop(),src:s}}},zf={extension:{type:E.ResolveParser,priority:-2,name:"resolveJson"},test:s=>Ke.RETINA_PREFIX.test(s)&&s.endsWith(".json"),parse:ul.parse};class Gf{constructor(){this._detections=[],this._initialized=!1,this.resolver=new Ke,this.loader=new nf,this.cache=Y,this._backgroundLoader=new Xu(this.loader),this._backgroundLoader.active=!0,this.reset()}async init(t={}){var r,o;if(this._initialized){V("[Assets]AssetManager already initialized, did you load before calling this Assets.init()?");return}if(this._initialized=!0,t.defaultSearchParams&&this.resolver.setDefaultSearchParams(t.defaultSearchParams),t.basePath&&(this.resolver.basePath=t.basePath),t.bundleIdentifier&&this.resolver.setBundleIdentifier(t.bundleIdentifier),t.manifest){let a=t.manifest;typeof a=="string"&&(a=await this.load(a)),this.resolver.addManifest(a)}const e=((r=t.texturePreference)==null?void 0:r.resolution)??1,i=typeof e=="number"?[e]:e,n=await this._detectFormats({preferredFormats:(o=t.texturePreference)==null?void 0:o.format,skipDetections:t.skipDetections,detections:this._detections});this.resolver.prefer({params:{format:n,resolution:i}}),t.preferences&&this.setPreferences(t.preferences)}add(t){this.resolver.add(t)}async load(t,e){this._initialized||await this.init();const i=_i(t),n=Pt(t).map(a=>{if(typeof a!="string"){const l=this.resolver.getAlias(a);return l.some(c=>!this.resolver.hasKey(c))&&this.add(a),Array.isArray(l)?l[0]:l}return this.resolver.hasKey(a)||this.add({alias:a,src:a}),a}),r=this.resolver.resolve(n),o=await this._mapLoadToResolve(r,e);return i?o[n[0]]:o}addBundle(t,e){this.resolver.addBundle(t,e)}async loadBundle(t,e){this._initialized||await this.init();let i=!1;typeof t=="string"&&(i=!0,t=[t]);const n=this.resolver.resolveBundle(t),r={},o=Object.keys(n);let a=0,l=0;const c=()=>{e==null||e(++a/l)},h=o.map(d=>{const f=n[d],u=Object.values(f),m=[...new Set(u.flat())];return l+=m.length,this._mapLoadToResolve(f,c).then(y=>{r[d]=y})});return await Promise.all(h),i?r[t[0]]:r}async backgroundLoad(t){this._initialized||await this.init(),typeof t=="string"&&(t=[t]);const e=this.resolver.resolve(t);this._backgroundLoader.add(Object.values(e))}async backgroundLoadBundle(t){this._initialized||await this.init(),typeof t=="string"&&(t=[t]);const e=this.resolver.resolveBundle(t);Object.values(e).forEach(i=>{this._backgroundLoader.add(Object.values(i))})}reset(){this.resolver.reset(),this.loader.reset(),this.cache.reset(),this._initialized=!1}get(t){if(typeof t=="string")return Y.get(t);const e={};for(let i=0;i<t.length;i++)e[i]=Y.get(t[i]);return e}async _mapLoadToResolve(t,e){const i=[...new Set(Object.values(t))];this._backgroundLoader.active=!1;const n=await this.loader.load(i,e);this._backgroundLoader.active=!0;const r={};return i.forEach(o=>{const a=n[o.src],l=[o.src];o.alias&&l.push(...o.alias),l.forEach(c=>{r[c]=a}),Y.set(l,a)}),r}async unload(t){this._initialized||await this.init();const e=Pt(t).map(n=>typeof n!="string"?n.src:n),i=this.resolver.resolve(e);await this._unloadFromResolved(i)}async unloadBundle(t){this._initialized||await this.init(),t=Pt(t);const e=this.resolver.resolveBundle(t),i=Object.keys(e).map(n=>this._unloadFromResolved(e[n]));await Promise.all(i)}async _unloadFromResolved(t){const e=Object.values(t);e.forEach(i=>{Y.remove(i.src)}),await this.loader.unload(e)}async _detectFormats(t){let e=[];t.preferredFormats&&(e=Array.isArray(t.preferredFormats)?t.preferredFormats:[t.preferredFormats]);for(const i of t.detections)t.skipDetections||await i.test()?e=await i.add(e):t.skipDetections||(e=await i.remove(e));return e=e.filter((i,n)=>e.indexOf(i)===n),e}get detections(){return this._detections}setPreferences(t){this.loader.parsers.forEach(e=>{e.config&&Object.keys(e.config).filter(i=>i in t).forEach(i=>{e.config[i]=t[i]})})}}const Fe=new Gf;st.handleByList(E.LoadParser,Fe.loader.parsers).handleByList(E.ResolveParser,Fe.resolver.parsers).handleByList(E.CacheParser,Fe.cache.parsers).handleByList(E.DetectionParser,Fe.detections);st.add(qu,Zu,Ku,sf,Ju,tf,ef,af,hf,xf,wf,dl,Ff,ju,Vu,ul,zf);const ko={loader:E.LoadParser,resolver:E.ResolveParser,cache:E.CacheParser,detection:E.DetectionParser};st.handle(E.Asset,s=>{const t=s.ref;Object.entries(ko).filter(([e])=>!!t[e]).forEach(([e,i])=>st.add(Object.assign(t[e],{extension:t[e].extension??i})))},s=>{const t=s.ref;Object.keys(ko).filter(e=>!!t[e]).forEach(e=>st.remove(t[e]))});class ke extends Wn{constructor(t){t instanceof _t&&(t={context:t});const{context:e,roundPixels:i,...n}=t||{};super({label:"Graphics",...n}),this.renderPipeId="graphics",e?this._context=e:this._context=this._ownedContext=new _t,this._context.on("update",this.onViewUpdate,this),this.didViewUpdate=!0,this.allowChildren=!1,this.roundPixels=i??!1}set context(t){t!==this._context&&(this._context.off("update",this.onViewUpdate,this),this._context=t,this._context.on("update",this.onViewUpdate,this),this.onViewUpdate())}get context(){return this._context}get bounds(){return this._context.bounds}updateBounds(){}containsPoint(t){return this._context.containsPoint(t)}destroy(t){this._ownedContext&&!t?this._ownedContext.destroy(t):(t===!0||(t==null?void 0:t.context)===!0)&&this._context.destroy(t),this._ownedContext=null,this._context=null,super.destroy(t)}_callContextMethod(t,e){return this.context[t](...e),this}setFillStyle(...t){return this._callContextMethod("setFillStyle",t)}setStrokeStyle(...t){return this._callContextMethod("setStrokeStyle",t)}fill(...t){return this._callContextMethod("fill",t)}stroke(...t){return this._callContextMethod("stroke",t)}texture(...t){return this._callContextMethod("texture",t)}beginPath(){return this._callContextMethod("beginPath",[])}cut(){return this._callContextMethod("cut",[])}arc(...t){return this._callContextMethod("arc",t)}arcTo(...t){return this._callContextMethod("arcTo",t)}arcToSvg(...t){return this._callContextMethod("arcToSvg",t)}bezierCurveTo(...t){return this._callContextMethod("bezierCurveTo",t)}closePath(){return this._callContextMethod("closePath",[])}ellipse(...t){return this._callContextMethod("ellipse",t)}circle(...t){return this._callContextMethod("circle",t)}path(...t){return this._callContextMethod("path",t)}lineTo(...t){return this._callContextMethod("lineTo",t)}moveTo(...t){return this._callContextMethod("moveTo",t)}quadraticCurveTo(...t){return this._callContextMethod("quadraticCurveTo",t)}rect(...t){return this._callContextMethod("rect",t)}roundRect(...t){return this._callContextMethod("roundRect",t)}poly(...t){return this._callContextMethod("poly",t)}regularPoly(...t){return this._callContextMethod("regularPoly",t)}roundPoly(...t){return this._callContextMethod("roundPoly",t)}roundShape(...t){return this._callContextMethod("roundShape",t)}filletRect(...t){return this._callContextMethod("filletRect",t)}chamferRect(...t){return this._callContextMethod("chamferRect",t)}star(...t){return this._callContextMethod("star",t)}svg(...t){return this._callContextMethod("svg",t)}restore(...t){return this._callContextMethod("restore",t)}save(){return this._callContextMethod("save",[])}getTransform(){return this.context.getTransform()}resetTransform(){return this._callContextMethod("resetTransform",[])}rotateTransform(...t){return this._callContextMethod("rotate",t)}scaleTransform(...t){return this._callContextMethod("scale",t)}setTransform(...t){return this._callContextMethod("setTransform",t)}transform(...t){return this._callContextMethod("transform",t)}translateTransform(...t){return this._callContextMethod("translate",t)}clear(){return this._callContextMethod("clear",[])}get fillStyle(){return this._context.fillStyle}set fillStyle(t){this._context.fillStyle=t}get strokeStyle(){return this._context.strokeStyle}set strokeStyle(t){this._context.strokeStyle=t}clone(t=!1){return t?new ke(this._context.clone()):(this._ownedContext=null,new ke(this._context))}lineStyle(t,e,i){z(N,"Graphics#lineStyle is no longer needed. Use Graphics#setStrokeStyle to set the stroke style.");const n={};return t&&(n.width=t),e&&(n.color=e),i&&(n.alpha=i),this.context.strokeStyle=n,this}beginFill(t,e){z(N,"Graphics#beginFill is no longer needed. Use Graphics#fill to fill the shape with the desired style.");const i={};return t!==void 0&&(i.color=t),e!==void 0&&(i.alpha=e),this.context.fillStyle=i,this}endFill(){z(N,"Graphics#endFill is no longer needed. Use Graphics#fill to fill the shape with the desired style."),this.context.fill();const t=this.context.strokeStyle;return(t.width!==_t.defaultStrokeStyle.width||t.color!==_t.defaultStrokeStyle.color||t.alpha!==_t.defaultStrokeStyle.alpha)&&this.context.stroke(),this}drawCircle(...t){return z(N,"Graphics#drawCircle has been renamed to Graphics#circle"),this._callContextMethod("circle",t)}drawEllipse(...t){return z(N,"Graphics#drawEllipse has been renamed to Graphics#ellipse"),this._callContextMethod("ellipse",t)}drawPolygon(...t){return z(N,"Graphics#drawPolygon has been renamed to Graphics#poly"),this._callContextMethod("poly",t)}drawRect(...t){return z(N,"Graphics#drawRect has been renamed to Graphics#rect"),this._callContextMethod("rect",t)}drawRoundedRect(...t){return z(N,"Graphics#drawRoundedRect has been renamed to Graphics#roundRect"),this._callContextMethod("roundRect",t)}drawStar(...t){return z(N,"Graphics#drawStar has been renamed to Graphics#star"),this._callContextMethod("star",t)}}class Of extends Wn{constructor(t,e){const{text:i,resolution:n,style:r,anchor:o,width:a,height:l,roundPixels:c,...h}=t;super({...h}),this.batched=!0,this._resolution=null,this._autoResolution=!0,this._didTextUpdate=!0,this._styleClass=e,this.text=i??"",this.style=r,this.resolution=n??null,this.allowChildren=!1,this._anchor=new tt({_onUpdate:()=>{this.onViewUpdate()}}),o&&(this.anchor=o),this.roundPixels=c??!1,a!==void 0&&(this.width=a),l!==void 0&&(this.height=l)}get anchor(){return this._anchor}set anchor(t){typeof t=="number"?this._anchor.set(t):this._anchor.copyFrom(t)}set text(t){t=t.toString(),this._text!==t&&(this._text=t,this.onViewUpdate())}get text(){return this._text}set resolution(t){this._autoResolution=t===null,this._resolution=t,this.onViewUpdate()}get resolution(){return this._resolution}get style(){return this._style}set style(t){var e;t||(t={}),(e=this._style)==null||e.off("update",this.onViewUpdate,this),t instanceof this._styleClass?this._style=t:this._style=new this._styleClass(t),this._style.on("update",this.onViewUpdate,this),this.onViewUpdate()}get width(){return Math.abs(this.scale.x)*this.bounds.width}set width(t){this._setWidth(t,this.bounds.width)}get height(){return Math.abs(this.scale.y)*this.bounds.height}set height(t){this._setHeight(t,this.bounds.height)}getSize(t){return t||(t={}),t.width=Math.abs(this.scale.x)*this.bounds.width,t.height=Math.abs(this.scale.y)*this.bounds.height,t}setSize(t,e){typeof t=="object"?(e=t.height??t.width,t=t.width):e??(e=t),t!==void 0&&this._setWidth(t,this.bounds.width),e!==void 0&&this._setHeight(e,this.bounds.height)}containsPoint(t){const e=this.bounds.width,i=this.bounds.height,n=-e*this.anchor.x;let r=0;return t.x>=n&&t.x<=n+e&&(r=-i*this.anchor.y,t.y>=r&&t.y<=r+i)}onViewUpdate(){this.didViewUpdate||(this._didTextUpdate=!0),super.onViewUpdate()}destroy(t=!1){super.destroy(t),this.owner=null,this._bounds=null,this._anchor=null,(typeof t=="boolean"?t:t!=null&&t.style)&&this._style.destroy(t),this._style=null,this._text=null}get styleKey(){return`${this._text}:${this._style.styleKey}:${this._resolution}`}}function Df(s,t){let e=s[0]??{};return(typeof e=="string"||s[1])&&(z(N,`use new ${t}({ text: "hi!", style }) instead`),e={text:e,style:s[1]}),e}let me=null,Yt=null;function $f(s,t){me||(me=H.get().createCanvas(256,128),Yt=me.getContext("2d",{willReadFrequently:!0}),Yt.globalCompositeOperation="copy",Yt.globalAlpha=1),(me.width<s||me.height<t)&&(me.width=$e(s),me.height=$e(t))}function Co(s,t,e){for(let i=0,n=4*e*t;i<t;++i,n+=4)if(s[n+3]!==0)return!1;return!0}function Mo(s,t,e,i,n){const r=4*t;for(let o=i,a=i*r+4*e;o<=n;++o,a+=r)if(s[a+3]!==0)return!1;return!0}function Wf(...s){let t=s[0];t.canvas||(t={canvas:s[0],resolution:s[1]});const{canvas:e}=t,i=Math.min(t.resolution??1,1),n=t.width??e.width,r=t.height??e.height;let o=t.output;if($f(n,r),!Yt)throw new TypeError("Failed to get canvas 2D context");Yt.drawImage(e,0,0,n,r,0,0,n*i,r*i);const l=Yt.getImageData(0,0,n,r).data;let c=0,h=0,d=n-1,f=r-1;for(;h<r&&Co(l,n,h);)++h;if(h===r)return j.EMPTY;for(;Co(l,n,f);)--f;for(;Mo(l,n,c,h,f);)++c;for(;Mo(l,n,d,h,f);)--d;return++d,++f,Yt.globalCompositeOperation="source-over",Yt.strokeRect(c,h,d-c,f-h),Yt.globalCompositeOperation="copy",o??(o=new j),o.set(c/i,h/i,(d-c)/i,(f-h)/i),o}const To=new j;class Nf{getCanvasAndContext(t){const{text:e,style:i,resolution:n=1}=t,r=i._getFinalPadding(),o=$t.measureText(e||" ",i),a=Math.ceil(Math.ceil(Math.max(1,o.width)+r*2)*n),l=Math.ceil(Math.ceil(Math.max(1,o.height)+r*2)*n),c=zs.getOptimalCanvasAndContext(a,l);this._renderTextToCanvas(e,i,r,n,c);const h=i.trim?Wf({canvas:c.canvas,width:a,height:l,resolution:1,output:To}):To.set(0,0,a,l);return{canvasAndContext:c,frame:h}}returnCanvasAndContext(t){zs.returnCanvasAndContext(t)}_renderTextToCanvas(t,e,i,n,r){var b,_,S,v;const{canvas:o,context:a}=r,l=wi(e),c=$t.measureText(t||" ",e),h=c.lines,d=c.lineHeight,f=c.lineWidths,u=c.maxLineWidth,m=c.fontProperties,y=o.height;if(a.resetTransform(),a.scale(n,n),a.textBaseline=e.textBaseline,(b=e._stroke)!=null&&b.width){const w=e._stroke;a.lineWidth=w.width,a.miterLimit=w.miterLimit,a.lineJoin=w.join,a.lineCap=w.cap}a.font=l;let p,g;const x=e.dropShadow?2:1;for(let w=0;w<x;++w){const C=e.dropShadow&&w===0,M=C?Math.ceil(Math.max(1,y)+i*2):0,k=M*n;if(C){a.fillStyle="black",a.strokeStyle="black";const L=e.dropShadow,D=L.color,Mt=L.alpha;a.shadowColor=Q.shared.setValue(D).setAlpha(Mt).toRgbaString();const T=L.blur*n,I=L.distance*n;a.shadowBlur=T,a.shadowOffsetX=Math.cos(L.angle)*I,a.shadowOffsetY=Math.sin(L.angle)*I+k}else{if(a.fillStyle=e._fill?Ai(e._fill,a,c,i*2):null,(_=e._stroke)!=null&&_.width){const L=e._stroke.width*.5+i*2;a.strokeStyle=Ai(e._stroke,a,c,L)}a.shadowColor="black"}let A=(d-m.fontSize)/2;d-m.fontSize<0&&(A=0);const F=((S=e._stroke)==null?void 0:S.width)??0;for(let L=0;L<h.length;L++)p=F/2,g=F/2+L*d+m.ascent+A,e.align==="right"?p+=u-f[L]:e.align==="center"&&(p+=(u-f[L])/2),(v=e._stroke)!=null&&v.width&&this._drawLetterSpacing(h[L],e,r,p+i,g+i-M,!0),e._fill!==void 0&&this._drawLetterSpacing(h[L],e,r,p+i,g+i-M)}}_drawLetterSpacing(t,e,i,n,r,o=!1){const{context:a}=i,l=e.letterSpacing;let c=!1;if($t.experimentalLetterSpacingSupported&&($t.experimentalLetterSpacing?(a.letterSpacing=`${l}px`,a.textLetterSpacing=`${l}px`,c=!0):(a.letterSpacing="0px",a.textLetterSpacing="0px")),l===0||c){o?a.strokeText(t,n,r):a.fillText(t,n,r);return}let h=n;const d=$t.graphemeSegmenter(t);let f=a.measureText(t).width,u=0;for(let m=0;m<d.length;++m){const y=d[m];o?a.strokeText(y,h,r):a.fillText(y,h,r);let p="";for(let g=m+1;g<d.length;++g)p+=d[g];u=a.measureText(p).width,h+=f-u+l,f=u}}}const Po=new Nf;class fl extends Of{constructor(...t){const e=Df(t,"Text");super(e,Ae),this.renderPipeId="text",e.textureStyle&&(this.textureStyle=e.textureStyle instanceof We?e.textureStyle:new We(e.textureStyle))}updateBounds(){const t=this._bounds,e=this._anchor;let i=0,n=0;if(this._style.trim){const{frame:r,canvasAndContext:o}=Po.getCanvasAndContext({text:this.text,style:this._style,resolution:1});Po.returnCanvasAndContext(o),i=r.width,n=r.height}else{const r=$t.measureText(this._text,this._style);i=r.width,n=r.height}t.minX=-e._x*i,t.maxX=t.minX+i,t.minY=-e._y*n,t.maxY=t.minY+n}}st.add(Yl,Vl);const Uf=[{day:1,forcedDice:4,targetLevel:5,reward:{kind:"minigame",minigame:"lootbox",forceLootboxAmount:50,forceLootboxKind:"bonus",notes:"Fixed starter 50p bonus to demonstrate bonus currency."},autoTriggerCategory:!0,overrideZone:"carnival",designerNotes:"Introduce movement + UI.",popups:{start_day:["<p>Welcome to tombola trails! I’m BIG STEVE, your guide to this world!</p>","<p>Before I forget, here is your daily dice, you can roll this every day to move through the world and earn rewards, why not give it a try?</p>"],post_move:["<p>You moved onto your first tile!</p>","<p>Looks like you collected some tokens, every step you take will give you a token, once you get X, you can play a bonus game!</p>","<p>You’ve landed on a minigame, lets see what it is!</p>"],pre_minigame:["<p>Ah, a mystery box, why not tap and see whats inside?</p>"],post_minigame:["<p>That’s a cool prize. It looks like you also found a key! You can collect keys every consecutive day you play and when you have 30 you can open the treasure vault. I’ve heard there are some great riches to be had. Be warned however, that skipping a day will cause all keys to be destroyed!</p>","<p>You also found a prize star! You can collect a single prize star each day, and when you have 5 you will win a prize. Don’t worry about losing these, they won’t reset even if you miss a day!</p>","<p>That’s everything for today. But before you go, if you want a sneak peek of what’s coming up you can look further ahead by scrolling.</p>"]}},{day:2,forcedDice:6,targetLevel:11,reward:{kind:"freePlays",amount:2,notes:"Two Free Plays to showcase multi-award."},overrideZone:"carnival",designerNotes:"Highlight progress & level nodes.",popups:{start_day:"<p>Welcome back {PLAYER_NAME} it’s great to see you! Ready to see what prizes await today?</p>",post_move:"<p>Looks like you’ve landed on an instant win space, let’s see what your prize is shall we?</p>",post_instantwin:["<p>Way to go! Another prize and another star, it won’t be long until you have 5! Remember that 5 stars grants a prize!</p>","<p>Since you’re down by the water, why not try one of our water themed games? Oh, and don’t forget to continue the adventure tomorrow!</p>"]}},{day:3,forcedDice:3,targetLevel:14,reward:{kind:"bonus",notes:"Introduce bonus round concept."},overrideZone:"carnival",forceLandingCategory:"bonus_round",designerNotes:"Introduce concept of prizes.",popups:{start_day:"<p>Hey again partner! You don’t mind me calling you that right? See that box on the path? That’s a bonus game, wouldn’t it be cool if we landed on it?</p>",post_move:"<p>You did it! Time for a bonus round! In this game it’s just you vs the banker!</p>",post_bonus_round:["<p>Whew, that was fun! Bonus games are great ways to receive bigger wins! Don’t forget your key and prize star too</p>","<p>This isn’t the only place you can play Deal or No Deal. If you enjoyed that, why not check out our other Deal or No Deal games</p>"]}},{day:4,forcedDice:1,targetLevel:15,reward:{kind:"minigame",minigame:"slot",forceSlotSymbol:"⭐",notes:"Force open slot after landing (tutorial explanation). Guaranteed win via forced symbols."},overrideZone:"carnival",forceLandingCategory:"mystery",designerNotes:"Teach minigame basics.",popups:{start_day:["<p>Welcome back, let’s get to rolling shall we?</p>","<p>Is that, a mystery space ahead?</p>"],post_move:"<p>This is a mystery square, you won’t know what it is until you land on it! Let’s hope we get lucky! We'll see you tomorrow no matter the reward I hope!</p>"}},{day:5,forcedDice:4,targetLevel:19,reward:{kind:"tokens",amount:15,notes:"Bump token amount; show resource utility soon."},overrideZone:"carnival",designerNotes:"Escalating token reward.",popups:{start_day:"<p>It’s your 5th day, you know what that means? Collecting a prize star today will give you a reward!</p>",post_instantwin:["<p>It’s your 5th prize star!</p>","<p>Wow, way to go! Remember, you receive prize star prizes every 5th day, so why not start collecting stars again tomorrow?</p>"]}},{day:6,forcedDice:3,targetLevel:22,reward:{kind:"minigame",minigame:"spin_wheel",notes:"Demonstrate spin wheel fairness/visuals."},overrideZone:"carnival",designerNotes:"Spin Wheel intro.",popups:{start_day:"<p>Hey! Hope you're ready to win some prizes!</p>",post_roll:"<p>You’ve landed on a movement space! Looks like the journey doesn’t stop here!</p>",post_move:"<p>Looks like a mini game!</p>",post_minigame:"<p>Thats a lot of tokens today, just a few more and you will be able to redeem them for a bonus game!</p>"}},{day:7,forcedDice:5,targetLevel:27,reward:{kind:"tokens",amount:20,notes:"Escalation before finale; sets up for loot box preview."},overrideZone:"carnival",designerNotes:"Pre-finale build-up.",popups:{start_day:"<p>Hi again! We’re still so close to having enough tokens for a bonus game!</p>",post_move:"<p>Let’s hope we get a good token prize! Only X to go!</p>",post_minigame:"<p>You’ve done it! Looks like it’s time for a bonus game!</p>"}},{day:8,forcedDice:3,targetLevel:30,reward:{kind:"minigame",minigame:"lootbox",forceLootboxKind:"cash",forceLootboxAmount:100,notes:"Showcase guaranteed cash reel outcome before transition."},overrideZone:"carnival",transitionAfter:!0,designerNotes:"Finale + transition.",popups:{start_day:"<p>Welcome back! Yesterday was exciting and I have a feeling today will be too!</p>",post_minigame:"<p>You’ve reached the end of the zone! Looks like a new adventure awaits</p>"}}];function bt(s){return s>=1&&s<=8}function At(s){return Uf.find(t=>t.day===s)}const Hf="/game.trail.prototype/assets/jungle_background-BdApZqyu.png",Yf="/game.trail.prototype/assets/carnival_background-BsFaZ7L7.png",Vf="/game.trail.prototype/assets/token-C4c7ykNK.svg",Qn="/game.trail.prototype/assets/carnival_character-2KSKpjoa.png",Ri="/game.trail.prototype/",jf=`${Ri}general/BM.png`,Xf=`${Ri}general/FP.png`,qf=`${Ri}general/key.png`,Eo=`${Ri}general/star.png`;let at=30;const pl="trailProgressV2",ml="tokensV1",Kf=8;let Ye=140,Ce=260,Ut=38;const Zf=15;let Gn="Jungle";const It=["slot","spin_wheel","lootbox"],Qf="minigameAssignmentsV1",gl="currenciesV1",yl="categoryAssignmentsV1",xl="dayStateV1",bl="levelStateV1",_l="dualChoiceMilestoneConsumedV1",wl="prizeStarMilestoneCycleV1";let B={day:1,rollUsed:!1};function Jf(){try{const s=localStorage.getItem(xl);if(!s)return;const t=JSON.parse(s);typeof t.day=="number"&&t.day>=1&&typeof t.rollUsed=="boolean"&&(B.day=Math.floor(t.day),B.rollUsed=t.rollUsed)}catch{}}function Jn(){localStorage.setItem(xl,JSON.stringify(B))}let Me={level:1};function tp(){try{const s=localStorage.getItem(bl);if(s){const t=JSON.parse(s);typeof t.level=="number"&&t.level>=1&&(Me.level=Math.floor(t.level))}}catch{}}function vl(){localStorage.setItem(bl,JSON.stringify(Me))}let Wt=[];function ep(){try{const s=localStorage.getItem(yl);if(!s)return!1;const t=JSON.parse(s);if(Array.isArray(t)){Wt=t.filter(i=>typeof i.level=="number"&&i.level>=1&&i.level<=at&&typeof i.category=="string"),Wt.forEach(i=>{i.tileId||(i.tileId=`tile_${i.level}`)});let e=!1;return Wt.forEach(i=>{(i.category==="extra_move"||i.category==="travel_back")&&(i.resolvedAs=void 0,i.category="mystery",e=!0)}),e&&pt(),Wt.length!==0}}catch{}return!1}function pt(){localStorage.setItem(yl,JSON.stringify(Wt))}function Io(s){for(let t=s.length-1;t>0;t--){const e=Math.floor(Math.random()*(t+1));[s[t],s[e]]=[s[e],s[t]]}return s}function tr(){const s=Array.from({length:at},(a,l)=>l+1),t=Io(s.slice(1)).slice(0,It.length),e=new Set(t),i=t.map((a,l)=>({level:a,category:"minigame",minigame:It[l],completed:!1,tileId:`tile_${a}`})),n=["instant_tokens","instant_prize","reveal","bonus_round","mystery"],r=Io(s.slice(1).filter(a=>!e.has(a)));n.forEach((a,l)=>{if(r[l]!==void 0){const c=r[l];i.push({level:c,category:a,tileId:`tile_${c}`}),e.add(c)}}),i.push({level:1,category:"instant_tokens",completed:!1,tileId:"tile_1"}),e.add(1);const o=["instant_tokens","instant_prize","reveal","mystery","minigame"];s.forEach(a=>{if(!e.has(a)){const l=o[Math.floor(Math.random()*o.length)];if(l==="minigame"){const c=It.filter(h=>!i.some(d=>d.minigame===h));c.length?i.push({level:a,category:"minigame",minigame:c[0],completed:!1,tileId:`tile_${a}`}):i.push({level:a,category:"instant_tokens",completed:!1,tileId:`tile_${a}`})}else i.push({level:a,category:l,tileId:`tile_${a}`})}}),Wt=i.sort((a,l)=>a.level-l.level),pt()}function sp(){ep()||tr()}function se(s){return Wt.find(t=>t.level===s)}function ip(s){return Wt.find(t=>t.tileId===s)}window.forceTileReward=function(s,t){const e=ip(s);if(!e){console.warn("Tile not found for id",s);return}e.category!=="instant_prize"&&console.warn("Tile is not an instant_prize category; current:",e.category),e.forcedReward=t,pt(),console.log("Forced reward set on",s,t)};let On=null;window.overrideLandingCategoryOnce=function(s){On=s,console.log("Next landing category will be forced to",s)};const ht=[{kind:"freePlays",amount:1,label:"1 Free Play"},{kind:"freePlays",amount:5,label:"5 Free Plays"},{kind:"cash",amount:10,label:"10p Cash"},{kind:"cash",amount:100,label:"£1 Cash"},{kind:"bonus",amount:50,label:"50p Bonus Money"},{kind:"bonus",amount:100,label:"£1 Bonus Money"},{kind:"bonus",amount:500,label:"£5 Bonus Money"},{kind:"tokens",amount:10,label:"10 Tokens"},{kind:"tokens",amount:50,label:"50 Tokens"},{kind:"tokens",amount:100,label:"100 Tokens"},{kind:"nothing",label:"Nothing"}];let Ws=0,Ns=0,Us=0,Te=0,kt=0;function np(){try{const s=localStorage.getItem(gl);if(!s)return;const t=JSON.parse(s);typeof t.freePlays=="number"&&(Ws=t.freePlays),typeof t.cashPence=="number"&&(Ns=t.cashPence),typeof t.bonusPence=="number"&&(Us=t.bonusPence),typeof t.streakKeys=="number"&&(Te=t.streakKeys),typeof t.prizeStars=="number"&&(kt=t.prizeStars)}catch{}}function Qt(){localStorage.setItem(gl,JSON.stringify({freePlays:Ws,cashPence:Ns,bonusPence:Us,streakKeys:Te,prizeStars:kt}))}function Oe(s){s>0&&(Ws+=s,Qt(),Ct())}function er(s){s>0&&(Ns+=s,Qt(),Ct())}function sr(s){s>0&&(Us+=s,Qt(),Ct())}function Ee(s){s>0&&(Te+=s,Qt(),Ct())}function le(s){if(s>0){kt+=s,Qt(),Ct();try{gt&&typeof gt=="function"&&gt()&&kt>=5&&(document.querySelector(".modal-backdrop")||typeof Bt<"u"&&!Bt&&Di())}catch{}}}let Je=[];function ts(){localStorage.setItem(Qf,JSON.stringify(Je))}function Sl(){const s=Array.from({length:at-1},(e,i)=>i+2);for(let e=s.length-1;e>0;e--){const i=Math.floor(Math.random()*(e+1));[s[e],s[i]]=[s[i],s[e]]}Je=s.slice(0,It.length).map((e,i)=>({level:e,game:It[i],completed:!1})),ts()}function rp(s){return Je.find(t=>t.level===s)}function Ve(s){return s<100?s+"p":"£"+(s/100).toFixed(s%100===0?0:2)}function op(){if(bt(B.day)){const s=ht.filter(t=>t.kind!=="nothing");return s[Math.floor(Math.random()*s.length)]}return ht[Math.floor(Math.random()*ht.length)]}function es(s){s.kind==="tokens"&&s.amount?is(s.amount):s.kind==="freePlays"&&s.amount?Oe(s.amount):s.kind==="cash"&&s.amount?er(s.amount):s.kind==="bonus"&&s.amount?sr(s.amount):s.kind==="streakKeys"&&s.amount?Ee(s.amount):s.kind==="prizeStars"&&s.amount&&le(s.amount),Ct()}function ss(){return`<p class='meta-bonus-line' style="margin-top:10px;font-size:13px;opacity:.85;"><strong>+1 🔑 Streak Key</strong> & <strong>+1 ⭐ Prize Star</strong></p>`}const ie=[],Kt=[];function ap(){try{const s=localStorage.getItem(pl);if(!s)return{current:1};const t=JSON.parse(s);return typeof t.current!="number"||t.current<1||t.current>at?{current:1}:t}catch{return{current:1}}}function Hs(s){localStorage.setItem(pl,JSON.stringify(s))}const R=ap();let Gs=!1;const mn=[{x:-200},{x:-180},{x:-130},{x:-80},{x:-70},{x:-100},{x:-180},{x:-180},{x:-130},{x:-70},{x:-60},{x:-95},{x:-150},{x:-190},{x:-160},{x:-110},{x:-80},{x:-120},{x:-170},{x:-155},{x:-115},{x:-85},{x:-95},{x:-140},{x:-185},{x:-175},{x:-145},{x:-110},{x:-90},{x:-130}],lp=140;function ir(){return lp}function Fi(s){const t=ir(),e=400,i=[],n=t*(s-1)+Ye+Ce;for(let r=0;r<s;r++){const o=mn[r]||mn[mn.length-1],a=Ce+r*t+(o.yOffset||0),l=n-a,c=e+o.x;i.push({x:c,y:l})}return i}let Et=800,ot=900;function Al(){Et=Math.min(600,window.innerWidth-8),Et=Math.max(360,Et),ot=Math.min(window.innerHeight-12,1100),ot=Math.max(640,ot);const t=(Et-360)/240;Ut=30+8*Xs(t,0,1),ot<760?(Ye=120,Ce=230):(Ye=140,Ce=260)}Al();let et=0;function cp(){try{const s=localStorage.getItem(ml);if(!s)return 0;const t=Number(s);return Number.isFinite(t)&&t>=0?Math.floor(t):0}catch{return 0}}function Ys(){localStorage.setItem(ml,String(et))}let Os=!1,Xt=!1,Ms=null;function kl(){Xt||et<120||gt()&&Nt||document.querySelector(".modal-backdrop")||(et>=120&&(et-=120,Ys(),rs()),Xt=!0,Os=!1,gt()&&!Nt&&(Nt=!0,nr()),$i(),hp())}function Cl(){Ms===null&&(Ms=window.setInterval(()=>{try{kl()}catch{}},800))}function hp(){Ms!==null&&(clearInterval(Ms),Ms=null)}function gt(){return B.day>8}function dp(){return localStorage.getItem(_l)==="1"}function nr(){localStorage.setItem(_l,"1")}function up(){const s=localStorage.getItem(wl);if(!s)return 0;const t=parseInt(s,10);return isNaN(t)?0:t}function fp(s){localStorage.setItem(wl,String(s))}let Nt=dp(),Lo=up();function is(s){if(s>0){const t=et;if(et+=s,Ys(),rs(),!Xt){const e=t<120&&et>=120,i=t>=120&&et>=120&&!Nt&&!gt();(e||i)&&Cl()}}}et=cp();let Z=Fi(at),ns=Math.max(1600,Math.max(...Z.map(s=>s.y))+400);const ne=new $a,Zt=new lt,ki=new lt,Ci=new lt;Zt.addChild(ki,Ci);const ut=new lt,je=new lt,Vs=new lt,Ml=new lt;ut.addChild(je,Vs,Ml);ne.stage.addChild(Zt);ne.stage.addChild(ut);async function pp(){np(),Jf(),tp(),sp(),await ne.init({backgroundAlpha:0,antialias:!0,width:Et,height:ot,autoDensity:!0});const s=document.getElementById("pixi-root");if(!s)throw new Error("Missing pixi-root");s.appendChild(ne.canvas),Lp(s),window.addEventListener("resize",Bp),Rp(),await rr(),zi(),Gi(),mp(),Ap(),Sp(),vp(s),Wp(),it(),et>=120&&!Xt&&(!gt()||gt()&&!Nt)&&Cl();try{et>=120&&!Xt&&(!gt()||gt()&&!Nt)&&(et>=120&&(et-=120,Ys(),rs()),Xt=!0,Os=!1,gt()&&!Nt&&(Nt=!0,nr()),$i())}catch{}ce(R.current,!0)}function zi(){const s=new ke;s.lineStyle(34,3097174,1),s.moveTo(Z[0].x,Z[0].y);for(let t=1;t<Z.length;t++){const e=Z[t],i=Z[t-1],n=(i.x+e.x)/2+Math.sin(t*.7)*40,r=(i.y+e.y)/2+Math.cos(t*.45)*60;s.quadraticCurveTo(n,r,e.x,e.y)}s.alpha=.9,je.addChild(s);for(let t=0;t<Z.length-1;t++){const e=new ke;Kt.push({from:t+1,to:t+2,line:e}),je.addChild(e)}Kt.forEach(t=>Tl(t.line,t.from,t.to))}let gn=null,yn=null;async function rr(){if(ki.removeChildren(),Ci.removeChildren(),!gn)try{gn=await Fe.load(Hf)}catch(n){console.warn("Failed to load jungle",n)}if(!yn)try{yn=await Fe.load(Yf)}catch(n){console.warn("Failed to load carnival",n)}const s=100,t=1.28,e=Et+s;function i(n,r,o){if(!n)return;const a=e/n.width,l=Math.round(n.height*a*t);if(l<=0)return;o(l);const c=ns+ot+l;for(let h=0;h<c;h+=l){const d=new Ue(n);d.x=-50,d.y=h,d.width=e,d.height=l,d.alpha=1,r.addChild(d)}}i(gn,ki,n=>n),i(yn,Ci,n=>n),js()}function Tl(s,t,e){s.clear();const i=Z[t-1],n=Z[e-1],r=Xe(t),o=Xe(e);let a=3688017;r==="completed"&&(a=5025616),r==="current"&&(a=16752451),r==="completed"&&(o==="current"||o==="unlocked"||o==="completed")&&(a=5025616),s.lineStyle(8,a,1),s.moveTo(i.x,i.y),s.lineTo(n.x,n.y),s.alpha=r==="locked"?.35:.95}function Pl(){const s=(Ut-30)/8,t=Math.round(16+4*Xs(s,0,1));return new Ae({fill:"#ffffff",fontSize:t,fontWeight:"600",stroke:"#000000"})}let El=Pl();function Xe(s){return s<R.current?"completed":s===R.current?"current":s===R.current+1?"unlocked":"locked"}function Gi(){Z.forEach((s,t)=>{const e=t+1,i=new lt;i.x=s.x,i.y=s.y,i.eventMode="static",i.cursor="pointer";const n=new ke,r=se(e);r?Ll(n,r):Il(n,Xe(e));const o=new fl({text:String(e),style:El});o.anchor.set(.5),o.y=2,i.addChild(n,o),i.hitArea=new Ii(0,0,Ut),i.on("pointertap",()=>xp(e)),i.on("pointerover",()=>i.scale.set(1.08)),i.on("pointerout",()=>i.scale.set(1)),Vs.addChild(i),ie.push({level:e,container:i,circle:n,label:o})})}let De=null;function mp(){const s=new lt;s.eventMode="none";const t=new ke;t.beginFill(16752451),t.drawCircle(0,0,26),t.endFill();const e=new fl({text:"YOU",style:new Ae({fill:"#fff",fontSize:16,fontWeight:"700",stroke:"#000"})});e.anchor.set(.5),s.addChild(t,e),Ml.addChild(s),De=s,re(R.current,!0)}function re(s,t=!1,e=600){const i=Z[s-1];if(!De)return;const n=Ut+26+12,r=i.x+n,o=i.y+2;if(t){De.position.set(r,o);return}Rl(De,{x:r,y:o},e,Fl)}function gp(s){var t;return((t=Z[s-1])==null?void 0:t.y)??0}function yp(){return gp(Zf)}const Bo=400;function js(){const s=-ut.position.y+ot/2,t=yp(),e=s-t,i=Xs((e+Bo)/(Bo*2),0,1);ki.alpha=1-i,Ci.alpha=i,bt(B.day)?Gn="Carnival":Gn=i<.5?"Jungle":"Carnival"}function Il(s,t){s.clear();let e=4015180;t==="current"?e=16752451:t==="unlocked"?e=5923952:t==="completed"&&(e=4608605),s.lineStyle(4,1581096,1),s.beginFill(e),s.drawCircle(0,0,Ut),s.endFill()}function Ll(s,t){s.clear();const e=Xe(t.level);let i=4015180;t.completed?i=5025616:e==="current"?i=16752451:e==="unlocked"?i=5923952:e==="completed"&&(i=4608605),s.lineStyle(4,1581096,1),s.beginFill(i);const n=Ut;switch(t.category==="mystery"&&t.resolvedAs?t.resolvedAs:t.category){case"instant_tokens":s.drawCircle(0,0,n);break;case"instant_prize":s.drawRoundedRect(-n,-n,n*2,n*2,10);break;case"reveal":for(let o=0;o<6;o++){const a=Math.PI/3*o-Math.PI/6,l=Math.cos(a)*n,c=Math.sin(a)*n;o===0?s.moveTo(l,c):s.lineTo(l,c)}s.closePath();break;case"minigame":s.moveTo(0,-n),s.lineTo(n,0),s.lineTo(0,n),s.lineTo(-n,0),s.closePath();break;case"bonus_round":for(let o=0;o<10;o++){const a=Math.PI/5*o-Math.PI/2,l=o%2===0?n:n*.45,c=Math.cos(a)*l,h=Math.sin(a)*l;o===0?s.moveTo(c,h):s.lineTo(c,h)}s.closePath();break;case"mystery":for(let o=0;o<5;o++){const a=Math.PI*2/5*o-Math.PI/2,l=Math.cos(a)*n,c=Math.sin(a)*n;o===0?s.moveTo(l,c):s.lineTo(l,c)}s.closePath();break;case"extra_move":s.moveTo(0,-n),s.lineTo(n,n),s.lineTo(-n,n),s.closePath();break;case"travel_back":s.moveTo(-n,-n),s.lineTo(n,-n),s.lineTo(0,n),s.closePath();break}s.endFill()}function it(){ie.forEach(s=>{const t=Xe(s.level),e=se(s.level);e?Ll(s.circle,e):Il(s.circle,t);const i=t==="current"||t==="completed"||t==="unlocked";s.container.eventMode=i?"static":"none",s.container.alpha=t==="locked"?.3:1}),Kt.forEach(s=>Tl(s.line,s.from,s.to)),ar()}function xp(s){const t=Xe(s);t!=="current"&&t!=="completed"||or(s,!0)}function or(s,t,e=0){const i=se(s);if(!i){Tp(s);return}if(i.completed)return;if(i.category==="mystery"&&!i.resolvedAs){const r=["instant_tokens","instant_prize","reveal","minigame","bonus_round","extra_move","travel_back"];i.resolvedAs=r[Math.floor(Math.random()*r.length)],pt(),it()}const n=i.category==="mystery"&&i.resolvedAs?i.resolvedAs:i.category;if(n==="minigame"){(!i.minigame||!It.includes(i.minigame))&&(i.minigame=It[Math.floor(Math.random()*It.length)],pt());let r=rp(i.level);r||(r={level:i.level,game:i.minigame,completed:!!i.completed},Je.push(r),ts()),r.completed?os("Minigame","Already completed."):cr(r);return}switch(n){case"instant_tokens":qp(i);break;case"instant_prize":Zp(i);break;case"reveal":Jp(i);break;case"bonus_round":Qp(i);break;case"extra_move":Wo(i,!0);break;case"travel_back":Wo(i,!1);break;default:e<2&&or(s,t,e+1);break}}function bp(s){s===R.current&&R.current<at&&(R.current+=1,Hs(R),is(1),it(),re(R.current),ce(R.current),setTimeout(()=>{Ts()},650))}function Bl(s){if(s<=0)return;const t=Math.min(s,at-R.current);if(t<=0)return;Gs=!0;const e=At(B.day);let i=t;if(e&&e.targetLevel>0){const a=e.targetLevel-R.current;a<i&&(i=Math.max(0,a))}const n=[];for(let a=0;a<i;a++)n.push(R.current+1+a);const r=520;function o(){n.length&&(R.current+=1,Hs(R),is(1),it(),re(R.current,!1,r-50),ce(R.current),n.length>1?(n.shift(),setTimeout(o,r)):(n.shift(),setTimeout(()=>{const a=At(B.day),l=On||a&&a.forceLandingCategory;if(l){const d=se(R.current);d&&d.category!==l&&(d.category=l,d.category!=="minigame"&&delete d.minigame,d.completed=!1,pt(),it()),On=null}lm();const c=ft("post_move"),h=se(R.current);if(c&&h){const d=h.category==="mystery"&&h.resolvedAs?h.resolvedAs:h.category;["bonus_round","instant_tokens","instant_prize","reveal"].includes(d)&&bt(B.day)?(Ds.add("post_move"),Ps||(Ps=()=>{Ts()})):Ts()}else Ts();setTimeout(()=>{Gs=!1,ee()},200)},r+120)))}o()}function _p(s){if(s<=0)return;const t=R.current-1,e=Math.min(s,t);if(e<=0)return;Gs=!0;const i=[];for(let o=0;o<e;o++)i.push(R.current-1-o);const n=420;function r(){i.length&&(R.current-=1,Hs(R),it(),re(R.current,!1,n-60),ce(R.current),i.length>1?(i.shift(),setTimeout(r,n)):(i.shift(),setTimeout(()=>{Ts()},n+120),setTimeout(()=>{Gs=!1,ee()},n+260)))}r()}function Ts(){const s=R.current,t=se(s);t&&(t.completed||Es||(W(),or(s,!1)))}const wp=.47;function ce(s,t=!1){const e=Z[s-1],i=ir(),n=Ce*.55;let o=n+i*.3+Ut;const a=7,l=s===1?Ut*1.2:0,c=ot-l-Ye-a*i,h=n+Ut+8;o=Math.min(o,Math.max(h,c));const d=ot-o,f=-(e.y-(d-l)),u=-(ns-ot),m=Xs(f,u,0),p=-(Z.reduce((x,b)=>x+b.x,0)/Z.length-Et*wp),g=()=>{Zt.y=ut.position.y,Zt.x=0,js()};if(t){ut.position.set(p,m),g();return}Rl(ut,{x:p,y:m},600,Fl,g)}let pi=!1,Ro=0,Fo=0;function zo(s){const t=-(ns-ot);return Xs(s,t,0)}function Go(s){ut.position.y=s,Zt.y=ut.position.y,js()}function vp(s){s.addEventListener("wheel",e=>{e.preventDefault();const n=zo(ut.position.y-e.deltaY*1);Go(n)},{passive:!1}),s.addEventListener("pointerdown",e=>{e.target.closest(".modal,.controls,.nav-fab")||(pi=!0,Ro=e.clientY,Fo=ut.position.y,e.target.setPointerCapture(e.pointerId))}),s.addEventListener("pointermove",e=>{if(!pi)return;const i=e.clientY-Ro,n=zo(Fo+i);Go(n)});const t=e=>{if(pi){pi=!1;try{e.target.releasePointerCapture(e.pointerId)}catch{}}};s.addEventListener("pointerup",t),s.addEventListener("pointerleave",t)}function Sp(){var t;if(!document.querySelector(".nav-fab")){const e=document.createElement("button");e.className="nav-fab",e.type="button",e.title="Recenter on current level",e.ariaLabel="Recenter on current level",e.innerHTML="⤓",e.addEventListener("click",()=>ce(R.current)),(t=document.getElementById("app"))==null||t.appendChild(e)}}function Rl(s,t,e,i,n){const r=s.x,o=s.y,a=t.x??s.x,l=t.y??s.y,c=performance.now();function h(d){const f=Math.min(1,(d-c)/e),u=i(f);s.x=r+(a-r)*u,s.y=o+(l-o)*u,n&&n(),f<1&&requestAnimationFrame(h)}requestAnimationFrame(h)}function Fl(s){return s<.5?4*s*s*s:1-Math.pow(-2*s+2,3)/2}function Xs(s,t,e){return Math.max(t,Math.min(e,s))}function Ap(){var t;let s=document.querySelector(".controls");if(!s){if(s=document.createElement("div"),s.className="controls",s.innerHTML=`
      <div class="currency-bar vertical" aria-label="Currencies">
        <div class="currency-meta" aria-label="Meta Progress">
          <div class="currency day-counter pill" title="Current Day"><span class="label">Day</span><span class="day-count">1</span></div>
          <div class="currency level-counter pill" title="Player Level"><span class="label">Lvl</span><span class="level-count">1</span></div>
          <div class="prize-star-progress" title="Prize Star Progress" aria-label="Prize Star Progress">
            <div class="ps-progress-bar"><div class="ps-progress-fill"></div></div>
            <div class="ps-progress-label"><span class="ps-progress-count">0</span>/5 <img src="${Eo}" alt="Prize Star" class="currency-icon star-icon" /></div>
          </div>
        </div>
        <div class="currency-group-card" aria-label="Reward Currencies">
          <div class="currency bonus-counter pill" title="Bonus Money"><img src="${jf}" alt="Bonus Money" class="currency-icon bonus-icon" /><span class="bonus-count">0</span></div>
          <div class="currency fp-counter pill" title="Free Plays"><img src="${Xf}" alt="Free Plays" class="currency-icon fp-icon" /><span class="fp-count">0</span></div>
          <div class="currency sk-counter pill" title="Streak Keys"><img src="${qf}" alt="Streak Key" class="currency-icon key-icon" /><span class="sk-count">0</span></div>
          <div class="currency ps-counter pill" title="Prize Stars"><img src="${Eo}" alt="Prize Star" class="currency-icon star-icon" /><span class="ps-count">0</span></div>
          <div class="currency token-counter pill"><img src="${Vf}" alt="Token" class="token-icon" /><span class="token-count">0</span></div>
          <div class="currency cash-counter pill" title="Cash Balance"><span class="label">💰</span><span class="cash-count">0</span></div>
        </div>
      </div>
      <div class="control-row" style="display:flex;gap:8px;margin-top:10px;">
        <button type="button" data-action="reset" class="reset" aria-label="Reset progress">Reset</button>
      </div>`,(t=document.getElementById("app"))==null||t.appendChild(s),!document.querySelector(".legend-fab")){const e=document.createElement("button");e.className="legend-fab",e.type="button",e.textContent="?",e.title="Tile Legend",e.ariaLabel="Tile Legend",Object.assign(e.style,{position:"fixed",right:"14px",bottom:"118px",width:"44px",height:"44px",borderRadius:"50%",background:"#182028",color:"#fff",border:"2px solid #ff9f43",fontWeight:"700",cursor:"pointer",zIndex:"250",boxShadow:"0 4px 10px rgba(0,0,0,0.45)"}),e.addEventListener("click",Np),document.body.appendChild(e)}if(!document.getElementById("currency-pills-style")){const e=document.createElement("style");e.id="currency-pills-style",e.textContent=`.currency-bar{display:flex;gap:12px;align-items:flex-start;font-weight:600;font-size:13px;}
        .currency-bar.vertical{align-items:flex-start;flex-direction:row;flex-wrap:wrap;}
        .currency-bar .currency-meta{display:flex;flex-direction:column;gap:6px;padding:10px 12px;background:rgba(32,38,45,0.55);border:1px solid #2a333c;border-radius:18px;backdrop-filter:blur(6px);box-shadow:0 4px 12px rgba(0,0,0,0.35);}
        .currency-bar.vertical .currency-group-card{display:flex;flex-direction:column;gap:6px;padding:10px 12px;background:rgba(20,24,28,0.55);border:1px solid #2a333c;border-radius:18px;backdrop-filter:blur(6px);box-shadow:0 4px 12px rgba(0,0,0,0.4);}
        .currency-bar.vertical .pill{background:rgba(255,255,255,0.06);border:1px solid #333;}
        .currency-bar .pill{display:flex;align-items:center;gap:6px;padding:4px 10px;background:rgba(20,24,28,0.6);border:1px solid #2a333c;border-radius:18px;backdrop-filter:blur(4px);} 
        .currency-bar .pill .label{opacity:0.85;font-size:12px;letter-spacing:.5px;} 
        .currency-bar .cash-counter .label{font-size:15px;line-height:1;} 
    .currency-bar img.token-icon{width:18px;height:18px;display:block;}
    .currency-bar img.currency-icon{width:18px;height:18px;display:block;object-fit:contain;filter:drop-shadow(0 1px 2px rgba(0,0,0,0.6));}
    .currency-bar span{display:inline-block;min-width:14px;text-align:right;}
  .prize-star-progress{position:relative;display:flex;flex-direction:column;padding:6px 8px 8px;background:rgba(15,18,22,0.55);border:1px solid #2a333c;border-radius:14px;min-width:150px;}
  .ps-progress-bar{position:relative;width:100%;height:24px;background:#1f262d;border:1px solid #36424d;border-radius:10px;overflow:hidden;display:flex;align-items:center;}
  .ps-progress-fill{position:absolute;left:0;top:0;height:100%;width:0;background:linear-gradient(90deg,#ffcf9a,#ff9f43);box-shadow:0 0 6px rgba(255,159,67,0.6) inset,0 0 4px rgba(255,159,67,0.55);transition:width .6s cubic-bezier(.4,.8,.2,1),filter .5s;}
  /* Level-up glow flash after jackpot */
  .prize-star-progress.ps-level-up .ps-progress-fill{animation:psLevelUpFlash 1.6s ease forwards;}
  @keyframes psLevelUpFlash{0%{filter:drop-shadow(0 0 0px #ff9f43) brightness(1);}40%{filter:drop-shadow(0 0 10px #ffcd8a) brightness(1.3);}70%{filter:drop-shadow(0 0 5px #ff9f43) brightness(1.1);}100%{filter:drop-shadow(0 0 0px #ff9f43) brightness(1);} }
  .prize-star-progress.ps-level-up{box-shadow:0 0 0 0 rgba(255,159,67,0.0),0 0 0 2px rgba(255,159,67,0.4);animation:psOuterPulse 1.6s ease forwards;}
  @keyframes psOuterPulse{0%{box-shadow:0 0 0 0 rgba(255,159,67,0.0),0 0 0 2px rgba(255,159,67,0.0);}35%{box-shadow:0 0 18px 6px rgba(255,159,67,0.55),0 0 0 2px rgba(255,159,67,0.65);}100%{box-shadow:0 0 0 0 rgba(255,159,67,0.0),0 0 0 2px rgba(255,159,67,0.15);} }
  /* Adjust vertical nudge of label here via translateY */
  .ps-progress-label{pointer-events:none;position:absolute;left:0;top:0;width:100%;height:100%;display:flex;align-items:center;justify-content:center;font-size:13px;font-weight:800;letter-spacing:.6px;color:#fff;text-shadow:0 1px 2px rgba(0,0,0,0.9),0 0 4px rgba(0,0,0,0.55);transform:translateY(-1px);} 
  .prize-star-progress .ps-progress-label .ps-progress-count{margin-right:4px;}
  .prize-star-progress.compact{padding:4px 6px 6px;}
  .ps-progress-complete .ps-progress-label{color:#222;}
  .ps-progress-complete .ps-progress-fill{filter:drop-shadow(0 0 6px #ff9f43) drop-shadow(0 0 12px rgba(255,159,67,.75));animation:psPulse 1.6s ease-in-out infinite alternate;}
  @keyframes psPulse{0%{opacity:1;}100%{opacity:.6;}}
        .controls button.next-day{background:#304050;color:#fff;border:1px solid #456075;padding:8px 14px;font-weight:600;border-radius:10px;cursor:pointer;transition:background .25s,box-shadow .25s;}
        .controls button.next-day:disabled{opacity:.35;cursor:default;box-shadow:none;}
        .controls button.next-day.ready{box-shadow:0 0 0 2px #ff9f43 inset,0 0 10px 2px rgba(255,159,67,0.55);}
        .controls button.reset{background:#402c2c;color:#fff;border:1px solid #664242;padding:8px 14px;font-weight:600;border-radius:10px;cursor:pointer;}
        .dice-bar .dice-btn.daily-used{background:#3a3f44 !important;border:0;color:#888;box-shadow:inset 0 0 0 2px #555;position:relative;}
        .dice-bar .dice-btn.daily-used::after{content:'Daily used';position:absolute;bottom:-18px;left:50%;transform:translateX(-50%);font-size:10px;font-weight:600;color:#bbb;letter-spacing:.5px;}
        @keyframes diceGlow{0%,100%{box-shadow:0 0 0 4px rgba(255,159,67,0.25),0 0 18px 4px rgba(255,159,67,0.55);}50%{box-shadow:0 0 0 2px rgba(255,159,67,0.55),0 0 10px 2px rgba(255,159,67,0.9);}}
        @keyframes diceShake{0%,100%{transform:translateY(-3px) rotateZ(-3deg);}25%{transform:translate(-3px,1px) rotateZ(5deg);}50%{transform:translate(3px,-2px) rotateZ(-6deg);}75%{transform:translate(-2px,2px) rotateZ(4deg);}}
        .dice-cube.can-roll{animation:diceGlow 2.8s ease-in-out infinite;position:relative;}
        .dice-cube.can-roll::after{content:'Roll!';position:absolute;bottom:-20px;left:50%;transform:translateX(-50%);font-size:11px;font-weight:600;color:#ffcf9a;letter-spacing:.5px;text-shadow:0 1px 2px #000;}
        .dice-cube.spinning{animation:diceShake 0.65s linear infinite;}
      `,document.head.appendChild(e)}}Cp(),ar(),rs(),Pe()}function ar(){const s=document.querySelector('[data-action="reset"]');s&&(s.disabled=R.current===1)}function kp(){W(),R.current=1,Hs(R),Wt.forEach(t=>{t.completed=!1,t.category==="mystery"&&delete t.resolvedAs}),pt(),Je.forEach(t=>{t.completed=!1}),ts(),et=0,Ys(),Ws=0,Ns=0,Us=0,Te=0,kt=0,Qt(),Ct(),B.day=1,B.rollUsed=!1,Jn(),Pe(),Me.level=1,vl(),Oi(),document.querySelectorAll(".inline-next-day-btn").forEach(t=>t.remove());const s=document.querySelector(".dice-roll-btn");s&&(s.style.display="",s.disabled=!1,s.classList.remove("daily-used"),s.classList.add("can-roll")),typeof Bt<"u"&&(Bt=!1),qs=!1,at=30,Sl(),tr(),it(),re(R.current,!0),ce(R.current,!0),je.removeChildren(),Vs.removeChildren(),Kt.splice(0,Kt.length),ie.splice(0,ie.length),Z=Fi(at),ns=Math.max(1600,Math.max(...Z.map(t=>t.y))+400),ne.renderer.resize(Et,ot),zi(),Gi(),it(),re(R.current,!0),setTimeout(()=>ft("start_day"),400),ar()}function Cp(){let s=document.querySelector(".reset-fab");return s||(s=document.createElement("button"),s.type="button",s.className="reset-fab",s.innerHTML='<span class="rf-icon" style="font-size:14px;line-height:1;">↺</span><span class="rf-label" style="margin-left:6px;">Reset</span>',s.title="Reset progress",s.ariaLabel="Reset progress",document.body.appendChild(s),s.addEventListener("click",()=>{confirm("Reset your progress?")&&kp()})),s}function rs(){const s=document.querySelector(".token-counter .token-count");s&&(s.textContent=String(et))}function Ct(){rs();const s=document.querySelector(".fp-count");s&&(s.textContent=String(Ws));const t=document.querySelector(".cash-count");t&&(t.textContent=Ve(Ns));const e=document.querySelector(".bonus-count");e&&(e.textContent=Ve(Us));const i=document.querySelector(".sk-count");i&&(i.textContent=String(Te));const n=document.querySelector(".ps-count");n&&(n.textContent=String(kt)),Mp(),Oi()}function Mp(){const s=document.querySelector(".prize-star-progress");if(!s)return;const t=s.querySelector(".ps-progress-fill"),e=s.querySelector(".ps-progress-count");if(e&&(e.textContent=String(Math.min(5,kt))),t){const i=Math.min(1,kt/5);t.style.width=i*100+"%",i>=1?s.classList.add("ps-progress-complete"):s.classList.remove("ps-progress-complete")}}function Pe(){const s=document.querySelector(".day-count");s&&(s.textContent=String(B.day)),Oi();const t=document.querySelector(".dice-roll-btn");t&&(B.rollUsed?(t.classList.add("daily-used"),t.classList.remove("can-roll"),t.disabled=!0):(t.classList.remove("daily-used"),t.classList.add("can-roll"),xi||(t.disabled=!1)))}function Oi(){const s=document.querySelector(".level-count");s&&(s.textContent=String(Me.level))}function Tp(s){var i,n;W();const t=document.createElement("div");t.className="modal-backdrop";const e=document.createElement("div");e.className="modal",e.setAttribute("role","dialog"),e.innerHTML=`
    <h2>Level ${s}</h2>
    <p>Placeholder content for level ${s}. Complete to advance.</p>
    <div class="modal-footer">
      <button class="secondary" type="button" data-action="cancel">Close</button>
      <button class="primary" type="button" data-action="complete">Complete Level</button>
    </div>`,t.addEventListener("click",r=>{r.target===t&&W()}),(i=e.querySelector('[data-action="cancel"]'))==null||i.addEventListener("click",W),(n=e.querySelector('[data-action="complete"]'))==null||n.addEventListener("click",()=>{bp(s),W()}),t.appendChild(e),document.body.appendChild(t),document.body.classList.add("modal-open"),setTimeout(()=>{var r;return(r=e.querySelector('[data-action="complete"]'))==null?void 0:r.focus()},30)}let Mi=!1,xt=!1,we=!1,oe=!1,Ps=null;function W(){var t;(t=document.querySelector(".modal-backdrop"))==null||t.remove(),document.body.classList.remove("modal-open");let s=!1;if(xt?(xt=!1,s=!0,setTimeout(()=>{ft("post_instantwin"),ee()},60)):we?(we=!1,s=!0,setTimeout(()=>{ft("post_bonus_round"),ee()},60)):Mi&&(Mi=!1,s=!0,setTimeout(()=>{ft("post_minigame"),ee()},60)),!s&&Ps){const e=Ps;Ps=null,setTimeout(()=>{e()},40),s=!0}s||setTimeout(()=>{ee(),Pp();try{kl()}catch{}},60),oe&&setTimeout(()=>{Ep(),oe=!1},120),setTimeout(()=>{document.querySelector(".modal-backdrop")||Ol()},40)}function Pp(){kt<5||Bt||document.querySelector(".modal-backdrop")||Ds.size>0||Di()}function Ep(){try{if(!De||!document.getElementById("app"))return;const t=De.getGlobalPosition(),e=ne.canvas.getBoundingClientRect(),i=e.left+t.x,n=e.top+t.y;[{selector:".sk-counter",glyph:"🔑"},{selector:".ps-counter",glyph:"⭐"}].forEach(o=>{const a=document.querySelector(o.selector);if(!a)return;const l=a.getBoundingClientRect(),c=l.left+l.width/2,h=l.top+l.height/2,d=document.createElement("div");d.textContent=o.glyph,Object.assign(d.style,{position:"fixed",left:`${i}px`,top:`${n}px`,zIndex:"9999",fontSize:"20px",filter:"drop-shadow(0 2px 4px rgba(0,0,0,0.6))",transition:"transform 780ms cubic-bezier(.4,.8,.2,1), opacity 780ms ease",pointerEvents:"none",opacity:"1"}),document.body.appendChild(d),requestAnimationFrame(()=>{const f=c-i,u=h-n;d.style.transform=`translate(${f}px,${u}px) scale(0.6)`,d.style.opacity="0"}),setTimeout(()=>{d.remove()},820)})}catch(s){console.warn("Meta trail animation failed",s)}}function lr(){var n;if(xt||!bt(B.day))return;const s=At(B.day);if(!s)return;const t=(n=s.popups)==null?void 0:n.post_instantwin;if(!t)return;(Array.isArray(t)?t:[t]).some(r=>!qe.has(`${s.day}:post_instantwin:${r}`))&&(xt=!0)}function Ip(){var n;if(we||!bt(B.day))return;const s=At(B.day);if(!s)return;const t=(n=s.popups)==null?void 0:n.post_bonus_round;if(!t)return;(Array.isArray(t)?t:[t]).some(r=>!qe.has(`${s.day}:post_bonus_round:${r}`))&&(we=!0)}function Lp(s){let t=s.querySelector(".fade-top");t||(t=document.createElement("div"),t.className="fade-top",s.appendChild(t)),s.style.position="relative",t.style.position="absolute",t.style.top="0",t.style.left="0",t.style.right="auto",t.style.width="calc(100%)",t.style.margin="0 auto",t.style.height="170px",t.style.pointerEvents="none",t.style.zIndex="20",t.style.background="linear-gradient(to bottom, rgba(15,16,20,0.95) 0%, rgba(15,16,20,0.85) 22%, rgba(15,16,20,0.5) 60%, rgba(15,16,20,0) 100%)",t.style.mixBlendMode="normal"}function Bp(){const s=R.current;Al(),El=Pl(),Z=Fi(at),ns=Math.max(1600,Math.max(...Z.map(t=>t.y))+400),ne.renderer.resize(Et,ot),je.removeChildren(),Vs.removeChildren(),Kt.splice(0,Kt.length),ie.splice(0,ie.length),zi(),Gi(),it(),re(s,!0),rr(),ce(s,!0),Zt.y=ut.position.y,Zt.x=0,js(),Ct()}let mi=!1,Dt=null,nt=null;function Rp(){window.addEventListener("keydown",s=>{if(s.key==="0")if(mi=!mi,mi){if(Dt||(Dt=document.createElement("div"),Dt.className="debug-overlay",document.body.appendChild(Dt),Object.assign(Dt.style,{position:"fixed",top:"8px",left:"8px",padding:"8px 10px",background:"rgba(0,0,0,0.55)",color:"#fff",font:"12px/1.3 monospace",zIndex:"9999",maxWidth:"240px",borderRadius:"6px",pointerEvents:"none",whiteSpace:"pre",backdropFilter:"blur(3px)"})),!nt){nt=document.createElement("div"),nt.className="debug-buttons",document.body.appendChild(nt),Object.assign(nt.style,{position:"fixed",bottom:"10px",right:"10px",display:"flex",flexDirection:"column",gap:"6px",zIndex:"10000",padding:"8px",background:"rgba(0,0,0,0.65)",border:"1px solid rgba(255,255,255,0.15)",borderRadius:"8px",font:"12px system-ui, sans-serif",boxShadow:"0 2px 6px rgba(0,0,0,0.4)"});const t=(a,l)=>{const c=document.createElement("button");return c.type="button",c.textContent=a,Object.assign(c.style,{cursor:"pointer",background:"#222",color:"#fff",border:"1px solid #444",padding:"4px 8px",borderRadius:"4px",fontSize:"12px",letterSpacing:"0.5px"}),c.addEventListener("mouseenter",()=>{c.style.background="#333"}),c.addEventListener("mouseleave",()=>{c.style.background="#222"}),c.addEventListener("click",()=>{cr({level:-1,game:l,completed:!1})}),c};nt.appendChild(t("Force Slot","slot")),nt.appendChild(t("Force Spin Wheel","spin_wheel")),nt.appendChild(t("Force Loot Box","lootbox"));const e=document.createElement("button");e.type="button",e.textContent="Force Jackpot",Object.assign(e.style,{cursor:"pointer",background:"#222",color:"#fff",border:"1px solid #444",padding:"4px 8px",borderRadius:"4px",fontSize:"12px",letterSpacing:"0.5px"}),e.addEventListener("mouseenter",()=>{e.style.background="#333"}),e.addEventListener("mouseleave",()=>{e.style.background="#222"}),e.addEventListener("click",()=>{kt=5,Bt=!1,Qt(),Ct(),Di()}),nt.appendChild(e);const i=document.createElement("button");i.type="button",i.textContent="Force Dual Choice",Object.assign(i.style,{cursor:"pointer",background:"#222",color:"#fff",border:"1px solid #444",padding:"4px 8px",borderRadius:"4px",fontSize:"12px",letterSpacing:"0.5px"}),i.addEventListener("mouseenter",()=>{i.style.background="#333"}),i.addEventListener("mouseleave",()=>{i.style.background="#222"}),i.addEventListener("click",()=>{Os=!0,Xt=!1,$i()}),nt.appendChild(i);const n=document.createElement("button");n.type="button",n.textContent="Force Special Scratch",Object.assign(n.style,{cursor:"pointer",background:"#222",color:"#fff",border:"1px solid #444",padding:"4px 8px",borderRadius:"4px",fontSize:"12px",letterSpacing:"0.5px"}),n.addEventListener("mouseenter",()=>{n.style.background="#333"}),n.addEventListener("mouseleave",()=>{n.style.background="#222"}),n.addEventListener("click",()=>{Dl()}),nt.appendChild(n);const r=document.createElement("button");r.type="button",r.textContent="Force Mega Box",Object.assign(r.style,{cursor:"pointer",background:"#222",color:"#fff",border:"1px solid #444",padding:"4px 8px",borderRadius:"4px",fontSize:"12px",letterSpacing:"0.5px"}),r.addEventListener("mouseenter",()=>{r.style.background="#333"}),r.addEventListener("mouseleave",()=>{r.style.background="#222"}),r.addEventListener("click",()=>{$l()}),nt.appendChild(r);const o=t("Close Debug (0)","slot");o.removeEventListener("click",()=>{}),o.addEventListener("click",()=>{window.dispatchEvent(new KeyboardEvent("keydown",{key:"0"}))}),Object.assign(o.style,{background:"#552222"}),nt.appendChild(o)}Oo()}else Dt&&(Dt.remove(),Dt=null,nt&&(nt.remove(),nt=null))}),setInterval(()=>{mi&&Oo()},400)}function Oo(){if(!Dt)return;const s=ir(),t=Kf-1,e=ot-Ye-Ce,i=ut.position.x.toFixed(1),n=ut.position.y.toFixed(1),r=R.current,o=Math.min(at,r+7),a=`${r}-${o}`,l=Je.length,c=Wt.length;Dt.textContent=`VIEW: ${Et}x${ot}
TILE_RADIUS: ${Ut.toFixed(1)}
spacing: ${s.toFixed(1)} (gaps:${t})
usable: ${e.toFixed(1)}
paddings T:${Ye} B:${Ce}
camera: (${i}, ${n})
progress: ${r}/${at} visible:${a}
categories: ${c} minigames: ${l}
day: ${B.day} rollUsed:${B.rollUsed} level:${Me.level}
zone: ${Gn}`}function cr(s){var i;W();const t=document.createElement("div");t.className="modal-backdrop";const e=document.createElement("div");e.className="modal",e.setAttribute("role","dialog"),e.innerHTML=`<h2>${Fp(s.game)}</h2><div class="minigame" data-game="${s.game}"></div><div class="result"></div><div class="modal-footer"><button class="secondary" data-action="close" type="button">Close</button></div>`,t.addEventListener("click",n=>{n.target===t&&W()}),(i=e.querySelector('[data-action="close"]'))==null||i.addEventListener("click",W),t.appendChild(e),document.body.appendChild(t),document.body.classList.add("modal-open"),zp(s,e.querySelector(".minigame"),e.querySelector(".result")),setTimeout(()=>Gp(s,e),140)}function Fp(s){switch(s){case"slot":return"3x1 Slot";case"spin_wheel":return"Spin Wheel";case"lootbox":return"Loot Box";default:return"Minigame"}}function zp(s,t,e){switch(It.includes(s.game)||(s.game=It[Math.floor(Math.random()*It.length)],ts()),s.game){case"slot":return Op(t,s,e);case"spin_wheel":return Dp(t,s,e);case"lootbox":return $p(t,s,e);default:t.innerHTML="<p style='text-align:center;'>Minigame unavailable.</p>"}}function Gp(s,t){var u,m;if(!bt(B.day))return;const e=At(B.day);if(!e||!e.popups||!e.popups.pre_minigame)return;const i=e.popups.pre_minigame,r=(Array.isArray(i)?i:[i]).filter(y=>{const p=`${e.day}:pre_minigame:${y}`;return qe.has(p)?!1:(qe.add(p),!0)});if(!r.length)return;hr();const o=document.createElement("div");Object.assign(o.style,{position:"fixed",left:"0",top:"0",right:"0",bottom:"0",display:"flex",alignItems:"flex-start",justifyContent:"center",background:"rgba(0,0,0,0.45)",zIndex:"650",padding:"0",overflow:"auto"});const a=document.createElement("div");a.className="tutor-stage",a.style.minHeight="unset",a.style.width="100%",a.style.maxWidth="var(--tutor-stage-max)",a.style.marginTop="150px";const l=document.createElement("div");l.className="tutor-portrait-wrap",l.innerHTML=`<img src='${Qn}' alt='Guide' class='tutor-character'/>`;const c=document.createElement("div");c.className="tutor-speech",c.innerHTML="<div class='tutor-speech-arrow'></div><div class='tutor-speech-inner'><h2>Minigame</h2><div class='stacked-copy'></div><div class='tutor-actions stacked-actions' style='display:flex;align-items:center;justify-content:space-between;gap:16px;'><div class='ts-progress' style='font-size:12px;font-weight:600;opacity:.75;letter-spacing:.5px;'></div><div class='nav-btns' style='display:flex;gap:8px;'><button type='button' class='secondary ts-prev' style='display:none;'>Back</button><button type='button' class='primary ts-next'>Next</button></div></div></div>";const h=c.querySelector(".stacked-copy");o.appendChild(a),a.appendChild(c),a.appendChild(l),t.appendChild(o);let d=0;function f(){h.innerHTML=`<div style='font-size:14px;line-height:1.55;'>${r[d]}</div>`;const y=c.querySelector(".ts-progress"),p=c.querySelector(".ts-prev"),g=c.querySelector(".ts-next");y.textContent=`Step ${d+1}/${r.length}`,p.style.display=d>0?"inline-flex":"none",g.textContent=d===r.length-1?"Finish":"Next"}(u=c.querySelector(".ts-prev"))==null||u.addEventListener("click",()=>{d>0&&(d--,f())}),(m=c.querySelector(".ts-next"))==null||m.addEventListener("click",()=>{d<r.length-1?(d++,f()):o.remove()}),f()}function Do(s,t,e){if(s.completed){e.innerHTML="<p><strong>Already completed.</strong></p>";return}let i="";if(t){const r=op();r.kind==="nothing"?i="<p><strong>No reward this time.</strong></p>":(es(r),Ee(1),le(1),Ct(),i=`<p><strong>Reward:</strong> ${r.label}</p>${ss()}`,oe=!0)}else i="<p><strong>Try again tomorrow!</strong></p>";s.completed=!0,ts();const n=se(s.level);n&&!n.completed&&(n.completed=!0,pt()),it(),e.innerHTML=i,qs=!0,Mi=!0}function zl(s,t,e){if(s.completed)return;let i="";t?t.kind==="nothing"?i="<p><strong>No reward this time.</strong></p>":(es(t),Ee(1),le(1),Ct(),i=`<p><strong>Reward:</strong> ${t.label}</p>${ss()}`,oe=!0):i="<p><strong>Try again tomorrow!</strong></p>",s.completed=!0,ts();const n=se(s.level);n&&!n.completed&&(n.completed=!0,pt()),it(),e.innerHTML=i,qs=!0,Mi=!0}function Op(s,t,e){var n;s.innerHTML=`<div class='slot' style='display:flex;gap:8px;justify-content:center;margin-bottom:8px;'>
    <div class='reel' data-r='0' style='width:46px;height:46px;background:#222;border:2px solid #555;display:flex;align-items:center;justify-content:center;font-size:24px;'>?</div>
    <div class='reel' data-r='1' style='width:46px;height:46px;background:#222;border:2px solid #555;display:flex;align-items:center;justify-content:center;font-size:24px;'>?</div>
    <div class='reel' data-r='2' style='width:46px;height:46px;background:#222;border:2px solid #555;display:flex;align-items:center;justify-content:center;font-size:24px;'>?</div>
  </div><button class='primary' data-action='spin'>Spin</button>`;const i=["🍒","⭐","7","🍋"];(n=s.querySelector('[data-action="spin"]'))==null||n.addEventListener("click",()=>{if(t.completed)return;let r=At(B.day),o=null;if(r&&r.reward.kind==="minigame"&&r.reward.minigame==="slot"){const d=r.reward;Array.isArray(d.forceSlotSymbols)&&d.forceSlotSymbols.length===3?o=d.forceSlotSymbols:d.forceSlotSymbol&&(o=[d.forceSlotSymbol,d.forceSlotSymbol,d.forceSlotSymbol])}const a=o?!0:Math.random()<.5,l=Array.from(s.querySelectorAll(".reel"));let c=0;const h=setInterval(()=>{if(l.forEach(d=>d.textContent=i[Math.floor(Math.random()*i.length)]),c++,c>15)if(clearInterval(h),o)l.forEach((d,f)=>d.textContent=o[f]),Do(t,!0,e);else{const d=a?"⭐":i[Math.floor(Math.random()*i.length)];l.forEach(f=>f.textContent=d),Do(t,a,e)}},80)})}function Dp(s,t,e){const i=ht.length,n=260;s.innerHTML=`<div style='position:relative;width:${n}px;height:${n}px;margin:0 auto 12px;'>
    <canvas class='spin-wheel-canvas' width='${n}' height='${n}' style='width:${n}px;height:${n}px;display:block;'></canvas>
    <div class='wheel-pointer' style='position:absolute;left:50%;bottom:-10px;transform:translateX(-50%);width:0;height:0;border-left:16px solid transparent;border-right:16px solid transparent;border-bottom:30px solid #ff9f43;filter:drop-shadow(0 2px 4px rgba(0,0,0,.6));'></div>
  </div>
  <button class='primary' data-action='spinwheel'>Spin</button>`;const o=s.querySelector(".spin-wheel-canvas").getContext("2d");if(!o)return;const a=o,l=n/2,c=n/2-4;let h=At(B.day),d=Math.floor(Math.random()*i);if(bt(B.day)){let g=0;for(;ht[d].kind==="nothing"&&g<25;)d=Math.floor(Math.random()*i),g++}if(h&&h.reward.kind==="minigame"&&h.reward.minigame==="spin_wheel"){const g=h.reward;if(g.forceSpinWheelLabel){const x=ht.findIndex(b=>b.label===g.forceSpinWheelLabel);x>=0&&(d=x)}else if(g.forceSpinWheelKind||g.forceSpinWheelAmount!==void 0){const x=ht.findIndex(b=>(g.forceSpinWheelKind?b.kind===g.forceSpinWheelKind:!0)&&(g.forceSpinWheelAmount!==void 0?b.amount===g.forceSpinWheelAmount:!0));x>=0&&(d=x)}}const f=["#243240","#2f4256","#364d63","#2a3947"];function u(g){a.clearRect(0,0,n,n),a.save(),a.translate(l,l),a.rotate(g);const x=Math.PI*2/i;for(let b=0;b<i;b++){a.beginPath(),a.moveTo(0,0),a.fillStyle=f[b%f.length],a.arc(0,0,c,b*x,(b+1)*x),a.closePath(),a.fill(),a.save(),a.rotate(b*x+x/2),a.translate(c*.62,0),a.rotate(Math.PI/2),a.fillStyle="#fff",a.font="12px system-ui, sans-serif",a.textAlign="center",a.textBaseline="middle";const _=ht[b],S=_.kind==="tokens"?`${_.amount}T`:_.kind==="freePlays"?`${_.amount}FP`:_.kind==="cash"?`${(_.amount||0)/100}£`:_.kind==="bonus"?`${(_.amount||0)/100}B`:_.kind==="streakKeys"?`${_.amount}K`:_.kind==="prizeStars"?`${_.amount}★`:"—",v=_.kind==="tokens"?"🪙":_.kind==="freePlays"?"▶️":_.kind==="cash"?"💷":_.kind==="bonus"?"🎟️":_.kind==="streakKeys"?"🔑":_.kind==="prizeStars"?"⭐":"Ø";m(a,v+`
`+S,0,0,70,12),a.restore()}a.restore()}function m(g,x,b,_,S,v){const w=x.split(" ");let C="";const M=[];for(const A of w){const F=C?C+" "+A:A;g.measureText(F).width>S?(M.push(C),C=A):C=F}C&&M.push(C);const k=-((M.length-1)*v)/2;M.forEach((A,F)=>g.fillText(A,b,_+k+F*v))}u(0);const y=s.querySelector('[data-action="spinwheel"]');let p=!1;y.addEventListener("click",()=>{if(p||t.completed)return;p=!0,y.disabled=!0,y.textContent="Spinning...";const g=Math.PI*2/i,x=6,b=d*g+g/2,_=Math.PI/2-b,S=x*Math.PI*2+_+(Math.random()*g-g/2)*.15,v=3800,w=performance.now();function C(A){return 1-Math.pow(1-A,4)}function M(A){const F=Math.min(1,(A-w)/v),L=C(F),D=S*L;u(D),F<1?requestAnimationFrame(M):k()}requestAnimationFrame(M);function k(){let A=ht[d];if(bt(B.day)&&A.kind==="nothing"){const L=[...ht.slice(d+1),...ht.slice(0,d)].find(D=>D.kind!=="nothing");L&&(A=L)}zl(t,A,e)}})}function $p(s,t,e){const i={common:{color:"#ddd",bg:"#2a2a2a"},uncommon:{color:"#b1f29d",bg:"#244a28"},rare:{color:"#82c7ff",bg:"#14344d"},epic:{color:"#d5a6ff",bg:"#41245b"},mythic:{color:"#ffdf7f",bg:"#5a430f"}},n=ht.map(y=>{let p="common",g=30;return y.kind==="nothing"?(p="common",g=bt(B.day)?0:40):y.kind==="tokens"&&(y.amount||0)>=50?(p="uncommon",g=18):y.kind==="cash"&&(y.amount||0)>=100?(p="rare",g=10):y.kind==="bonus"&&(y.amount||0)>=500?(p="epic",g=4):y.kind==="tokens"&&(y.amount||0)>=100?(p="rare",g=8):y.kind==="freePlays"&&(y.amount||0)>=5?(p="rare",g=7):y.kind==="bonus"&&(y.amount||0)>=100&&(p="uncommon",g=16),{reward:y,weight:g,rarity:p}}),r=n.filter(y=>y.weight>0);function o(){const y=r.length?r:n,p=y.reduce((x,b)=>x+b.weight,0);let g=Math.random()*p;for(const x of y){if(g<x.weight)return x;g-=x.weight}return y[0]}let a=o();const l=At(B.day);if(l&&l.reward.kind==="minigame"&&l.reward.minigame==="lootbox"){const y=l.reward;let p;y.forceLootboxLabel&&(p=ht.find(g=>g.label===y.forceLootboxLabel)),!p&&(y.forceLootboxKind||y.forceLootboxAmount!==void 0)&&(p=ht.find(g=>(y.forceLootboxKind?g.kind===y.forceLootboxKind:!0)&&(y.forceLootboxAmount!==void 0?g.amount===y.forceLootboxAmount:!0))),p&&(a={reward:p,weight:1,rarity:"rare"})}const c=48,h=40,d=[];for(let y=0;y<c;y++)y===h?d.push(a):d.push(o());s.innerHTML=`<div style='display:flex;flex-direction:column;align-items:center;gap:14px;width:100%;'>
    <div class='lootbox-reel-wrapper' style='position:relative;width:320px;height:86px;overflow:hidden;border:3px solid #555;border-radius:14px;background:#111;'>
      <div class='indicator' style='position:absolute;left:50%;top:0;bottom:0;width:2px;background:#ff9f43;box-shadow:0 0 6px #ff9f43;transform:translateX(-50%);pointer-events:none;'></div>
      <div class='lootbox-track' style='display:flex;align-items:center;gap:8px;will-change:transform;padding:8px;'></div>
    </div>
  <button class='primary' data-action='open'>Start</button>
  </div>`;const f=s.querySelector(".lootbox-track");d.forEach(y=>{const p=i[y.rarity],g=document.createElement("div");g.className="lb-item",g.style.cssText=`flex:0 0 96px;height:60px;border:2px solid ${p.color};border-radius:10px;display:flex;flex-direction:column;align-items:center;justify-content:center;font-size:11px;font-weight:600;letter-spacing:.5px;text-align:center;color:${p.color};background:${p.bg};padding:4px;box-shadow:0 0 4px rgba(0,0,0,.6);`,g.innerHTML=`<span style='font-size:12px;'>${y.reward.label.replace(/\s+/g,"<br>")}</span>`,f.appendChild(g)});const u=s.querySelector('[data-action="open"]');let m=!1;u.addEventListener("click",()=>{if(m||t.completed)return;m=!0,u.disabled=!0,u.textContent="Opening...";const y=104,p=h*y-(320/2-y/2),g=4500,x=performance.now();function b(v){return 1-Math.pow(1-v,3)}function _(v){const w=Math.min(1,(v-x)/g),C=b(w),M=p*C;f.style.transform=`translateX(${-M}px)`,w<1?requestAnimationFrame(_):S()}requestAnimationFrame(_);function S(){const v=s.querySelector(".lootbox-reel-wrapper"),w=v.getBoundingClientRect().left+v.clientWidth/2;let C=0,M=1/0,k=null;Array.from(f.children).forEach((L,D)=>{const Mt=L.getBoundingClientRect(),T=Mt.left+Mt.width/2,I=Math.abs(T-w);I<M&&(M=I,C=D,k=L)});const A=k||f.children[h];A.style.outline="3px solid #fff",A.animate([{transform:"scale(1)"},{transform:"scale(1.15)"},{transform:"scale(1)"}],{duration:600,easing:"ease"});const F=d[C].reward;zl(t,F,e)}})}let xi=!1;function Wp(){var t;let s=document.querySelector(".dice-bar");if(!s){s=document.createElement("div"),s.className="dice-bar",s.innerHTML=`
      <div class="dice-wrapper" style="display:flex;align-items:center;justify-content:center;">
        <button type="button" class="dice-cube dice-roll-btn" aria-label="Roll Dice" title="Roll Dice">-</button>
      </div>`,(t=document.getElementById("app"))==null||t.appendChild(s);const e=s.querySelector(".dice-roll-btn"),i=e;if(!document.getElementById("dice-style")){const n=document.createElement("style");n.id="dice-style",n.textContent=`.dice-bar{display:flex;justify-content:center;margin-top:6px;}
        .dice-cube{width:72px;height:72px;background:#222;border:4px solid #ff9f43;border-radius:18px;display:flex;align-items:center;justify-content:center;font-size:26px;font-weight:800;color:#fff;cursor:pointer;box-shadow:0 4px 10px rgba(0,0,0,0.5);transition:transform .18s, background .25s, box-shadow .25s;}
        .dice-cube:hover:not(:disabled){transform:translateY(-3px) rotateZ(-3deg);}
        .dice-cube:disabled{opacity:.55;cursor:default;}
        .dice-cube.daily-used{background:#3a3f44 !important;color:#888;box-shadow:inset 0 0 0 3px #555;}
        .dice-cube.daily-used::after{content:'Daily used';position:absolute;bottom:-20px;left:50%;transform:translateX(-50%);font-size:11px;font-weight:600;color:#bbb;letter-spacing:.5px;}
      `,document.head.appendChild(n)}e.addEventListener("click",()=>{if(xi)return;if(R.current>=at){i.textContent="🏁";return}if(B.rollUsed)return;ft("pre_roll"),xi=!0,e.disabled=!0,e.classList.remove("can-roll"),e.classList.add("spinning");let n=0,r=1+Math.floor(Math.random()*6);const o=At(B.day);o&&o.forcedDice>=1&&o.forcedDice<=6&&(r=o.forcedDice);const a=setInterval(()=>{n++,i.textContent=String(1+Math.floor(Math.random()*6)),n>=10&&(clearInterval(a),i.textContent=String(r),ft("post_roll"),Bl(r),B.rollUsed=!0,Jn(),Pe(),setTimeout(()=>{xi=!1,e.classList.remove("spinning"),Pe()},900))},80)})}}function Np(){var i;W();const s=document.createElement("div");s.className="modal-backdrop";const t=document.createElement("div");t.className="modal",t.setAttribute("role","dialog");const e=[{cat:"instant_tokens",label:"Instant Tokens",desc:"Immediate token bundle."},{cat:"instant_prize",label:"Instant Prize",desc:"Immediate Free Plays / Cash / Bonus."},{cat:"reveal",label:"Reveal",desc:"Open a random reward reveal."},{cat:"minigame",label:"Minigame",desc:"Play for a reward."},{cat:"bonus_round",label:"Bonus Round",desc:"High-value reward chance."},{cat:"mystery",label:"Mystery",desc:"Transforms when landed on."},{cat:"extra_move",label:"Extra Move",desc:"Automatically roll forward again."},{cat:"travel_back",label:"Travel Back",desc:"Move backwards (no reward)."}];t.innerHTML=`<h2>Tile Legend</h2>
  <div class='legend-list' style='display:flex;flex-direction:column;gap:10px;max-height:360px;overflow:auto;'>
    ${e.map(n=>`<div style='display:flex;align-items:center;gap:10px;'>
      <canvas data-shape='${n.cat}' width='52' height='52' style='background:transparent;'></canvas>
      <div><strong>${n.label}</strong><br/><span style='font-size:12px;opacity:.85;'>${n.desc}</span></div>
    </div>`).join("")}
  </div><div class='modal-footer'><button class='primary' data-action='close'>Close</button></div>`,s.addEventListener("click",n=>{n.target===s&&W()}),(i=t.querySelector('[data-action="close"]'))==null||i.addEventListener("click",W),s.appendChild(t),document.body.appendChild(s),document.body.classList.add("modal-open"),setTimeout(()=>{t.querySelectorAll("canvas[data-shape]").forEach(n=>{const r=n.getContext("2d");if(!r)return;const o=20,a=n.dataset.shape;switch(r.lineWidth=3,r.strokeStyle="#182028",r.fillStyle="#5a6470",r.beginPath(),a){case"instant_tokens":Up(r,26,26,o);break;case"instant_prize":Xp(r,6,6,40,40,10);break;case"reveal":$o(r,26,26,o,6,-Math.PI/6);break;case"minigame":Hp(r,26,26,o);break;case"bonus_round":Yp(r,26,26,o,5,.45);break;case"mystery":$o(r,26,26,o,5,-Math.PI/2);break;case"extra_move":Vp(r,26,26,o);break;case"travel_back":jp(r,26,26,o);break}r.fill(),r.stroke()})},30)}function Up(s,t,e,i){s.moveTo(t+i,e),s.arc(t,e,i,0,Math.PI*2)}function $o(s,t,e,i,n,r=0){for(let o=0;o<n;o++){const a=r+Math.PI*2*o/n,l=t+Math.cos(a)*i,c=e+Math.sin(a)*i;o===0?s.moveTo(l,c):s.lineTo(l,c)}s.closePath()}function Hp(s,t,e,i){s.moveTo(t,e-i),s.lineTo(t+i,e),s.lineTo(t,e+i),s.lineTo(t-i,e),s.closePath()}function Yp(s,t,e,i,n,r){for(let o=0;o<n*2;o++){const a=-Math.PI/2+Math.PI*o/n,l=o%2===0?i:i*r,c=t+Math.cos(a)*l,h=e+Math.sin(a)*l;o===0?s.moveTo(c,h):s.lineTo(c,h)}s.closePath()}function Vp(s,t,e,i){s.moveTo(t,e-i),s.lineTo(t+i,e+i),s.lineTo(t-i,e+i),s.closePath()}function jp(s,t,e,i){s.moveTo(t-i,e-i),s.lineTo(t+i,e-i),s.lineTo(t,e+i),s.closePath()}function Xp(s,t,e,i,n,r){const o=Math.min(r,i/2,n/2);s.moveTo(t+o,e),s.lineTo(t+i-o,e),s.quadraticCurveTo(t+i,e,t+i,e+o),s.lineTo(t+i,e+n-o),s.quadraticCurveTo(t+i,e+n,t+i-o,e+n),s.lineTo(t+o,e+n),s.quadraticCurveTo(t,e+n,t,e+n-o),s.lineTo(t,e+o),s.quadraticCurveTo(t,e,t+o,e)}function wt(s,t){return s+Math.floor(Math.random()*(t-s+1))}function os(s,t,e){var o;W();const i=document.createElement("div");i.className="modal-backdrop";const n=document.createElement("div");n.className="modal",n.setAttribute("role","dialog"),bt(B.day)&&(s==="Info"||s==="Tutorial")?(hr(),n.classList.add("tutor-modal"),n.innerHTML=`<div class='tutor-stage'>
        <div class='tutor-portrait-wrap'>
          <img src='${Qn}' alt='Guide' class='tutor-character'/>
        </div>
        <div class='tutor-speech'>
          <div class='tutor-speech-arrow'></div>
          <div class='tutor-speech-inner'>
            <h2>${s}</h2>
            <div class='tutor-text'>${t}</div>
            <div class='tutor-actions'><button class='primary' data-action='close'>Close</button></div>
          </div>
        </div>
      </div>`):n.innerHTML=`<h2>${s}</h2><div class='body'>${t}</div><div class='modal-footer'><button class='primary' data-action='close'>Close</button></div>`,i.addEventListener("click",a=>{}),(o=n.querySelector('[data-action="close"]'))==null||o.addEventListener("click",()=>{W(),e==null||e()}),i.appendChild(n),document.body.appendChild(i),document.body.classList.add("modal-open")}function qp(s){const t=wt(10,50);is(t),Ee(1),le(1),oe=!0,s.completed=!0,pt(),it(),os("Instant Tokens",`<p>You received <strong>${t} Tokens</strong>.</p>${ss()}`,()=>{const e=xt;lr(),(xt||e)&&(xt=!1,ft("post_instantwin"))})}function Gl(){const s=["freePlays","bonus","cash"][wt(0,2)];if(s==="freePlays"){const e=wt(1,3);return{label:`${e} Free Play${e>1?"s":""}`,apply:()=>Oe(e)}}if(s==="bonus"){const e=wt(1,50)*10;return{label:`${Ve(e)} Bonus Money`,apply:()=>sr(e)}}const t=wt(1,10)*100;return{label:`${Ve(t)} Cash`,apply:()=>er(t)}}function Kp(){const s=[()=>{const i=wt(20,100);return is(i),`${i} Tokens`},()=>{const i=wt(1,3);return Oe(i),`${i} Free Play${i>1?"s":""}`},()=>{const i=wt(10,50)*10;return sr(i),`${Ve(i)} Bonus`},()=>{const i=wt(1,10)*100;return er(i),`${Ve(i)} Cash`}],t=s[wt(0,s.length-1)];return{label:t(),apply:()=>{}}}function Zp(s){let t;if(s.forcedReward)es(s.forcedReward),t=s.forcedReward.label;else{const e=Gl();e.apply(),t=e.label}Ee(1),le(1),oe=!0,s.completed=!0,pt(),it(),os("Instant Prize",`<p>You won <strong>${t}</strong>.</p>${ss()}`,()=>{const e=xt;lr(),(xt||e)&&(xt=!1,ft("post_instantwin"))})}function Qp(s){const t=Kp();Ee(1),le(1),oe=!0,s.completed=!0,pt(),it(),os("BONUS ROUND",`<p><strong>${t.label}</strong></p>${ss()}`,()=>{const e=we;Ip(),(we||e)&&(Ds.add("post_bonus_round"),we=!1,ft("post_bonus_round"))})}function Jp(s){W();const t=Gl();t.apply(),Ee(1),le(1),oe=!0,s.completed=!0,pt(),it(),os("Reveal",`<p>You uncovered <strong>${t.label}</strong>.</p>${ss()}`,()=>{const e=xt;lr(),(xt||e)&&(xt=!1,ft("post_instantwin"))})}function Wo(s,t){var l;W();const e=document.createElement("div");e.className="modal-backdrop";const i=document.createElement("div");i.className="modal",i.setAttribute("role","dialog"),i.innerHTML=`<h2>${t?"Extra Move":"Travel Back"}</h2><p>Rolling...</p>
    <div class='move-die' style='font-size:42px;font-weight:700;margin:14px auto;width:84px;height:84px;display:flex;align-items:center;justify-content:center;background:#222;border:3px solid #ff9f43;border-radius:16px;'>-</div>`;const n=i.querySelector(".move-die");let r=0;const o=wt(1,6),a=setInterval(()=>{r++,n.textContent=String(wt(1,6)),r>14&&(clearInterval(a),n.textContent=String(o),s.completed=!0,pt(),it(),setTimeout(()=>{W(),t?Bl(o):_p(o)},650))},80);e.addEventListener("click",c=>{c.target===e&&W()}),(l=i.querySelector(".close-btn"))==null||l.addEventListener("click",W),e.appendChild(i),document.body.appendChild(e)}pp();setTimeout(()=>{ft("start_day")},800);function hr(){if(document.getElementById("tutor-bubble-styles"))return;const s=document.createElement("style");s.id="tutor-bubble-styles",s.textContent=`
  .tutor-modal{background:transparent !important;box-shadow:none !important;padding:0 !important;max-width:none !important;width:100% !important;}
  :root{--tutor-char-width:340px;--tutor-char-width-mobile:230px;--tutor-char-max-vw:60vw;--tutor-stage-top-shift:100px;--tutor-bubble-max:560px;--tutor-stage-max:600px;--tutor-stage-right-extra:50px;}
  /* Centered tutorial layout */
  .tutor-stage{position:relative;display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:100dvh;padding: clamp(16px,4vh,40px) clamp(16px,5vw,48px);gap:32px;width:100%;max-width:var(--tutor-stage-max);margin:0 auto; box-sizing:border-box;}
  .tutor-speech{order:1;position:relative;max-width:var(--tutor-bubble-max);width:100%;margin:0 auto;display:flex;flex-direction:column;}
  .tutor-speech-inner{background:#1c232b;border:2px solid #ff9f43;border-radius:26px;padding:28px 30px 30px;box-shadow:0 14px 34px rgba(0,0,0,0.6);font-size:15px;line-height:1.6;}
  .tutor-speech-inner h2{margin:0 0 12px;font-size:22px;}
  .tutor-text{font-size:15px;}
  .tutor-actions{margin-top:22px;display:flex;justify-content:flex-end;}
  /* Arrow removed when centered */
  .tutor-speech-arrow{display:none;}
  .tutor-speech-arrow:after{display:none;}
  .tutor-portrait-wrap{order:2;display:flex;align-items:flex-end;justify-content:center;margin-top:12px;}
  .tutor-character{width:var(--tutor-char-width);max-width:var(--tutor-char-max-vw);height:auto;filter:drop-shadow(0 10px 18px rgba(0,0,0,.7));transition:transform .45s ease;image-rendering:auto;}
  .tutor-stage:hover .tutor-character{transform:translateY(4px);} 
  /* Responsive adjustments */
  @media (max-width:900px){
    .tutor-stage{padding: clamp(16px,4vh,34px) clamp(16px,5vw,42px);}
    .tutor-character{width:calc(var(--tutor-char-width) - 60px);}
    .tutor-speech-inner{padding:26px 24px 28px;font-size:14px;}
    .tutor-speech-inner h2{font-size:20px;}
  }
  @media (max-width:560px){
    .tutor-stage{padding: clamp(12px,3vh,30px) 16px;}
    .tutor-character{width:var(--tutor-char-width-mobile);}
    .tutor-speech-inner{padding:22px 20px 24px;font-size:13px;}
    .tutor-speech-inner h2{font-size:19px;}
  }
  @media (min-width:1280px){
    .tutor-stage{min-height:100dvh;}
    .tutor-character{width:380px;max-width:50vw;}
  }
  `,document.head.appendChild(s)}function tm(){let s=document.getElementById("day-fader");return s||(s=document.createElement("div"),s.id="day-fader",Object.assign(s.style,{position:"fixed",left:"0",top:"0",right:"0",bottom:"0",background:"#000",opacity:"0",transition:"opacity 420ms ease",zIndex:"9998",pointerEvents:"none"}),document.body.appendChild(s)),s}function em(){const s=tm();s.style.pointerEvents="auto";const t="day-fader-label";let e=document.getElementById(t);e||(e=document.createElement("div"),e.id=t,Object.assign(e.style,{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%,-50%)",color:"#fff",fontSize:"48px",fontWeight:"700",fontFamily:"system-ui, sans-serif",textShadow:"0 4px 12px rgba(0,0,0,0.6)",opacity:"0",transition:"opacity 500ms ease"}),s.appendChild(e)),requestAnimationFrame(()=>{s.style.opacity="1"});const i=B.day;setTimeout(()=>{!B.rollUsed&&Te!==0&&(Te=0,Qt()),ft("end_day"),B.day+=1,B.rollUsed=!1,Jn(),typeof Bt<"u"&&(Bt=!1),i===8&&B.day===9&&sm(),qs=!1;const n=document.querySelector(".dice-roll-btn");n&&(n.style.display=""),document.querySelectorAll(".inline-next-day-btn").forEach(r=>r.remove()),Pe(),e&&(e.textContent=`Day ${B.day}`,e.style.opacity="1"),setTimeout(()=>{e&&(e.style.opacity="0"),s.style.opacity="0",setTimeout(()=>{s.style.pointerEvents="none",ft("start_day")},500)},3e3)},500)}function sm(){at=100,R.current=30,Hs(R),Sl(),tr(),Z=Fi(at),ns=Math.max(1600,Math.max(...Z.map(s=>s.y))+400),ne.renderer.resize(Et,ot),je.removeChildren(),Vs.removeChildren(),Kt.splice(0,Kt.length),ie.splice(0,ie.length),zi(),Gi(),it(),re(R.current,!0),rr(),ce(R.current,!0),Zt.y=ut.position.y,Zt.x=0,js(),console.log("[Transition] Tutorial complete. Main board activated (levels 1-100, starting at 30).")}const im=[],qe=new Set,Ds=new Set;let Es=null;function Ol(){if(!Es||document.querySelector(".modal-backdrop"))return;const s=Es;Es=null,cr({level:R.current,game:s,completed:!1})}function ft(s){if(!bt(B.day))return!1;const t=B.day,e=[],i=Ds.has(s);i&&Ds.delete(s);const n=At(t);if(n&&n.popups&&n.popups[s]){const o=n.popups[s];(Array.isArray(o)?o:[o]).forEach(l=>{const c=`${t}:${s}:${l}`;if(i){e.push(l);return}qe.has(c)||(qe.add(c),e.push(l))})}return im.filter(o=>o.day===t&&o.phase===s).forEach(o=>e.push(o.html)),e.length===0?!1:e.length===1?(os("Info",e[0]),!0):(nm(e),!0)}function nm(s){W();let t=0;const e=document.createElement("div");e.className="modal-backdrop";const i=document.createElement("div");i.className="modal",i.setAttribute("role","dialog");const n=bt(B.day);n&&hr(),n?(i.classList.add("tutor-modal"),e.classList.add("tutor-backdrop"),e.classList.add("tutor-backdrop"),i.innerHTML=`<div class='tutor-stage'>
        <div class='tutor-portrait-wrap'>
          <img src='${Qn}' alt='Guide' class='tutor-character'/>
        </div>
        <div class='tutor-speech'>
          <div class='tutor-speech-arrow'></div>
          <div class='tutor-speech-inner'>
            <h2>Tutorial</h2>
            <div class='tutor-copy'></div>
            <div class='tutor-actions chain-actions'>
              <div class='progress-indicator'></div>
              <div class='nav-btns'>
                <button class='secondary prev-btn' type='button' style='display:none;'>Back</button>
                <button class='primary next-btn' type='button'>Next</button>
              </div>
            </div>
          </div>
        </div>
      </div>`):i.innerHTML=`<h2>Tutorial</h2>
      <div class='body multi-body'><div class='tutor-copy'></div></div>
      <div class='modal-footer' style='display:flex;justify-content:space-between;align-items:center;width:100%;'>
        <div class='progress-indicator' style='font-size:12px;font-weight:600;letter-spacing:.5px;opacity:.75;'></div>
        <div style='display:flex;gap:8px;'>
          <button class='secondary prev-btn' type='button' style='display:none;'>Back</button>
          <button class='primary next-btn' type='button'>Next</button>
        </div>
      </div>`,e.addEventListener("click",()=>{}),e.appendChild(i),document.body.appendChild(e),document.body.classList.add("modal-open");const r=i.querySelector(".tutor-copy"),o=i.querySelector(".next-btn"),a=i.querySelector(".prev-btn"),l=i.querySelector(".progress-indicator");function c(){if(r)r.innerHTML=s[t];else{const h=i.querySelector(".multi-body");h&&(h.innerHTML=s[t])}l&&(l.textContent=`Step ${t+1} / ${s.length}`),a&&(a.style.display=t>0?"inline-block":"none"),o&&(o.textContent=t===s.length-1?"Finish":"Next")}o==null||o.addEventListener("click",()=>{t<s.length-1?(t++,c()):W()}),a==null||a.addEventListener("click",()=>{t>0&&(t--,c())}),c()}let qs=!1;function ee(){if(Gs)return;const s=At(B.day),t=s&&s.reward.kind==="minigame"&&s.reward.minigame;if(!B.rollUsed||t&&!qs)return;if(Os&&!Xt&&!document.querySelector(".modal-backdrop")){et>=120&&(et-=120,Ys(),rs()),Xt=!0,Os=!1,gt()&&!Nt&&(Nt=!0,nr()),$i();return}if(kt>=5&&!Bt){Di();return}const e=document.querySelector(".dice-roll-btn");if(e&&e.parentElement&&e.style.display!=="none"){e.style.display="none";const i=e.parentElement;let n=i.querySelector(".inline-next-day-btn");n||(n=document.createElement("button"),n.type="button",n.className="inline-next-day-btn",n.textContent="Next Day",Object.assign(n.style,{width:"140px",height:"72px",background:"#ff9f43",border:"4px solid #ffcf9a",borderRadius:"18px",fontWeight:"800",fontSize:"18px",cursor:"pointer",color:"#111",boxShadow:"0 4px 10px rgba(0,0,0,0.45)"}),n.addEventListener("click",()=>{em()}),i.appendChild(n))}}const rm=Pe;Pe=function(){rm(),ee()};let Bt=!1;function Di(){if(Bt)return;Bt=!0,gt()&&(Lo++,fp(Lo));const s=document.querySelector(".prize-star-progress");s&&(s.classList.add("ps-progress-activating"),s.animate([{boxShadow:"0 0 0 0 rgba(255,159,67,0.0)"},{boxShadow:"0 0 14px 4px rgba(255,159,67,0.85)"},{boxShadow:"0 0 0 0 rgba(255,159,67,0.0)"}],{duration:1400,easing:"ease"})),setTimeout(()=>om(),600)}function om(){W();const s=document.createElement("div");s.className="modal-backdrop jackpot-backdrop",s.style.backdropFilter="blur(4px)";const t=document.createElement("div");t.className="modal jackpot-modal",t.style.maxWidth="640px",t.style.width="100%",t.innerHTML=`<h2 style='text-align:center;margin-bottom:8px;'>Prize Star Bonus Game</h2>
    <p style='text-align:center;margin:0 0 18px;font-size:14px;line-height:1.5;'>Scratch 3 panels to reveal your guaranteed big reward!</p>
    <div class='scratch-grid' style='display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin:0 auto 20px;max-width:420px;'></div>
    <div class='jackpot-result' style='text-align:center;font-weight:600;font-size:16px;min-height:32px;'></div>
    <div class='modal-footer' style='justify-content:center;'><button class='primary jackpot-close' type='button' disabled>Close</button></div>`;const e=t.querySelector(".scratch-grid"),i=t.querySelector(".jackpot-result"),n=t.querySelector(".jackpot-close"),o=[...[{kind:"freePlays",amount:10,label:"10 Free Plays"},{kind:"bonus",amount:1e3,label:"£10 Bonus Money"},{kind:"cash",amount:500,label:"£5 Cash"}]],a=9;let l=0,c=null;for(let h=0;h<a;h++){const d=document.createElement("button");d.type="button",d.className="scratch-panel",Object.assign(d.style,{position:"relative",height:"90px",background:"#222",border:"2px solid #555",borderRadius:"12px",cursor:"pointer",fontWeight:"700",color:"#ffcf9a",fontSize:"15px",letterSpacing:".5px",display:"flex",alignItems:"center",justifyContent:"center"}),d.textContent="SCRATCH",d.addEventListener("click",()=>{if(d.dataset.revealed!=="1"){if(d.dataset.revealed="1",l++,c)d.textContent=c.label;else if(l<=3){const f=o.shift();d.textContent=f.label,l===3&&(c=f,am(c,i,n))}else d.textContent="—";d.style.background="#333",d.style.borderColor="#ff9f43"}}),e.appendChild(d)}s.appendChild(t),document.body.appendChild(s),document.body.classList.add("modal-open"),n.addEventListener("click",()=>{if(!n.disabled){kt=0,Qt(),Ct(),Me.level<at&&(Me.level+=1,vl(),Oi());try{const h=document.querySelector(".prize-star-progress");h&&(h.classList.remove("ps-level-up"),h.offsetWidth,h.classList.add("ps-level-up"),setTimeout(()=>h.classList.remove("ps-level-up"),1800))}catch{}W(),ee()}})}function am(s,t,e){es(s),t.innerHTML=`<p><strong>Congrats!</strong> You won ${s.label}!</p>`,e.disabled=!1}function $i(){var o,a;if(dr(),document.querySelector(".modal-backdrop"))return;W();const s=document.createElement("div");s.className="modal-backdrop dual-choice-backdrop";const t=document.createElement("div");t.className="dual-choice-wrap",t.innerHTML=`
    <div class='dual-choice-header'>
      <h1>Milestone Unlocked!</h1>
      <p>You reached 120 Tokens. Choose ONE premium bonus game.</p>
    </div>
    <div class='dual-choice-inner'>
      <div class='choice left-choice' tabindex='0'>
        <div class='dual-choice-badges'><span class='dual-choice-badge'>Guaranteed Win</span><span class='dual-choice-badge'>High Value</span></div>
        <h2>Scratch Jackpot</h2>
        <p>Scratch 3 premium panels. One high-tier reward is yours—no duds.</p>
        <button type='button' class='primary play-left'>Play Scratch</button>
      </div>
      <div class='choice right-choice' tabindex='0'>
        <div class='dual-choice-badges'><span class='dual-choice-badge'>Tension Build</span><span class='dual-choice-badge'>Big Range</span></div>
        <h2>Mega Box Pick</h2>
        <p>Keep one box, eliminate the rest, then decide: stay or switch at the end.</p>
        <button type='button' class='primary play-right'>Play Mega Box</button>
      </div>
    </div>`,s.appendChild(t),document.body.appendChild(s),document.body.classList.add("modal-open");const e=()=>{W(),Dl()},i=()=>{W(),$l()};(o=t.querySelector(".play-left"))==null||o.addEventListener("click",e),(a=t.querySelector(".play-right"))==null||a.addEventListener("click",i);const n=t.querySelector(".left-choice"),r=t.querySelector(".right-choice");n&&n.addEventListener("keydown",l=>{const c=l.key||l.code;(c==="Enter"||c===" ")&&(l.preventDefault(),e())}),r&&r.addEventListener("keydown",l=>{const c=l.key||l.code;(c==="Enter"||c===" ")&&(l.preventDefault(),i())}),n==null||n.focus()}function dr(){let s=document.getElementById("dual-choice-styles");s||(s=document.createElement("style"),s.id="dual-choice-styles",document.head.appendChild(s)),s.textContent=`
  .dual-choice-backdrop{backdrop-filter:blur(6px);}
  .dual-choice-wrap{width:100%;max-width:1000px;display:flex;flex-direction:column;align-items:stretch;padding:28px 26px 34px;gap:26px;}
  .dual-choice-header{text-align:center;}
  .dual-choice-header h1{margin:0 0 8px;font-size:30px;background:linear-gradient(90deg,#ffb25b,#ff6d3b);-webkit-background-clip:text;color:transparent;letter-spacing:1px;font-weight:800;}
  .dual-choice-header p{margin:0;font-size:15px;opacity:.85;letter-spacing:.5px;}
  .dual-choice-inner{display:flex;gap:34px;flex-wrap:wrap;justify-content:center;width:100%;}
  .dual-choice-inner .choice{position:relative;flex:1 1 360px;max-width:440px;background:linear-gradient(155deg,#111b23,#0c1217 60%,#181f26);border:2px solid rgba(255,159,67,0.65);border-radius:26px;padding:26px 28px 28px;display:flex;flex-direction:column;gap:14px;box-shadow:0 18px 40px -14px rgba(0,0,0,0.75),0 0 0 1px rgba(255,159,67,0.15);overflow:hidden;}
  .dual-choice-inner .choice:before{content:'';position:absolute;inset:0;background:radial-gradient(circle at 28% 18%,rgba(255,159,67,0.18),transparent 60%);pointer-events:none;}
  .dual-choice-inner .choice h2{margin:0 0 4px;font-size:24px;letter-spacing:.5px;}
  .dual-choice-inner .choice p{margin:0 0 10px;font-size:15px;line-height:1.55;opacity:.9;}
  .dual-choice-inner .choice button{align-self:flex-start;transition:transform .18s ease,background .2s;}
  .dual-choice-inner .choice:hover{border-color:#ffbc6e;box-shadow:0 18px 42px -14px rgba(0,0,0,0.8),0 0 0 1px rgba(255,188,110,0.35);}
  .dual-choice-inner .choice:hover button{transform:translateY(-2px);}
  .dual-choice-badges{display:flex;gap:10px;flex-wrap:wrap;}
  .dual-choice-badge{background:#1f2d36;padding:4px 10px;border-radius:30px;font-size:11px;letter-spacing:.7px;font-weight:600;text-transform:uppercase;border:1px solid #314149;color:#ffb56a;}
  @media(max-width:760px){ .dual-choice-inner{flex-direction:column;} .dual-choice-header h1{font-size:24px;} }
  .special-scratch{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;max-width:420px;margin:0 auto 20px;}
  .special-scratch button{position:relative;height:90px;background:#222;border:2px solid #555;border-radius:14px;cursor:pointer;font-weight:700;color:#ffcf9a;font-size:15px;letter-spacing:.5px;display:flex;align-items:center;justify-content:center;transition:background .2s,border-color .2s,transform .18s;}
  .special-scratch button:not(.revealed):hover{background:#2b2b2b;transform:translateY(-3px);} 
  .special-scratch button.revealed{background:#333;border-color:#ff9f43;}
  .mega-box-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:12px;max-width:640px;margin:0 auto 16px;}
  .mega-box-grid button{height:86px;background:#1b2228;border:2px solid #3a4550;border-radius:12px;color:#fff;font-weight:600;cursor:pointer;letter-spacing:.5px;font-size:14px;position:relative;transition:background .18s,border-color .18s,transform .18s;}
  .mega-box-grid button:not(.opened):hover{background:#25323a;transform:translateY(-3px);} 
  .mega-box-grid button.kept{outline:3px solid #ff9f43;}
  .mega-box-grid button.eliminated{background:#101417;border-color:#222;color:#555;}
  .mega-box-grid button.final{animation:pulseFinal 1.4s ease-in-out infinite alternate;}
  @keyframes pulseFinal{0%{box-shadow:0 0 0 0 rgba(255,159,67,0.4);}100%{box-shadow:0 0 0 6px rgba(255,159,67,0.0);} }
  .mega-status{min-height:52px;text-align:center;font-size:15px;font-weight:600;letter-spacing:.5px;}
  .mega-decisions{display:flex;justify-content:center;gap:18px;margin:6px 0 10px;}
  .mega-decisions button{min-width:140px;}
  .mega-close-row{display:flex;justify-content:center;margin-top:8px;}
  .mega-close-row button{min-width:160px;}
  `}function Dl(){dr(),W();const s=document.createElement("div");s.className="modal-backdrop";const t=document.createElement("div");t.className="modal",t.style.maxWidth="680px",t.innerHTML=`<h2 style='text-align:center;margin:0 0 10px;'>Grand Scratch Bonus</h2>
    <p style='text-align:center;margin:0 0 16px;font-size:14px;'>Scratch any 3 panels. One of the displayed rewards will be yours!</p>
    <div class='special-scratch'></div>
    <div class='jackpot-result' style='text-align:center;font-weight:600;font-size:16px;min-height:34px;'></div>
    <div class='modal-footer' style='justify-content:center;'><button class='primary close-special' type='button' disabled>Close</button></div>`;const e=t.querySelector(".special-scratch"),i=t.querySelector(".jackpot-result"),n=t.querySelector(".close-special"),r=[{kind:"freePlays",amount:15,label:"15 Free Plays"},{kind:"bonus",amount:1500,label:"£15 Bonus Money"},{kind:"cash",amount:1e3,label:"£10 Cash"}];let o=0,a=null;for(let l=0;l<9;l++){const c=document.createElement("button");c.type="button",c.textContent="SCRATCH",c.addEventListener("click",()=>{if(!c.classList.contains("revealed"))if(o++,o<=3){const h=r[o-1];c.textContent=h.label,a=h,c.classList.add("revealed"),o===3&&a&&(es(a),i.innerHTML=`<p><strong>You won ${a.label}!</strong></p>`,n.disabled=!1)}else c.textContent="—",c.classList.add("revealed")}),e.appendChild(c)}s.appendChild(t),document.body.appendChild(s),document.body.classList.add("modal-open"),n.addEventListener("click",()=>{n.disabled||W()})}function $l(){dr(),W();const s=document.createElement("div");s.className="modal-backdrop";const t=document.createElement("div");t.className="modal",t.style.maxWidth="860px",t.innerHTML=`<button class='close-x' aria-label='Close' style='position:absolute;top:10px;right:10px;background:#222;border:1px solid #444;color:#fff;border-radius:50%;width:34px;height:34px;font-size:16px;cursor:pointer;'>&times;</button>
    <h2 style='text-align:center;margin:0 0 10px;'>Mega Box Pick</h2>
    <p style='text-align:center;margin:0 0 14px;font-size:14px;'>Pick a box to keep. Eliminate the rest. When only one other box remains, decide to <strong>Keep</strong> or <strong>Switch</strong>. The unchosen final box will always be Nothing.</p>
    <div class='mega-box-grid'></div>
    <div class='mega-status'></div>
    <div class='mega-decisions' style='display:none;'>
      <button type='button' class='primary keep-choice' disabled>Keep My Box</button>
      <button type='button' class='secondary switch-choice' disabled>Switch Boxes</button>
    </div>
    <div class='mega-close-row' style='display:none;'>
      <button type='button' class='primary close-mega'>Close</button>
    </div>`;const e=t.querySelector(".mega-box-grid"),i=t.querySelector(".mega-status"),n=t.querySelector(".keep-choice"),r=t.querySelector(".switch-choice"),o=t.querySelector(".mega-decisions"),a=t.querySelector(".mega-close-row"),l=t.querySelector(".close-x"),c=t.querySelector(".close-mega");l.addEventListener("click",W),c.addEventListener("click",W);const h=[{kind:"cash",amount:2e3,label:"£20 Cash"},{kind:"bonus",amount:2500,label:"£25 Bonus"},{kind:"freePlays",amount:20,label:"20 Free Plays"},{kind:"cash",amount:1e3,label:"£10 Cash"},{kind:"bonus",amount:1500,label:"£15 Bonus"},{kind:"freePlays",amount:10,label:"10 Free Plays"},{kind:"tokens",amount:200,label:"200 Tokens"},{kind:"bonus",amount:500,label:"£5 Bonus"},{kind:"cash",amount:500,label:"£5 Cash"},{kind:"freePlays",amount:5,label:"5 Free Plays"},{kind:"tokens",amount:100,label:"100 Tokens"},{kind:"bonus",amount:1e3,label:"£10 Bonus"}];for(let g=h.length-1;g>0;g--){const x=Math.floor(Math.random()*(g+1));[h[g],h[x]]=[h[x],h[g]]}const d=h.map((g,x)=>{const b=document.createElement("button");return b.type="button",b.textContent=String(x+1),e.appendChild(b),{idx:x,reward:g,el:b}});let f=null,u=null,m=!1;function y(g){i.innerHTML=`<p>${g}</p>`}y("Select a box to keep."),d.forEach(g=>{g.el.addEventListener("click",()=>{if(m)return;if(!f){f=g,g.kept=!0,g.el.classList.add("kept"),y("Now open every other box.");return}if(g===f||g.opened)return;g.opened=!0,g.el.classList.add("eliminated"),g.el.textContent=g.reward.label,g.el.classList.add("opened");const x=d.filter(b=>!b.opened&&b!==f);x.length===1&&(u=x[0],u.el.classList.add("final"),f.el.classList.add("final"),y("Final decision: Keep your box or Switch?"),o.style.display="flex",n.disabled=!1,r.disabled=!1,n.focus())})});function p(g,x){m||(m=!0,es(g.reward),g.el.textContent=g.reward.label+" (Won)",x.el.textContent="Nothing",x.el.classList.add("eliminated"),d.forEach(b=>b.el.classList.remove("kept")),g.el.classList.add("kept"),x.el.classList.remove("kept"),y(`<strong>You won ${g.reward.label}!</strong>`),o.style.display="none",a.style.display="flex",c.focus())}n.addEventListener("click",()=>{!f||!u||p(f,u)}),r.addEventListener("click",()=>{!f||!u||p(u,f)}),s.appendChild(t),document.body.appendChild(s),document.body.classList.add("modal-open")}function lm(s){if(!bt(B.day))return;const t=At(B.day);if(!t)return;const e=`tutorialRewardApplied_${t.day}`;window[e]||(cm(t),window[e]=!0,t.reward.kind==="minigame"&&t.reward.minigame&&(Es=t.reward.minigame,setTimeout(()=>{Ol()},450)))}function cm(s){const t=s.reward;switch(t.kind){case"tokens":t.amount&&is(t.amount);break;case"prize":{t.amount?Oe(t.amount):t.prizeId&&Oe(1);break}case"freePlays":t.amount&&Oe(t.amount);break;case"streak_boost":t.amount&&le(Math.min(5,t.amount));break;case"nothing":default:break;case"minigame":break}}export{Rc as $,za as A,dt as B,lt as C,H as D,E,aa as F,Pi as G,Er as H,Ue as I,ih as J,uh as K,$s as L,G as M,K as N,j as O,rt as P,Eh as Q,Mn as R,Qh as S,ri as T,Sn as U,Lr as V,Ki as W,Br as X,zc as Y,We as Z,Q as _,Rt as a,ia as a0,Ga as a1,z as a2,N as a3,Fh as a4,ld as a5,ed as a6,Md as a7,Pd as a8,Rd as a9,zd as aa,Gd as ab,Qa as ac,jr as ad,Yr as ae,bo as af,$t as ag,Du as ah,Y as ai,ke as aj,ic as ak,Ae as al,Po as am,el as an,Rs as b,yi as c,Nn as d,st as e,Vr as f,qh as g,Ba as h,pa as i,Ft as j,Ta as k,zs as l,Cd as m,Td as n,Ld as o,Fd as p,Un as q,yc as r,O as s,Aa as t,sc as u,Dd as v,V as w,St as x,ta as y,Lt as z};
